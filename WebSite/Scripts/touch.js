/*!
* Data Aquarium Framework - Touch UI
* Copyright 2008-2017 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function hc(){return g.appName||"Code On Time"}function e(n,t){var u,o=arguments.length;if(o==1&&(u=ec[n],u!==undefined))return u;for(var s=n.split(/\./g),e=s.length,r,i=g,f=0;f<e;f++)if(r=s[f],o==2)f==e-1?(i[r]=t,ec[n]=t):i=i[r]==null?i[r]={}:i[r];else{if(f==e-1)return u=i[r],ec[n]=u,u;if(i[r]!=null)i=i[r];else return null}}function ht(n){return e(n)!=!1}function cc(i){var e,u,r,f;if(tr.list.length&&(e=i.keyCode||i.which,u=tr.keyCodes.indexOf(e),u!=-1&&(r=tr.list[u],r.ctrlKey==i.ctrlKey&&r.altKey==i.altKey&&r.shiftKey==i.shiftKey)))return t.popup(":visible")?!1:(f=[],n.navContext(f),$(f).each(function(){var n=this;if(n.shortcut==r.shortcut)return vf(!0),setTimeout(function(){wi(n)},100),!1}),i.preventDefault(),i.stopPropagation(),!0)}function vf(n){var i=$(".ui-panel-open"),t;return i.length?(i.panel("close",n),!0):(t=$(".app-popup"),t.length?(t.popup("close",n),!0):void 0)}function lc(n){var t=n.text,i=n.shortcut;return i&&(t+=" ("+i+")"),t}function ps(n,t){r.AccountManager.avatar(n,t)}function yg(n){ge=pr(n)}function pg(n){var t=$(this),i;ge&&(i=pr(n),ge.y<i.y?(t[0].scrollHeight<t.height()||t.scrollTop()==0)&&n.preventDefault():ge.y>i.y&&(t[0].scrollHeight<t.height()||t.outerHeight()+t.scrollTop()>=t[0].scrollHeight)&&n.preventDefault(),ge=null)}function no(n,t){var i=n.is(".ui-panel-inner,.app-wrapper")?n:n.find(".ui-panel-inner"),r=i.closest(".app-popup,.ui-panel");if(gt)if(t)i.off("touchstart touchmove");else i.on("touchstart",yg).on("touchmove",pg);i.is(".ui-panel-inner")}function ac(){wt=!0;setTimeout(function(){wt=!1},250)}function wg(n){var t=f.navigate.history;f.navigate("#"+n);t.stack[t.activeIndex].pageUrl=n}function ws(n){n=n.split(/@/g);n=n[0];n=n.split(/\\/g);n=n[n.length>1?1:0];var t=n.replace(/\W/g," ").trim(),i,u="",r;for(t||(t=n),t=t.split(/\b/g),r=0;r<t.length;r++)if(i=t[r],i&&(i=i.trim()),i&&(u+=i.substring(0,1)),u.length==2)break;return u}function hu(n){var f=n[0],t,i,r=f.className,e=h.left.visible?h.left.width:0,u=h.left.visible?h.right.width:0;return r.match(/\b(app\-wrapper)\b/)?(t=n.closest(".ui-page")[0].className,i=t.match(/\b(app\-page\-modal|app\-has\-panel)\b/)&&t.indexOf("app-page-modal-never")==-1?v(n,"width"):p-e-u):i=r.match(/\b(app\-bar\-tools)\b/)?p-u:n.outerWidth(),i}function vy(){return p>=pt("md")&&nt>=pt("xs")||vc().length>0}function yy(){return p>420&&nt>=600}function vc(){return $(".app-page-modal-root")}function cu(){var t=l._toolbarHeight;return t||(t=l._toolbarHeight=n.toolbar().outerHeight()),t}function py(){return o&&($(document.activeElement).is(":input")||gi.height()<nt)}function yc(n){$(document).one("pagecanceled.app",function(t){t.namespace=="app"&&n()})}function ui(n){$(document).one("pageready.app",function(t){t.namespace=="app"&&n()})}function li(n){n&&typeof n=="function"&&ui(n);tt=!0;vs.go(-1)}function wy(n){var t=n?n.page.find(".app-page-header").filter(function(){return!$(this).is(".app-page-header-fixed")}):null;c.is(".app-page-header-hidden")||n&&n.headerText==!1?vi(!1,t):vi(n&&n.headerText||n&&n.dataView&&n.dataView.get_view().Label||document.title,t)}function bt(){}function by(t){var i=typeof t=="string";n.infoView(r.find(i?t:t.id),i)}function bg(n,t){n.Token&&r.userName()!=n.UserName?bh(n.UserName):k(t,function(){bh(n.UserName)})}function ky(){return l.location.pathname.match(/\/login$/i)}function lu(t,u){function h(){var r=Web.Membership&&Web.Membership._instance,i;if(r&&!r.get_displayLogin())l.location.href=__baseUrl+"login";else if(i=kr(),i.is(".app-acc-man-inactive")||i.is(".app-acc-man-splash")||i.appendTo(c).addClass("app-acc-man-inactive"),i.insertBefore($(".app-page-modal-background")),n.show({controller:"MyProfile",startCommand:"New",startArgument:"loginForm",showActionButtons:"Bottom",defaultValues:t}),i.length)$(document).one("pageready.app",function(){f.activePage.is(".app-page-modal")||kr().hide()})}var s=r.AccountManager.list(),a=location.href.match(/(\?|&)_accMan/),e=[],o;if(Web.Membership._instance._rememberMeSet&&(t||(t=[]),t.push({name:"RememberMe",value:!0})),!r.AccountManager.enabled()){h();return}for(o in s)o!="_lastUser"&&s[o].UserName&&e.push({text:o,callback:bg,context:s[o]});u&&(e.length||a)?a||e.length?(e.push({text:i.AddAccount,callback:h,icon:"material-icon-add"}),kr(e,"switch")):bh(e[0].context.UserName):h()}function dy(){function t(){lu(null,!0)}if(n._started)t();else{r.AccountManager.count()&&kr(null,"loading");$(document).one("start.app",t)}}function gy(){if(ht("splash.enabled")){if(sessionStorage){if(sessionStorage.spashShown)return;sessionStorage.spashShown=!0}var n=Math.max(1e3,e("splash.duration")||2500)-500;kr(null,"splash");setTimeout(function(){var n=kr();n.css("transition","opacity 500ms");setTimeout(function(){n.css("opacity",0);setTimeout(function(){n.remove()},525)})},n)}}function kg(){var i=l.location.href.match(/(\?|&)_accMan=(\w+)/),e=l.location.href.match(/\?ReturnUrl=(.+?)(#.+)?$/),c,o=r.loggedIn(),f;if(sessionStorage&&(c=sessionStorage.signedOut,sessionStorage.removeItem("signedOut")),!o&&r.AccountManager.enabled()||i){var y=r.userName(),s=r.AccountManager.list(),t=s._lastUser&&s[s._lastUser],a=!i&&t&&t.Token,u=i?i[2]:null,h=u=="loading"||u=="splash",v=u=="list";a||h?(h&&!t&&(t={UserName:"Test"}),f=[],u!="splash"&&(f.push({text:t.UserName,context:t}),f.push({text:st.Loading})),kr(f,u),h||r.switchUser(t,function(){var n=e&&decodeURIComponent(e[1])||__baseUrl;i||l.location.replace(n)},function(){n.busy(!1);dy()})):(v||e||c)&&!ky()?dy():o||gy()}else o||gy()}function kr(n,t){var u=$(".app-acc-man"),e,s,h,p;if(!arguments.length)return u;if(u.length)u.show().appendTo(c).removeClass("app-acc-man-inactive"),e=u.find("ul").empty();else{u=$('<div class="app-acc-man"><div class="app-acc-space"><\/div><\/div>').appendTo(c);var f=$('<div class="app-acc-inner"><\/div>').appendTo(u),l=$('<div class="app-logo"><\/div>').appendTo(f).html(hc()),a=$('<div class="app-acc-list"><\/div>').appendTo(f),v=$('<a class="app-acc-close"><i class="material-icon">close<\/i><\/a>').attr("title",gv.Close).prependTo(f),o=g.splash;if(o){s=o.background;h=o.logo;function y(n,t){t.match(/url\(/)?n.css("background",t):n.css("background-image","url("+t+")");n.css("text-indent","-9999px")}s&&y(u.find(".app-acc-space"),s);h&&y(l,h)}v.on("vclick",function(){k(v,function(){u.hide()})});e=$("<ul/>").appendTo(a).on("vclick","a",function(n){var t=$(n.target),u=t.closest("a"),f=u.data("context"),e;return t.is(".app-btn-more")?(e=f.context.UserName,k(t,function(){rt({anchor:t,items:[{text:e,user:e,keepOpen:!0,callback:bt},{},{text:i.Forget,icon:"material-icon-delete",callback:function(){r.AccountManager.remove(e,!0);u.remove()}}]})})):f.callback&&k(u,function(){f.callback(f.context,u)}),!1});p=$('<div class="app-acc-footer"><\/div>').appendTo(f).html($("#PageFooterBar,footer small").html());a.css({top:l.outerHeight(!0)+16,bottom:p.outerHeight(!0)})}t&&u.removeClass("app-acc-man-loading app-acc-man-switch").addClass("app-acc-man-"+t);$(n).each(function(){var t=this,s=$("<li/>").appendTo(e),n=$("<a/>").appendTo(s),h=$('<div class="app-user-name"><\/div>').text(t.text).appendTo(n),u=t.context,o,f;t.icon&&ft(t.icon,n);n.data("context",t);u&&(n.addClass("app-avatar"),f=u.UserName,h.text(f),f==r.userName()&&n.addClass("app-selected"),u.Email&&n.append($('<span class="app-user-email"><\/span>').text(u.Email)),u.Token||n.append($('<span class="app-user-signed-out"><\/span>').text(i.SignedOut)),o=$('<i class="app-icon-avatar">'+ws(f)+"<\/i>"),n.prepend(o),ps(f,o),t.callback&&$('<span class="app-icon material-icon app-btn-more"/>').appendTo(n).attr("title",i.More));t.callback||n.addClass("app-link-disabled")})}function np(n,t){n._syncKey=t;n._selectedKey=t}function dg(t){var i=t._controller;$(n._pages).each(function(){var r=this,n=r.dataView;n&&r.id!=t._id&&!n.get_isForm()&&n._syncKey==null&&(n._controller==i?n._syncKey=!0:$(n._fields).each(function(){if(this.ItemsDataController==i)return n._syncKey=!0,!1}))})}function tp(){return rs>=144}function au(n){n.type!="taphold"&&(ir=pr(n))}function ai(n){return ir&&ir.x||n}function yf(n){return ir&&ir.y||n}function ip(n){var t=n.find(".ui-popup-arrow-container");return n.outerHeight()+(t.length?t.height()/2:0)+5}function pf(n,t){if(n.multiSelect()){var i;t||(t=(et()==n._id?f.activePage:ho(n)).find(".app-listview .ui-btn.app-selected"),i=!0);t.is(".app-checked")||(n._selectedKeyList.length&&wl(n,i),dl(n,t))}}function rp(n){var t=f.activePage,i=v(t,"width"),r=v(t,"height"),u=v(n,"width"),e=v(n,"height");(i!=u||r!=e)&&pi(n)}function pc(n){return n.is(".app-page-modal-centered,.app-page-modal-fullscreen,.app-page-modal-fit-content,.app-page-modal-dock")}function bs(){return p>1200?80:p<500?40:50}function wc(n,t){var v=ri.stack,c,s,e,r,h,o,w=bs(),y=[],u=[],l,i,a;if(n||(n=f.activePage),n.is(".app-page-modal")){for(s="#"+n.attr("id"),r=v.length;r--;r>=0){if(l=v[r],u.length)if(s=l.hash,s){if(i=$(s),!i.length||!i.is(".app-page-modal"))break}else break;else l.hash==s&&(i=n);i&&(u.push(i),pc(i)&&(e=i))}for(e&&(r=u.indexOf(e),r<u.length-1&&(e=u[r+1])),r=0;r<u.length;r++){if(i=u[r],r>0)if(e)rp(i.addClass("app-page-modal-revealed"));else{if(t=u[r-1],c=p-t.offset().left+w,c>p*1.75)break;rp(i.addClass("app-page-modal-partial"));i.css("right",c);o||(o=i)}e&&(a=i.css("width")+","+i.css("height"),u.length>1&&(y.indexOf(a)==-1?(e!=i&&i.addClass("app-page-modal-centered"),y.push(a)):i.addClass("app-page-modal-obscured")));e==i&&(e=null)}h=$(".app-page-modal-glass-pane");h.length||(h=$('<div class="app-page-modal-glass-pane"><\/div>'));o&&u.indexOf(o)==1?h.addClass("app-page-modal-glass-pane-partial").css({right:o.css("right"),top:o.css("top"),height:o.css("height")}).insertAfter(o):h.css({right:0,top:"",height:""}).removeClass("app-page-modal-glass-pane-partial").insertBefore(u[0])}}function bc(t){var v,h,a;if(g){wt=!1;kt();tb(!1);fb();var i=t.toPageInfo||s(),e,y=t.options,c=y&&y.fromPage&&y.reverse;i&&i.initCallback&&(i.initCallback(),i.initCallback=null);n.busy(!1);var u=$(t.toPage),p=u.is(".app-page-modal"),l=u.is(".app-page-panel"),o=$(t.prevPage),b=o.is(".app-page-modal");if(tt||(i&&i&&(e=i.dataView,e&&e._syncKey&&(e._syncKey==!0?e.sync():e.sync(e._syncKey),e._syncKey=null)),u.find(".app-echo").each(function(){var t=$(this).attr("data-for"),n=r.find(t);n._syncKey&&(n._syncKey==!0?n.sync():n.sync(n._syncKey),n._syncKey=null)})),u&&o&&u.attr("id")==o.attr("id"))return!1;pi(l?o:u);l&&fo();l||(v=ri.stack,ri.activeIndex>1&&v[ri.activeIndex].hash==v[ri.activeIndex-1].hash&&v.splice(--ri.activeIndex,1),h=n._modalBackground,!b&&p?(o.addClass("app-page-modal-root"),h||(h=n._modalBackground=$('<div class="app-page-modal-background"><\/div>')),h.insertBefore(u).show()):b&&!p&&h&&h.hide(),$(".app-page-modal-partial").removeClass("app-page-modal-partial").css("right",""),$(".app-page-modal-revealed,.app-page-modal-centered,.app-page-modal-obscured").removeClass("app-page-modal-revealed app-page-modal-centered app-page-modal-obscured"),p?wc(u,o,c):(u.removeClass("app-page-modal-root"),$(".app-page-modal-glass-pane").remove()));l&&wy(i);a=i&&i.scrollable||w(u);ur(a.find(".app-listview"));wu(a);nu(u);hr(a);so(a);th();sr&&!oc&&n._toolbar.css("visibility",et()=="Main"||f.activePage&&f.activePage.is(".app-page-modal")?"hidden":"");yr(i?i.page:null);c=ri.activeIndex<ri.previousIndex;!l&&vo()=="slide"&&o?gg(o,u,c,function(){up(i,c)}):up(i,c)}}function up(t,i){var s=t?t.scrollable:null,f=$.Event("pageready.app"),u,r,e;t&&(f.dataView=t.dataView);ae(100);n.busy(!1);$(document).trigger(f);df(t?t.dataView:null);lt(!1,0);er(null,null,t?t.scrollable.find(".app-echo"):null);o||setTimeout(function(){$(document.activeElement).closest("[data-control]").length||cr(s)});n.garbageCollector();i&&(u=ri.stack[ri.activeIndex+1],r=u&&u.hash,r&&r.match(/^#/)&&(e=n.pageInfo(r.substring(1)),e&&$(r).trigger("pagecanceled.app")))}function gg(t,i,r,u){function it(){c--;c==0&&(w&&w(),c==0&&(u(),wt=!1))}function rt(n,t){n.is(":visible")&&(c++,n.one("transitionend",it).css(t))}function s(n){wt=!0;w=n.done;n.position();setTimeout(function(){n.transition();setTimeout(function(){$(n.run).each(function(){var n=this,i={};for(var t in n)t!="element"&&(i[t]=n[t]);rt(n.element,i)})},16)},16)}var nt=t.is(".app-page-modal"),g=i.is(".app-page-modal"),tt,a,y,e,h,f=n._backText,w,c=0,b,k,o,d;n.busy(!0);lt(!0);nt?g?(tt=t.is(".app-page-modal-partial"),a=pc(t),y=pc(i),r?a||y?s({position:function(){t.addClass("app-page-revealed").css({opacity:1})},transition:function(){t.addClass("app-transition-fade-out")},run:[{element:t,opacity:0}],done:function(){t.removeClass("app-transition-fade-out app-page-revealed").css({opacity:""})}}):(e=$(".app-page-modal-partial").add(i),h=v(i,"width")+bs(),b=v(t,"left")+h,s({position:function(){t.css("left",b).addClass("app-page-revealed");t.css({transform:"translate3d("+-h+"px,0,0)"});e.css({transform:"translate3d("+-h+"px,0,0)"})},transition:function(){e.addClass("app-transition-slide");t.addClass("app-transition-slide")},run:[{element:t,transform:"translate3d("+(p-b+bs())+"px,0,0)"},{element:e,transform:""}],done:function(){e.removeClass("app-transition-slide").css({transform:"",transition:""});t.removeClass("app-transition-slide app-page-revealed").css({left:"",transform:"",transition:""})}})):y||a?(k=t.is(".app-page-modal-obscured"),s({position:function(){k&&t.toggleClass("app-page-modal-obscured app-page-modal-centered");i.css({opacity:0})},transition:function(){i.addClass("app-transition-fade-in")},run:[{element:i,opacity:""}],done:function(){i.removeClass("app-transition-fade-in");k&&t.toggleClass("app-page-modal-obscured app-page-modal-centered")}})):(e=$(".app-page-modal-partial").add(i),s({position:function(){h=v(i,"width")+bs();e.css({transform:"translate3d("+h+"px,0,0)"});e=$(e.get().reverse())},transition:function(){e.addClass("app-transition-slide")},run:[{element:e,transform:""}],done:function(){e.removeClass("app-transition-slide").css({transform:"",transition:""})}}))):(o=n._modalBackground,s({position:function(){o.show().css({opacity:1});t.addClass("app-page-revealed").css({opacity:1})},transition:function(){t.addClass("app-transition-fade-out");o.addClass("app-transition-fade-out")},run:[{element:t,opacity:0},{element:o,opacity:0}],done:function(){t.removeClass("app-transition-fade-out app-page-revealed").css({opacity:""});o.hide().removeClass("app-transition-fade-out").css({opacity:""})}})):g?(o=n._modalBackground,s({position:function(){i.css({opacity:0});o.css({opacity:0})},transition:function(){i.addClass("app-transition-fade-in");o.addClass("app-transition-fade-in")},run:[{element:i,opacity:""},{element:o,opacity:""}],done:function(){i.removeClass("app-transition-fade-in");o.removeClass("app-transition-fade-in")}})):t.length?t.is("#Main")&&!l.location.hash?u():(d=v(i,"width"),d>pt("md")?r?s({position:function(){i.addClass("app-transition-slide-background");t.addClass("app-page-revealed").css({transform:"translate3d(0,0,0)","z-index":2,opacity:1});f.css({transform:"translate3d(-"+v(f,"width")+"px,0,0)",opacity:0})},transition:function(){t.addClass("app-transition-slide-peel-out");f.addClass("app-transition-slide-and-reveal")},run:[{element:t,transform:"translate3d(200px,0,0)",opacity:0},{element:f,transform:"",opacity:""}],done:function(){i.removeClass("app-transition-slide-background");t.removeClass("app-transition-slide-peel-out app-page-revealed").css({transform:"","z-index":"",opacity:""});f.removeClass("app-transition-slide-and-reveal")}}):s({position:function(){i.css({transform:"translate3d(200px,0,0)"});t.addClass("app-transition-slide-background app-page-revealed");f.css({transform:"translate3d("+v(f,"width")+"px,0,0)",opacity:0})},transition:function(){i.addClass("app-transition-slide-peel-in");f.addClass("app-transition-slide-and-reveal")},run:[{element:i,transform:""},{element:f,transform:"",opacity:""}],done:function(){t.removeClass("app-transition-slide-background app-page-revealed");i.removeClass("app-transition-slide-peel-in").css({transform:"",transition:"","z-index":""});f.removeClass("app-transition-slide-and-reveal").css({transform:"",opacity:""})}}):s({position:function(){i.css({transform:"translate3d("+(r?-1:1)*d+"px,0,0)"});t.addClass("app-page-revealed");f.css({transform:"translate3d("+(r?-1:1)*v(f,"width")+"px,0,0)",opacity:0})},transition:function(){i.addClass("app-transition-slide");t.addClass("app-transition-slide");f.addClass("app-transition-slide-and-reveal")},run:[{element:i,transform:""},{element:t,transform:"translate3d("+(r?1:-1)*v(t,"width")+"px,0,0)"},{element:f,transform:"",opacity:""}],done:function(){t.removeClass("app-transition-slide app-page-revealed").css({transform:""});i.removeClass("app-transition-slide").css({transform:"",transition:""});f.removeClass("app-transition-slide-and-reveal").css({transform:"",opacity:""})}})):u()}function fp(n,t){function u(t){if(!h){var r=[];$(n.get_actions("Custom")).each(function(){var t=this;n._isActionMatched(t,!0)&&r.push(t)});r.length&&(t&&i.push('<div data-container="collapsible" data-wrap="false" data-header-text="none">'),i.push('<div data-container="row">'),$(r).each(function(){i.push('<span data-control="action" data-action="'+this.Path+'"><span class="app-control-inner"/><\/span>')}),i.push("<\/div>"),t&&i.push("<\/div>"));h=!0}}var l=n.get_view(),e,i,f=[],o={},s,h,c=[];return $(n._expressions).each(function(){var n=this;n.Scope==2&&c.push(n.Target)}),$(n._categories).each(function(n){var u=this,i=u.Wizard,e=n==0||u.Flow=="NewRow",r,t;i?s:i=s?"_after_":"_before_";t=o[i];t||(t={text:i,rows:[]},o[i]=t,f.push(t),e=!0);e?(r={categories:[]},t.rows.push(r)):r=t.rows[t.rows.length-1];r.categories.push(u)}),$(f).each(function(){var t=this;$(t.rows).each(function(){var t=this,i=[],r={},u={};$(t.categories).each(function(){var n=this,e=n.Tab,t=r["t_"+e],f,o={id:n.Id,headerText:n.HeaderText,desc:n.Description,collapsed:n.Collapsed,fields:[],floating:n.Floating,wrap:n.Wrap,dataViewCount:0};t?n.Flow=="NewColumn"?(f={categories:[]},t.columns.push(f)):f=t.columns[t.columns.length-1]:(f={categories:[]},t={text:n.Tab,columns:[f]},r["t_"+e]=t,i.push(t));u[n.Index]=o;f.categories.push(o)});$(n._fields).each(function(){var n=this,t=u[n.CategoryIndex];t&&(t.fields.push(n),n.Type=="DataView"&&t.dataViewCount++)});t.tabList=i})}),i=['<div data-layout="form" data-layout-size="'+wf(t)+'">'],$(f).each(function(){var f=this,o=f.text,s=!o.match(/^\_(before|after)\_$/);s&&(i.push('<div data-container="wizard" data-wizard-step="'+r.htmlAttributeEncode(o)+'">'),u(!0));$(f.rows).each(function(){var s=this,o=s.tabList,f=o.length>1;f&&u(!0);f&&i.push('<div data-container="tabset">');$(o).each(function(){var s=this,h=s.columns,o=s.columns.length>1;f&&i.push('<div data-container="tab" data-tab-text="'+r.htmlAttributeEncode(s.text)+'">');$(h).each(function(){var r=this,s=100/h.length-1,l=o?t*s/100:t;o&&l<=pt("tn")&&(o=!1);o&&(u(!0),i.push('<div data-container="column" style="width:'+s+'%">'));$(r.categories).each(function(){var h=this,w=h.desc,v=f&&r.categories.length==1&&h.dataViewCount==h.fields.length,b=w&&w.replace(/\{([\w+\_]+)\}/g,'<span data-control="field" data-field="$1" data-read-only="true"><span class="app-control-inner">&#160;<\/span><\/span>'),k=b&&n._formatViewText(kv.DefaultCategoryDescriptions[b],!0,b),y=h.wrap==!0||(o?l:t)<=pt("xs");v||i.push('<div data-container="collapsible" data-wrap="'+(y?"true":"false")+'" data-header-text="'+(h.headerText||"none")+'"'+(h.collapsed?'data-collapsed="true" ':"")+(c.indexOf(h.id)!=-1?' data-visibility="c:'+h.id+'"':"")+">");u();w&&(v||i.push('<div data-container="row">'),i.push('<div data-control="description"><span class="app-control-inner">'+k+"<\/span><\/div>"),v||i.push("<\/div>"));var p=[],a=[],s=1;$(h.fields).each(function(){var n=this;n.Type=="DataView"?(a.length&&p.push(a),p.push([n]),a=[]):a.push(n)});!o&&h.floating&&(h.wrap?(pt("sm")<=t&&(s=2),pt("md")<=t&&(s=3),pt("lg")<=t&&(s=4)):(pt("md")<=t&&(s=2),pt("xl")<=t&&(s=3)),s=Math.min(s,h.fields.length));a.length&&p.push(a);$(p).each(function(){for(var t,u,n,h=this,a=h.length,c=Math.ceil(a/s),f=0;f<c;f++){for(v?i.push('<div data-container="simple"'):i.push('<div data-container="row"'+(s>1?' data-columns="'+s+'"':"")),t=[],u=0;u<s;u++)if(n=h[f+u*c],n){var l=n.Type=="DataView",r=n.Name,o=' data-visibility="f:'+r+'"';s==1&&i.push(o);y&&s>1&&t.push('<span class="app-field-group">');l||y&&(!n.HeaderText||n.HeaderText=="&nbsp;")||t.push('<span data-control="label" data-field="'+r+'"'+(s>1?o:"")+'><span class="app-control-inner">'+r+"<\/span><\/span>");t.push('<span data-control="'+(l?"dataview":"field")+'" data-field="'+r+'"'+(s>1?o:"")+'><span class="app-control-inner">['+r+"]<\/span><\/span>");y&&s>1&&t.push("<\/span>");e||(e=n)}i.push(">");$(t).each(function(){i.push(this)});i.push("<\/div>")}});v||i.push("<\/div>")});o&&i.push("<\/div>")});f&&i.push("<\/div>")});f&&i.push("<\/div>")});s&&i.push("<\/div>")}),i.push("<\/div>"),i=i.join("\n")}function wf(n){return n>=1366?"xxl":n>=1200?"xl":n>=992?"lg":n>=768?"md":n>=576?"sm":n>=480?"xs":n>=320?"xxs":"tn"}function nn(n){var t=be.indexOf(n);return t==-1?p:pt(be[Math.min(be.length-1,t+1)])-1}function pt(n){switch(n){case"tn":return 280;case"xxs":return 320;case"xs":return 480;case"sm":return 576;case"md":return 768;case"lg":return 992;case"xl":return 1200;case"xxl":return 1366;default:return p}}function tn(n,t){var h=wf(t),c=n._controller+"_"+n._viewId+"_"+n._filterFields+"_layout_"+h+(vy(n)?"_m":""),f=r.cache[c],e=n.survey(),u,i,o,s,l,a;return f||(u=n.get_view().Layout,u&&(o=$("<div>"+u+"<\/div>"),s=o.find("[data-layout]"),s.length?(a=be.indexOf(h),s.each(function(){var t=$(this),r=t.attr("data-layout-size")||"tn",n=be.indexOf(r);n!=-1&&n<=a&&(!i||n>l)&&(i=t,l=n)})):(i=$('<div data-layout="form"><\/div>'),$(o.html()).appendTo(i))),i?(i.find("[data-control]").each(function(){var n=$(this),t=n.contents().remove();t.appendTo($('<span class="app-control-inner"/>').appendTo(n))}),u=$("<div><\/div>").append(i.clone()).html()):u=fp(n,t),f={html:u},e&&(e.dynamic||!e.cache)||(r.cache[c]=f)),i=$(f.html),i.attr("data-input-container",n._id),n._isWizard=i.find('[data-container="wizard"]').length>0,i}function rn(n,i,r){function s(n,t,i){if(n.getAttribute){var v=n.getAttribute("data-control"),l=!v&&n.getAttribute("data-container"),a,y=n.childNodes,o,p,r;for(v&&t?(f.push(n),o=$(n),p=o.offset(),r={self:o,parent:i,type:v,children:[]},c.push(r),i.children.push(r),o.data("node",r)):l&&(u.push(n),o=$(n),r={self:o,children:[],type:l},o.data("node",r),h.push(r),t?(r.parent=i,i.children.push(r)):e.push(r)),a=0;a<y.length;a++)s(y[a],l?n:t,l?r:i,null)}}var a=n._allFields,v=n.get_viewType()=="Form",y=r.offset(),u=[],h=[],f=[],c=[],e=[],p=w(r),l=n.extension(),o=l.editing();r.data("prepared",!0);r.find("[data-visible-when]").each(function(t){var i=$(this),r=n._expressions,e=i.attr("data-visible-when"),u=i.parent().is('[data-container="wizard"]'),f={Scope:u?2:7,Target:t,Test:e,Type:1,ViewId:n._viewId};r||(r=n._expressions=[]);r.push(f);i.attr({"data-visible-when":null,"data-visibility":(u?"c:":"v:")+f.Target})});t.evaluate({dataView:n,row:i,container:r,ignoreDynamicButtons:!0});s(r[0]);u=$(u);f=$(f);r.data("rootNodes",e).attr("data-state",o?"write":"read");ep(n,i,o,e)}function ep(i,r,u,f){$(f).each(function(f){var e=this,s=e.self,h,c,v,l,a;!e.ready&&s.is(":visible")&&(e.ready=!0,e.type=="tabset"?(h=[],$(e.children).each(function(){var n=this;n.type=="tab"&&h.push({text:n.self.attr("data-tab-text"),content:n.self,context:n})}),h.length&&(e.tabs=h,n.tabs("create",{id:i._id+"_tabset_"+f,tabs:h,className:"app-tabs-layout",scope:i.get_selectedKey(),change:function(n){to({dataView:i,row:r,controls:n.context.children});ki(null,n.content);i.editing()&&!o&&t.focus({container:n.content})}}),$(h).each(function(){var n=this;if(n.active)return to({dataView:i,row:r,editing:u,controls:n.context.children}),!1}))):(e.type=="collapsible"&&(c=s.attr("data-header-text"),c&&c!="none"&&(v=s.contents(),l=$('<div data-container="toggle" class="app-feedback"><\/div>'),a=$('<div data-container="simple"><\/div>)'),v.appendTo(a),$('<span class="app-collapsible-toggle-text"/>').appendTo(l).text(c),$('<span class="app-collapsible-toggle-button"/>').appendTo(l),l.appendTo(s),a.appendTo(s),s.attr("data-collapsed")=="true"&&s.addClass("app-container-collapsed"))),op(i,r,u,e.children)))})}function op(n,i,u,f){$(f).each(function(){var y=this,o=y.self,a,v,l,f,p,tt,rt,k,et,st,ut;if(y.children.length)ep(n,i,u,[y]);else{if(y.ready||!o.is(":visible"))return;if(y.ready=!0,l=o.attr("data-field"),a=y.type,l){if(v=o.find(".app-control-inner"),f=n.findField(l),f)if(f.AllowNulls||o.attr("data-required",!0),a=="label"||a=="header")f=n._allFields[f.AliasIndex],p=f.HeaderText,v.html(p),p&&p!="&nbsp;"||o.attr("data-required",null);else if(a=="footer")tt=f.FooterText,tt?v.html(tt):o.addClass("app-hidden");else if(o.addClass("app-field-"+f.Name),a=="dataview"){if(f.Type=="DataView"&&f.DataViewController)if(n.extension().inserting())o.hide(),o.parent().is('[data-container="row"]')&&o.parent().hide();else{var d=n.get_parentDataView(n),l=f.Name,h=n._id+"_"+l,c,ot=0,g,p=f.HeaderText,it=f.DataViewFilterFields,e,ft=i[f.Index],b,nt;for(b=n._dataViewFields,b||(b=n._dataViewFields={}),b[l]?h+=b[l]++:b[l]=1,c=r.find(h);c&&c._dataViewFieldParentId!=d._id;)h=d._id+"_"+l+ot++,c=r.find(h);y.echoSelector="#"+n._id+" #"+h+"_echo";o.empty().attr("id",h+"_ph");c?c._startPage=ft:(e={id:h,controller:f.DataViewController,viewId:f.DataViewId,filterFields:f.DataViewFilterFields,baseUrl:__baseUrl,servicePath:__servicePath,showSearchBar:!0,autoHide:it?2:null,tag:f.Tag},e.startPage=ft,it&&(e.filterSource=f.DataViewFilterSource?n.findField(it)._dataViewId:n._id),e.showInSummary=!!f.DataViewShowInSummary,f.DataViewPageSize&&(e.pageSize=f.DataViewPageSize),e.selectionMode=!f.DataViewMultiSelect?"Single":"Multiple",f.DataViewShowActionButtons&&(e.showActionButtons=f.DataViewShowActionButtons),e.showActionBar=f.DataViewShowActionBar!=!1,e.showDescription=f.DataViewShowDescription!=!1,e.showViewSelector=f.DataViewShowViewSelector!=!1,e.showSearchBar=f.DataViewShowSearchBar!=!1,e.showQuickFind=f.DataViewShowQuickFind!=!1,e.showRowNumber=!!f.DataViewShowRowNumber,f.DataViewShowPager&&(e.showPager=f.DataViewShowPager),e.showPageSize=f.DataViewShowPageSize!=!1,e.showModalForms=!!f.DataViewShowModalForms,e.searchOnStart=!!f.DataViewSearchOnStart,e.autoSelectFirstRow=!!f.DataViewAutoSelectFirstRow,e.autoHighlightFirstRow=!!f.DataViewAutoHighlightFirstRow,c=$create(Web.DataView,e,null,null,$("<p>")[0]),c._dataViewFieldName=l,f._dataViewId=h,c._dataViewFieldParentId=d._id,c._filterSourceSelected(d),g=s(h),g.text=p,g.headerText=p,g.activator.text=p);rt=w(o);nt=rt.find('[data-for="'+h+'"]');nt.length||(nt=ua(h,rt).addClass("app-echo-embedded"));nt.width(o.width());c.get_startPage()&&(c._loadPage(),vr(h+"_echo"))}}else a=="field"&&(f.ToolTip&&o.attr("title",f.ToolTip),t.render({container:o,inner:v,dataView:n,field:f,row:i,editing:u}))}else a=="description"?o.closest("[data-container]").addClass("app-has-description"):a=="action"&&(v=o.find(".app-control-inner"),k=n.findAction(o.attr("data-action")),k?(st=k&&n._isActionAvailable(k),et=$('<span class="app-action-column-button"/>').appendTo(v.empty().addClass("app-action-column")).text(k.HeaderText),ut=k.Description,ut&&et.attr("title",ut)):v.text("("+v.text()+")"))}})}function sp(n,i,r,u){$(u).each(function(){var u=this,f=u.self,e;if(!u.ready)return!1;u.children.length?sp(n,i,r,u.children):u.ready&&u.dirty&&f.is(":visible")&&(e=t.elementToField(f),t.render({container:f,dataView:n,field:e,editing:r,row:i}),u.dirty=!1)})}function to(n){var t=n.dataView,u=n.row,f=n.editing,i=n.controls;i&&i.length&&(t||(t=r.find($(i[0].self).closest("[data-input-container]").attr("data-input-container"))),u||(u=t.editRow()),f==null&&(f=t.editing()),op(t,u,f,i),sp(t,u,f,i))}function hr(n,t){if(t){clearTimeout(l._syncEmbeddedViewsTimeout);l._syncEmbeddedViewsTimeout=setTimeout(function(){hr(n)});return}n||(n=w());var r=[],u=kf(n),e=n.offset(),i,f;n.find('[data-control="dataview"]').each(function(){var t=$(this),u=t.data("node"),n=$(u.echoSelector),i=v(n,"height")+v(n,"margin-top")+v(n,"margin-bottom")+v(n,"padding-top")+v(n,"padding-bottom");n.length&&i&&(i!=v(t,"height")&&t.height(i),r.push({p:t,e:n}))});$(r).each(function(){var t=this,o=t.p,r,s=o.width();s?(i==null&&(i=n.scrollTop(),f=u.length?u.offset().left:0),r=o.offset(),t.e.css({visibility:"",left:r.left-f,top:r.top+i-e.top,width:s})):t.e.css("visibility","hidden")});wu(n)}function un(n,t){for(var i=t.parent().hide().next();i.length&&!i.is(":visible");)i=i.show().next()}function io(){return $(this).is(":visible")}function ks(){return $("<style/>").appendTo($("head"))}function kc(n){return n._enumerateExpressions(Web.DynamicExpressionType.Any,Web.DynamicExpressionScope.ViewRowStyle,n.get_viewId())}function bf(n,t,i,r){var f,u;r||(r=kc(n));r&&r.length&&(f=n._evaluateJavaScriptExpressions(r,t,!0),i&&(u=[],$(r).each(function(){var n=this;n.Scope==1&&u.push(n.Result)}),u=u.join(" "),i.removeClass(u),f&&i.addClass(f)))}function ds(n){var t=n.pageProp("frozenField");return!t&&n._hasKey()&&(t="_first_"),t||"_none_"}function gs(n){return n||(n=f.activePage),n.find(".dv-heading")}function hp(n){gs(n).remove()}function dc(n){var t=n.replace(/\.\w+$/,"").replace(/\W/g,"_").toLowerCase()||"page";return t.match(/^\_/)&&(t=t.substring(1)),t}function ro(){var n=p,t=nt;return n<480&&t<640||t<480&&n<640}function cp(n){s(typeof n=="string"?n:n._id).echoChanged=!0}function lp(){var n=480;return h.left.visibile&&(n+=193),h.right.visible&&(n+=193),p>=n}function ap(n,t){var u=t&&t._controller?t:r.find(kf(t).attr("id")),i;return u&&$(u._panels).each(function(){var t=this;return t.location==n&&$(t.pages).each(function(){var n=this;if(n.is(".app-page-panel-active"))return i=n,!1}),i?!1:void 0}),i}function w(n){return n?typeof n=="string"?(n.match(/^\w/)&&(n="#"+n),$(n).find(".app-wrapper")):n.length&&n[0].className.indexOf("ui-page")!=-1?n.find(".app-wrapper"):n.closest(".app-wrapper"):f.activePage?f.activePage.find(".app-wrapper"):$()}function kf(n){return n?n.closest(".ui-page"):f.activePage}function fn(){var n=w(),t=n.find(".app-toolbar-stub");t.length&&(rr(n,n.data("restore-scroll-top")),t.remove())}function ei(n){return $(n).closest(".app-echo")}function cr(n){var i=document.activeElement,t=$(i).closest(".app-wrapper"),n=w(n);n.length&&(!t.length||t[0]!==n[0])&&n.focus()}function gc(){var n=l.location.href,t=n.indexOf("#");t>=0&&(n=n.substr(0,t));l.location.reload(n)}function uo(){if(!af){var n=e("ui.displayDensity.value");af=16;n=="Compact"?af==14:(n=="Condensed"||n=="Tiny")&&(af=12)}return af}function en(t){var i=$(this),u,f=i.is(".app-bar-toolbar")?8:4,r=ai(t.clientX),e=yf(t.clientY);return i.find(".ui-btn-icon-notext").each(function(){var t=$(this),i,u,f;if(t.is(":visible")&&(t.is(".ui-icon-bars")?(i=0,u=v(n._backText,"left")):(i=t.offset().left,u=i+t.outerWidth()+8,i-=8),i<=r&&r<=u))return setTimeout(function(){t.trigger("vclick")}),f=!0,!1}),u}function rr(n,t){function r(){n.removeData("scrolling enableScrollEventsTimeout");lr(n)}n.data("scrolling",!0);n.scrollTop(t);var i=n.data("enableScrollEventsTimeout");i!=null&&clearTimeout(i);n.data("enableScrollEventsTimeout",setTimeout(r,300))}function vu(t,i){i||(i=ho(t));i.length&&i.find(".app-echo-toolbar .app-echo-controls").addClass("app-stale");var r=et();clearTimeout(l._refreshEchoToolbar);l._refreshEchoToolbar=setTimeout(function(){r!=et()||n.busy()||tt||er()},500)}function vp(n){return!n&&ro()?g.pageTransition!="none"?"slideup":"none":o?"fade":"none"}function nh(n){return n&&typeof n=="string"&&n.match(/^(material\-icon|glyphicons|glyphicon|fa|ion)\-.+/)}function ft(n,t){var i=n.match(/^(material\-icon|glyphicons|glyphicon|fa|ion)\-(.+)/),r,u;return i?(r=i[1],u=r=="material-icon",$('<i class="app-icon '+r+" "+i[0]+'" aria-hidden="true">'+(u?i[2].replace(/\-/g,"_"):"")+"<\/i>").appendTo(t.addClass("app-has-icon app-has-"+r))):null}function yp(){return $(".ui-panel-open .ui-btn.app-animated")}function nl(){return $(".ui-popup-active .ui-btn.app-animated")}function pp(n){fr("show",n.dataViewId)}function wp(n){$(n).find(".app-signature").each(function(){r.upload("resize",{container:this})})}function bp(n){var t=n.find(".Current"),i,r;t.length&&(r=n.offset(),i=t.offset(),n.scrollLeft(i.left-r.left-t.outerWidth(!0)/2))}function dr(n,i){function c(n){var t,i=u.steps[n];return i.isDynamic&&(t=!0,$(u.containers[n]).children().each(function(){var n=this;if(n.style.display!="none")return t=!1,!1})),!t}function l(n,t){for(t==null&&(t=u.active),t+=n;t>=0&&t<u.steps.length;)if(c(t))break;else t+=n;return t}function d(n){$(u.steps).each(function(t){var i=this;i.text==n&&c(t)&&(u.active=t,y())})}function a(n,t){var t=l(n,t);return t>=0&&t<u.steps.length}function v(){dt();u.containers.removeClass("app-wizard-active");var n=u.active,t;n!=-1&&(t=$(u.containers[n]).addClass("app-wizard-active"),to({controls:t.data("node").children}),ki())}function y(){v();p();o||t.focus({container:$(u.containers[u.active])})}function p(){var n=s.closest(".ui-content"),t,i;n.length||(n=s.find(".ui-content"));t=n.find('[data-action-path="wizard-next"]');i=n.find('[data-action-path="wizard-prev"]');t.toggleClass("app-btn-disabled",!a(1));i.toggleClass("app-btn-disabled",!a(-1));k()}function k(){var o=e.closest(".ui-page"),t=o.find(".app-status-bar"),n,i,f,s;t.length&&(n=r.find(o.attr("id")),n._statusBarAuto&&(i=[n._controller+"."+n._viewId+"._wizard:"+u.active+"\n"],$(u.steps).each(function(n){var r=this,t,f=r.text;r.isDynamic&&(t=!0,$(u.containers[n]).children().each(function(){if(this.style.display!="none")return t=!1,!1}));t||i.push((n==u.active?"["+f+"]":f)+" >")}),n._statusBarAuto=i.join("")),t.html(n.statusBar()),f=t.find("li.Segment"),s=f.length+10,f.each(function(n){this.style.zIndex=s-n}),bp(t))}var s,e,u,w,b,h;if(i||(i={}),s=i.container||f.activePage,e=i.layout||s,e.is("[data-layout]")||(e=e.find("[data-layout]"),!e.length&&s&&(e=s.closest("[data-layout]"))),u=e.data("wizard-config"),u||(u={steps:[],active:0},u.containers=e.find('[data-container="wizard"]').each(function(){var n=$(this),t={text:n.attr("data-wizard-step"),isDynamic:n.find("> [data-visibility]").length>0};u.steps.push(t)}),e.data("wizard-config",u)),u.steps.length)switch(n){case"start":u.active=a(1,-1)?0:-1;v();k();break;case"status":p();break;case"select":d(i.text);break;case"next":w=l(1);w!=-1&&(u.active=w,y());break;case"prev":b=l(-1);b!=-1&&(u.active=b,y());break;case"visible":if(i.step)return i.step.is(".app-wizard-active")?!0:(h=i.step.prevAll('[data-container="wizard"]').length,c(h));break;case"show":i.step&&!i.step.is(".app-wizard-active")&&(h=i.step.prevAll('[data-container="wizard"]').length,h!=u.active&&c(h)&&(u.active=h,v(),p()))}}function df(t,i){var w,k,g;if(e("ui.actions.promote")&&(t||(t=n.dataView()),t&&t._panelContainer&&(t=r.find(t._panelContainer.attr("id"))),w=t&&t._id||(re()?et():null),w)){var y=t&&t.extension().viewStyle(),d=y=="List"||y=="Cards",o,c,l=y=="Map",a,b,u;d&&i==null&&(i=f.activePage.find(".app-listview .ui-li-has-thumb").length>0);a=n.promo();y!="Map"&&(d&&i||t&&t.get_showMultipleSelection()||!ll())&&(l=!1);a=n.promo();o=s(w).page;b=a.outerWidth();u=Math.floor(b/3);o&&(o.is(".app-page-modal")?(c=o.offset(),o.is(".app-page-modal-fullscreen")?a.css({left:l?c.left+u:"auto",right:l?"auto":p-(c.left+o.outerWidth())+u,bottom:nt-(c.top+o.outerHeight()-u),"margin-bottom":0}):a.css({left:l?c.left+u:"auto",right:l?"auto":p-(c.left+o.outerWidth())+u,bottom:nt-(c.top+o.outerHeight()+Math.ceil(b/2)),"margin-bottom":0})):(k=ap("right",t),g=k?v(k,"width"):0,a.css({left:l?h.left.visible?h.left.width+u:u:"auto",right:l?"auto":g+(h.right.visible?h.right.width+u:u),bottom:"","margin-bottom":""})))}}function th(t){var i=n._title;(i.data("screen-width")!=p||t)&&i.data("screen-width",p).css("marginLeft",h.left.visible?h.left.width:n._logo.offset().left+n._logo.outerWidth())}function kp(){var n=h.left.inner;h.left.width=n.css("width","").outerWidth();b.width&&n.css({"overflow-y":"scroll",width:h.left.width-b.width+2})}function fo(t){var i,u,r,f,o,s,l;if(t&&c.removeClass("app-has-panel-right"),i=document.body.className,!sr){function a(){h.left.mini&&!i.match(/\bapp\-has\-minisidebar\-left\b/)?c.addClass("app-has-minisidebar-left"):!h.left.mini&&i.match(/\bapp\-has\-minisidebar\-left\b/)&&c.removeClass("app-has-minisidebar-left");i.match(/\bapp-has-sidebar-left\b/)||(c.addClass("app-has-sidebar-left"),h.left.visible=!0,kp(),u=!0)}function y(){i.match(/\bapp\-has\-minisidebar\-left\b/)&&c.removeClass("app-has-minisidebar-left");i.match(/\bapp-has-sidebar-left\b/)&&(c.removeClass("app-has-sidebar-left"),h.left.visible=!1,h.left.width=0,u=!0)}e("ui.sidebar.when")=="Landscape"?vh()&&p>nt?a():y():e("ui.sidebar.when")=="Never"?i.match(/\bapp-has-sidebar-left\b/)&&(c.removeClass("app-has-sidebar-left app-has-minisidebar-left"),h.left.visible=!1,h.left.width=0,u=!0):vh()?a():y()}p>=pt("md")&&!1?i.match(/\bapp-has-sidebar-right\b/)||(c.addClass("app-has-sidebar-right"),h.right.visible=!0,h.right.width=h.right.inner.outerWidth()-b.width,r=!0):i.match(/\bapp-has-sidebar-right\b/)&&(c.removeClass("app-has-sidebar-right"),h.right.visible=!1,h.right.width=0,r=!0);u&&(th(!0),yr(),df());f=$(".ui-page.app-has-panel-right").first();o=f.is(".app-has-panel");f.is(".app-page-modal")||(o&&!i.match(/\bapp-has-panel-right\b/)?r=!0:!o&&i.match(/\bapp-has-panel-right\b/)&&(r=!0));r&&(s=ap("right",f),l=s?v(s,"width"):0,h.right.visible&&(l+=h.right.width+1),c.toggleClass("app-has-panel-right",o&&!!s),n._toolbar.css(l?{right:l,width:"auto"}:{right:"",width:""}),df());dp()}function dp(){if(h.left.visible){var n=h.left.inner,t=parseInt(n[0].style.bottom||"0");h.left.mini?t||n.css("bottom",n.next().outerHeight()-1):t&&h.left.inner.css("bottom","")}}function ih(n){kt();o?l.location.href=n:l.open(n)}function gf(){return(new Date).getTime()}function v(n,t){return parseFloat(arguments.length==1?n:n.css(t))}function on(n){return n.x!=null&&(n.x=Math.ceil(n.x)),n.y!=null&&(n.y=Math.ceil(n.y)),n}function sn(){for(var r=n._toolbarButtons,e,u=n._contextButton,o=Math.ceil(u.show().offset().left),s=v(u,"width")+2,f=uo(),i=r.length-1,t=v(n._toolbar,"width")-o+f;i>=0;)e=$(r[i]).css("right",t),t=t+s+f,i--}function gp(n,t,i,u){if(n.htmlEncode())if(n.TextMode==3){for(var f=r.htmlEncode(t).split(/\r?\n/),o,e=0;e<f.length;e++)o=f[e],m=o.match(/^\s+/),m&&(f[e]=Array(m[0].length*2).join("&nbsp;")+o.substring(m[0].length));t=f.join("<br/>");f.length>15?(i.html('<div class="app-text-collapsible"><\/div>').children().html(t),$('<span class="ui-btn ui-btn-icon-notext ui-btn-inline ui-icon-carat-d ui-inline ui-corner-all app-btn-toggle"/>').attr("title",es.Maximize).appendTo(i)):(i.html(t),u&&i.css("white-space","nowrap"))}else i.text(t);else i.html(t)}function nw(t,i,r){t.find("> .app-map, > .app-presenter-instruction").hide();r||(i._mapPageWindow=null);n.presenter("hide",{container:t})}function tw(){return String.format("{0:"+r.dateFormatStrings["{0:f}"]+"}",new Date)}function rh(){return!0}function tl(n,t,r){if(n._hasKey()){var u=$('<span class="app-btn-more">&nbsp;<\/span>').appendTo(t).attr("title",i.More);r&&u.addClass("app-frozen")}}function hn(n,t){if(n=$(n),t==null&&(t=n.val().length),n.length)try{n[0].setSelectionRange(t,t)}catch(i){}}function il(n){var t=ln();"path"in n||(n.path=t.path);"fileName"in n||(n.fileName=t.fileName);r.execute({controller:g.siteContent,filter:[{field:"Path",operator:"=",value:n.path},{field:"FileName",operator:"=",value:n.fileName}],success:function(t){var i={FileName:n.fileName,Path:n.path};t.SiteContent.length?n.callback(t.SiteContent[0]):r.confirm("This is a static application page. A copy of the page will be created in the content management system. Continue?",function(){uw(i,"$Text",function(){il(n)})})}})}function cn(){il({callback:function(n){var t=g.siteContentPK;r.touch.navigate({href:String.format("{0}pages/site-content?{1}={2}&_controller={3}&_commandName=Select&_commandArgument=editForm1",__baseUrl,t,n[t],g.siteContent)})}})}function ln(){var n=l.location.pathname,t;return(n=n.substring(g.rootUrl.length),n.match(/^\//)&&(n=n.substring(1)),t=n.lastIndexOf("/"),t==-1)?{path:null,fileName:n}:{path:n.substring(0,t),fileName:n.substring(t+1)}}function iw(n){if(!n){il({callback:function(n){iw(n)}});return}yn(n)}function rw(n,t){n.errors.length?r.alert(n.errors.join("\n")):t(n)}function uw(n,t,i){r.execute({controller:g.siteContent,command:"Insert",view:"createForm1",values:[{name:"Path",newValue:n.Path},{name:"FileName",newValue:n.FileName},{name:"ContentType",newValue:"text/html"},{name:"Text",newValue:t}],success:function(n){rw(n,i)}})}function an(n,t,i){var u=g.siteContentPK;r.execute({controller:g.siteContent,command:"Update",view:"editForm1",values:[{name:u,oldValue:n[u]},{name:"Path",value:n.Path},{name:"FileName",value:n.FileName},{name:"Text",oldValue:n.Text,newValue:t}],success:function(n){rw(n,i)}})}function fw(){var n=$.mobile.activePage,t=n.find('[data-editable="true"]'),i;if(n.find(".app-page-content").addClass("app-editor-active"),n.find(".carousel").each(function(){$(this).carousel("pause").off("keydown.bs.carousel swipeleft swiperight")}),t.each(function(){var n=$(this),t;n.is("a")&&(n.attr({"data-href":n.attr("href"),tabIndex:0}),n.removeAttr("href"));t=n.html();n.data("data-content",t);t&&(t=t.replace(/\s*\r?\n\s*/g," ").trim(),n.html(t))}).attr("contenteditable","true"),i=w(n).find('[data-editable="true"]').find("img, .glyphicon"),is)i.on("mousedown",function(n){$(n.target).focus()});return t}function rl(n){$(document).trigger($.Event("editor"+n+".app"))}function ul(n){var t=$.mobile.activePage;t.find('[data-editable="true"]').each(function(){var t=$(this),i=t.data("data-content");t.removeAttr("contenteditable").removeData("data-content");t.is("a")&&(t.attr({href:t.attr("data-href"),tabIndex:0}),t.removeAttr("data-href"));n&&t.html(i)});t.find(".app-page-content").removeClass("app-editor-active");rl("stop")}function vn(n){var a=$.mobile.activePage,u=[],r,h,f,t,i,o,e,s=0,c,l;if(f=a.find(".app-page-content").html(),r=n.Text,r&&(h=r.match(/<footer/),t=n.Text.match(/<([\s\S]*?)data-content-framework\s*=\s*"\w+"([\s\S]*?)>/),t&&(t=t[0],u.push(t),c=t.split(/<div[\s\S]*?>/gi),l=t.split(/<\/div>/gi),s=c.length-l.length),s)){for(i=[],o=/\s*<\/div>/gi,e=o.exec(r);e;)i.push(e.index),e=o.exec(r);i=r.substring(i[i.length-s])}return h||(f=f.replace(/\s*<footer([\s\S]+?)<\/footer>/,"")),u.push(f),i&&u.push(i),u.join("")}function ew(n,t){var i=vn(n);"Text"in n?an(n,i,t):uw(n,i,t)}function yn(t){function e(){yi.disabled=!1;n.bar("remove",i.off());n.bar("remove",r.off())}var u=$.mobile.activePage,i,r,f=fw();f.length&&(yi.disabled=!0,i=$('<div class="app-bar-strip"><\/div>').appendTo(n.bar("create",{type:"header",page:u})).on("vclick",function(i){ne();var r=$(i.target).closest("a");return r.length&&k(r,function(){n.listPopup({anchor:r,iconPos:"left",items:[{text:"Save & Close",icon:"check",callback:function(){ul();ew(t,function(){e()})}},{text:"Save & Keep Editing",icon:"edit",callback:function(){ul();ew(t,function(){fw();rl("start")})}},{text:"Stop Editing",icon:"delete",callback:function(){ul(!0);e()}}]})}),!1}),r=$('<div class="app-bar-strip"><\/div>').appendTo(n.bar("create",{type:"footer",page:u})).on("vclick",function(n){function u(){i.is(".app-has-children")&&t.trigger($.Event("contextmenu",{relatedTarget:i})).addClass("app-editor-focus")}var i=$(n.target).closest(".ui-btn"),t;return i.length?k(i,function(){t=i.data("elem");t&&(t.is('[data-editable="true"]')?t.focus():ne(t),u())}):(i=r.find(".ui-btn").last(),i.length&&(t=i.data("elem"),t&&t.is('[data-editable="true"]')&&t.focus())),!1}),$('<a class="ui-btn ui-mini app-has-children"/>').appendTo(i).text("Save & Close"),n.bar("show",i.parent()),n.bar("show",r.parent()),ne(f.first().focus()),rl("start"))}function pn(){return o?"vclick contextmenu":"contextmenu"}function ne(n){var e=f.activePage,o=e.find(".app-bar-footer .app-bar-strip"),s,r,t,i,u,h;if(e.find(".app-editor-focus").removeClass("app-editor-focus"),s=o.find(".ui-btn"),n=$(n),s.removeData().remove(),n.length&&!n.closest("footer,.footer").length){for(n.is('[data-editable="true"]')||n.addClass("app-editor-focus"),r=[];n.length&&!n.is(".app-page-content");)t=null,n.is('[data-editable="true"]')?t=n.is(".btn")?"button":"text":n.is(".jumbotron")?t="jumbotron":n.is(".container")?t="container":n.is(".carousel")?t="carousel":n.parent().is(".row")&&n.is("div")&&(t="column"),t&&r.push({text:t,elem:n}),n=n.parent();for(i=r.length-1;i>=0;)u=r[i],n=u.elem,h=$('<a class="ui-btn ui-mini"/>').appendTo(o).text(u.text).data("elem",n),i||n.is('[data-editable="true"]')&&!n.is("a")||h.addClass("app-has-children"),i--}}function wn(){var i="vclick",n=f.activePage,t;n.on("focus",'[data-editable="true"]',function(){var n=$(this).closest(".ui-page").find(".app-bar-footer .app-bar-strip .ui-btn");n.length&&n.last().data("elem")[0]===this||ne(this)});n.on(i,'[data-editable="true"] .glyphicon',function(){function f(n){t.attr("class","glyphicon "+n)}function i(){var i=[];$(n).each(function(){var n=this,t={text:n,icon:"glyphicon-"+n,context:"glyphicon-"+n,callback:f};u==n&&(t.visible=!0);i.push(t)});rt({anchor:t,iconPos:"left",title:"Glyphicon",items:i})}var t=$(this),u=(t.attr("class").match(/glyphicon-([\w+\-]+)/)||[])[1],n=r.glyphicons;return is&&t.parent().focus(),n?i():$.ajax({url:__baseUrl+"touch/bootstrap.min.css",dataType:"html",success:function(t){var e=/\.glyphicon-([\w\-]+)/g,u,f;for(n=[],u=e.exec(t);u;)f=u[1],n.indexOf(f)==-1&&n.push(f),u=e.exec(t);n.sort();r.glyphicons=n;i()}}),!1});n.on(i,'.btn[data-editable="true"]',function(n){function i(n){r.removeClass("btn-default btn-primary btn-success btn-info btn-warning btn-danger").addClass("btn-"+n)}function u(n){r.removeClass("btn-xs btn-sm btn-md btn-lg").addClass("btn-"+n)}function t(n,t,i,u){return{text:n,icon:r.is("."+t+"-"+i)?"check":"",context:i,callback:u}}var r=$(this);return rt({anchor:n.relatedTarget||r,iconPos:"left",title:"Button",items:[t("Default","btn","default",i),t("Primary","btn","primary",i),t("Success","btn","success",i),t("Info","btn","info",i),t("Warning","btn","warning",i),t("Danger","btn","danger",i),{},t("X-Small","btn","xs",u),t("Small","btn","sm",u),t("Medium","btn","md",u),t("Large","btn","lg",u),]}),!1});n.on("vclick contextmenu",".row > div,.container,.carousel,.jumbotron",function(t){function u(){r.alert("context menu")}var i=$(this);if(!$(t.target).closest('[data-editable="true"],a').length)return n.find('[data-editable="true"]').blur(),i.is(".app-editor-focus")&&t.type=="vclick"||(ne(i),t.type=="contextmenu"&&u()),!1});n.on("vclick contextmenu",".app-page-content",function(i){if(!$(i.target).closest('[data-editable="true"],a').length&&!t){var r;return n.find(".app-page-content > *").each(function(){var n=$(this);if(n.offset().top<=i.clientY&&n.offset().top+n.outerHeight()>=i.clientY&&!n.is("footer,.footer"))return r=!0,setTimeout(function(){t=!0;n.trigger(i.type);t=!1}),!0}),r||ne(),!1}})}function bn(){var t=pn(),n=f.activePage;n.off("focus",'[data-editable="true"]');n.off(t,'[data-editable="true"] .glyphicon');n.off(t,'.btn[data-editable="true"]');n.off("vclick contextmenu",".row > div,.container,.carousel,.jumbotron");n.off("vclick contextmenu",".app-page-content")}function kn(n,t){n.extension().quickFind(t)}function te(n){var t=[];return n&&n.viewProp("useAdvancedSearch")&&(t=n.viewProp("advancedSearchFilter")||t),t}function eo(n){ve(n);sw(n);$(n._allFields).each(function(){delete this._listOfValues});aa(n);n._forceSync();n.refreshData()}function fl(n,t){!t&&te(n).length&&n.viewProp("advancedSearchFilter",null);n.clearFilter(!0);eo(n)}function ow(n){var r=n._filter,t=te(n),i;return t.length&&(n._filter=t,i=n.extension().filterStatus(!0),n._filter=r),i}function sw(n){var t=(n.get_filter()||[]).slice(0),r=[],u,i=0,f=$.Event("searching.app",{dataView:n});for($(n.get_externalFilter()).each(function(){r.push(this.Name)});i<t.length;)u=t[i],Array.indexOf(r,u.match(/^\w+/)[0])!=-1?t.splice(i,1):i++;n.viewProp("filter",t);$(document).trigger(f)}function hw(){var t=n._menuStrip;return t&&t.strip.is(":visible")}function oo(t){var r=n._menuStrip,i=r&&r.strip,u=n._title;i&&(arguments.length==0&&(t=hw()),t?i.show():(i.hide(),n.refreshTitleState()))}function cw(n){n.length&&n[n.length-1].text&&n.push({})}function gr(n){var i=!0,t;if(n)setTimeout(function(){gr()},5);else try{l.getSelection?(t=l.getSelection(),t&&t.rangeCount>0&&t.removeAllRanges()):document.selection&&document.selection.empty()}catch(r){i=!1}return i}function lw(){var n,t,i,u,r;return document.selection&&document.selection.createRange?(n=document.selection.createRange(),t=n.htmlText):window.getSelection&&(i=window.getSelection(),i.rangeCount>0&&(n=i.getRangeAt(0),u=n.cloneContents(),r=document.createElement("div"),r.appendChild(u),t=r.innerHTML)),t}function aw(t){var r=n._menuStrip,i=r&&r.strip;i&&(i.hide(),arguments.length==1&&i.attr("data-enabled",t?"true":"false"))}function dn(n,t){t=="Cards"?n.addClass("app-cardview").removeClass("app-grid app-onecolumnview"):t=="Grid"?n.addClass("app-grid").removeClass("app-cardview app-onecolumnview"):t=="List"&&n.addClass("app-onecolumnview").removeClass("app-cardview app-grid")}function ie(n,t,i){var u=r.find(n);ve(u);u.extension().viewStyle(t,i);cp(n);lt(!0);lt(!1,10)}function el(n,t){if(t.instruction){var i=n.find("> .app-presenter-instruction"),r=t.instruction();i.length||(i=$('<div class="app-presenter-instruction"><\/div>').appendTo(n).hide());r?(i.show(),i.html(r)):i.hide();co();vw(t.dataView(),n.closest(".ui-page"),!1,!0)}}function vw(n,t,i,r){var e,o,f,u;s(n).stickyHeader.hide();e=n.extension();e._instructed||n._totalRowCount==-1||(f=e.instruction(),u=gs(t),f||i?(u.empty(),e._instructed=!0,u.length||(u=$('<span class="dv-heading"/>').appendTo(t).hide()),f&&$('<span class="app-view-instruction"/>').appendTo(u).html(f.replace(/<a.*?<\/a>/gi,"")),u.attr("data-selector",r?".app-presenter-instruction:visible":"ul.app-listview li.app-list-instruction"),i&&(o=gl(n,u),f||o.addClass("app-grid-header-no-description")),yr(),(i||n.extension().viewStyle().match(/Cards|List/)&&n.get_groupExpression())&&$(document).trigger($.Event("scrollstop.app",{relatedTarget:w(t)}))):u.remove())}function yw(t){function i(i){var e=i.attr("data-presenter"),u=n.dataView(),r=u?u._id:null,f=i.closest(".app-echo");f.length&&(r=f.attr("data-for"));r&&i.css("display")!="none"&&n.presenter("show",{name:e,id:r,container:t||w(i)})}t?(t.find('div[data-role="presenter"]').each(function(){i($(this))}),$('.ui-page:not(.ui-page-active) div[data-role="presenter"]').each(function(){var n=$(this);n.closest(".app-echo-inner").length||n.addClass("app-stale")})):$('div[data-role="presenter"].app-stale').each(function(){var n=$(this);n.removeClass("app-stale");i(n)})}function ol(n){n.find("> .app-map").each(function(){var i=$(this),u=n.find("> .app-page-header:visible"),f=n.find("> .app-presenter-instruction:visible"),r=$(f.length&&f||u.length&&u),e=i.data("data-map"),t,o;i.css("top",r.length?r.position().top+r.outerHeight(!0):0);i.is(":visible")&&e&&(t=e.map,o=t.getCenter(),google.maps.event.trigger(t,"resize"),t.setCenter(o))})}function sl(n){var t=n[0];t.style.zIndex=-10;pi(n);t.style.zIndex=""}function gn(){var n=Math.max(p,nt*.85);return n<=pt("xxs")?n-30:Math.ceil(n/1.618)}function ntt(){return p<=pt("xxs")?nt-30:Math.ceil(nt*.8)}function pw(n){var i=n.prev(),r,t;i.is(".app-page-header-fixed")&&(i.css("top",v(n,"top")),r=i.outerHeight(),n.data("header-height",r),t=i.prev(),t.is(".app-page-header-image")&&(t.css("height",""),t.css({top:v(n,"top"),height:t.height()+r})))}function pi(n){var lt=f.activePage,t=n||lt,bt,rt,kt,dt,tt,d,g;if(!t.is(".app-page-panel")){var gt=t.attr("id")==lt.attr("id")||t.is(".app-page-modal-root"),ni=t.is(".app-page-modal"),o=cu(),l=nt-cu(),at=t.find(".ui-content"),vt=at.children().filter(function(){return $(this).is(".app-bar-header,.app-bar-actions,.app-tabs")}),ut=at.find(".app-bar-footer"),ft=de&&t.find(de.fixedTop.selector),et=ft&&ft.css("position")=="fixed"&&ft.outerHeight(),ot=de&&t.find(de.fixedBottom.selector),st=ot&&ot.css("position")=="fixed"&&ot.outerHeight(),ii=t.is(".app-stale"),a=0,ht,ri=p;if(ni){var yt=t.attr("class"),ct=yt.match(/\bapp\-page\-modal\-max\-(tn|xxs|xs|sm|md|lg|xl|xxl|any)\b/),u=yt.match(/\bapp\-page\-modal\-dock\-(top|left|right|bottom)\b/),i=ntt(),e=Math.min(gn(),pt("md")),ti=ct?nn(ct[1]):0;u&&(u=u[1]);ct&&(e=Math.min(p-30,ti));ht=t.is(".app-page-modal-fullscreen");ht&&(e=p-30,i=nt-30);var c=w(t),r=0,wt=s(t.attr("id")),k=wt&&wt.dataView,y=(nt-i)/2,d=(p-e)/2,g,it;u&&(u=="top"?y=15:u=="left"?(d=15,k&&k.tagged("modal-fit-content")||(y=15,it=15,i=nt-30)):u=="bottom"?(y="auto",it=15):u=="right"&&(d="auto",g=15,k&&k.tagged("modal-fit-content")||(y=15,it=15,i=nt-30)));t.css({"padding-top":0,top:y,left:d,right:g,bottom:it,"min-width":e,"max-width":e,width:e,"min-height":i,"max-height":i,height:i});footerHeight=ut.length?ut.outerHeight():0;vt.each(function(){var n=$(this);n.css("display")!="none"&&(r+=n.outerHeight(!0))});bt=c.data("scrolling");c.data("scrolling",!0);t.find(".app-bar-actions,.app-bar-footer,.app-bar-header").each(function(){var n=$(this);n.width(e-v(n,"padding-left")-v(n,"padding-right"))});r+=t.find(".app-page-modal-title").outerHeight();c.css({top:r,left:0,"min-width":e+b.width,"max-width":e+b.width,width:e+b.width,"min-height":i-footerHeight-r,"max-height":i-footerHeight-r,height:i-footerHeight-r});!ht&&k&&k.tagged("modal-fit-content")&&(rt=c.find(".app-stub"),rt.length&&(kt=rt.position(),dt=Math.ceil(kt.top+rt.height()),tt=i-footerHeight-r-dt,tt>0&&(c.css({"min-height":i-footerHeight-r-tt,"max-height":i-footerHeight-r-tt,height:i-footerHeight-r-tt}),i-=tt,u!="top"&&u!="bottom"&&(y=(nt-i)/2),t.css({top:y,"min-height":i,"max-height":i,height:i}))),t.addClass("app-page-modal-fit-content"));pw(c);c.data("vscrollbar").css({height:i-footerHeight-r,right:0,top:r});ol(c);bt||c.data("scrolling",!1)}else t.css({"padding-top":o,"min-height":l}),o=v(o),sr&&!oc&&t.attr("id")=="Main"&&(o=0,l+=cu()),d=h.left.visible?h.left.width+1:0,g=h.right.visible?h.right.width+1:0,t.css({left:d,right:g,width:p-g-d+1}),w(t).each(function(){var n=$(this),i=0,u=n.data("scrolling"),r;n.data("scrolling",!0);vt.each(function(){var n=$(this);n.css("display")!="none"&&(i+=n.outerHeight(!0))});ut.each(function(){var n=$(this);n.css("display")!="none"&&(a+=n.outerHeight(!0))});i&&(l=l-i,o=o+i);et&&(l-=et,o+=et);st&&(l-=st,a+=st);a&&(a-=2);r=l-a;t.is(".app-has-panel")&&$(s(t.attr("id")).dataView._panels).each(function(){var n=this,u=v(t,"left"),r=p-(h.right.visible?h.right.width:0)-u-1,i=r;$(n.pages).each(function(){var u=this;u.is(".app-page-panel-active")&&n.location=="right"&&(i=Math.ceil(r*n.size/100),t.css({right:g+i}),u.css({top:v(t,"top"),left:"auto",bottom:a,width:i,"min-height":v(t,"min-height")}))})});n.css({top:o,bottom:a,"min-height":r});gt&&n.css({height:r});b.width&&n.css("width","").width(n.width()+b.width);n.data("vscrollbar").css({height:l-a,right:0,top:o});pw(n);ol(n);u||n.data("scrolling",!1)})}}function ttt(){function at(n){return n&&(n=n.match(/Landscape|Always|Never/)),n?n[0]:"Landscape"}var nt=e("ui.displayDensity.mobile"),st=e("ui.displayDensity.desktop"),a=Sys.Browser,tt,y,it,s=$("#PageHeader").parent(),u,w=$("div[data-content-framework]").first(),rt=ot("promoteActions"),ut=ot("smartDates"),ft=document.cookie.split(";"),et,k,l,ct=g.appInfo.split("|")[1],lt=new RegExp("\\.COTTHEME"+ct+"=((\\w+).(\\w+))"),d,r,t;for(et in ft)if(k=ft[et],l=k&&lt.exec(k),l){u={theme:l[2],accent:l[3]};break}if(s.length||(s=c),e("membership.profile",e("membership.profile")||"view switch login logout"),e("ui.transitions.style",ot("transitions")||e("ui.transitions.style")||(nr?"slide":tp()?"slide":"none")),e("ui.sidebar.when",ot("sidebar")||at(e("ui.sidebar.when"))||(vh()?"Always":"Landscape")),d=ot("minisidebar"),e("ui.sidebar.mini",d!=null?d:ht("ui.sidebar.mini")||e("ui.sidebar.mini")==null&&p<=pt("lg")),e("ui.menu.location",sr?"toolbar":e("ui.menu.location")?e("ui.menu.location"):"toolbar"),g.bars={left:{visible:!1,width:0,content:[]},bottom:{visible:!1,height:0,content:[]},right:{visible:!1,width:0,content:[]}},e("ui.theme.name",u&&u.theme||e("ui.theme.name")),e("ui.theme.accent",u&&u.accent||e("ui.theme.accent")),e("ui.displayDensity.value",ot("displayDensity")||(rs<144?st:nt=="Auto"?rs>=432?"Comfortable":"Compact":nt)),e("ui.list.labels.display",ot("labelsInList")||e("ui.list.labels.display")),e("ui.showSystemButtons",ot("showSystemButtons")||e("ui.showSystemButtons")||"Auto"),e("ui.actions.promote",rt!=null?rt:e("ui.actions.promote")),e("ui.list.initialMode",sr?"Summary":ot("initialListMode")||e("ui.list.initialMode")||"SeeAll"),e("ui.smartDates",ut!=null?ut:e("ui.smartDates")==!0),h=g.bars,a.agent==a.InternetExplorer&&a.version<=9&&(c.hide(),g.defaultUI?(tt=(new Date).getDate()+365,y=new Date,y.setDate(tt),it=String.format("appfactorytouchui=false; expires={0}; path=/",y.toUTCString()),document.cookie=it,location.reload(f.path.parseUrl(location.href).hrefNoHash)):alert(i.TouchUINotSupported)),gt&&(c.addClass("app-ios"),ts<8&&c.addClass("app-ios7")),nr&&c.addClass("app-android"),e("ui.showSystemButtons")!="Always"&&c.addClass("app-show-system-buttons-on-hover"),s.is(".Tall")&&c.addClass("app-page-header-hidden"),(s.is(".Wide")||w.length&&w.attr("data-sidebar")!="true"||!w.length&&$('div[data-app-role="page"]').first().attr("data-sidebar")=="false")&&(e("ui.sidebar.when","Never"),e("settings.options.sidebar",!1)),sr){if(location.href.match(/_showNavigation=false/)||(c.addClass("app-hosted-show-navigation"),oc=!0,n._toolbar.css("visibility","")),location.hash){c.children().hide();location.reload(location.pathname+location.search);return}c.addClass("app-hosted")}$(document).trigger($.Event("init.app"));f.defaultPageTransition="none";r=$('<div id="app-sidebar" class="ui-panel ui-panel-fixed ui-body-a app-sidebar app-sidebar-left app-sidebar"><div class="ui-panel-inner" tabindex="0"><ul/><\/div><div class="app-bar-toolbar-bottom"><\/div><\/div>').appendTo(c);t=r.find(".ui-panel-inner");b.width&&t.css({"overflow-y":"scroll",width:r.width()-v(t,"padding-left")-v(t,"padding-right")+b.width});h.left.inner=t;h.left.toolbar=t.next();h.left.content.push(r.find("ul").listview());r=$('<div class="ui-panel ui-panel-fixed ui-body-a app-sidebar app-sidebar-right"><div class="ui-panel-inner" tabindex="0"><ul/><\/div><\/div>').appendTo(c);t=r.find(".ui-panel-inner");h.right.inner=t;h.right.content.push(r.find("ul").listview());ht("ui.sidebar.mini")&&(h.left.mini=!0);fo();e("ui.displayDensity.value")||e("ui.displayDensity.value",o?"Comfortable":"Compact");c.addClass(ya(e("ui.theme.name")));c.addClass(va(e("ui.displayDensity.value")));e("ui.list.labels.display")=="DisplayedAbove"&&c.addClass("app-labelsinlist-displayedabove")}function ww(n){return(n.metaKey||n.ctrlKey)&&n.shiftKey}function nu(t){n.tabs("fit",{page:t})}function bw(n){n=$(n);w(n).each(function(){var n=$(this),t=n.data("scroll-top")});n.find(".app-echo-inner").each(function(){var n=$(this),t=n.data("scroll-left");n.parent().is(":visible")&&t&&n.scrollLeft()!=t&&n.scrollLeft(t)});ce(n)}function hl(n){n=$(n);n.is(":visible")&&(w(n).each(function(){var n=$(this)}),n.find(".app-echo-inner").each(function(){var n=$(this);n.parent().is(":visible")&&n.data("scroll-left",n.scrollLeft())}))}function kw(n){var t=n.scrollTop();return{top:t*-1,height:n.height()+t,maxHeight:n[0].scrollHeight}}function dw(n){var t=n.find(".ui-panel-inner"),i,r;if(t.length)t.on("scroll keydown keyup",function(){if(!tt&&o&&!i){i=!0;r=t.scrollTop();wt=!0;var n=(new Date).getTime();function u(){var f=t.scrollTop(),e=f!=r;e||(new Date).getTime()-n<100?(r=f,e&&(n=(new Date).getTime()),requestAnimationFrame(u)):(i=!1,wt=!1,t.data("scroll-stop-time",new Date))}requestAnimationFrame(u)}})}function itt(n){n.find(".ui-panel-inner").off("scroll keydown keyup")}function so(n,t){n||(n=w());lr(n,!1,t==!0);n.find(".app-data-list").each(function(){uh($(this))})}function uh(n,t,i){function f(){t.css({left:r*u,width:n.width()*u,display:""})}var r;n.length&&(t||(t=n,n.parent().attr("class").match(/\-outer/)&&(t=n.parent()),t=t.next().find(".app-hscrollbar-handle")));r=n.scrollLeft();var e=n.width(),o=n[0].scrollWidth,u=Math.abs(e-o)<=2?1:e/o;t.parent().css("visibility",u==1?"hidden":"");u==1||n.find(".app-hidden").length?(t.css("display","none"),n.removeClass("app-inner-shadow-left app-inner-shadow-right app-inner-shadow-left-right")):(r<=0?n.addClass("app-inner-shadow-right").removeClass("app-inner-shadow-left app-inner-shadow-left-right"):r>=n[0].scrollWidth-n[0].clientWidth-1?n.addClass("app-inner-shadow-left").removeClass("app-inner-shadow-right app-inner-shadow-left-right"):n.addClass("app-inner-shadow-left-right").removeClass("app-inner-shadow-right app-inner-shadow-left"),i&&!1?requestAnimationFrame(f):f())}function lr(n,t,i){if(n.length)if(i)clearTimeout(l._updateVScrollbarTimeout),l._updateVScrollbarTimeout=setTimeout(function(){lr(n,t)},100);else{t||(t=n.next().find(".app-vscrollbar-handle"));var f=n[0].scrollHeight,u=n.height(),r=u/f,e=t.parent(),o=n.parent().parent();footer=e.next();e.css("visibility",r==1?"hidden":"");r==1?(t.css("display","none"),footer.addClass("app-bar-footer-no-scrolling"),o.removeClass("app-page-scrolled")):requestAnimationFrame(function(){var i=n.scrollTop(),e=u*r,s;e<16&&(e=16);t.css({top:i*r-0,height:e,display:""});f<=i+u?footer.addClass("app-bar-footer-no-scrolling"):footer.removeClass("app-bar-footer-no-scrolling");s=n.data("header-height");o.toggleClass("app-page-scrolled",i>(s||50))})}}function fh(t,i){function d(){u=r.data("lastScrollTop");u==null&&(u=0);var t=r.data("scroll-dir"),i=r.scrollTop(),n=i<u?"up":i==u?"none":"down";n=="none"&&t=="none"&&(n="up");n!=t&&(r.data("scroll-dir",n),$(document).trigger($.Event("scrolldir.app",{relatedTarget:r})))}var r=w(t),f,e,l,v,s,u,y,k,c,g,a;if(!r.length){if(l=t.find(".ui-content"),v=l.contents(),r=$('<div class="app-wrapper"><\/div>').appendTo(l),b.width&&r.css("overflow-y","scroll"),g=p,r.toggleClass("app-display-tablet",g>=pt("sm")+(h.left.visible?h.left.width:0)),f=$('<div class="app-vscrollbar"><\/div>').insertAfter(r),e=$('<div class="app-vscrollbar-handle" data-draggable="vscrollbar"><\/div>').appendTo(f),r.data({vscrollbar:f,"vscrollbar-handle":e}),lr(r,e),no(r,!1),a=n.pageInfo(t),a&&a.external&&f.css("display","none"),i==!1)r.on("scroll",function(){lr(r,e)});else r.on("touchstart",function(n){au(n);gt&&ts<8&&(c=!1,or=!0)}).on("touchmove",function(){gt&&(y=gf(),k=r.scrollTop())}).on("touchend",function(n){if(au(n),gt&&ts<8){var i=gf()-y,t=r.scrollTop(),u=Math.abs(k-t);i>0&&u/i>.25||t<0||t>r.height()?c=!0:or=!1}}).on("scroll",function(){if(tt||r.data("scrolling")){clearInterval(r.data("scrollInterval"));r.data("lastScrollTop",r.scrollTop());s=!1;wt=!1;return}if(lr(r,e),s)d();else{s=!0;dt();$(document).trigger($.Event("scrollstart.app",{relatedTarget:r}));wt=!0;f.addClass("app-scrollbar-reveal");var n=(new Date).getTime();function t(){var i=r.scrollTop(),e=i!=u,o=(new Date).getTime();e||o-n<100?(u=i,e&&(n=o),requestAnimationFrame(t)):(clearInterval(r.data("scrollInterval")),d(),s=!1,wt=!1,r.data({"scroll-stop-time":new Date,lastScrollTop:i,scrollInterval:null}),f.removeClass("app-scrollbar-reveal"),c&&(c=!1,or=!1),$(document).trigger($.Event("scrollstop.app",{relatedTarget:r})))}requestAnimationFrame(t)}});o||r.attr("tabindex",0);$('<div class="app-page-header"><h2/><h1/><\/div><div class="app-page-header-divider"><\/div>').appendTo(r);v.appendTo(r)}return r}function kt(t){n.activeLink(t)}function k(n,t){t||(t=bt);n=$(n);var i=n.attr("class");i&&i.match(/\bapp-btn-/)?(n.addClass("ui-btn-active"),setTimeout(function(){n.removeClass("ui-btn-active");fc="link";t(n)},ti)):(kt(n),setTimeout(function(){tt&&t==bt||(kt(),fc="link",n&&n.is(".app-btn")&&(fc="toolbar"),t(n))},ti))}function gw(n,t){if(t||(t=n.find(".app-stub,.app-stub-main")),t.length){var i=Math.ceil(t.offset().top),r=Math.ceil(n.offset().top),u=n.height();i>r&&(i>r+u?t.height(""):t.height(u-(i-r)))}}function cl(){di&&di._updateLastActivity()}function eh(){return cs&&cs.length||(cs=$(".app-sidebar").first()),cs}function ll(n){return g.bars[n||"left"].visible}function wi(n,t,i){n&&(i||cr(),n.href?ih(n.href):n.callback&&n.callback(n.context,t))}function al(n){var t=n.closest("ul").find(".app-focus");n.closest(".ui-panel-inner").focus();t.length&&(t.removeClass("app-focus ui-btn-active"),n.addClass("app-focus ui-btn-active"))}function nb(n,t){if(n.length){t||(t=n.closest(".ui-panel-inner"));var i=n.offset(),e=t.offset(),r,u=e.top,f=u+t.outerHeight()-1;i.top<u?r=i.top-u:i.top+n.outerHeight()>f&&(r=i.top+n.outerHeight()-f);r&&setTimeout(function(){t.scrollTop(t.scrollTop()+r)},10)}}function tb(n){var t=f.activePage;t&&t.find(".dv-load-at-top").css("visibility",n?"hidden":"");tt=n}function et(){var n=f.activePage;return n?n.attr("id"):"_"}function s(t){return n.pageInfo(t)}function ho(n){var t=s(n),i=t.echo;return i||(i=t.echo=$("#"+t.id+"_echo")),i}function ib(){return et()=="Main"}function re(){return et()=="advanced-search"}function vl(n,t){return"rg_"+n._id+"_v_"+n._viewId+(n._groupExpression?"_g_"+n._groupExpression.replace(/\W/g,"_"):"")+"_f_"+t.Name}function ue(n){return"rg_"+n._id+"_v_"+n._viewId+(n._groupExpression?"_g_"+n._groupExpression.replace(/\W/g,"_"):"")+"_scroll_"}function rb(n){var t=n.Columns;return t==0&&n.Type=="String"&&(t=Math.floor(n.Len)),n.ItemsTargetController&&!t?t=80:t>80?t=80:t||(n.Type=="String"?(t=n.Rows>1?80:30,n.Len>0&&n.Len<t&&(t=n.Len)):t=7),n.Type.match(/^Date/)&&t<20?t=n.DataFormatString=="d"||n.DataFormatString=="{0:d}"?10:t:n.Type=="Guid"&&t<36&&(t=36),t}function utt(n,t){t||(t=uo());var i=n.cols!=null?n.cols:rb(n),r=n.long?i*.5:i<11?i:i<21?Math.ceil(i*.5):10;return Math.ceil(t*(r<=3?1:.55)*r)}function ur(n){var t=Math.ceil(uo()*1);$(n||f.activePage.find(".app-listview")).each(function(){var i=$(this),h=i.parent(),l=i.closest(".ui-page"),et,wt="w"+Math.ceil(v(l,"width")/t),r=oy[wt],tt,ot,st,bt,ht,it,ct=i.data("data-yardstick-class"),f=c.find("#app-yardstick"),kt=i.is(".app-grid"),rt=h.is(".app-echo-inner"),dt,vi=rt||h.is(".app-map-info"),gt,ni,yt,pt,ii,ri,ui,o,fi;if(r||(f.length||(f=$('<ul id="app-yardstick" class="app-listview"><li class="dv-item"><a><span>1<\/span><\/a><\/li><li><a class="dv-item">2<\/a><\/li><li><a class="dv-item">3<\/a><\/li><\/ul>').appendTo(c).listview()),rt&&kt&&(h=w(h)),f.addClass("app-onecolumnview").appendTo(h).show(),tt=f.find("li").first(),et=l.css("display"),et!="block"&&l.css("display","block"),st=tt.outerWidth(),f.toggleClass("app-onecolumnview  app-cardview"),ot=tt.outerWidth(),f.toggleClass("app-cardview app-grid"),bt=f.find("span").first(),ht=v(bt,"margin-left"),b.gridColumnPadding=ht,dt=tt.outerWidth(),f.removeClass("app-grid"),et!="block"&&l.css("display",""),f.appendTo(c).hide(),gt=wf(st),ni=wf(ot),r={listBreakpoint:gt,cardBreakpoint:ni,card:Math.floor(ot/t),list:Math.floor(st/t),columnPadding:ht,grid:{},gridWidth:dt},oy[wt]=r),it="app-listitem-"+(i.is(".app-cardview")?r.cardBreakpoint:r.listBreakpoint),it!=ct&&(ct&&i.removeClass(ct),i.addClass("app-yardstick "+it).data("data-yardstick-class",it)),kt){var oi=s(rt?ei(i).attr("data-for"):l.attr("id")),n=oi.dataView,a=n.session("grid-style"),e=pu(n);if(!a||n.session("grid-style-changed")||e&&(n.session("window-width")!=p||n.session("grid-with-sidebar")!=ll())){n.session("grid-style-changed",null);var si=n._fields,hi=n._allFields,lt=[],y,ci=0,k=n.get_showMultipleSelection(),u=i.is(":visible")?i.width():r.gridWidth,at=n._hasKey(),ti=(at?22:0)+(k?38:0)+b.gridColumnPadding,ut=ti,ft,yi=2*t+r.columnPadding,o,d=n.gridSettings(),vt=new Sys.StringBuilder;if($(si).each(function(){var r=this,i=hi[this.AliasIndex];r.Hidden||i.GroupBy||r.OnDemand||r.Type=="DataView"||(y=rb(i),ft=Math.ceil(Math.min(u*.5,y*t*(y<=3?1:.55))),d&&d.width[i.Name]&&(ft=d.width[i.Name]),ut+=ft+b.gridColumnPadding,ci+=y,lt.push({name:i.Name,className:vl(n,i),cols:y,type:i.Type,ew:ft,long:i.ItemsDataController||i.Type=="String"&&i.Rows>1}))}),n){if(n.session("avail-width",u),yt=n.session("grid-avail-width"),pt=ti,n.tagged("grid-fit-none")&&(e&&pu(n,!1),e=!1),d){for(o in d.width)ri=!0;ri&&(e&&pu(n,!1),e=!1)}yt==null||e?(u-=b.gridColumnPadding+1,rt&&(u-=b.width),e&&(u<ut&&(ui=(u-(k?22:0))/ut,$(lt).each(function(){var n=this,i=utt(n,t);n.ew=(n.ew+b.gridColumnPadding)*ui-b.gridColumnPadding;n.ew<i&&(n.ew=i,ii=!0);pt+=n.ew+b.gridColumnPadding})),n.session("scroll-left",0)),ii?u=pt:e||(u=ut),n.session("grid-avail-width",Math.floor(u)),pu(n,e),n.session("window-width",p),n.session("grid-with-sidebar",ll())):u=yt}var li,g=0,nt=ds(n),ai=nt!="_none_";$(lt).each(function(){o=this;var n=o.ew;o==li&&(at&&(n-=22),k&&(n-=22+r.columnPadding));nt!="_none_"&&(g+=n+r.columnPadding,(nt==o.name||nt=="_first_")&&(nt="_none_"));vt.appendFormat(".{0} {{width:{1}px;max-width:{1}px}}",o.className,Math.floor(n));vt.appendLine()});fi=vt.toString();a||(a=ks(),n.session("grid-style",a));a.text(fi);g&&(g+=4);n.session("grid-frozen-width",!ai&&!k?0:Math.floor(g+(at?26:4))+(k?22+(g>0?r.columnPadding:4):0))}}})}function oi(t){var i=n._menuButton;if(arguments.length==0)return i.is(".app-transition");i&&!t&&n.toolbar().is(":visible")&&!f.activePage.is(".app-page-modal")&&(t?i.removeClass("ui-icon-bars").addClass("app-transition"):i.removeClass(kh).addClass(ub()?"ui-icon-bars":"ui-icon-back"))}function fe(){oi(!0);gi.one("beforeunload pagehide",function(){oi(!1)})}function ub(){var i=et(),t=n._pages;return i=="Main"||t.length&&i==t[0].id&&t[0].home}function fb(){var r=n._menuButton,a=f.activePage,e,o,h;if(r&&n.toolbar().is(":visible")&&!a.is(".app-page-modal"))if(ub()?r.removeClass("ui-icon-back ui-icon-bars "+kh).addClass("ui-icon-bars").attr({"data-action":"#app-btn-menu",title:i.Menu}):r.removeClass("ui-icon-bars "+kh).addClass("ui-icon-back").attr({"data-action":"#app-back",title:i.Back}),o=!r.is(".ui-icon-bars"),n.toolbar().toggleClass("app-has-back",o),h=n._backText,o){var u=ri.stack[ri.activeIndex-1],c=u&&u.hash,l=c?s(c.substring(1)):null,t=l?l.headerText:u&&u.title;e=s();(!t||e&&e.headerText==t)&&(t=i.Back);h.text(typeof t=="string"?t:t[0]).show()}else h.hide()}function yl(n){n.length&&n.closest(".app-sidebar").length&&(ey[et()+"_"+n.attr("id")]=n.find(".ui-panel-inner").scrollTop())}function ftt(n){n.find(".ui-panel-inner").scrollTop(n.length&&n.closest(".app-sidebar").length?ey[et()+"_"+n.attr("id")]||0:0)}function pl(n){var t=$(n.target).closest(".ui-btn,.app-grid-header").find(".app-btn-check");return t.length>0&&ai(n.pageX)<=t.offset().left+t.outerWidth()+8}function eb(n,t){var u,i,f=ai(n.clientX),e=yf(n.clientY),o=$(n.target).closest(".ui-btn").find(".app-action-column"),r;return o.length&&o.find(".app-action-column-button").each(function(){var n=$(this),o=n.offset();if(f>=o.left-4&&f<=o.left+n.outerWidth()+3&&e>=o.top-6&&e<=o.top+n.outerHeight()+4)return u=!0,n.addClass("ui-btn-active"),setTimeout(function(){n.removeClass("ui-btn-active");i=ei(n);ra(i);sh(t).removeClass("app-selected ui-btn-active");r=n.closest(".ui-btn");t.extension().tap(r.data("data-context"),"none");i.length&&r.addClass("app-selected");var u=[],f=n.attr("data-action-path");ko("ActionColumn",t,u,t.extension().commandRow());$(u).each(function(){var n=this;if(n.path==f)return wi(n,r),!1});i.length?vu(t,i):cp(t._id)},ti),!1}),u}function ob(n){var i=$(n.target).closest(".ui-btn").find(".app-btn-more"),r=ai(n.clientX),u=yf(n.clientY),t;return i.length?(t=i.offset(),t.left-8<=r&&r<=t.left+i.outerWidth(!0)+8&&t.top-8<=u&&u<=t.top+i.outerHeight(!0)+8):!1}function sb(n){return n.closest(".ui-btn").find(".app-btn-more")}function oh(n){return String.format("app-style-dv-{0} app-style-c-{1} app-style-cv-{1}-{2}",n._id,n._controller,n._viewId)}function sh(n){return s(n).page.find('ul[data-role="listview"] li a')}function ar(n){$(arguments).each(function(t){t&&(n?$(this).addClass("app-btn-check-selected").closest(".ui-btn").addClass("app-checked").parent().addClass("app-checked"):$(this).removeClass("app-btn-check-selected").closest(".ui-btn").removeClass("app-checked").parent().removeClass("app-checked"))})}function hh(n){n.is(".app-cardcolumn")&&(n=n.parent());n.find("a.app-selected").removeClass("app-selected ui-btn-active")}function wl(t,i){function a(){e.length&&vu(t,e)}var u=t._selectedKeyList,o=u.length==0,f=w().find(".app-style-dv-"+t._id),e=ei(f),h=f.find(".dv-item .ui-btn:not(.app-calculated) .app-btn-check"),v=f.closest(".ui-page").find(".app-grid-header .app-btn-check, .dv-heading .app-btn-check"),y=n.stickyHeaderBar().find(".app-grid-header .app-btn-check"),c,l;if(o&&t._totalRowCount>sc){r.alert(String.format(si.Presenters.Charts.DataWarning,sc),function(){e.length&&n.contextScope(t._id);gu({mode:"everything"});n.contextScope(null)});return}if(u.splice(0,u.length),ar(o,h,v,y),o)if(h.length&&!t.extension().commandRow()&&(l=$(h[0]).closest(".ui-btn"),t.extension().tap(l.data("data-context"),"none"),e.length&&l.addClass("app-selected")),t._keyFields.length==1&&f.find(".dv-load-at-top,.dv-load-at-bottom,.dv-action-see-all").length){if(t._busy())return;c=t._createArgsForListOfValues(t._keyFields[0].Name);c.request.MaximumValueCount=sc;t._invoke("GetListOfValues",c,function(n){t._busy(!1);$(n).each(function(){u.push(this.toString())});t.set_selectedValue(u.join(";"));kl(t);a()})}else f.find(".dv-item .ui-btn:not(.app-calculated)").each(function(){u.push(t._createRowKey($(this).data("data-context").row))}),a();else i||t.extension().clearSelection(!0);t.set_selectedValue(u.join(";"));e.length?(ar(o,s(t).page.find(".app-wrapper .app-listview .app-btn-check, .dv-heading .app-btn-check")),a()):(s(t).echoChanged=!0,lt());kl(t)}function bl(n){return n.closest(".ui-page").find(".app-grid-header .app-btn-check, .dv-heading .app-btn-check")}function hb(n){return ru(s(n).page).find(".app-grid-header .app-btn-check")}function cb(n){var t=n._selectedKeyList.length;return t?" "+String.format(t>1?i.ItemsSelectedMany:i.ItemsSelectedOne,t)+".":""}function kl(n){var r=n._selectedKeyList.length,t=s(n),i=$.merge(t.page.find(".app-multi-select-instruction"),ho(n).find(".app-multi-select-instruction"));et()==n._id&&$.merge(i,ru(t.page).find(".app-multi-select-instruction"));i.text(cb(n));r>1&&co()}function co(n){n||(n=ru());n.find(".app-bar-text-instruction-hidden").removeClass("app-bar-text-instruction-hidden")}function dl(n,t){var h=n.extension(),a=t.find(".app-btn-check"),f=t.data("data-context"),i=n._selectedKeyList,c=i.length,v=f?n._createRowKey(f.row):n.get_selectedKey().join(";"),l=i.indexOf(v),r=t.closest(".ui-listview"),u=ei(r),y,p=hb(n),e,o,b=t.is(".app-selected");y=bl(r);l!=-1?(i.splice(l,1),ar(!1,a),b&&(hh(r),c>1?n._clearSelectedKey():h.clearSelection(!0),o=r.find(".dv-item.app-checked .ui-btn").first(),o.length?(h.tap(o.data("data-context"),"none"),u.length&&o.addClass("app-selected")):i.length&&n.sync(i[0])),u.length?vu(n,u):s(n).echoChanged=!0):(i.push(v),ar(!0,a),hh(r),f&&h.tap(f,"none"),u.length?t.addClass("app-selected"):s(n).echoChanged=!0);ar(i.length,y,p);u.length&&(r=w(n._id).find(".app-listview"),r.length&&(e=t.data("data-context"),r.find(".ui-btn").each(function(){var t=$(this),u=t.data("data-context"),f=0;if(e&&($(n._keyFields).each(function(){var t=n.findField(this.Name);e.row&&u&&u.row&&e.row[t.Index]==u.row[t.Index]&&f++}),f==n._keyFields.length))return checkBox=t.find(".app-btn-check"),l!=-1?ar(!1,checkBox):(hh(r),ar(!0,checkBox),t.addClass("app-selected")),ar(r,i.length,bl(r)),!1})));n.set_selectedValue(i.join(";"));(!c&&i.length||c&&!i.length)&&lt();kl(n)}function gl(n,t){var l=n._fields,a=n._allFields,s=!0,r=$('<div data-draggable="grid-header" class="app-grid-header app-grid-header-cv-'+n._id+"-"+n._viewId+'"><\/div>').appendTo(t).attr("data-for",n._id),h=ue(n),u=ds(n),f=u=="_none_",v=0,c,e;return n.get_showMultipleSelection()&&(e=$('<span class="app-btn-check"><\/span>').appendTo(r).attr("title",i.LookupSelectAction),n._selectedKeyList.length&&e.addClass("app-btn-check-selected")),(u!="_none_"||e)&&$('<span class="app-frozen-spacer '+h+'frozen_"/>').appendTo(r),$(l).each(function(){var e=this,t=a[e.AliasIndex],i,l,y,p,w,b;e.Hidden||t.GroupBy||e.OnDemand||e.Type=="DataView"||(i=$('<span data-draggable="grid-header-field"/>').addClass(vl(n,t)).attr("title",t.HeaderText).attr("data-field-name",t.Name).appendTo(r),t.Type.match(wv)?i.addClass("app-field-type-numeric"):t.Type=="Boolean"&&i.addClass("app-field-type-bool"),l=uu(n,t.Name),y=n.get_fieldFilter(t,!0),l||y?$('<b class="app-grid-header-text"/>').appendTo(i).text(t.HeaderText+" "):i.text(t.HeaderText),l&&ft("material-icon-arrow-"+(l.match(/^asc/i)?"upward":"downward"),i),y&&(b=ft("material-icon-filter-list",i),$(n._filter).each(function(){var n=this;if(n.startsWith(t.Name+":"))return p=n,!1}),p&&!o&&(w=n._filter,n._filter=[p],b.attr("title",n.extension().filterStatus(!0)),n._filter=w)),s&&(s=!1,tl(n,r)),c=$('<span class="app-field-separator" data-draggable="grid-header-separator"/>').appendTo(r),u!="_none_"?(i.addClass("app-frozen"),t.Name==u||u=="_first_"?(f=!0,u="_none_"):c.addClass("app-frozen")):f&&(i.addClass(h+" app-scroll"),f=!1),v++)}),r}function lb(n,t,r,u){if(n.get_showMultipleSelection()){var e=$('<span class="app-btn-check"><\/span>').appendTo(u).attr("title",i.LookupSelectAction),f;r||(f=n._createRowKey(t),n._selectedKeyList.indexOf(f)!=-1&&(e.addClass("app-btn-check-selected"),u.addClass("app-checked").parent().addClass("app-checked")))}}function na(n,t){var i=n.HyperlinkFormatString,r;return i&&(r=n._dataView._parseLocation(i,t)),r}function lo(n,t,i,u,f){if(f)switch(t.Type){case"Date":case"DateTime":n.removeAttr("data-smart-type data-smart-value data-smart-text")}if(g.ui.smartDates&&i!=null){var e,o;switch(t.Type){case"Date":case"DateTime":e=vb(n,t.Type,i,u,new Date);e&&(o=!0,n.attr({"data-smart-type":t.Type,"data-smart-value":JSON.stringify(i),"data-smart-text":u}));break;default:t._smartSize&&(e=r.sizeToText(i),n.text(e))}return e&&o&&!l.smartValueInterval&&(l.smartValueInterval=setTimeout(function(){ab();l.smartValueInterval=setInterval(ab,6e4)},6e4-(new Date).getSeconds()*1e3)),e}}function ab(n){n&&n.length||(n=$("[data-smart-value]"));var t=new Date;n.each(function(i){var r=n.eq(i),f=r.attr("data-smart-type"),u=JSON.parse(r.attr("data-smart-value")),e=r.attr("data-smart-text");switch(f){case"Date":case"DateTime":u=new Date(u)}vb(r,f,u,e,t)})}function vb(n,t,i,r,u){if(i)switch(t){case"Date":case"DateTime":var f=yb(i,u);return f?(n.text(f),!0):(n.removeAttr("data-smart-type").removeAttr("data-smart-value").removeAttr("data-smart-text").text(r),!1)}}function yb(n,t){var u,e;if(n==null)return null;var o=wr.AbbreviatedDayNames,r=i.Dates,s=t-n,h=s/864e5;if(h>=8||h<-14)return n.getYear()==t.getYear()?String.format("{0:"+wr.MonthDayPattern.replace(/M+/,"MMM")+"}",n)+ee(n):null;var c=new Date(t).setHours(0,0,0,0),l=new Date(n).setHours(0,0,0,0),f=(c-l)/864e5;return f>1?r.Last+" "+o[n.getDay()]+ee(n):f==1?r.Yesterday+ee(n):f==0?pb(n)?r.Today:(u=s/6e4,e=u/60,u%=60,s>0)?e>1?String.format("{0:"+wr.ShortTimePattern+"}",n):e==1?r.OneHour:u>2?String.format(r.MinAgo,Math.floor(u)):u>1?r.AMinAgo:r.JustNow:e<=-1?String.format("{0:"+wr.ShortTimePattern+"}",n):u<=-59?r.InHour:u<-2?String.format(r.InMin,-Math.floor(u)):u<-1?r.InAMin:r.Now:f==-1?r.Tomorrow+ee(n):f>=-7?o[n.getDay()]+ee(n):r.Next+" "+o[n.getDay()]+ee(n)}function pb(n){var t=n.getHours(),i=n.getMinutes(),r=n.getSeconds();return t==0&&i==0&&r==0}function ee(n){if(!pb(n)){var t=n.getSeconds(),i=n.getMinutes(),r=n.getHours();if(r||i||t)return t==0?", "+String.format("{0:"+wr.ShortTimePattern+"}",n):", "+String.format("{0:"+wr.LongTimePattern+"}",n)}return""}function ao(n,t,i,r,u){var l=n._fields,a=n._allFields,h=ue(n),e,f=ds(n),o=f=="_none_",c,s=!0,v=0;(f!="_none_"||n.get_showMultipleSelection())&&$('<span class="app-frozen-spacer '+h+'frozen_"/>').appendTo(r);r.attr("data-draggable","data-item");lb(n,t,u,r);$(l).each(function(l){var b=this,y=a[b.AliasIndex],g=y.itemColumnClass||vl(n,y),p,w,d,nt,k=b.Items,tt;b.Hidden||y.GroupBy||b.OnDemand||b.Type=="DataView"||(p=$('<span data-draggable="data-item"><\/span>').appendTo(r).addClass(g+" app-field app-field-"+y.Name),y.itemColumnClass||(y.itemColumnClass=g),tt=w=t[u?b.Index:y.Index],w==null?(nt=!0,p.addClass("app-null")):d=na(b,t),w=y.text(w,y.TextMode!=3),s&&tl(n,r,f!="_none_"),y.Type.match(wv)&&p.addClass("app-field-type-numeric"),u?(e=u?u[l]:null,e&&(w=t[b.Index],w=String.localeFormat(b.DataFormatString||"{0:n0}",w),p.text(w),$('<div class="app-static-text"><\/div>').text(e).insertBefore(p.contents()),p.attr("title",y.HeaderText+"\n"+e+" "+w))):(y.Type=="Boolean"?(p.addClass("app-field-type-bool"),ft("material-icon-"+(!nt&&k&&k.length>=2&&k[k.length-1][1]==w?"check-box":"check-box-outline-blank"),p)):gp(y,w,p,!0),p.attr("title",y.HeaderText+":\n"+w),d&&p.attr("data-href",d)),lo(p,y,tt,w),s&&i!=null&&$('<span class="app-item-number"/>').insertBefore(p.contents()).text(i+"."),u&&(c=$('<span class="app-field-separator"/>').appendTo(r)),f!="_none_"?(p.addClass("app-frozen"),y.Name==f||f=="_first_"?(o=!0,f="_none_"):u&&c.addClass("app-frozen")):o&&(p.addClass(h),o=!1),v++,s=!1)})}function yu(n,t,i,r,u,f,e,o){var b=n._allFields,rt=f.is("a"),k=$("<h3>").appendTo(f),nt=b[i.heading],s,l,y,p,w;if(rt&&lb(n,t,null,f),i.thumb!=null)if(s=t[i.thumb],s&&s.toString().match(/^null/))u.addClass("ui-li-has-thumb");else var yt=n.resolveClientUrl(n.get_appRootPath()),ht=b[i.thumb],bt=$('<img class="ui-li-thumb"/>').appendTo(f).attr({src:String.format("{0}blob.ashx?{1}=t|{2}{3}",yt,ht.OnDemandHandler,s,ht.OnDemandStyle==2?"&_nocrop":"")});if(s=t[i.heading],s=nt.text(s),rt&&f.attr("title",s),nt.HtmlEncode?k.text(s):k.html(s),k.addClass("app-field app-field-"+nt.Name).attr("title",nt.HeaderText+":\n"+k.text()),r&&$('<span class="app-item-number"/>').insertBefore(k.contents()).text(r+". "),k.contents().wrap('<span class="app-field-data"/>'),i.desc.length){var tt=$('<p class="app-para"/>').appendTo(f),d=tt,h,ct=1,ut;$(i.desc).each(function(n){var a=this,o=b[a],k=i.descLabels[n],nt=i.descPara[n],it=i.descColumn[n],v,l,w=o.HeaderText,c,y,p;nt&&(d.is(".app-para")||(tt=$('<p class="app-para"/>').appendTo(f),h||tt.insertAfter(d),d=tt,ct++),h=null);it&&(h||u.addClass("app-has-column"),h=$('<span class="app-column"/>').appendTo(f).addClass(h?"":"app-column-first"),v=100/i.descColumnCount+"%",h.css({minWidth:v,maxWidth:v}));s=t[a];y=s==null;c=$('<span class="app-item-desc"/>').insertAfter(d).addClass("app-field app-field-"+o.Name);h&&c.appendTo(h);d=c;s=o.text(s);e?(ut=$('<span class="app-field-data"/>').appendTo(c),gp(o,s,ut)):o.HtmlEncode||o.TextMode==3?c.text(s):c.html(s);e&&a==i.heading&&(c.addClass("app-item-heading"),r&&$('<span class="app-item-number"/>').insertBefore(ut.contents()).text(r+". "));l=c.contents();c.attr("title",o.HeaderText+":\n"+c.text());y||(i.descOriginal[n]!=null&&(o=b[i.descOriginal[n]]),p=na(o,t),p&&(l=l.wrap("<span/>").parent().attr("data-href",p)));k!=null&&((g.ui.list.labels.display=="DisplayedAbove"||e)&&$('<span class="app-field-label-before"/>').insertBefore(l.first()).text(w),g.ui.list.labels.display=="DisplayedBelow"&&$('<span class="app-field-label-after"/>').insertAfter(l.last()).text(w));y?l.wrap('<span class="app-null"/>'):e||l.wrap('<span class="app-field-data"/>');lo(e?l:l.parent(),o,t[a],s)});ct>1&&u.addClass("app-para-multi")}if(rt){var ft=n.extension(),pt=ft._commandRow,et,lt=n.get_actionGroups("ActionColumn",!0),wt=0,at=uo();if(lt.length&&o!=!0){et=$('<span class="app-action-column"/>').appendTo(f);var ot=v(f,"padding-left"),st=lt[0],vt=st.groupText,a=st.groupTextMaxWidth,it;vt&&!a&&(a=0,it=$('<span class="app-action-column"><span class="app-action-column-button"/><\/span>').appendTo(c).find("span"),$(vt).each(function(){it.text(this);a=Math.max(a,it.outerWidth())}),it.parent().remove(),st.groupTextMaxWidth=a);et.css({left:ot,maxWidth:a});ot+=a+at;f.css("padding-left",ot/at+"em");ft._commandRow=t;$(n.actionGroups("ActionColumn")).each(function(){$(this.Actions).each(function(){var n=this;wt++;$('<span class="app-action-column-button"/>').appendTo(et).text(n.HeaderText).attr({title:n.Description,"data-action-scope":"ActionColumn","data-action-path":n.Path})})});ft._commandRow=pt}i.aside!=null&&(u.addClass("app-li-has-aside"),l=$('<p class="ui-li-aside"/>').appendTo(f),y=b[i.aside],s=t[i.aside],s=y.text(s),y.HtmlEncode?l.text(s):l.html(s),l.addClass("app-field app-field-"+y.Name).attr("title",y.HeaderText+":\n"+l.text()),lo(l,y,t[i.aside],s),i.asideLabel&&$('<span class="app-field-label"/>').insertBefore(l.contents()).text(y.HeaderText));i.count!=null&&(l==null||i.desc.length)&&(p=$('<span class="ui-li-count"/>').appendTo(f),w=b[i.count],s=t[i.count],s=w.text(s),w.HtmlEncode?p.text(s):p.html(s),p.addClass("app-field app-field-"+w.Name).attr("title",w.HeaderText+":\n"+p.text()),lo(p,w,t[i.count],s),i.countLabel&&$('<span class="app-field-label"/>').insertBefore(p.contents()).text(w.HeaderText));tl(n,f)}}function ott(n,t,i){var r=n._headerImageField,e="t",u,f,o;r&&(f=i[r.Index],o=r.tagged("header-image-original"),typeof f!="string"||f.match(/^null\|/)||(r.tagged("header-image-original")&&(e=wf(v(t,"width"))),u=s(n),u.dataImage=String.format("{0}blob.ashx?{1}={2}|{3}&_nocrop",n.resolveClientUrl(n.get_appRootPath()),r.OnDemandHandler,e,r.format(i[r.Index])),u.dataImageOriginal=o))}function wb(n,t,i){var r=n.tagged(yv),u;!r&&n._lookupInfo&&(r=["","material-icon-playlist-add-check"]);r&&(i.find(".app-icon").remove(),ft(r[1],i.addClass("app-has-icon")),u=t.find(".app-page-modal-title"),u.length&&ft(r[1],u.addClass("app-has-icon")),t.addClass("app-has-icon"),ft(r[1],i).addClass("app-icon-background"))}function vi(t,i){function k(){var u,n,f,t;i.length>1&&(i=i.first());i.show().next().show();u=r.find(".app-wrapper");n=r.find(".app-page-header-fixed");n.is(".app-page-header")||(n=$('<div class="app-page-header app-page-header-fixed"><\/div>').insertBefore(u));n.html(i.html()).css("top",v(u,"top"));n.toggleClass("app-has-action-bar",i.is(".app-has-action-bar"));n.toggleClass("app-has-icon",i.is(".app-has-icon"));f=o&&o.dataImage;f&&(n.addClass("app-has-image"),i.addClass("app-has-image"),t=n.prev(),t.is(".app-page-header-image")||(t=$('<div class="app-page-header-image"><\/div>').insertBefore(n)),t.css("background-image",'url("'+f+'")'),o.dataImageOriginal&&t.addClass("app-page-header-image-original"))}function d(){i.hide().next().hide()}var h,r,c,y,l,u,e="",p,o,w,a,b,g;if(i)r=i.first().closest(".ui-page");else{if(r=f.activePage,!r)return;i=r.find(".app-page-header")}if(p=r.is(".app-page-modal"),o=s(r.attr("id")),y=i.find("h1"),l=i.find("h2"),c=r.attr("data-page-header")!="false",typeof t=="boolean")t&&c?k():d();else return h=i.data("data-text"),t?(h&&typeof h!="string"&&typeof t=="string"&&(h[1]=t,t=h),i.data("data-text",t)):t=h,t&&(typeof t=="string"?u=t.trim():(u=t[0].trim(),e=t[1].trim())),i.attr("data-locked")!="true"&&(y.length&&(y[0].innerText=u,u&&(a=u)),l.length&&(l[0].innerText=e,e&&(a+=" / "+e),e||(l[0].innerHTML="")),u&&(p?(w=r.find(".app-page-modal-title"),a=w.find(".app-text").text(u),e&&!w.next().is(".app-bar-actions")&&$("<span/>").appendTo(a).text(e)):(b=r.find(".app-page-header-placeholder"),b.length&&(g=b.find(".app-text").text(u),e&&$("<span/>").appendTo(g).text(e)))),o&&u&&(o.headerText=e?[u,e]:u,o.text=u)),(t!=n.title()||p)&&c||r.is(".app-page-header-show")?k():(d(),c&&r.attr("data-page-header","false")),t}function stt(n,t){var i=Math.ceil(p*.9);!t&&ro()?n.css({maxWidth:p-1,minWidth:p-1}):(i>800&&(i=800),n.css({maxWidth:i}))}function vo(n){var t=e("ui.transitions.style");if(!arguments.length)return t;n?e("ui.transitions.style",e("ui.transitions.currentStyle")):(e("ui.transitions.currentStyle",t),e("ui.transitions.style","none"))}function fr(t,u){var h,s,v,b,y,a;if(t||(t="search"),s=u?typeof u=="string"?$app.find(u):u._controller?u:$app.find(u.id):n.contextDataView(),t=="mode")return h=s.viewProp("searchMode"),h||"quickfind";if(t=="toggle"&&(h=fr("mode",s),h=h=="quickfind"?"advanced":"quickfind",s.viewProp("searchMode",h)),t=="enumerate"){var c=[],l,p=w(f.activePage),k=p.offset();return p.find(".app-echo").each(function(){var t=$(this),n=$app.find(t.attr("data-for")),i=n._totalRowCount,r=t.offset();i!=-1&&r.top>=k.top-1&&r.top<=k.top+p.height()-1&&c.push({text:n.get_view().Label,icon:"search",desc:n.extension().instruction(!1),count:i,callback:function(){fr("show",n)}})}),c.length&&(l=function(){c.length==1?c[0].callback():(c.splice(0,0,{text:hi.PerformAdvancedSearch}),it(c,"#app-panel-search-menu",{position:"right"}))}),l||(n.navContext(c),$(c).each(function(){var n=this;if(n.icon=="search")return l=function(){n.callback(n.context)},!1})),l&&setTimeout(l),l!=null}v=s.get_searchOnStart();b=f.activePage;v&&(s._totalRowCount=0,et()!=s._id?lh(s):lt(!1,0),s._requiresContextRefresh=!0,s.set_searchOnStart(!1));h=s.viewProp("searchMode")||"quickfind";y=n.contextDataView();a={id:s._id,start:v,search:!0};y&&y!=s&&r.read(y,"_survey.context.search")&&(n.pageInfo().deleted=!0,a=y.survey().context,v=a.start);v&&ui(function(){var t=n.pageInfo();yc(function(){var n=t.dataView.survey();n&&!t._canceled&&se(n.context.id)})});h=="advanced"?r.survey({controller:s._controller+"._search",parent:s._id,context:a,submitText:hi.PerformAdvancedSearch,submit:function(){},options:{discardChangesPrompt:!1,modal:{fitContent:!0}},fail:function(){fr("toggle",a.id)}}):r.survey({parent:s._id,controller:s._id+"-quickfind",context:a,topics:[{questions:[{name:"QuickFind",text:!1,placeholder:"Search in "+s.get_view().Label}]}],showActionButtons:"None",options:{modal:{fitContent:!0,always:!0,max:b.is(".app-page-modal")&&!b.is(".app-page-modal-dock")?"":"sm",title:!1,tapOut:!0,dock:"top"},actionButtons:!1,discardChangesPrompt:!1,contentStub:!1},layout:'<div class="app-container-search" data-container="simple" data-header-text="none" data-wrap="true" data-density="'+(o?"comfortable":"relaxed")+'"><div class="app-bar-search app-null"><i class="app-icon material-icon material-icon-search" title="'+hi.PerformAdvancedSearch+'">search<\/i><div data-container="row"><span data-control="field" data-field="QuickFind">[Query]<\/span><\/div><i class="app-icon material-icon material-icon-cancel" title="'+i.ClearText+'">cancel<\/i><i class="app-icon material-icon material-icon-more" title="'+i.More+'">more_'+(nr?"vert":"horiz")+"<\/i><\/div><\/div>",submitText:"Search",submit:function(t){var u=t.rules.dataView(),i=u.survey(),f=u.survey("data");n.pageInfo(u)._canceled=!0;vo(!1);e("ui.transitions.style","none");ui(function(){if(vo(!0),"QuickFind"in f){var n=f.QuickFind,t=i.context.id;!n&&i.context.start?se(t):kn(r.find(t),n)}else $app.alert("Create parameters for advanced search",function(){i.context.start&&se(i.context.id)})})}})}function bb(n){return n.forEach(function(t,i){if(t==null)t="";else{t=t.toString();var r;t.match(/\"/)?(r=!0,t=t.replace(/\"/g,'""')):t.match(/(\r|\n|,)/)&&(r=!0);r&&(t='"'+t+'"')}n[i]=t}),n.join(",")}function kb(n,t,i){if(navigator.msSaveBlob)return navigator.msSaveBlob(new Blob(["",t],{type:"data:attachment/text"}),n);var r=$('<a style="display: none;"/>').appendTo(c),u=window.URL.createObjectURL(new Blob(["",t],{type:i||"text/csv"}));r.attr({download:n,href:u})[0].click();r.remove();window.URL.revokeObjectURL(u)}function ta(t,u,e){function ut(n,t,i,u){var e=i.SearchOptions,f=t.FilterType;return{field:t.Name,originalField:i.Name,id:n._id,mappedId:n._mappedId,filterField:n._mappedId&&n._filterFields[0],headerText:t.HeaderText,scopeText:n._mappedId&&n.get_view().Label,filterType:f,operation:e&&r.filterDef(ct.Filters[f].List,e[0])&&e[0]||(f=="Boolean"?"$true":f=="Text"?"$contains":"="),value:null,value2:null,values:[],required:u==!0}}function ft(n,t,i){var r=a(),f=r._fields,u=r._allFields;$(u).each(function(){var f=this,s=u[f.AliasIndex],e=f.Search,o=e==1&&n=="Required",h=e==2&&n==="Suggested",c=e==4,l=!n&&t.length<3||o||h;s.AllowQBE&&l&&!c&&(!f.Hidden||o||h)&&t.push(ut(r,s,f,o&&i==!0))})}function b(n,t){var a=t.find(".app-condition-list-field").text(n.headerText),i=n.operation,c=ct.Filters[n.filterType],e=c.Kind.toLowerCase(),v=r.filterDef(c.List,i),l=!i.match(pv),y=l&&i=="$between",s=t.find(".app-condition-list-operation"),u=t.find(".app-input-container").first(),p=u.find(".app-input-value"),w=u.find(".app-input-text"),h=u.next(),f=h.next(),b=f.find(".app-input-value"),k=f.find(".app-input-text"),o=t.find(".app-condition-list-values");n.scopeText&&$("<span/>").appendTo(a).text(n.scopeText);s.text(v.Text);i.match(/month/)?s.addClass("app-condition-list-operation-month"):s.removeClass("app-condition-list-operation-month");p.text(e);w.attr("placeholder",e);b.text(e);k.attr("placeholder",e);l?u.show():u.hide();y?(h.show(),f.show()):(h.hide(),f.hide());u.find(":input").val(n.value);f.find(":input").val(n.value2);i=="$in"||i=="$notin"?(o.show(),o.text(n.lovText||ef.SelectLink),o.addClass("app-has-children")):o.hide();t.data("condition",n)}function pt(n,t){var r=$('<li class="app-condition ui-body-a"><\/li>').appendTo(t),f,u;return f=$('<a class="app-condition-list-field app-btn-select ui-btn ui-corner-all ui-btn-inline"/>').appendTo(r),(!n.required||r.closest(".app-conditions").prev().length)&&f.addClass("app-has-children"),$('<a class="app-condition-list-operation app-btn-select ui-btn app-has-children ui-corner-all ui-btn-inline"/>').appendTo(r),u=$('<div class="app-input-container ui-first-child"><\/div>').appendTo(r),$('<input type="text" class="app-input-text"/>').appendTo(u),$('<span class="app-input-value"/>').appendTo(u).css("visibility","hidden"),$('<span class="app-condition-and"/>').appendTo(r).text(ct.Filters.Labels.And),u=$('<div class="app-input-container ui-last-child"><\/div>').appendTo(r),$('<input type="text" class="app-input-text"/>').appendTo(u),$('<span class="app-input-value"/>').appendTo(u).css("visibility","hidden"),$('<a class="app-condition-list-values app-btn-select ui-btn ui-corner-all ui-btn-inline"/>').appendTo(r),$('<a class="ui-btn ui-btn-icon-notext app-btn-icon-transparent app-btn-more ui-btn-right"/>').appendTo(r).attr("title",i.More),b(n,r),r}function et(n,t){var r=$('<ul class="app-condition-list ui-body-a"/>').appendTo($('<div class="app-conditions"><\/div>').appendTo(s)).data("group",t),f=$('<li class="app-matching ui-body-a"><\/li>').appendTo(r),u;return $('<a class="app-condition-list-scope app-btn-select ui-btn app-has-children ui-corner-all ui-btn-inline"/>').appendTo(f).text(i[t.scope]),$('<a class="ui-btn ui-btn-icon-notext app-btn-icon-transparent app-btn-more ui-btn-right"/>').appendTo(f).attr("title",i.More),$(t.conditions).each(function(){pt(this,r)}),u=$('<li class="app-condition app-condition-more ui-body-a"><\/li>').appendTo(r),$('<a class="app-condition-list-field app-btn-select ui-btn ui-corner-all ui-btn-inline app-has-children"/>').appendTo(u).text(hi.AddConditionText),p(t).length||!h()&&ot().length||u.hide(),r.parent()}function wt(n,t,i){var r=r={scope:"MatchAll",required:!1},u=[],f=[];ft("Required",u,i);ft("Suggested",f);u.length?r.conditions=u.concat(f):f.length?r.conditions=f:(ft(null,u),r.conditions=u,t&&(n.push(r),r=JSON.parse(JSON.stringify(r)),r.scope="MatchAny"));n.push(r)}function p(n,t){function e(n,t){$(n._allFields).each(function(){var i=this,u=n._allFields[i.AliasIndex],f=i.Search,e=f==4;u.AllowQBE&&!e&&(!i.Hidden||i.Search>=1&&i.Search<=3)&&r.indexOf(u.Name+"."+n._mappedId)==-1&&(!n._mappedId||i.Name!=n._filterFields[0])&&t.push(i)})}var u=h(),i=[],r=[],f,o;if($(n.conditions).each(function(){r.push(this.field+"."+this.mappedId)}),f=r.indexOf(t),f>=0&&r.splice(f,1),e(a(),i),u){i._hasChildren=!0;for(o in u)e(u[o],i)}return i}function kt(n,t,i,r){var u;$(n).each(function(){var s=this,f=s._dataView,e=f._mappedId,h,o;o=f._allFields[s.AliasIndex];n._hasChildren&&(u?e&&u!=e&&(t.push({text:f.get_view().Label}),u=e):(t.push({text:f.get_view().Label}),u=f._id||e));h=i==o.Name+"."+e;t.push({text:o.HeaderText,icon:h?"check":!1,visible:h,context:{field:o.Name,originalField:s.Name,id:f._id,mappedId:e},callback:r})})}function dt(n,t,i){function e(t,u){for(var s=0;s<t.length;s++){var o=t[s],h=o&&o.Function,c=h==n.operation;o?o.List?e(o.List,u):f&&r.indexOf(h)==-1||u.push({text:o.Text,icon:c?"check":!1,visible:c,context:h,callback:i}):f||u.push({})}}var u=nt(n),o=u.findField(n.field),s=u.findField(n.originalField),r=s.SearchOptions,f=r&&r.length;e(ct.Filters[o.FilterType].List,t)}function k(n,t){var i=ot(),u=[];(nl().length||n==!0)&&($(i).each(function(){var n=r.find(this.id);u.push({Controller:n._controller,View:n._viewId,RequiresMetaData:!0,DoesNotRequireData:!0})}),r._invoke("GetPageList",{requests:u},function(r){if(n==!0||n()){var u={};$(r).each(function(n){var r=this,f=i[n],e=f.id,t=new Web.DataView($("<div><\/div>").appendTo(c));t._render=bt;r.Expressions=[];t._servicePath=a()._servicePath;t._controller=r.Controller;t._viewId=r.View;t._onGetPageComplete(r);t._filterFields=f.filterFields;t._mappedId=e;u[e]=t});h(u);t()}}))}function gt(n,t){var i=n.find(".ui-listview"),r=!o,u;r&&i.hide();items=[];t(items);rf(i);fv(i,items,{});i.listview("refresh");r&&i.show();u=n.data("position-options");n.popup("reposition",n.data("position-options"))}function ci(n,t,i){var r=[],u;t.mappedId&&!h()?r.push({text:st.Loading,icon:"material-icon-refresh",animate:!0,context:{},keepOpen:!0,callback:bt}):dt(t,r,i);rt({anchor:n,items:r,afterclose:function(){u=!0;promoteSearch()},afteropen:function(){var n=this;k(function(){return u!=!0},function(){gt(n,function(n){dt(t,n,i)})})}})}function ni(n,t,i,r){var s=a(),e=ot(),o=p(t,i),u=[],f;kt(o,u,i,r);e.length&&!h()&&u.push({text:st.Loading,icon:"refresh",animate:!0,context:{},keepOpen:!0,callback:function(){}});rt({anchor:n,items:u,afterclose:function(){f=!0;promoteSearch()},afteropen:function(){var n=this;k(function(){return f!=!0},function(){gt(n,function(n){kt(p(t,i),n,i,r)})})}})}function a(){return r.find(l.attr("data-scope"))}function h(n){if(arguments.length==0)return l.data("detail-map");l.data("detail-map",n)}function ot(t){t||(t=a());var i=[];return $(n._pages).each(function(){var r=this,n=r.dataView;n&&n._filterSource==t._id&&i.push({id:n._id,filterFields:n._filterFields.split(/,/)})}),i}function ti(t){var i=w(l),r=t.closest(".app-conditions"),u=r.offset();le(i,i.scrollTop()+u.top-(i.height()-r.outerHeight())/2,function(){n.blink(t.find(".app-matching .app-btn-select"),function(){o||t.find("input:visible").first().focus()})})}function ht(t){n.blink(t,function(){o||t.parent().find(":input:visible").first().focus()})}function li(){r.confirm(i.ResetSearchConfirm,function(){var n=a();n.viewProp("advancedSearchConfig",null);ta(n,null,"no")})}function ii(n,t){if(t&&t.length){var u=t.slice().reverse(),r=!0;$(u).each(function(){var t=this,f,u;n&&t.count<5||!n&&t.count>=5||(r&&(r=!1,$('<div class="app-clear-fix"><\/div>').appendTo(s),$('<div class="app-header"><\/div>').appendTo(s).text(n?i.Favorites:i.Recent)),f=$('<ul class="app-condition-list app-condition-list-history ui-body-a"/>').appendTo($('<div class="app-conditions"><\/div>').appendTo(s)),u=$('<li class="app-condition app-condition-history ui-body-a"><\/li>').appendTo(f),$("<div><\/div>").appendTo(u).text(t.date),$("<div><\/div>").appendTo(u).text(t.text),$('<a class="ui-btn ui-btn-icon-notext app-btn-icon-transparent app-btn-more ui-btn-right"/>').appendTo(u).attr("title",i.More))})}}function d(n){if(!n)return s.find(".app-clear-fix").nextAll().andSelf().detach();n.appendTo(s)}function ri(n,t){var i=-1;return $(n).each(function(n){if(this.text==t)return i=n,!1}),i}function fi(n,t,i){var u=n[ri(n,t)],r=a();r.viewProp("advancedSearchConfig",u.config);le(w(),0,function(){ta(r,null,i)})}function nt(n){return r.find(n.id)||h()[n.mappedId]}function ai(){var t,n;g.pageTransition!="none"&&u&&e!="none"&&(t=f.navigate.history.stack,t[t.length-1].transition="slidedown");n=s.find("input:visible").first();n.length&&(u&&!n.val().length&&(n.val(u),n.closest(".app-condition").data("condition").value=u),o||(hn(n,n.val().length),n.focus()))}var yi=t.get_filter(),pi=t.extension(),y=n.content("advanced-search"),l=y.closest(".ui-page"),it=y.find(".app-page-header"),at=t.get_view().Label,vt=i.AdvancedSearch,s=y.find(".app-panel-filter"),yt=t.viewProp("advancedSearchRecent"),v,tt,ei,lt,oi,si;if(fn(),yh(),n._contextButton.show().removeClass("ui-icon-dots").addClass("ui-icon-carat-d").attr("title",hi.HideAdvancedSearch),l.attr("data-scope")!=t._id||l.attr("data-view")!=t._viewId){if(l.attr("data-scope",t._id),l.attr("data-view",t._viewId),tt=h(),tt)for(ei in tt)lt=tt[ei],lt._element.remove(),lt.dispose();h(null);w(l).data("scroll-top",null)}if(it.attr("data-locked","false"),vi(at==n.title()?[vt,""]:[at,vt],it),it.attr("data-locked","true"),l.addClass("app-page-search app-page-scrollable"),!s.length){s=$('<div class="app-panel-filter"><\/div>').appendTo($("<div><\/div>").appendTo(y)).on("vclick",function(t){var u=$(t.target).closest(".ui-btn"),f=s.data("config");u.length&&n.callWithFeedback(u,function(){var l,t,e,n;if(u.is(".app-btn-more"))if(u.parent().is(".app-matching"))rt({anchor:u,iconPos:"left",tolerance:2,items:[{text:ou.Delete.HeaderText,icon:"trash",callback:function(){var n=u.closest(".app-condition-list"),i=n.data("group"),t=!0;$(n).find(".app-condition").each(function(){var n=$(this),i=n.data("condition");if(i&&i.required)return t=!1,rt({anchor:n.find(".app-condition-list-field"),title:eu.RequiredField}),!1});t&&(f.splice(f.indexOf(i),1),n.find(".app-condition").data("condition",null),n.data("group",null).parent().remove())}},{text:ou.Duplicate.HeaderText,icon:"duplicate",callback:function(){var n=u.closest(".app-condition-list").data("group"),t,i=d();n=JSON.parse(JSON.stringify(n));f.push(n);t=et(a(),n);s.find(".app-matching-more").closest(".app-conditions").appendTo(s);d(i);ti(t)}}],afterclose:promoteSearch});else if(u.parent().is(".app-condition-history")){var g=a(),w=u.parent().find("div").last().text(),c=g.viewProp("advancedSearchRecent");u.parent().addClass("app-selected");rt({anchor:u,iconPos:"left",tolerance:2,items:[{text:hi.PerformAdvancedSearch,icon:"search",callback:function(){fi(c,w,"search")}},{text:ou.Edit.HeaderText,icon:"edit",callback:function(){fi(c,w,"no")}},{},{text:ou.Delete.HeaderText,icon:"trash",callback:function(){c.splice(ri(c,w),1);g.viewProp("advancedSearchRecent",c);var n=u.closest(".app-conditions");n.prev().is(".app-header")&&!n.next().is(".app-conditions")&&(n.prev().remove(),n.prev().remove());n.remove()}}],afterclose:function(){u.parent().removeClass("app-selected");promoteSearch()}})}else u.parent().is(".app-condition")&&rt({anchor:u,iconPos:"left",tolerance:2,items:[{text:ou.Delete.HeaderText,icon:"trash",callback:function(){var n=u.closest(".app-condition-list"),t=n.data("group"),i=u.parent(),r=i.data("condition");r.required&&!u.closest(".app-conditions").prev().length?rt({anchor:i.find(".app-condition-list-field"),title:eu.RequiredField}):(t.conditions.splice(t.conditions.indexOf(r),1),i.data("condition",null).remove(),n.find(".app-condition").length<=1?(f.splice(f.indexOf(t),1),n.data("group",null).parent().remove()):p(t).length&&n.find(".app-condition-more").show())}}],afterclose:promoteSearch});else if(u.is(".app-btn-select"))if(u.is(".app-condition-list-scope")){t=u.closest(".app-condition-list").data("group");function v(n){t.scope=n;u.text(i[n])}rt({anchor:u,iconPos:"left",items:[{text:i.MatchAll,context:"MatchAll",icon:t.scope=="MatchAll"?"check":!1,callback:v},{text:i.MatchAny,context:"MatchAny",icon:t.scope=="MatchAny"?"check":!1,callback:v},{text:i.DoNotMatchAll,context:"DoNotMatchAll",icon:t.scope=="DoNotMatchAll"?"check":!1,callback:v},{text:i.DoNotMatchAny,context:"DoNotMatchAny",icon:t.scope=="DoNotMatchAny"?"check":!1,callback:v}],afterclose:promoteSearch})}else if(u.parent().is(".app-matching-more")){function y(n){wt(f,!1,f.length==0);var t=f[f.length-1],i,r=d();t.scope=n;i=et(a(),t);u.closest(".app-conditions").appendTo(s);d(r);ti(i)}rt({anchor:u,items:[{text:i.MatchAll,context:"MatchAll",callback:y},{text:i.MatchAny,context:"MatchAny",callback:y},{text:i.DoNotMatchAll,context:"DoNotMatchAll",callback:y},{text:i.DoNotMatchAny,context:"DoNotMatchAny",callback:y}],afterclose:promoteSearch})}else if(u.parent().is(".app-condition-more"))l=u.closest(".app-condition-list"),t=l.data("group"),ni(u,t,null,function(n){var i=nt(n),r=ut(i,i.findField(n.field),i.findField(n.originalField)),f;t.conditions.push(r);f=pt(r,l);u.parent().appendTo(l);p(t).length?u.parent().show():u.parent().hide();ht(f.find(".app-condition-list-field"))});else if(u.is(".app-condition-list-field")){var l=u.closest(".app-condition-list"),t=l.data("group"),e=u.parent(),o=e.data("condition");o.required&&!u.closest(".app-conditions").prev().length?rt({anchor:e.find(".app-condition-list-field"),title:eu.RequiredField}):ni(u,t,o.field+"."+o.mappedId,function(n){var f=nt(n),i=ut(f,f.findField(n.field),f.findField(n.originalField));i.value=o.value;i.value2=o.value2;r.filterDef(ct.Filters[i.filterType].List,o.operation)&&(i.operation=o.operation);t.conditions[t.conditions.indexOf(o)]=i;b(i,e);ht(u)})}else if(u.is(".app-condition-list-operation"))e=u.parent(),n=e.data("condition"),ci(u,n,function(t){n.operation=t;b(n,e);ht(u)});else if(u.is(".app-condition-list-values")){e=u.parent();n=e.data("condition");function tt(){var t=nt(n),i=n.field;ert(u,t,i,n.lov,function(r){var s=r.match(/^\w+\:((\$\w+)\$|=)(.+)$/),f=t.findField(i),u=n.operation,h,o,c=[];s?(h=n.lov=s[3],o=s[1],o=="="?u="=":u=="$in"?o=="$in$"||(u="$notin"):o=="$in$"||(u="$in"),n.operation=u,u=="="?(n.value=f.text(t.convertStringToFieldValue(f,h)),n.lovText=null,n.lov=null):($(h.split(/\$or\$/g)).each(function(){var n=t.convertStringToFieldValue(f,this.toString());c.push(f.text(n))}),n.lovText=c.join(", "))):(n.lov=null,n.lovText=null);b(n,e);promoteSearch()},promoteSearch)}n.mappedId&&!h()?k(!0,tt):tt()}})});s.on("change",function(n){var t=$(n.target),i,r;t.is(".app-input-text")&&(i=t.closest(".app-condition").data("condition"),r=t.val(),t.parent().is(".ui-first-child")?i.value=r:i.value2=r)}).on("vclick",function(n){var t=$(n.target);if(t.is(".app-condition"))return t.find(":input:visible").first().focus(),!1});$('<div class="app-promo-filler"><\/div>').appendTo(y);$(document).on("sidebar.app",function(n){if(re()){var t=n.items;t.splice(0,t.length);t.push({text:i.AdvancedSearchInstruction,isStatic:!0,wrap:!0});t.push({});t.push({text:hi.ResetAdvancedSearch,icon:"refresh",callback:li})}}).on("search.app",function(t,i){function e(){var n,d=h(),t=a(),g={MatchAll:"_match_:$all$",MatchAny:"_match_:$any$",DoNotMatchAll:"_donotmatch_:$all$",DoNotMatchAny:"_donotmatch_:$any$"},o={positive:[],negative:[]},v,c,l,y,e,p=[],w=[],b={},k=0,f;$(u).each(function(t){var i=this,u,f;$(i.conditions).each(function(e){function rt(n,i,r){return{gIndex:t,cIndex:e,text:n,focus:i,focus2:r}}var s=this,c=s.operation,ut=!c.match(pv),ft=s.value,y,et=s.value2,p,nt=r.find(s.id)||s.mappedId&&d[s.mappedId],tt=nt.findField(s.field),it=tt.Name,l,a,v="",ot;if(ut?(String.isBlank(ft)?s.required&&(n=rt(eu.RequiredField,!0)):(y={NewValue:ft.trim()},a=nt._validateFieldValueFormat(tt,y,!0),a?n=rt(a,!0):v=nt.convertFieldValueToString(tt,y.NewValue)),n||c=="$between"&&(String.isBlank(et)?s.required&&(n=rt(eu.RequiredField,!1,!0)):(p={NewValue:et.trim()},a=nt._validateFieldValueFormat(tt,p,!0),a&&(n=rt(a,!1,!0))),y&&p&&(!n&&y.NewValue>=p.NewValue&&(n=rt(et+" "+ig.LessThanOrEqual+" "+ft,!1,!0)),n||(v+="$and$"+nt.convertFieldValueToString(tt,p.NewValue))))):(c=="$in"||c=="$notin")&&(v=s.lov,ut=!0),n)return!1;if(!ut||v){if(s.mappedId&&(l=h()[s.mappedId],l==null))return;u||(u=!0,f=i.scope.startsWith("DoesNot")?o.negative:o.positive,f.push(g[i.scope]),k++);c.match(/\$/)&&(c+="$");s.mappedId&&(ot=new Sys.StringBuilder,l._fieldNameHint={},l._fieldNameHint[it]=s.headerText+" ("+s.scopeText.toUpperCase()+")",l._renderFilterDetails(ot,[it+":"+c+v],!1),it+=","+l._controller+"."+(l._viewId||"grid1")+"."+s.filterField,b[it.replace(/\W/g,"_")+(k-1)]=ot.toString());f.push(it+":"+c+v)}else w.push(s)});u||p.push(i)});n?(v=s.find(".app-condition-list").get(n.gIndex),c=$($(v).find(".app-condition").get(n.cIndex)),l=n.focus?c.find(".ui-first-child .app-input-text"):n.focus2?c.find(".ui-last-child .app-input-text"):c.find(".app-condition-list-field"),rt({anchor:l,title:n.text,xOffset:8,yOffset:"bottom",afterclose:function(){l.is(":input")&&l.focus();promoteSearch()}})):(t.viewProp("advancedSearchFilter",o.positive.concat(o.negative)),$(u).each(function(){var n=this;$(w).each(function(){var t=n.conditions.indexOf(this);t>=0&&n.conditions.splice(t,1)})}),$(p).each(function(){var n=u.indexOf(this);n>=0&&u.splice(n,1)}),t.viewProp("advancedSearchConfig",u.length==0?null:u),t.viewProp("deepSearchInfo",b),u.length&&(y=t._filter,t._filter=[],e=t.extension().filterStatus(),t._filter=y,f=t.viewProp("advancedSearchRecent")||[],$(f).each(function(n){var t=this;if(t.text==e)return t.date=tw(),t.count++,f.splice(n,1),f.push(t),e=null,!1}),e&&(f.push({text:e,date:tw(),count:1,config:u}),f.length>30&&f.splice(30,1)),t.viewProp("advancedSearchRecent",f)),i())}n.promo(!1);var u=[],f;s.find(".app-condition-list").each(function(){var n=$(this).data("group");n&&(u.push(n),$(n.conditions).each(function(){this.mappedId&&(f=!0)}))});f&&!h()?k(!0,e):e()})}if(v=t.viewProp("advancedSearchConfig"),v||(v=[],wt(v,!0,!0)),s.data("condition",null),s.find(".app-condition").data("condition",null),s.data("config",v).find(".app-condition-list").data("group",null).parent().remove(),s.find(".app-header,.app-clear-fix").remove(),$(v).each(function(){et(t,this)}),oi=$('<ul class="app-condition-list app-condition-list-more ui-body-a"/>').appendTo($('<div class="app-conditions"><\/div>').appendTo(s)),si=$('<li class="app-matching app-matching-more ui-body-a"><\/li>').appendTo(oi),$('<a class="app-condition-list-field app-btn-select app-has-children ui-btn ui-corner-all ui-btn-inline"/>').appendTo(si).text(i.AddMatchingGroup),ii(!0,yt),ii(!1,yt),$('<div class="app-clear-fix"><\/div>').appendTo(s),e=="no"){n.blink(s.find(".app-condition-list-scope"));return}if(e=="search"){n.blink(s.find(".app-condition-list-scope"),function(){ia(!1)});return}ui(ai);sl(l);f.changePage("#advanced-search",{changeHash:!0,transition:"none"})}function ia(t){t?k(n.promo(),function(){ia()}):$(document).trigger("search.app",function(){var t=$("#advanced-search"),i=r.find(t.attr("data-scope")),n=f.navigate.history.stack;n[n.length-1].transition="none";li(function(){eo(i)})})}function oe(n){n.find(".app-listview a").removeData();n.find('ul[data-role="listview"]').listview("destroy").remove()}function se(n){var t=$app.find(n);t._requiresContextRefresh=!0;t.sync()}function htt(n,t){var u,f;typeof n=="string"&&(n=r.find(n));f=n.extension().viewStyle();t.push({});f!="Grid"||n.tagged("grid-fit-none")||(u=n.viewProp("grid-is-fitted")!=!1,t.push({text:i.FitToWidth,icon:u?"check":!1,callback:function(){var t=n.gridSettings();t&&(t.width={},n.gridSettings(t));pu(n,!u,!0);yo(n);ur();ce();wu();hr()}}));f.match(/Grid|List|Cards/)&&!n.tagged("multi-select-none")&&(!n._lookupInfo||n._lookupInfo.multiSelect)&&t.push({text:i.MultiSelection,icon:n.multiSelect()?"check":!1,callback:function(){n.multiSelect(!n.multiSelect());yo(n);n.sync()}});t.push({text:fu.Refresh,icon:"refresh",context:n._id,callback:se})}function ra(n){n.find(".app-echo-inner .app-selected").removeClass("app-selected")}function ua(t,u){function v(i){function c(n){var r=parseInt(o.attr("data-start-index")),u=parseInt(o.attr("data-end-index")),t=n=="next"?u+1:r-1,i=0;return t<0&&(t=0),i=Math.floor(t/h.extension().pageSize()),{action:n,rowIndex:t,pageIndex:i,ensurePageIndex:Math.max(n=="next"?i+1:i-1,0),pageY:f.offset().top}}var u=$(i.target),f=u.closest("a"),r=f.find(".app-btn-next"),o=f.find(".app-info"),s=t+"_echo",e=ai(i.pageX);r.length&&e>=r.offset().left&&e<r.offset().left+r.outerWidth()+4?u=r:(r=f.find(".app-btn-prev"),r.length&&e>=r.offset().left&&e<r.offset().left+r.outerWidth()?u=r:(f.find(".app-btn-see-all").addClass("ui-btn-active"),u=f));u.is(".app-btn-disabled")||(f.removeClass("ui-btn-active"),k(u,function(){u.removeClass("ui-btn-active");setTimeout(function(){u.is(".app-btn-next")?vr(s,c("next")):u.is(".app-btn-prev")?vr(s,c("prev")):n.changePage(t)},25)}))}var f=$('<div class="app-echo"><\/div>').appendTo(u).attr({id:t+"_echo","data-for":t}),l,a,c,h=r.find(t),e,y=s(t);y.echoChanged=!0;e=$('<div class="app-echo-toolbar"><h3><\/h3><a class="ui-btn ui-btn-inline ui-corner-all ui-icon-dots ui-btn-icon-notext app-btn-more"/><div class="app-echo-controls"><\/div><span class="app-echo-see-all"/><\/div>').appendTo(f);l=e.find("h3");h.get_showViewSelector()||l.addClass("app-hidden");e.find(".ui-icon-dots").attr("title",i.More).css("visibility","hidden");e.find(".ui-icon-carat-r").attr("title",i.SeeAll).toggleClass("ui-icon-recycle").prev().hide();ft("material-icon-chevron-right",e.find(".app-echo-see-all").html(i.SeeAll));e.find(".app-echo-controls");h.get_showActionBar()||e.hide();$('<div class="app-echo-instruction"><\/div>').appendTo(f).hide();a=$('<div class="app-echo-inner"><\/div>').appendTo(f).on("vclick taphold",function(i){var e=$(i.target),r=e.closest("a"),b,u,o,a,h,y=i.type,l=y!="taphold"&&!i.ctrlKey,p=r.is(".dv-action-see-all"),w;if(!e.closest(".app-presenter").length||p){if(c){c=!1;return}if(r.length&&!r.is(".app-divider")&&tu(e,y)&&(!p||l)&&!n.busy())if(p)v(i);else{if(e.is("[data-href]"))return;if(n.contextScope(t),b=s(t),u=b.dataView,o=u.extension(),h=r.data("data-context"),w=r.is(".app-selected"),u._hasKey()){if(eb(i,u))return!1;a=u.get_showMultipleSelection();l&&a&&pl(i)?dl(u,r):(ra(f),l?r.addClass("app-selected"):w?r.removeClass("app-selected"):r.addClass("app-selected"),sh(u).removeClass("app-selected"),l?(a&&r.find(".app-btn-check").addClass("app-btn-check-selected"),o.tap(h,"none"),pf(u,r),ob(i)?go(sb(e)):o.tap(h)):(w?o.clearSelection():o.tap(h,"none"),y=="taphold"&&(c=!0)),k(e));vu(u,f)}else n.infoView(u,!0,h.row);n.contextScope(null)}if(!e.closest(".app-grid-header").length)return!1}}).on("contextmenu",function(n){return fd(s(t).dataView,n)});$('<div class="app-echo-footer"><\/div>').appendTo(f).on("vclick",function(){var t=$(event.target),n=t.closest("a");return n.length&&n.is(".dv-action-see-all")&&v(event),!1});return $('<div class="app-echo-empty"><\/div>').appendTo(a).text(st.Loading),db(f),e.find("h3").text(s(t).text),o||f.find(".app-echo-inner").attr("tabindex",0),h._hidden&&f.hide(),f}function er(t,i,r){var o,e,u,h=0;t?f.activePage.find(".app-echo-toolbar").each(function(){o=$(this).parent();e=o.attr("data-for");u=s(e);u.echoId&&!u.dataView._busy()&&vr(u.echoId)}):wt||tt||or?(clearTimeout(ny),ny=setTimeout(function(){er(t,i)},50)):(n.callWhenVisible(r||".app-echo",function(t){setTimeout(function(){e=t.attr("data-for");u=s(e);u&&u.dataView&&!u.dataView._busy()&&!u.dataView.get_isForm()&&(u.echoInitialized?u.echoChanged&&vr(u.echoId):(u.echoId=t.attr("id"),n.pageInit(u.id,!1)&&vr(u.id+"_echo")))},i==null?h:i);h+=50}),f.activePage.find(".app-echo-controls.app-stale").each(function(){var n=ei($(this).removeClass("app-stale")),t=n.attr("id"),i=s(t.substring(0,t.length-5));lh(i.dataView,n)}))}function db(n){var t=e("ui.displayDensity.value");t!="Condensed"&&t!="Tiny"&&(t=="Comfortable"&&Math.min(p,nt)<=414?n.addClass("app-density-compact"):t=="Compact"&&Math.min(p,nt)<=320&&n.addClass("app-density-condensed"))}function ch(n,t,i){var r=n.find("h3").empty().text(t.get_view().Label||i.text),u=t._totalRowCount;return n.length&&u>0&&($("<span> (<\/span>").appendTo(r),$('<span class="app-echo-count"><\/span>').appendTo(r).text(u),$("<span>)<\/span>").appendTo(r),o||r.attr("title",r.text())),r}function he(n){var i=ue(n),t=n.session(i);return t||(t=ks(),t.text("."+i+"frozen_{display:none!important}"),n.session(i,t)),t}function pu(n,t,i){if(arguments.length>=2)n.session("grid-is-fitted",t),i&&n.viewProp("grid-is-fitted",t?null:!1);else{var r=n.session("grid-is-fitted");return r!=null&&n.session("window-width")!=p&&(r=null),r==null&&(r=n.viewProp("grid-is-fitted"),r==null&&(r=!n.tagged("grid-fit-none")),n.session("grid-is-fitted",r)),r}}function fa(n,t){var r=n.session("grid-avail-width"),i,u=pu(n);r!=null&&(t.find(".app-hscrollbar-inner").width(r),b.height&&ei(t).length&&(i=t.parent(),i.parent().width()>=r?i.hide():i.show()))}function gb(n,t){var r=n.session("grid-avail-width"),i=t.find(".app-hscrollbar");ei(t).length||i.css("margin-right",b.width);fa(n,i);ce(t)}function wu(n){var t;n||(n=f.activePage,t=!0);n.find(".app-grid-header").each(function(){var u=$(this),s=u.height(),e=u.find("[data-field-name]").first(),o,n,i,f;s&&e.length&&(o=u.attr("data-for"),n=r.find(o),i=n.session("grid-header-style"),i||(i=ks(),n.session("grid-header-style",i)),(t||n.session("reset-grid-header"))&&(i.text("").data("text",""),n.session("reset-grid-header",null)),f=".app-grid-header-cv-"+n._id+"-"+n._viewId+" > span {height:"+(u.height()-parseFloat(e.css("padding-top"))*2)+"px}",i.data("text")!=f&&i.data("text",f).text(f))})}function bu(n,t,i,r){function f(){ea(n,t)}function e(){d.scrollingAnimationFrame=null;i&&(t=-1*n.session("scroll-left"));var c=o+"-last-scroll-left",h=n.session(c),l=n.session("scroll-left-margin")||0,a=Math.abs(Math.abs(t)-Math.abs(h));i&&h!=null&&a==0||(r&&t<(h||0)&&f(),u.html("."+o+"{margin-left:"+(t?t+l+"px!important":"inherit")+";transition:margin-left "+(r?s+"ms ease-out":"0 linear")+"}"),n.session(c,t),r?setTimeout(function(){f();bu(n,t)},s+64):f());i&&(d.scrollingAnimationFrame=requestAnimationFrame(e))}var u=n.session("scroll-style"),o=ue(n),h=+new Date,s=384;if(u||(u=ks(),n.session("scroll-style",u)),arguments.length>=2)if(i){if(d.scrollingAnimationFrame)return;d.scrollingAnimationFrame=requestAnimationFrame(e)}else e();return u}function ctt(){var t=$(this),i,n;t.data("ignore-scrolling")||(i=r.find(t.attr("data-view")),n=-t.scrollLeft(),bu(i,n),n=t.scrollLeft(),i.session("scroll-left",n),ea(i,n))}function ea(n,t){var i=he(n),r=t?"inline-block":"none",u=n.session("grid-frozen-width")||0;if(i&&(i.data("display")!=r||i.data("width")!=u))return i.html("."+ue(n)+"frozen_{display:"+r+"!important;width:"+u+"px}"),i.data("display",r).data("width",u),!0}function ltt(n){n.session("scroll-left",0);var t=n.session("scroll-style");t&&(t.remove(),n.session("scroll-style",null))}function ce(n,t){n||(n=f.activePage);n.find(".app-hscrollbar").each(function(){var u=$(this),n=r.find(u.attr("data-view")),i=n?n.session("scroll-left"):null,e=u.closest(".app-grid");he(n);e.length||(e=f.activePage.find(".app-grid"));(n.session("grid-avail-width")<e.width()||t)&&(i=0,n.session("scroll-left",i));fa(n,u);i!=null&&(u.data("ignore-scrolling",i>0).scrollLeft(i),t?bu(n,i,!1):ea(n,i),setTimeout(function(){u.removeData("ignore-scrolling")},100))})}function nk(n,t,i){var r=n.extension(),u=r.aggregateLabels(),f=$('<div class="app-bar-aggregate-list"><\/div>').appendTo(t);$(n._fields).each(function(t){var o=this,h=n._allFields[o.AliasIndex],s=u[t],r,e,c;s&&(r=i[o.Index],r=String.localeFormat(o.DataFormatString||"{0:n0}",r),e=$('<a class="ui-btn ui-inline app-calculated app-btn-static"/>').appendTo(f),$('<span class="app-calculated-label"/>').text(h.HeaderText).appendTo(e),c=$('<span class="app-calculated-value"/>').text(r).appendTo(e),$('<div class="app-static-text"><\/div>').text(s).insertBefore(c.contents()),e.attr("title",h.HeaderText+"\n"+s+" "+r))})}function tk(t,i){if(!t._checkedStartCommand){t._checkedStartCommand=!0;var r=t.get_lastCommandName(),u=t.get_lastCommandArgument();function f(){var t=[];n.navContext(t);$(t).each(function(){var n=this;if(n.command==r&&(!u||u==n.argument))return n.callback(n.context),!1})}r&&(i?f():ui(f))}}function vr(t,r){function tu(){ii&&(nk(e,dt.show().empty(),ii),f.activePage.find(".app-echo:visible").length==1&&k.prev().is(".app-page-header,.app-tabs")&&(g-=dt.outerHeight()))}function iu(){$(c).each(function(n){var t=this;if(e.rowIsSelected(t))return rt=n,y.commandRow()||(y.tap(t,"none"),y.currentPageIndex(bt)),!1});ut=c.length}function tr(){var n;r?(rt=null,r.action=="prev"?(p=r.rowIndex-l+1,p<0&&(p=0),lastPageRowIndex=r.rowIndex%ni,n=lastPageRowIndex-l+1,n>0?c=c.slice(n,lastPageRowIndex+1):(c=c.slice(0,lastPageRowIndex+1),r.pageIndex&&(tt=y.visibleDataRows(r.pageIndex-1),tt&&(c=tt.slice(tt.length+n).concat(c))))):(p=r.rowIndex,n=r.rowIndex%ni,c=c.slice(n,n+l+1),c.length<l&&(tt=y.visibleDataRows(r.pageIndex+1),tt&&(c=c.concat(tt)))),iu()):rt!=null&&l<ht&&(vi=Math.floor(l/2),lt=p+rt-vi+1,ht-(p+rt)<vi&&(lt-=vi-(ht-(p+rt))),lt<0&&(lt=0),lt!=p&&(lt>p?(c=c.slice(0),c.splice(0,lt-p),rt-=lt-p,p=lt,c.length<l&&bt<y.pageCount()-1&&(tt=y.visibleDataRows(bt+1),tt&&(c=c.concat(tt)))):bt>0&&(tt=y.visibleDataRows(bt-1),tt&&(tt=tt.slice(0),tt.splice(0,ni-(p-lt)),rt+=tt.length,p=lt,c=tt.concat(c)))),ut=ni)}function yi(n,t,r){n.empty().removeClass("ui-btn-icon-left");var u=$('<span class="app-btn-prev"/>').appendTo(n).text(i.Prev).attr("title",fu.Previous);return t||u.addClass("app-btn-disabled"),u=$('<span class="app-btn-next"/>').appendTo(n).text(i.Next).attr("title",fu.Next),r==ht-1&&u.addClass("app-btn-disabled"),$('<span class="app-info"/>').appendTo(n).attr({"data-start-index":t,"data-end-index":r}).html(String.format(fu.ShowingItems,t+1,r+1,ht)),n}function au(n){if(r){var u=n.offset().top,t=Math.ceil(r.pageY)-Math.ceil(u),i;t>0&&t+n.outerHeight(!0)<nt.height()&&(i=n.parent().prev("li").first().find("a"),i.length&&$('<div class="app-listview-stub"><\/div>').height(t).appendTo(i))}}var k,hi,ir,rr,ri,sr,cr,it,ot,st,ar,kt,yr,eu,pr;if(!or&&(k=$("#"+t),k.length)){hi=k.is(".app-echo-embedded");k.removeClass("app-density-condensed app-density-compact");var nt=w(k),ou=nt.scrollTop(),su=k.outerHeight(),h=k.find(".app-echo-inner").show(),dt=h.next().hide(),hu=k.attr("data-for"),pt=s(hu),e=pt.dataView,wi=kc(e),ht=e._totalRowCount,y=e.extension(),bt=r?r.pageIndex:y.currentPageIndex()||0,ni=y.pageSize(),p=bt*ni,ci,lt,c=y.visibleDataRows(bt),tt,u,a,d,ti,li,ui=e.get_showRowNumber()==!0,bi=$(k).find(".app-echo-toolbar"),cu=bi.find(".app-echo-controls"),wr=bi.find(".app-echo-see-all"),br,kr=h.prev(),ki=y.instruction(!1),at=y.viewStyle(),ai=y.itemMap(at=="List"),lu=f.getScreenHeight(),g=nt.height()*.55,fi,rt,ut,l,vi,ft,wt,dr,ei,di=e.get_selectedKey().length>0,oi,gr,gi,ii=y.aggregates(),nu,nr;if(e._checkedAutoSelect||(e._checkedAutoSelect=!0,y._autoSelect&&(oi=y._autoSelect,y._autoSelect=null,oi&&!n.busy()&&(pt.echoChanged=!0,n.contextScope(e._id),y.tap(oi.row,oi.action),e._selectedKeyList=[e._createRowKey(oi.row)],n.contextScope(null),di=!0))),tk(e,!0),!k.is(":visible")){pt.echoChanged=!0;return}if(pt.echoChanged=!1,db(k),!c||r&&ni*r.ensurePageIndex<ht&&!y.visibleDataRows(r.ensurePageIndex)){e.goToPage(r&&r.pageIndex||0,!0);y.echoCallback=function(){y.echoCallback=null;vr(t,r)};return}if(br=ch(bi,e,pt),pt.echoInitialized||(pt.echoInitialized=!0,pt.refreshed=!1),hi||(k.css("padding-bottom",""),wt=nt.find(".app-stub,.app-stub-main"),wt.length||(wt=$("<div><\/div>").appendTo(nt).addClass("app-stub"+(ib()?"-main":""))),wt.height(wt.outerHeight()+h.outerHeight(!0))),ki&&(c.length||ki.match(/"app-filter"/))?kr.html(ki).show():kr.hide(),fi=h.scrollLeft(),h.find(".app-hscrollbar").off(),oe(h),nu=h.find('div[data-role="presenter"]').detach(),h.empty(),nu.appendTo(h),n.presenter("hide",{container:h}),c.length||e.get_searchOnStart()&&at=="Grid"){if(h.removeClass("app-no-scrolling app-horizontal-scrolling"),e._filterSource||nt.find(".app-echo").filter(io).length!=1?o||nt.css("overflow",""):(g=lu-h.offset().top,o||(g-=v(k,"padding-top")+v(k,"padding-bottom"),at&&at.match(/List|Grid|Cards/)?(nt.css("overflow",""),gr=!0):nt.css("overflow",""))),ha(e,h),n.presenter("supports",at)&&(ir=[],rr=!1,n.presenter("enumerate",{id:e._id,list:ir}),$(ir).each(function(){if(this.name==at)return rr=!0,!1}),h.addClass("app-no-scrolling").height(""),rr&&n.presenter("show",{name:at,id:e._id,container:h,maxHeight:Math.ceil(g)})?nr=!0:at=lp()?"Grid":"List"),!nr)if(r||iu(),at=="Grid"){h.addClass("app-no-scrolling").height("");oe(h);u=$('<ul class="app-listview app-grid" data-role="listview"/>').addClass(oh(e)).appendTo(h);a=$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(u);gl(e,a);a=$('<li data-icon="false" class="dv-item"/>').appendTo(u);c.length&&ao(e,c[0],null,$("<a/>").appendTo(a));u.listview().listview("refresh");ti=a.outerHeight();ur(u);wu(u);g-=a.prev().outerHeight()+1;l=Math.ceil(g/(ti+1));ii&&(l-=2);a.remove();l<4&&(l=4);tr();var et=[],vt=[],si=0,yt,er;$(c).each(function(n){var i=this,f=p+n+1,t=$('<li data-icon="false" class="dv-item"/>').appendTo(u),r=$('<a class="ui-btn"/>').appendTo(t).data("data-context",{row:this.slice(0),pageIndex:0});return ao(e,i,ui?f:null,r),n==rt&&(ei=i,r.addClass("app-selected")),bf(e,i,t,wi),ci=p+n,!rt||n<rt?et.push(t):vt.push(t),l<ut&&l-1==n?!1:void 0});ii&&(a=$('<li data-icon="false" class="dv-item"/>').appendTo(u),d=$('<a class="app-divider app-calculated"/>').appendTo(a),ao(e,ii,null,d,y.aggregateLabels()));function ru(){ft=$('<a class="dv-action-see-all"/>').appendTo($("<li/>").appendTo(u)).html("text")}if(ri=$('<li class="app-echo-grid-hscrollbar"><div class="app-hscrollbar"><div class="app-hscrollbar-inner"><\/div><\/div><\/li>').height(b.height),sr=ri.find(".app-hscrollbar").attr("data-view",e._id),he(e),ri.appendTo(u),b.height){sr.on("scroll",ctt);fa(e,sr);requestAnimationFrame(function(){gb(e,ri)});g-=ri.outerHeight()}else ri.hide();(l<ut||ut<ht)&&ru();u.listview().listview("refresh");ft&&(g-=ft.outerHeight());u.find(".dv-item").each(function(){si+=$(this).outerHeight()});function uu(){yt&&(si-=yt.outerHeight(),yt.find(".ui-btn").removeData(),yt.remove())}if(si>g){if(ft||(ru(),g-=ft.outerHeight()),vt.length)while(et.length+vt.length+1>3&&si>g)yt=null,er=="before"?(er="after",et.length>1&&et.length>=vt.length&&(yt=et[0],et.splice(0,1),p++)):(er="before",vt.length>1&&vt.length>et.length&&(yt=vt[vt.length-1],vt.splice(vt.length-1,1),ci--)),uu();else while(et.length>3&&si>g)r&&r.action=="prev"?(yt=et[0],et.splice(0,1),p++):(yt=et[et.length-1],et.splice(et.length-1,1),ci--),uu();u.listview("refresh")}ft&&(yi(ft.toggleClass("ui-btn-icon-right ui-btn-icon-left"),p,ci),au(ft))}else if(at=="List"){for(l=30,tr(),h.addClass("app-no-scrolling").height(""),oe(h),tu(),u=$('<ul class="app-listview app-onecolumnview" data-role="listview"/>').addClass(oh(e)).appendTo(h).listview(),cr=0,it=rt==null?0:rt,ur(u),ca(e,u),r&&(it=r.action=="next"?0:c.length-1),ot=it,st=it,ft=$('<li data-icon="false" class="dv-item"><a class="ui-btn dv-action-see-all"/><\/li>').appendTo(u),g-=ft.outerHeight(),ft.remove();it>=0&&it<c.length;){var pi=c[it],vu=p+it+1,a=$('<li data-icon="false" class="dv-item"/>'),d=$('<a class="ui-btn"/>').appendTo(a).data("data-context",{row:pi.slice(0),pageIndex:0});if(r&&r.action=="prev"&&yr?a.insertBefore(yr):a.appendTo(u),yr=a,yu(e,pi,ai,ui?vu:null,a,d,!0),it==rt&&(ei=pi,d.addClass("app-selected")),u.listview("refresh"),bf(e,pi,a,wi),cr+=a.outerHeight(),cr>=g&&st-ot>=3){eu=!0;break}r?r.action=="next"?(st++,it=st):(ot--,it--):kt=="up"?(a.insertBefore(ar),ar=a,st<c.length-1?(kt="down",st++,it=st):(ot--,it=ot)):kt=="down"?ot>0?(kt="up",ot--,it=ot):(st++,it=st):(ar=a,ot>0?(ot--,kt="up",it=ot):(st++,kt="down",it=st))}st-ot<ht&&(kt=="down"||r&&r.action=="next"?st--:ot++,eu&&(d.removeData(),a.remove()),a=$('<li data-icon="false" class="dv-item"/>').appendTo(u),d=yi($("<a/>").appendTo(a).addClass("dv-action-see-all"),p+ot,p+st),u.listview("refresh"),d.toggleClass("ui-btn-icon-left ui-btn-icon-right"))}else{if(l=30,tr(),ut=c.length,u=$('<ul class="app-listview app-cardcolumn" data-role="listview"/>').hide().appendTo(h),a=$('<li data-icon="false" class="dv-item"/>').appendTo(u),d=$('<a class="ui-btn"/>').appendTo(a),tu(),yu(e,c[0],ai,ui?1:null,a,d),u.listview().show(),ti=a.outerHeight(!0),li=Math.floor(h.innerWidth()/a.outerWidth(!0)),l=Math.floor(g/ti),l<1&&(l=1),u=dt.find(".app-echo-container-see-all").hide(),ht>ut&&(dt.show(),u.length?(u.show(),d=u.find(".ui-btn")):(u=$('<div class="app-echo-container-see-all"><\/div>'),ii?u.insertBefore(dt.find(".app-bar-aggregate-list")):u.appendTo(dt),d=$('<a class="ui-btn-icon-left ui-btn-icon-right ui-btn dv-action-see-all"/>').appendTo(u)),ft=yi(d,p,p+ut-1),g-=u.outerHeight(!0),o||(g-=8),l=Math.floor(g/ti),l<1&&(l=1)),li*l>=c.length&&(l=Math.ceil(c.length/li),h.addClass("app-no-scrolling")),ht>ut&&li*l>=ut&&h.addClass("app-no-scrolling"),h.is(".app-no-scrolling")||(h.addClass("app-horizontal-scrolling"),o||(l=Math.floor(g/ti),l<1&&(l=1))),oe(h),$(c).each(function(n){if(n>=ut)return!1;u&&n%l!=0||(u=$('<ul class="app-listview app-cardcolumn" data-role="listview"/>').addClass(oh(e)).appendTo(h),ha(e,u),ca(e,u));var t=this,f=p+n+1,i=$('<li data-icon="false" class="dv-item"/>').appendTo(u),r=$('<a class="ui-btn"/>').appendTo(i).data("data-context",{row:this.slice(0),pageIndex:0});yu(e,t,ai,ui?f:null,i,r);n==rt&&(ei=t,r.addClass("app-selected"));bf(e,t,i,wi)}),ut>l&&(pr=l-ut%l,pr<l))while(pr-->0)a=$('<li data-icon="false" class="dv-item"/>').appendTo(u),d=$("<a/>").appendTo(a),yu(e,c[0],ai,ui?1:null,a,d),d.css("visibility","hidden").parent().addClass("app-hidden");l==ht&&u.addClass("app-list-one-column");ur(h.find(".app-listview").listview());u=h.find(".app-listview").first();u.length&&!o&&h.height(u.height()+b.height+8);d=h.find(".app-selected");d.length&&(dr=d.offset().left-h.offset().left+d.outerWidth(),dr>h.width()&&(fi=d.offset().left-h.offset().left-(h.width()-d.outerWidth())/2));r&&(r.action=="next"?fi=0:(u=h.find(".app-listview").last(),fi=u.offset().left+u.outerWidth()-h.offset().left));h.scrollLeft(fi);ft&&yi(ft,p,p+ut-1)}}else $('<div class="app-echo-empty"><\/div>').appendTo(h.height("")).text(ct.NoRecords);hi||(k.prev().is(".app-echo")||k.next().is(".app-echo")||k.css("padding-bottom",0),gw(nt,wt),(nt.scrollTop()||gr&&wt.first().prev().offset().top+wt.first().prev().height()>nt.offset().top+nt.height())&&nt.css("overflow",""));nr||(di?ei||r?e.rowIsSelected(y.commandRow())||(y.clearSelection(),y.tap(ei,"none")):y.clearSelection():y.commandRow()&&y.clearSelection());wr.css("visibility",ht==0?"hidden":"");lh(e,k,di,cu,br,wr);hi&&hr(nt);gi=$(".app-data-input");gi.length&&!gt&&gi.offset().top>k.offset().top?nt.scrollTop(ou+k.outerHeight()-su):lr(nt,null,!0);e.get_searchOnStart()&&fr("show",e)}}function lh(n,t,i,r,u,f){if(i==null&&(i=n.get_selectedKey().length>0),!r){if(t||(t=ho(n)),!t.length)return;r=t.find(".app-echo-toolbar .app-echo-controls");u=r.parent().find("h3");f=r.next()}var e=u.next().css("visibility",""),o=e.offset().left+e.outerWidth(),s=f.offset().left-16;ik(n,r,o,s)}function ik(t,i,r,u,f,e){function v(n){return n.offset().left+n.outerWidth()>d+p-1}var b=[],y=[],k,d,p,s=[],w=[],l,a={},o,h,c;if(r==0||u==0)i.addClass("app-stale");else if(u-r>=28){if(i.find(".ui-btn").data("data-context",null),i.hide().contents().remove(),k=n.contextScope(),n.contextScope(t._id),t.extension().context(b,["ActionBar"]),n.contextScope(k),$(b).each(function(){var n=this;n.system?n.icon!="search"||f||y.push(n):n.text&&!n.isStatic&&y.push(n)}),$(y).each(function(){var r=this,n,t=r.icon,u;l=r.group;e&&t==e||(n=$('<a class="ui-btn"/>').appendTo(i).data("data-context",r).attr("title",lc(r)),t=="dots"||r.transition?n.addClass("app-has-children ui-mini").text(r.text):(n.addClass("ui-mini ui-btn-icon-left"),t=="search"?n.toggleClass("ui-btn-icon-left ui-btn-icon-notext ui-mini "):n.text(r.text),t=bo(t),u=nh(t),u&&ft(t,n),t==!1&&n.removeClass("ui-btn-icon-left"),o=a[l],o||(o=a[l]=[]),o.push(n)))}),p=u-r,i.width(p).show(),d=i.offset().left,i.find(".ui-btn").each(function(){var n=$(this);n.is(".ui-btn-icon-left")&&w.push(n);v(n)&&s.push(n)}),s.length)for(w.reverse();s.length;){if(h=s[0],c=v(h),c&&(isGeneric=h.is(".ui-icon-carat-r"),isGeneric?s.push(h):h.is(".ui-btn-icon-left")&&(h.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),c=v(h)),!isGeneric&&c&&$(w).each(function(){var n=this;if(s.indexOf(n)==-1&&n.is(".ui-btn-icon-left")&&(n.is(".ui-icon-carat-r")?n.hide():n.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),c=v(h),!c))return!1}),c)){$(s).each(function(){this.hide()});break}s.splice(0,1)}else for(l in a)o=a[l],o.length>1&&($(o).each(function(){$(this).addClass("app-group-item")}),o[0].addClass("app-group-first"),o[o.length-1].addClass("app-group-last"));$('<a class="ui-btn ui-btn-icon-notext ui-corner-all"/>').appendTo(i).css("visibility","hidden")}else i.hide()}function att(n,t){var i=$('<div class="app-bar-actions ui-header ui-bar-inherit ui-header-fixed"><\/div>').insertBefore(t),u=$("<h3/>").appendTo(i).text(s(n).text),r;return $('<a class="ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-dots app-btn-more"/>').appendTo(i),r=$('<div class="app-bar-controls"><\/div>').appendTo(i),i.data({selector:u,controls:r}),i}function vtt(){var n=wt||tt;return n==!0}function tu(n,t){var i;if(wt||tt||d.dragged())return!1;if(gt)if(i=$(n).closest("a"),i.data("scroll-check")==!0)i.data("scroll-check",!1);else{or=!1;var r=i.closest(".app-wrapper,.ui-panel-inner"),u=r.data("scroll-stop-time"),f=r.scrollTop();return u&&gf()-u.getTime()>5e3?!0:(i.data("scroll-check",!0),setTimeout(function(){t||(t="vclick");f==r.scrollTop()?($(n).is(".app-btn-more")?n:i).trigger(t):(tu(i,t),kt())},10),!1)}return!0}function lt(t,i,r){function u(){var u,e;if(tt)lt(t,ti,r);else{if(pe=null,u=f.activePage,u.is(".app-page-modal")){e=[];n.navContext(e);n.refreshAppButtons(e,{toolbar:!1,actionBar:!0,promo:!0,buttonBars:u.find(".app-bar-buttons")});return}var o=et(),i=eh(),s=i.data("page-id"),h=n.contextScope();s==o&&yl(i);n.contextScope(null);i.find(".app-show-request").removeClass("app-show-request").show().trigger("show.sidebar.app");i.find(".app-hide-request").removeClass("app-hide-request").hide().trigger("hide.sidebar.app");n.refreshTitleState();n.refreshContextMenu(i.data("page-id",o));n.contextScope(h);n.refreshMenuStrip();r&&r()}}lg||(i==null&&(i=ag),pe&&(clearTimeout(pe),pe=null),t||(i?pe=setTimeout(u,i):u()))}function rk(n,t){if(arguments.length==1)return r.cache[n];r.cache[n]=t}function ku(n,t){if(n=location.pathname.replace(/\W/g,"_")+"_"+n,arguments.length==1)return ot(n);ot(n,t)}function ot(n,t){if(nc||(nc=g.appInfo.replace(/\W/g,"_")),n=nc+"_"+n,arguments.length==1){if(typeof Storage!="undefined")try{return t=localStorage[n],t!=null&&(t=JSON.parse(t)),t}catch(i){}return null}if(typeof Storage!="undefined")if(t==null)localStorage.removeItem(n);else try{localStorage[n]=JSON.stringify(t)}catch(i){}}function uk(n,t){var u={text:t,resolved:!0,description:null,type:null},i=n.attr("data-activator"),o,f,s,h=$(n).prev(".DataViewHeader").text(),e;return i||(s=n.closest("div[data-activator]"),i=s.attr("data-activator"),n=s),i&&(o=n.parent(),f=o.attr("id"),f||(f="aid"+cg++,o.attr("id",f)),u.container=f),i||(i=h),i&&i!="false"?(i=r.eval(i),e=pd.exec(i),e?(u.text=e[4]||e[2],u.type=e[1]):u.text=i):u.resolved=!1,u.description=n.attr("data-activator-description"),u}function oa(n,t){return(t?n.tagged("action-call"):n.tagged("action-call","field-call"))||n.Name.match(dd)&&(!t||!n.tagged("action-call-disabled"))}function sa(n,t){return(t?n.tagged("action-email"):n.tagged("action-email","field-email"))||n.Name.match(gd)&&!(t||!n.tagged("action-email-disabled"))}function ytt(n,t){return(t?n.tagged("action-url"):n.tagged("action-url","field-url"))||n.Name.match(ng)&&(!t||!n.tagged("action-url-disabled"))}function ha(n,t){n.get_isTagged("thumb-person")||n._controller.match(/\b(emp|acc|user|usr|person|cust)/i)&&!n.get_isTagged("thumb-standard")?t.addClass("app-thumb-person"):t.removeClass("app-thumb-person")}function ca(n,t){n.get_showMultipleSelection()?t.addClass("app-listview-multiselect"):t.removeClass("app-listview-multiselect")}function le(n,t,i){n.data("scrolling",!0).animate({scrollTop:t},"swing",function(){tt=!1;i&&i();setTimeout(function(){n.removeData("scrolling")},100)})}function fk(t,i,r){var u,e,f;if(r||(r={}),u=$(t),e=r.position||"right",dt(),sf=null,u.length)f=u.find("ul"),!u.is(".ui-panel-open")&&f.length>1&&(f.first().parent().css({transition:"none",transform:"none"}).removeClass("app-list-container-reverse"),f.slice(1).remove());else{u=$(String.format('<div data-position-fixed="true" data-role="panel" data-draggable="panel" data-theme="a" data-display="overlay" class="app-popup-icon-left ui-panel ui-panel-display-overlay ui-panel-animate ui-panel-position-{0}"><ul/><\/div>',e)).appendTo(c).panel({animate:rh(),position:e,beforeopen:function(){if(b.width){var n=u.find(".ui-panel-inner").css({width:"","overflow-y":"scroll"});n.width(n.width()+b.width)}u.find(".ui-panel-inner").attr("tabindex",0);bi(!1);of=!0;we&&(clearTimeout(we),we=null);i&&i()},open:function(){setTimeout(function(){of=!1;kt();r&&r.afteropen&&r.afteropen();$(".ui-panel-open .ui-panel-inner").focus();bi(!0)})},beforeclose:function(){bi(!1);of=!0;yl(u)},close:function(){setTimeout(function(){bi(!0);of=!1;sf&&sf();n.contextScope()&&(we=setTimeout(function(){n.contextScope(null);we=null},1e3));sf=null;cr();r&&r.close&&r.close()})}});rh(u);r.className&&u.addClass(r.className);dw(u);t.match(/^#/)&&u.attr("id",t.substring(1));u.find("ul").listview();u.on("vclick",function(n){var t=$(n.target).closest("a"),r=t.closest("li").attr("data-icon"),i;if(of||!t.length||!tu(t))return!1;if(i=t.data("context-action"),i&&!ry){if(i.dataRel)return!0;i.feedback==!1?(kt(),i.keepOpen==!0||i.transition?(wi(i,t,!0),al(t)):(u.panel("close",r!="dots"&&r!=ut),sf=function(){setTimeout(function(){wi(i,t)},10)})):i.keepOpen==!0||i.transition?k(t,function(){wi(i,t,!0);al(t)}):k(t,function(){var n,f,o,e;i.icon==ut&&(n=t.closest(".ui-panel-inner").find("ul"),f=n.first());n&&n.length>1?(bi(!1),o=f.parent().addClass("app-list-container-reverse").css({transition:"",transform:"translate3d("+-(-v(f,"margin-right")+f.closest(".ui-panel").outerWidth()*(n.length-2))+"px,0,0)"}).one("transitionend",function(){setTimeout(function(){n.last().remove();o.removeClass("app-list-container-reverse");nb($(n[n.length-2]).find(".app-focus"));bi(!0)})})):(e=t.attr("href"),e?l.location.href=e:(u.panel("close",r!="dots"&&r!=ut),sf=function(){setTimeout(function(){wi(i,t)},rh()?10:ti)}))})}return ry=!1,!1}).on("swipe",function(){});no(u,!1);r&&r.resetScrolling&&u.addClass("app-reset-scrolling")}return u}function iu(){n.contextScope()=="_contextMenu"?n._menuPanel.panel("toggle"):n.toggleContextPanel("#app-panel-context")}function ru(t){return n.stickyHeaderBar(t)}function ae(t){t!=null?(clearTimeout(fy),fy=setTimeout(function(){n.fetchOnDemand()},t)):n.fetchOnDemand()}function yr(t){n.stickyHeader(t)}function ptt(n){ru(n).hide()}function wtt(n){ptt(n);yr(n)}function it(t,i,r){var u=$(".ui-panel-open"),s,f,e,c,l,o,h;if(u.length){bi(!1);f=u.find(".ui-panel-inner").addClass("app-multi-list");e=f.find(".app-list-container");e.length||(f.contents().wrap('<div class="app-list-container"><\/div>'),e=f.find(".app-list-container"));s=u.outerWidth();h='[data-panel="'+i+'"]';o=f.find(h);o.length||(o=$("<ul/>").attr("data-panel",i).appendTo(e).listview());c=u.find("ul").width(s);l=c.first();at=t;n.refreshContextMenu(u,at,h);e.css({transition:"",transform:"translate3d("+-(-v(l,"margin-right")+s*o.prevAll("ul").length)+"px,0,0)"}).one("transitionend",function(){setTimeout(function(){o.nextAll("ul").remove();r&&r.afteropen&&r.afteropen();bi(!0);$(".ui-panel-open .ui-panel-inner").focus()})})}else return at=t,(n.contextScope()&&(!r||r.position!="left")||r&&r.position!="right")&&(i+="-scope",r||(r={}),r.position="left"),fk(i,function(){n.refreshContextMenu(i,at)},r).panel("toggle")}function ek(n){var r=new Sys.StringBuilder,o=n._fields,i,f,u=n.get_sortExpression(),e=fs,t;if(u)for(t=e.exec(u);t;)i=n.findField(t[1]),f=!t[3]||t[3].match(/^asc/)?"asc":"desc",i&&i.AllowSorting&&(r.isEmpty()||r.append(", "),r.appendFormat("{0} ({1})",i.HeaderText,du(i,f))),t=e.exec(u);return r.toString()}function ok(n){var i=new Sys.StringBuilder,o=n._fields,r,e,u=n.get_groupExpression(),f=fs,t;if(u)for(t=f.exec(u);t;)r=n.findField(t[1]),e=!t[3]||t[3].match(/^asc/)?"asc":"desc",r&&r.AllowSorting&&(i.isEmpty()||i.append(", "),i.appendFormat("{0}",r.HeaderText)),t=f.exec(u);return i.toString()}function ve(n){n.extension()._instructed=!1;s(n).stickyHeader.find(".app-bar-text").removeData("html")}function la(n,t){var e=n.groupExpression(),i=n.get_sortExpression(),f,u=0;if(e&&i){for(i=i.split(r._simpleListRegex);u<i.length;)f=i[u].match(/(\w+)(\s+\w+)?/),!i[u]||f&&e.indexOf(f[1])!=-1?i.splice(u,1):u++;i=i.join(",");n.set_sortExpression(i);n.viewProp("sortExpression",i)}n.viewProp("groupExpression",t);n.set_groupExpression(t);ve(n);n._keepKeyList=!0;n.AutoPivots=null;yo(n);n.sync()}function aa(n){n.session("reset-grid-header",!0)}function yo(n){$(n._views).each(function(){var i=this,t=i.Id;i.Type!="Form"&&(n.session("grid-style-changed",!0,t),n.session("grid-avail-width",null,t),n.session("window-width",null,t))})}function ah(){var t=n.contextDataView();ci!=null&&(t.set_sortExpression(ci),ci=null,ve(t),t._keepKeyList=!0,aa(t),t.sync())}function uu(n,t,i){var e=ci==null?n.get_sortExpression()||"":ci,o=e.split(r._simpleListRegex),u,f;if(i==null){if(e)for(u=0;u<o.length;u++)if(f=o[u].match(tg),f&&f[1]==t)return f[3]||"asc";return null}ci=i?String.format("{0} {1}",t,i):"";n.viewProp("sortExpression",ci)}function du(n,t){var i=st.GenericSortAscending,r=st.GenericSortDescending;switch(n.FilterType){case"Text":i=st.StringSortAscending;r=st.StringSortDescending;break;case"Date":i=st.DateSortAscending;r=st.DateSortDescending}return t=="asc"?i:r}function fi(n,t){at=n;t?setTimeout(t,500):po()}function btt(n,t){var r=$app.find(n),i="",u=t.closest("ul").find(".app-layout-size").filter(function(){return $(this).find(".app-icon").length>0});fileName=r._controller+"."+r._viewId+".html";u.each(function(){var n=$(this).data("context-action");i+="\n<!--  "+n.text+" -->\n"+fp(r,pt(n.context));i+="\n"});i&&(i=String.format("<!--\n\t~/views/{0}\n-->\n",fileName)+i.replace(/<span\s+class=\"app-control-inner\">([\s\S]+?)<\/span>/g,"$1").replace(/\n\s*>/g,">"),kb(fileName,i,"text/html"))}function ktt(){function u(n,t){var i=t.find(".app-icon");i.length?(i.remove(),t.removeClass("app-has-material-icon")):ft("material-icon-check",t)}var e=at,t=[{text:i.Back,icon:ut,callback:function(){fi(e)}},{text:"Form Layout",isStatic:!1,instruction:!0},],o=n.dataView(),r;t.push({text:i.Download,icon:"material-icon-file-download",context:o._id,keepOpen:!0,callback:btt});r=wf(f.activePage.width());t.push({text:os.FormLayoutInstr,instruction:!0});t.push({text:"Tiny (tn)",icon:r=="tn"?"check":!1,keepOpen:!0,context:"tn",linkClassName:"app-layout-size",callback:u});t.push({text:"Extra Extra Small (xxs)",icon:r=="xxs"?"check":!1,keepOpen:!0,context:"xxs",linkClassName:"app-layout-size",callback:u});t.push({text:"Extra Small (xs)",icon:r=="xs"?"check":!1,keepOpen:!0,context:"xs",linkClassName:"app-layout-size",callback:u});t.push({text:"Small (sm)",icon:r=="sm"?"check":!1,keepOpen:!0,context:"sm",linkClassName:"app-layout-size",callback:u});t.push({text:"Medium (md)",icon:r=="md"?"check":!1,keepOpen:!0,context:"md",linkClassName:"app-layout-size",callback:u});t.push({text:"Large (lg)",icon:r=="lg"?"check":!1,keepOpen:!0,context:"lg",linkClassName:"app-layout-size",callback:u});t.push({text:"Extra Large (xl)",icon:r=="xl"?"check":!1,keepOpen:!0,context:"xl",linkClassName:"app-layout-size",callback:u});t.push({text:"Extra Extra Large (xxl)",icon:r=="xxl"?"check":!1,keepOpen:!0,context:"xxl",linkClassName:"app-layout-size",callback:u});it(t,"#app-panel-developer-tools-form-layout")}function dtt(){var u=at,t=[{text:i.Back,icon:ut,callback:function(){fi(u)}},{text:os.Tools,isStatic:!1,instruction:!0},],r=n.dataView();t.push({text:os.Explorer,icon:"material-icon-build",shortcut:"Ctrl+Shift+D",callback:bt});r&&r.get_isForm()&&t.push({text:"Form Layout",icon:!1,transition:!0,callback:ktt});it(t,"#app-panel-developer-tools")}function gtt(){function t(n){n=="OnHover"&&c.addClass("app-show-system-buttons-on-hover");n=="Always"&&c.removeClass("app-show-system-buttons-on-hover");ot("showSystemButtons",n);e("ui.showSystemButtons",n)}var r=at,u=[{text:i.Back,icon:ut,callback:function(){fi(r)}},{text:i.ShowSystemButtons,isStatic:!1,instruction:!0},{text:i.OnHover,icon:e("ui.showSystemButtons")=="OnHover"||e("ui.showSystemButtons")=="Auto"&&!o?"check":!1,context:"OnHover",callback:t},{text:i.Always,icon:e("ui.showSystemButtons")=="Always"?"check":!1,context:"Always",callback:t},];n.contextScope("_contextMenu");it(u,"#app-panel-settings-showsystembuttons")}function sk(){function t(t){aw();n.contextScope(null);e("ui.sidebar.when",t);ot("sidebar",t);fo();ki(!0)}var u=at,r=e("ui.sidebar.when"),f=[{text:i.Back,icon:ut,callback:function(){fi(u)}},{text:i.Sidebar,isStatic:!1,instruction:!0},{text:i.Landscape,icon:r=="Landscape"?"check":!1,context:"Landscape",callback:t},{text:i.Always,icon:r=="Always"?"check":!1,context:"Always",callback:t},{text:i.Never,icon:r=="Never"?"check":!1,context:"Never",callback:t}];n.contextScope("_contextMenu");it(f,"#app-panel-settings-sidebar")}function va(n){var n=n.toLowerCase();return n=="tiny"&&(n="condensed app-font-tiny"),"app-density-"+n}function ya(n){return"app-theme-"+n.toLowerCase()}function nit(n,t,i){var f=new Date,o=g.appInfo.split("|")[1],r,u,e;f.setMonth(f.getMonth()+1);document.cookie=".COTTHEME"+o+"="+t+";expires="+f.toUTCString()+";path=/";u=$("link.app-theme");u.length&&(r=u.attr("href"),r.indexOf("appservices")>-1?r=r.replace(new RegExp(RegExp.escape(n),"i"),t):(e=t.split("."),r=r.substring(0,r.indexOf("Theme.ashx")+17)+e[0]+"&accent="+e[1]),$.ajax({url:r,dataType:"text"}).done(function(){u.attr("href",r);i()}))}function hk(n,t){var i=g.ui.theme,r=i.name,u=i.accent;n.theme?i.name=n.theme.name:n.accent&&(i.accent=n.accent.name);t.closest(".ui-panel-inner").find(".app-item-theme-"+(n.theme?"name":"accent")+" i").remove();ft("material-icon-check",t);setTimeout(function(){e("ui.theme.name",i.name);e("ui.theme.accent",i.accent);nit(r+"."+u,i.name+"."+i.accent,function(){r&&c.removeClass(ya(r));c.addClass(ya(i.name));var n=$(".ui-panel-open").css("transition","opacity 500ms");setTimeout(function(){n.css("opacity",0);setTimeout(function(){n.css("opacity","");setTimeout(function(){n.css("transition","")},600)},i.preview||1e3)},32)})},200)}function tit(){function o(){$(r.themes).each(function(){var n=this;t.push({text:su.List[n.name]||n.text||n.name,icon:u.name==n.name?"check":!1,keepOpen:!0,context:{theme:n},callback:hk,linkClassName:"app-item-theme-name",color:n.color})});t.push({text:su.Accent,isStatic:!1,instruction:!0});$(r.accents).each(function(){var n=this;t.push({text:su.List[n.name]||n.text||n.name,icon:u.accent==n.name?"check":!1,keepOpen:!0,context:{accent:n},callback:hk,linkClassName:"app-item-theme-accent",color:n.color})})}var f=at,s=e("ui.theme.name"),t=[{text:i.Back,icon:ut,callback:function(){fi(f)}},{text:su.Label,isStatic:!1,instruction:!0}],u=g.ui.theme,r=u.config;t.push({text:st.Loading,icon:"material-icon-refresh",animate:!0,keepOpen:!0,callback:bt});$.ajax({url:__servicePath+"/Themes",method:"POST",cache:!1}).done(function(i){r=g.ui.theme.config=i.d||JSON.parse($(i).text());r.accents.splice(0,0,{name:"None"});var u=$('.ui-panel-open [data-panel="#app-panel-settings-theme"] .ui-btn.app-animated').closest(".ui-panel");u.length&&(t.splice(t.length-1,1),o(),n.refreshContextMenu(u,t,'[data-panel="#app-panel-settings-theme"]'))});it(t,"#app-panel-settings-theme")}function iit(){function r(t){t!=n&&(e("ui.transitions.style",t),ot("transitions",t))}var u=at,n=e("ui.transitions.style"),t=[{text:i.Back,icon:ut,callback:function(){fi(u)}},{text:i.Transitions.Label,isStatic:!1,instruction:!0},];t.push({text:i.Transitions.List.none,icon:"none"==n?"check":!1,context:"none",callback:r});t.push({text:i.Transitions.List.slide,icon:"slide"==n?"check":!1,context:"slide",callback:r});it(t,"#app-panel-settings-theme")}function rit(){var u=at,n=e("ui.displayDensity.value"),r=[{text:i.Back,icon:ut,callback:function(){fi(u)}},{text:i.DisplayDensity.Label,isStatic:!1,instruction:!0},];for(var t in i.DisplayDensity.List)r.push({text:i.DisplayDensity.List[t],icon:t==n?"check":!1,context:t,callback:function(t){t!=n&&(gi.trigger("resize"),c.removeClass(va(n)),e("ui.displayDensity.value",t),c.addClass(va(t)),pi(),ot("displayDensity",t),af=null,ki())}});it(r,"#app-panel-settings-display-density")}function uit(){var t=at,f=e("ui.list.labels.display"),u=[{text:i.Back,icon:ut,callback:function(){fi(t)}},{text:i.LabelsInList.Label,isStatic:!1,instruction:!0},];for(var n in i.LabelsInList.List)u.push({text:i.LabelsInList.List[n],icon:n==f?"check":!1,context:n,callback:function(n){e("ui.list.labels.display",n);ot("labelsInList",n);r.confirm(i.ConfirmReload,function(){gc()},function(){fi(t)})}});it(u,"#app-panel-settings-labels-in-form")}function ck(){function u(n){e("ui.actions.promote",n);ot("promoteActions",n);lt();fi(t,ck)}var t=at,r=e("ui.actions.promote"),n=[{text:i.Back,icon:ut,callback:function(){fi(t)}},{text:i.PromoteActions,isStatic:!1,instruction:!0},];n.push({text:hs,icon:r!=!1?"check":!1,context:!0,callback:u});n.push({text:ss,icon:r==!1?"check":!1,context:!1,callback:u});it(n,"#app-panel-promote-actions")}function fit(){var t=at,f=e("ui.list.initialMode"),u=[{text:i.Back,icon:ut,callback:function(){fi(t)}},{text:i.InitialListMode.Label,isStatic:!1,instruction:!0},];for(var n in i.InitialListMode.List)u.push({text:i.InitialListMode.List[n],icon:n==f?"check":!1,context:n,callback:function(n){ot("initialListMode",n);r.confirm(i.ConfirmReload,function(){gc()},function(){fi(t)})}});it(u,"#app-panel-settings-default-list-mode")}function eit(){function f(n){e("ui.smartDates",n);ot("smartDates",n);r.confirm(i.ConfirmReload,function(){gc()},function(){fi(t)})}var t=at,u=e("ui.smartDates"),n=[{text:i.Back,icon:ut,callback:function(){fi(t)}},{text:i.Dates.SmartDates,isStatic:!1,instruction:!0},];n.push({text:hs,icon:u!=!1?"check":!1,context:!0,callback:f});n.push({text:ss,icon:u==!1?"check":!1,context:!1,callback:f});it(n,"#app-panel-smart-dates")}function oit(){function u(n){n.selected||Web.Membership._instance.changeCulture(n.value)}var t=at,n=[{text:i.Back,icon:ut,callback:function(){fi(t)}},{text:br.ChangeLanguageToolTip,isStatic:!1,instruction:!0},];$(r.cultureList).each(function(){var t=this;n.push({text:t.text,icon:!1,selected:t.selected,context:t,keepOpen:t.selected,callback:u})});it(n,"#app-panel-languages")}function vh(){return p>=pt("md")}function sit(){po("left")}function po(n){var t=[],f,u;n||t.push({text:i.Back,icon:ut,callback:iu});t.push({text:i.Settings});ht("settings.options.displayDensity")&&t.push({text:i.DisplayDensity.Label,icon:"material-icon-blur-on",transition:!0,callback:rit,desc:i.DisplayDensity.List[e("ui.displayDensity.value")]});ht("settings.options.theme")&&(f=e("ui.theme.name"),u=e("ui.theme.accent"),t.push({text:su.Label,icon:"material-icon-brush",transition:!0,callback:tit,desc:(su.List[f]||r.prettyText(f))+(u=="None"?"":" "+(su.List[u]||r.prettyText(u)))}));ht("settings.options.transitions")&&t.push({text:i.Transitions.Label,icon:"material-icon-swap-horiz",transition:!0,callback:iit,desc:i.Transitions.List[e("ui.transitions.style")]});ht("settings.options.sidebar")&&vh()&&t.push({text:i.Sidebar,icon:"material-icon-view-quilt",transition:!0,callback:sk,desc:e("ui.sidebar.when")=="Landscape"?i.Landscape:e("ui.sidebar.when")=="Always"?i.Always:i.Never});ht("settings.options.labelsInList")&&t.push({text:i.LabelsInList.Label,icon:"material-icon-text-format",transition:!0,callback:uit,desc:i.LabelsInList.List[e("ui.list.labels.display")]});ht("settings.options.showSystemButtons")&&!o&&t.push({text:i.ShowSystemButtons,icon:"material-icon-more-"+(nr?"vert":"horiz"),transition:!0,callback:gtt,desc:e("ui.showSystemButtons")=="OnHover"||e("ui.showSystemButtons")=="Auto"&&!o?i.OnHover:i.Always});ht("settings.options.promoteActions")&&t.push({text:i.PromoteActions,icon:"material-icon-add-circle",transition:!0,callback:ck,desc:ht("ui.actions.promote")?hs:ss});ht("settings.options.smartDates")&&t.push({text:i.Dates.SmartDates,icon:"material-icon-event",transition:!0,callback:eit,desc:e("ui.smartDates")!=!1?hs:ss});ht("settings.options.initialListMode")&&t.push({text:i.InitialListMode.Label,icon:"material-icon-list",transition:!0,callback:fit,desc:i.InitialListMode.List[e("ui.list.initialMode")]});$(r.cultureList).each(function(){var n=this;if(n.selected)return t.push({text:n.text,icon:"material-icon-language",transition:!0,callback:oit}),!1});it(t,"#app-panel-settings",n?{position:n}:null)}function pa(t){function p(n){var t=0;return n.closest("ul").find(".app-keep-open").each(function(){var n=$(this).data("context-action").context;n.index&&n.index>t&&(t=n.index)}),t}function w(n,t){n.closest("ul").find(".app-keep-open").each(function(){var n=$(this).data("context-action").context;n.index&&n.index>t&&n.index--})}function b(n){n.closest("ul").find(".app-keep-open").each(function(){var n=$(this),t=n.data("context-action").context;n.find(".ui-li-count").remove();t.index&&$('<span class="ui-li-count ui-body-inherit"/>').appendTo(n).text(t.index)})}var u=n.contextDataView(),r=u.get_groupExpression(),l=u.get_view().Label,a=u._fields,v=u._allFields,s=[],f=[],h,e,y=1,c,o={};if(t||f.push({text:i.Back,icon:ut,callback:iu}),r&&f.push({text:i.GroupedBy+" "+ok(u)+"."},{text:ct.Filters.Labels.Clear,icon:"delete",callback:function(){la(u,null)}}),f.push({},{text:i.Apply,icon:"material-icon-check",callback:function(n,t){var i=[];$(t).closest("ul").find(".app-keep-open").each(function(){var n=$(this).data("context-action").context;n.index&&i.push(n)});i.sort(function(n,t){return n.index-t.index});r="";$(i).each(function(){var n=this;r&&(r+=",");r+=n.field});la(u,r)}},{text:String.format(i.GroupByField,l)}),r)for(h=fs,e=h.exec(r);e;)c=u.findField(e[1]),c&&(o[c.Name]={field:e[1],index:y++}),e=h.exec(r);$(a).each(function(){var n=this,t=n;n=v[n.AliasIndex];!t.Hidden&&n.AllowSorting&&n.Type!="DataView"&&s.push(n)});s.sort(function(n,t){var i=o[n.Name],r=o[t.Name];return(i?i.index:1e3)-(r?r.index:1e3)});$(s).each(function(){var t=this,n;n=o[t.Name];f.push({text:t.HeaderText,keepOpen:!0,icon:!1,context:n||{field:t.Name},count:n?n.index:null,callback:function(n,t){n.index?(w(t,n.index),n.index=null):n.index=p(t)+1;b(t)}})});it(f,"#app-panel-group-fields")}function hit(){function c(n){var t,i=0;$(r).each(function(){var i=this,r=i.context;if(r&&r.field==n.field)return t=i,!1});n.order?(t.context.order||($(r).each(function(){var n=this.context;n&&n.index>i&&(i=n.index)}),t.context.index=i+1,t.count=i+1),t.icon=n.order=="asc"?"arrow-u":"arrow-d",t.context.order=n.order):($(r).each(function(){var i=this,n=i.context;n&&n.index>t.context.index&&(i.count--,n.index--)}),t.context.order=null,t.context.index=null,t.count=null,t.icon=!1);it(r,"#app-panel-sort-fields")}var t=n.contextDataView(),f=t.get_sortExpression(),l=t.get_view().Label,a=t._fields,v=t._allFields,o=[],r=[{text:i.Back,icon:ut,callback:iu}],s,u,y=1,h,e={};if(f&&r.push({text:ek(t)},{text:ct.Filters.Labels.Clear,icon:"delete",callback:function(){ci="";t.viewProp("sortExpression",ci);ah()}}),r.push({text:i.Apply,icon:"material-icon-check",callback:function(n,i){var r=[];$(i).closest("ul").find(".ui-btn").each(function(){var n=$(this).data("context-action").context;n&&n.order&&r.push(n)});r.sort(function(n,t){return n.index-t.index});ci="";$(r).each(function(){var n=this;ci&&(ci+=",");ci+=n.field+" "+n.order});t.viewProp("sortExpression",ci);ah()}},{text:String.format(i.SortByField,l)}),f)for(s=fs,u=s.exec(f);u;)h=t.findField(u[1]),h&&(e[h.Name]={field:u[1],index:y++,order:u[3]&&u[3].match(/^desc/i)?"desc":"asc"}),u=s.exec(f);$(a).each(function(){var n=this,t=n;n=v[n.AliasIndex];!t.Hidden&&n.AllowSorting&&n.Type!="DataView"&&o.push(n)});o.sort(function(n,t){var i=e[n.Name],r=e[t.Name];return(i?i.index:1e3)-(r?r.index:1e3)});$(o).each(function(){var u=this,n,f=t.groupExpression();n=e[u.Name];r.push({text:u.HeaderText,icon:n?n.order=="asc"?"arrow-u":"arrow-d":!1,context:n||{field:u.Name},count:n?n.index:null,transition:!0,callback:function(n){var u=t.findField(n.field),e=[{text:i.Back,icon:ut,callback:function(){it(r,"#app-panel-sort-fields")}},{text:String.format(i.SortByOptions,t.get_view().Label,u.HeaderText)},{text:du(u,"asc"),icon:n.order=="asc"?"check":!1,transition:!0,reverse:!0,context:{order:"asc",field:n.field},callback:c},{text:du(u,"desc"),icon:n.order=="desc"?"check":!1,transition:!0,reverse:!0,context:{order:"desc",field:n.field},callback:c}];f&&f.indexOf(n.field)!=-1||e.splice(2,0,{text:i.None,icon:n.order?!1:"check",transition:!0,reverse:!0,context:{field:n.field},callback:c});it(e,"#app-panel-sort-field-options")}})});it(r,"#app-panel-sort-fields")}function cit(n){var t=n.find(".app-group"),i=t.length?t.first().outerHeight(!0):0;return t.remove(),i}function lit(n,t){var r=n.groupExpression(),o=[],v=n.get_showFirstLetters()&&!r,s,i=0,u,f,e,c,l,h,a;if(r){while(i<r.length)s=n.findField(r[i]),s?r[i++]=n._allFields[s.AliasIndex]:r.splice(i,1);t.find("li a").each(function(){var s=$(this),k=s.data("data-context"),t=[],y=[],p=[],w,b=[],d,n,g;k?($(r).each(function(l){var it=this,nt=k.row[it.Index],a,rt,tt,ft,ut;if(nt!=null&&(a=v?nt.substring(0,1):it.text(nt)),t.push(a),y.push(it.HeaderText),p.push(it.Type),b.push(nt),o.length&&o[l]==a||(o[l]=a,d=!0),d&&l==r.length-1){for(u&&($('<span class="app-group-count"/>').appendTo(u).text(f+(h?"+":"")),h=!1),n=$('<li class="app-group"/>').insertBefore(s.parent()),$('<span class="glyphicon glyphicon-menu-up"/>').appendTo(n),tt=null,rt=null,w=p[p.length-1].match(/^Date/),nt!=null&&p.length==1&&w&&(nt=b[b.length-1],rt=wr.DayNames[nt.getDay()]+" "+nt.getDate(),tt=wr.MonthNames[nt.getMonth()],ft=nt.getFullYear()),tt&&(e=$('<span class="app-group-info"/>').appendTo(n),$('<span class="app-group-info-value"/>').appendTo(e).text(tt),$('<span class="app-group-info-value-muted"/>').appendTo(e).text(ft),c!=tt?c=tt:e.addClass("app-group-info-duplicate")),w&&n.addClass("app-group-fixed"),f=0,i=0;i<t.length-1;)ut||(ut=$('<span class="app-group-path"/>').appendTo(n)),g=$('<span class="app-group-path-value"/>').appendTo(ut),a=t[i],a||(a=st.BlankValue),g.text(a).attr("title",y[i]+":\n"+a),i++;a=rt||t[t.length-1];u=$('<span class="app-group-title"/>').appendTo(n).text(a);a||(a=st.BlankValue);u.text(a).attr("data-text",a).attr("title",y[y.length-1]+":\n"+a)}}),f++):s.is(".dv-load-at-bottom")?a=!0:!l&&s.is(".dv-load-at-top")&&(h=!0,l=!0)});u&&$('<span class="app-group-count"/>').appendTo(u).text(f+(a?"+":""))}}function ait(n){var t=n.get_filter(),i=n._externalFilter||[];return t&&t.length&&i.length<t.length||te(n).length}function lk(n){var t=$(".ui-panel-open .app-btn-apply,.ui-popup-active .app-btn-apply");t.is(".app-enabled")||(n?t.removeClass("ui-disabled"):t.addClass("ui-disabled"))}function vit(n){var t=n.is(".app-include");n.find(".app-icon").text(t?"check_box":"check_box_outline_blank").toggleClass("material-icon-check-box",t).toggleClass("material-icon-check-box-outline-blank",!t)}function yit(n,t){var f=wa(t),u=ba(t),r,i;t.toggleClass("app-include");r=u.filter(".app-include").length;i=u.length==r;vit(t);f.find(".app-icon").text(i?"check_box":"check_box_outline_blank").toggleClass("material-icon-check-box",i).toggleClass("material-icon-check-box-outline-blank",!i);lk(r>0)}function wa(n){return n.closest(".ui-panel-inner").find(".app-btn-select-all a")}function ba(n){return wa(n).parent().nextAll().find("a")}function pit(n){return n.length>0?n.data("data-context")||n.data("context-action"):null}function wit(n,t){var i=r.find(n.dataViewId),u=n.field,e=i.findField(u),o=i._allFields[e.AliasIndex],f=ak(i,u,t);i.removeFromFilter(o);f&&i._filter.push(f);eo(i)}function ak(n,t,i){function s(t){r=[];o.each(function(){var i=$(this),u=i.is(".app-include");(u&&t||!u&&!t)&&r.push(n.convertFieldValueToString(f,f._listOfValues[pit(i).context]))})}var f=n.findField(t),h=n._allFields[f.AliasIndex],u=[],r,e,o=ba(i);return o.filter(":not(.app-include)").length&&(s(!0),r.length&&(u.push(h.Name+":"),r.length==1?u.push("="+r[0]):(e=r.length<=10||r.length<=r.length/2,u.push(e?"$in$":"$notin$"),e||s(!1),$(r).each(function(n){n>0&&u.push("$or$");u.push(this)})))),u.join("")}function gu(t){function s(n,t){var f=n._dataView,r=f._allFields[n.AliasIndex],e=f.get_fieldFilter(r,!0);u||(t.push({text:i.Back,icon:ut,callback:l}),t.push({text:r.HeaderText}));t.push({});e&&t.push({text:ct.Filters.Labels.Clear,context:r.Name,callback:function(){f.removeFromFilter(r);eo(f)},icon:"material-icon-clear"});t.push({text:ct.Filters[r.FilterType].Text,context:r.Name,disabled:!0,callback:function(){},transition:!0,icon:!1});u||t.push({text:String.format(i.FilterByOptions,f.get_view().Label,r.HeaderText,i.Apply)})}function h(n,t){var e,r,y,u=n._dataView,c=n._listOfValues||[],l=u._allFields[n.AliasIndex],s=u.get_fieldFilter(l,!0),a=[],p,v,o,f,h=s=="$notin";for(s&&(s=="="||s=="$in"||h)&&(v=(u.get_fieldFilter(l)||"").split(/\$or\$/)),p={text:i.Apply,icon:"material-icon-check",disabled:!0,itemClassName:"app-btn-apply",context:{dataViewId:u._id,mappedId:u._mappedId,field:n.Name},callback:wit},t.push(p,{}),c.length>1&&t.push({text:ct.Filters.Labels.SelectAll,keepOpen:!0,itemClassName:"app-btn-select-all",icon:"material-icon-check-box-outline-blank",callback:function(n,t){var r=ba(t),i=r.filter(".app-include").length==r.length;wa(t).find(".app-icon").text(i?"check_box_outline_blank":"check_box").toggleClass("material-icon-check-box",!i).toggleClass("material-icon-check-box-outline-blank",i);i?r.removeClass("app-include").find(".app-icon").text("check_box_outline_blank").removeClass("material-icon-check-box").addClass("material-icon-check-box-outline-blank"):r.addClass("app-include").find(".app-icon").text("check_box").addClass("material-icon-check-box").removeClass("material-icon-check-box-outline-blank");lk(!i)}}),e=0;e<c.length;e++)r=c[e],f=v&&v.indexOf(u.convertFieldValueToString(n,r))!=-1,h&&(f=!f),y=r==null?st.EmptyValue:typeof r=="string"&&r==""?st.BlankValue:l.text(r),o={text:y,icon:"material-icon-"+(f?"check-box":"check-box-outline-blank"),keepOpen:!0,context:e,callback:yit,linkClassName:f?"app-include":""},f?h?a.push(o):t.push(o):h?t.push(o):a.push(o);return t.concat(a)}function c(t){var i=[],f=n.contextDataView(),u=f.findField(t),e=f._allFields[u.AliasIndex];s(e,i);o&&i.splice(0,1);u._listOfValues&&u._listOfValues.length?i=h(u,i):i.push({text:st.Loading,icon:"material-icon-refresh",animate:!0,context:{id:f._id,field:t},keepOpen:!0,callback:bt});it(i,"#app-panel-filter-field",{position:"right",resetScrolling:!0,afteropen:function(){var f=yp().data("context-action"),u=f&&f.context,i,e,t;u&&(i=r.find(u.id),t=i.findField(u.field),e=i._allFields,i._loadListOfValues(null,t.Name,e[t.AliasIndex].Name,function(){var u=yp(),f=u.length&&u.data("context-action").context,r=[];u.length&&f.id==i._id&&f.field==t.Name&&(s(t,r),o&&r.splice(0,1),r=h(t,r),n.refreshContextMenu(u.closest(".ui-panel"),r,'[data-panel="#app-panel-filter-field"]'))}))}})}function l(){var t=n.contextDataView(),r=e?[]:[{text:i.Back,icon:ut,callback:iu}],u={},f=t&&t._filter;ait(t)&&(r.push({text:t.extension().filterStatus()}),r.push({text:ct.Filters.Labels.Clear,icon:"delete",callback:function(){var t=n.contextDataView();fl(t)}}),e&&te(t).length&&r.push({text:hi.ShowAdvancedSearch,desc:ow(t),icon:"search",toolbar:!1,system:!0,context:{dataViewId:t._id},callback:pp}));r.push({text:String.format(i.FilterByField,t.get_view().Label)});$(t._filter).each(function(){var n=this,t=n.match(/^\w+/);t&&(u[t[0]]=n)});$(t._externalFilter).each(function(){u[this.Name]=null});$(t._fields).each(function(){var o=this,i,e,n;i=t._allFields[o.AliasIndex];e=u[i.Name];e&&(t._filter=[e],n=t.extension().filterStatus(!0,!0),n.indexOf(i.HeaderText)==0&&(n=n.substring(i.HeaderText.length).trim(),n.length>2&&(n=n.charAt(0).toUpperCase()+n.slice(1))));!o.Hidden&&i.AllowQBE&&i.Type!="DataView"&&r.push({text:i.HeaderText,context:o.Name,icon:e?"filter":!1,desc:n,transition:!0,callback:c});t._filter=f});it(r,"#app-panel-filter")}var e,o,u,f;if(typeof t=="object"&&(t._dataView?u=t:t.scopeField?u=t.scopeField:t.mode=="everything"?e=!0:t.mode=="field"&&(o=!0)),u)return f=[],s(u,f),t.samples!=!1&&(u._listOfValues&&u._listOfValues.length?f=h(u,f):f.push({text:st.Loading,icon:"refresh",animate:!0,context:{id:u._dataView._id,field:u.Name},keepOpen:!0,callback:bt})),f;t&&t.mode=="field"?c(t.field):l()}function ka(n,t,i,r,u){i||(i=s());var f=i&&i.dataView,o=f&&f.get_view(),h=0,e,c=[];return f&&f.get_isGrid()&&f.get_showViewSelector()&&($(f.get_views()).each(function(){var n=this;t&&n.Id==o.Id||(n.Type!="Form"&&n.ShowInSelector||n.Id==o.Id)&&c.push(n)}),c.length>1&&$(c).each(function(){var s=this,c=s.Label,l=c==o.Label;e={text:c,radio:!0,icon:l?"check":t?"":!1,context:h,callback:function(n){var t=$.find("#"+i.id+" .ui-content > .app-tabs-views .ui-btn");r&&t.length?$(t[n]).trigger("vclick",{selectedTab:c}):(f._forceSync(),f.extension()._commandRow=null,f._requestedSortExpression=f.pageProp(s.Id+"_sortExpression"),f._requestedFilter=f.pageProp(s.Id+"_filter"),f.executeCommand({commandName:"Select",commandArgument:s.Id}),f.pageProp("viewId",s.Id),r&&!t.length&&ku(i.id+"_view-tabs",c),i.id==et()&&(i.headerText!=!1&&vi(c),hp(),ve(f),lt()))}};u&&(e.radio=!1,e.selected=e.icon=="check",e.icon="material-icon-folder"+(e.icon=="check"?"-open":""),e.depth=1);n.push(e);h++})),h}function wo(n){var t=n.url,i=t.match(/^((\_\w+)\:)/),u;i?l.open(t.substring(i[0].length),i[2]):(t.match(/^http(s)?\:/)&&(u=hd(t)),u?u():(r._navigated=!0,l.location.href=t))}function nf(n,t,r,u){var e,f,o;if(r)$(r).each(function(){var i=this,r=i.children,f={text:i.title,context:i,icon:!1,depth:u,selected:!r&&i.selected,icon:t&&i.icon?i.icon:!1,callback:i.url?wo:bt,keepOpen:!i.url},e;n.push(f);r&&(i.selected&&($(r).each(function(){this.selected&&(e=!0)}),e||(f.selected=!0)),nf(n,t,r,u+1))});else if(r=ii.nodes,r)if(ht("ui.menu.apps.tiles")&&t)if(e=Web.Menu.nodesWithIcons,f=e.length,$(e).each(function(){var i=this,r=i.icon;i=i.node;n.push({text:i.title,context:i,icon:r,icon:t&&i.icon?i.icon:!1,callback:i.url?wo:bt,keepOpen:!i.url,itemClassName:"app-item-tile",linkClassName:i.selected&&!i.children?"app-item-selected":null})}),f){if(f%3)for(o=f%3;o<3;o++)n.push({text:" ",icon:!1,callback:bt,itemClassName:"app-item-tile app-item-tile-stub"});f<Web.Menu.nodeCount&&n.push({},{text:i.More,icon:"material-icon-apps",transition:!0,callback:lrt,itemClassName:"app-item-tile-more"})}else nf(n,t,r,1);else nf(n,t,r,1)}function vk(t,r,u){var e=n.contextDataView(),f=e.extension(),o=f.viewStyle(),h=e!=n.dataView(),s=[];ka(t,null,n.contextPageInfo(),!0)==1&&t.splice(t.length-2,2);e.get_isGrid()&&e.get_showViewSelector()&&(r==!1?t.length&&t.push({}):t.push({text:i.PresentationStyle}),(u==null||u==!0)&&(f.tagged("view-style-grid-disabled")||t.push({text:i.Grid,icon:o=="Grid"?"check":!1,radio:!0,callback:function(){f.viewStyle("Grid")}}),f.tagged("view-style-list-disabled")||t.push({text:i.List,icon:o=="List"?"check":!1,radio:!0,callback:function(){f.viewStyle("List")}}),f.tagged("view-style-cards-disabled")||t.push({text:i.Cards,icon:o=="Cards"?"check":!1,radio:!0,callback:function(){f.viewStyle()!="Cards"&&f.viewStyle("Cards")}}),h||f.tagged("view-style-map-disabled")||f.tagged("supports-view-style-map")&&t.push({text:i.Map,icon:o=="Map"?"check":!1,radio:!0,callback:function(){f.viewStyle("Map")}}),n.presenter("enumerate",{id:e._id,list:s}),$(s).each(function(){var n=this;f.tagged("view-style-"+n.name.toLowerCase()+"-disabled")||(n.icon=n.name==o?"check":!1,n.radio=!0,t.push(n))})));htt(e,t)}function yk(n){n||(n={});var t=[];n.position!="left"&&t.push({text:i.Back,icon:ut,callback:iu});t.push({text:i.AlternativeView});vk(t);it(t,"#app-panel-view-options",n)}function pk(t,i,r){var e=t.extension(),o=t._id,s=t._allFields[t._fields[0].AliasIndex],f=i.length,u;r&&r.length&&!e.inserting()&&i.isSideBar==!1&&(n.enumerateFields(t,i,null,r),f<i.length&&(u=i[f],u.icon="material-icon-info-outline",u.transition=!0,u.context={id:o},u.callback=by))}function da(n,t,i){i&&$(n._fields).each(function(){var r=n._allFields[this.AliasIndex],f=oa(r,!0),e=sa(r,!0),u;(f||e)&&(u=i[r.Index],u!=null&&(f?t.push({text:r.text(u),desc:r.HeaderText,icon:"phone",href:"tel:"+u,system:!0}):e&&t.push({text:r.text(u),desc:r.HeaderText,icon:"mail",href:"mailto:"+u,system:!0})))})}function bo(n){var t=wk[n];return t?"material-icon-"+t:n}function bit(n){var t=null,i=n.CssClass;if(i&&nh(i)&&(t=i),!t){switch(n.CommandName){case"Delete":t="delete";break;case"New":t="add";break;case"Edit":t="edit";break;case"Insert":case"Update":case"Confirm":t=n.CommandArgument=="SaveAndNew"?"add":"check";break;case"Cancel":t="undo";break;case"Duplicate":t="content-copy";break;case"Select":t="arrow-forward";break;case"ExportCsv":t="file-download";break;case"ExportRowset":t="grid-on";break;case"ExportRss":t="rss-feed";break;case"ReportAsPdf":t="picture-as-pdf";break;case"ReportAsImage":t="collections";break;case"ReportAsExcel":t="filter-none";break;case"ReportAsWord":t="library-books";break;case"Search":t="search";break;case"BatchEdit":t="done-all";break;case"Import":t="file-upload";break;default:t=!1}t&&(t="material-icon-"+t)}return t}function bk(n){var u=r.find(n.dataViewId),o=n.row,f=n.action,e=f.CommandName,i;u.editing()&&(i=f.CausesValidation&&e!="Cancel",t.cancel(i),i&&!t.valid())||(dt(),e=="Edit"&&pf(u),u.extension().command(o,e,n.argument,i,f.Path))}function kit(t){n.contextScope(null);t=t.action;var i=r.find(t.dataViewId),u=t.action,f=t.group,e=t.groupIndex,o=t.actionIndex;i._busy()||(String.isNullOrEmpty(u.Confirmation)?bk(t):i._confirm({action:u,scope:f.Scope,actionIndex:o,rowIndex:0,groupIndex:e},function(n){r.confirm(n,function(){bk(t)})}))}function ko(n,t,r,u,f){function w(n){for(var r=t._views,i=0;i<r.length;i++)if(r[i].Id==n)return r[i].Type!="Form";return!1}var y=t.rowIsSelected(u),e,l=[],b=t.get_viewId(),a=t.get_isGrid(),v={},h,s,c,p=o?/^(DataSheet|Grid|Export(Rowset|Rss))$/:/^(DataSheet|Grid)$/;$(t.actionGroups(n)).each(function(o){var b=this,k=b.Scope;k!="ActionBar"||b.Flat||b.Id==n?(!b.Scope.match(/Grid|ActionColumn/)||y&&a||b.Flat)&&$(this.Actions).each(function(n){var y=this,i=y.CommandName,d=y.CommandArgument,nt=y.Key,tt=i+"/"+d+"/"+y.HeaderText,g=l.indexOf(tt)==-1&&(!i||!i.match(p))&&(!b.Flat||y.HeaderText);c=i?kit:null;s=null;g&&(h=i&&i.match(/^(Select|Edit|New|Duplicate)$/),h&&a&&(!d||w(d))?f&&i=="Edit"?d=f:(v[i]=r[r.length-1],g=!1):h&&(s=v[i]));g&&!c&&b.Scope.match(/Grid|ActionColumn/)&&(g=!1);g&&(l.push(tt),e={text:y.HeaderText,callback:c,icon:bit(y),uiScope:k,group:b.Id,path:y.Path,command:i,argument:d,context:{action:{dataViewId:t._id,row:u,group:b,groupIndex:o,action:y,actionIndex:n,argument:d}}},nt&&(e.shortcut=nt),s?Array.insert(r,r.indexOf(s)+1,e):r.push(e))}):r.push({text:b.HeaderText,icon:!1,transition:!0,uiScope:k,group:b.Id,context:{group:b,isSideBar:r.isSideBar},callback:function(n){at=[];n.isSideBar||at.push({text:i.Back,icon:ut,callback:iu});at.push({text:b.HeaderText});ko(n.group.Id,t,at,u);it(at,"#app-panel-group-actions",n.isSideBar?{position:"left"}:null)}})});t._editing=null}function dit(n,t){function s(n,t){$(e).each(function(i){var r=e[i],u=r.AliasIndex,o=e[u];r.Hidden||o.GroupBy||!(f||r.tagged(n))||t.call(r,u)})}function h(n){s(n,function(t){var e=this,h=e.tagged(n+"desc"),c=e.tagged(n+"para"),l=e.tagged(n+"column"),a=e.tagged(n+"nolabel"),o=(e.tagged(n+"label")||h||c||l)&&!a,s=r.tagSuffix,v=e.tagged(n+"count"),y=e.tagged(n+"aside"),p=e.tagged(n+"heading"),w=e.tagged(n+"thumb"),b;e.tagged(n+"none")||(!f||p||h||v||y||a||c||l||(i.heading==null?i.heading=t:i.thumb==null&&e.OnDemand&&e.OnDemandStyle!=1?i.thumb=t:(h=!0,o=!0)),p&&(i.heading=t),(!o||v||y)&&!a||(i.desc.push(t),u=i.desc.length-1,r.tagSuffix&&(i.descRwd[u]=r.tagSuffix),o&&(i.descLabels[u]=!0,s&&(i.descLabelsRwd[u]=s)),c&&(i.descPara[u]=!0),l&&(i.descColumn[u]=!0,b=e.Columns,i.descColumnCount++)),v&&(i.count=t,i.countRwd=r.tagSuffix,i.countLabel=o,i.countLabelRwd=s),y&&(i.aside=t,i.asideRwd=r.tagSuffix,i.asideLabel=o,i.asideLabelRwd=s),w&&(i.thumb=t))})}function c(){f=!0}var w=n._fields,e=n._allFields,i=t&&n._listItemMap&&n._listItemMap[n._viewId]||!t&&n._cardItemMap&&n._cardItemMap[n._viewId]||{heading:null,thumb:null,aside:null,count:null,desc:[],descOriginal:[],descRwd:[],descLabels:[],descLabelsRwd:[],descPara:[],descColumn:[],descColumnCount:0},f,u;if(i.cached)return i;if(t?(s("list-",c),f&&h("list-")):(s("card-",c),f&&h("card-",!0)),f||(s("item-",c),f&&h("item-")),f)i.heading==null&&(i.heading=w[0].AliasIndex);else{var l,a,b=0,o=[],v=3,y;function p(n){var r,s,h;if(!this.Hidden&&!this.GroupBy&&this.Type!="DataView")if(this.OnDemand)i.thumb==null&&this.OnDemandStyle!=1&&(i.thumb=n);else if(!l||this.ShowInSummary){if(n=this.AliasIndex,r=e[n],s=r.Type.match(/^Date/),r.GroupBy)return;h=r.Type!="String"&&!r.OnDemand;i.heading==null?(i.heading=n,t&&(i.desc.push(n),u=i.desc.length-1,i.descLabels[u]=n,o.push(u))):i.aside==null&&s&&i.count==null&&!t?i.aside=n:i.count!=null||!h||s||i.aside!=null||t?(i.desc.push(n),u=i.desc.length-1,i.descLabels[u]=n,t?(o.push(u),!r.ItemsLookupStyle&&(r.Rows>1||r.TextMode==3)?(i.descPara[u]=!0,a=!0):a&&(i.descPara[u]=!0,a=!1)):b++%3==0&&(i.descPara[u]=!0)):i.count=n;f=!0}}t&&(l=!1);$(e).each(p);t&&!i.descPara.length&&o.length>3&&(o.length<7&&(v=2),y=Math.ceil(o.length/v),$(o).each(function(n){n%y==0&&(i.descColumn[this]=!0,i.descColumnCount++)}));f||(l=!1,$(e).each(p))}return i.desc.length&&$(e).each(function(){var n=this,t=i.desc.indexOf(n.AliasIndex);t!=-1&&n.Index!=n.AliasIndex&&(i.descOriginal[t]=n.Index)}),i.cached=!0,t?(n._listItemMap||(n._listItemMap={}),n._listItemMap[n._viewId]=i):(n._cardItemMap||(n._cardItemMap={}),n._cardItemMap[n._viewId]=i),i}function kk(n){var t={latitude:null,longitude:null,segments:[]},i=[];return $(n._allFields).each(function(n){var r=this;r.tagged("map-")&&(r.tagged("map-latitude")?t.latitude=n:r.tagged("map-longitude")?t.longitude=n:i.push(this))}),$(["address","city","state","region","postalcode","zipcode","zip","country"]).each(function(){var n=this;$(i).each(function(r){var u=this;if(u.tagged("map-"+n))return t.segments.push(u.Index),i.splice(r,1),!1})}),t}function git(n){var t=ke||ot("geoLocations"),i=null;return t&&$(t).each(function(){var t=this;if(t.address==n)return i=t.lat==null&&t.lng==null?"ZERO_RESULTS":{lat:t.lat,lng:t.lng},!1}),ke||(ke=t),i}function dk(n,t,i){var r=ke||ot("geoLocations");r||(r=[]);r.push({address:n,lat:t,lng:i});r.length>fg&&r.splice(0,1);ke=r;setTimeout(function(){ot("geoLocations",r)},0)}function nrt(n,t,i){var r=new Sys.StringBuilder;return gt?r.append("http://maps.apple.com/?"):r.append("https://maps.google.com/?"),i=="q"?r.append("q="):i=="to"?r.append("daddr="):r.append("saddr="),t.latitude!=null&&t.longitude!=null?r.appendFormat("{0},{1}",t.latitude,t.latitude):$(t.segments).each(function(t){var i=n[this];i&&(t>0&&r.append(",+"),r.append(i.trim().replace(/\s+/g,"+")))}),r.toString()}function trt(n,t){var u,f,r,e,i;return t.latitude!=null&&t.longitude!=null?(u=n[t.latitude],f=n[t.longitude]):(r=new Sys.StringBuilder,$(t.segments).each(function(t){var i=n[this];i&&(t>0&&r.append(","),r.append(i))}),e=r.toString(),i=git(e),i?typeof i!="string"&&(u=i.lat,f=i.lng):i=e),typeof i!="string"&&(i=new google.maps.LatLng(u,f)),i}function gk(n){$(n.markers).each(function(){google.maps.event.clearListeners(this,"click");this.setMap(null)});n.markers=[];n.selected=null}function ga(n){if(n.fit!=!1){var i=new google.maps.LatLngBounds,t=n.markers,r=n.map;t.length==1?r.setCenter(t[0].position):($(t).each(function(){i.extend(this.position)}),r.fitBounds(i))}}function yh(){if(!!(__tf!=4)){var n=".noitide tcudorp ruoy ni detroppus ton si erutaef sihT".split("").reverse(),t=r.alert,i=Math.random()*1e4;setTimeout(function(){$(".ui-popup-active .ui-popup").popup("close");setTimeout(function(){t(n.join(""))},250)},i)}}function nv(t){t.items||(t.items=[]);var c=t.dataView,y=c.extension(),w=[],f=ro(),r=$('<div class="ui-content app-popup-message app-map-info"><\/div>').popup({transition:vp(),history:o,arrow:f?null:t.x?o?"b,t,l,r":"t,b,l,r":null,theme:"a",overlayTheme:"b",tolerance:f?0:5,positionTo:f?null:t.x?"origin":"window",afteropen:function(){td(null,r);ur(r.find(".ui-listview"));t.afteropen&&t.afteropen(r);tt=!1},afterclose:function(){r.find(".ui-btn").data("data-context",null);a.listview("destroy").remove();tv(r);tt=!1;t.afterclose&&t.afterclose(r);setTimeout(function(){u&&u.callback&&u.callback(u.context)},50)}}),l=f?{x:p/2,y:nt-1}:{x:t.x,y:t.y},a=$('<ul class="app-listview"/>').appendTo(r),b=$('<li data-icon="false"/>').appendTo(a),v=$("<a/>").appendTo(b),g=$('<div class="app-map-info-toolbar"><\/div>').appendTo(r),u,it,d,s,h;yu(c,y.commandRow(),y.itemMap(!1),null,b,v,null,!0);v.find(".app-btn-check").remove();a.listview();p<640&&(e("ui.displayDensity.value")=="Comfortable"?r.addClass("app-density-compact"):e("ui.displayDensity.value")=="Compact"&&r.addClass("app-density-condensed"));$(t.items).each(function(){w.push(this.icon)});context=[];n.contextScope(c._id);n.navContext(context,!1);$(context).each(function(){var n=this;n.icon=="eye"&&(it=n.text);n.icon=="dots"||n.navigateTo||n.system||!n.callback||w.indexOf(n.icon)!=-1||(!d&&(n.icon||n.command=="Select")&&(d=n,v.data("data-context",n)),n.command=="Edit"&&(s=n),n.command=="Delete"&&(h=n))});n.contextScope(null);t.hasMore||(t.items.splice(0,0,{text:i.More,icon:"dots",callback:function(){l.itemsToAppend=[{text:i.Back,icon:ut,callback:function(){nv(t)}}];go(t.anchor,l)}}),s&&t.items.push({text:s.text,icon:s.icon,callback:s.callback}),h&&t.items.push({text:h.text,icon:h.icon,callback:h.callback}),t.hasMore=!0);$(t.items).each(function(){var n=this,t=$('<a class="ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all"/>').appendTo(g).attr("title",n.text).addClass("ui-icon-"+n.icon).data("data-context",n);n.href&&t.attr("href",n.href);n.target&&t.attr("target",n.target)});f&&r.addClass("app-popup-panel").parent().css("minWidth","100%");tt=!0;r.popupopen(l).on("vclick",".ui-btn",function(n){var t=$(n.target),i=t.closest("a");if(!t.is("[data-href]"))if(u=i.data("data-context"),u.href)u.keepOpen||tf(r),u=null;else return k(i,function(){tf(r)}),!1}).on("vclick","li",function(n){if(!$(n.target).is("[data-href]"))return markerAction=!0,tf(r),!1})}function nd(n,t,r,u,f){var s=n,e=t.data("data-map"),h=s.dataView(),o=new google.maps.Marker({map:e.map,position:r,title:u});return google.maps.event.addListener(o,"click",function(){function a(n){google.maps.event.trigger(n||e.selected,"click")}function v(){if(e.fit=!1,o.setAnimation(null),n.getZoom()>=17){var t=n.getStreetView();t&&t.getVisible()?(t.setVisible(!1),a(o)):(e.fit=!0,ga(e));wh(o)}else n.setZoom(17),n.panTo(o.position),wh(o);a()}function y(t){var i=-1;$(u).each(function(n){if(this==o)return i=n,!0});i!=-1&&(t=="next"?i++:i--,i<0&&(i=u.length-1),i>=u.length&&(i=0),ph(e,u[i]),n.panTo(e.selected.position),a())}s.tap({row:f},"none");var n=e.map,u=e.markers,l=irt(o.position,n),c=l&&{x:l.x+t.offset().left,y:l.y+t.offset().top},r=[];n.getZoom()>=17?u.length>1&&r.push({text:i.ZoomOut,icon:"zoomout",callback:v}):r.push({text:i.ZoomIn,icon:"zoomin",callback:v});r.push({text:i.Directions,icon:"navigation",href:nrt(f,kk(h),"to"),target:"_blank",keepOpen:!0});e.markers.length>1&&(r.push({text:fu.Previous,icon:"arrow-l",context:"prev",callback:y}),r.push({text:fu.Next,icon:"arrow-r",context:"next",callback:y}));nv({x:c&&c.x,y:c&&c.y,dataView:h,afteropen:function(){ph(e,o);wh(o)},items:r})}),e.markers.push(o),o}function ph(n,t){n.selected&&n.selected.setIcon(null);n.selected=t;t&&t.setIcon("http://mt.google.com/vt/icon?psize=30&font=fonts/arialuni_t.ttf&color=ff304C13&name=icons/spotlight/spotlight-waypoint-a.png&ax=43&ay=48&text=%E2%80%A2")}function wh(n,t,i){typeof t=="undefined"&&(t=755);n.setAnimation(i||google.maps.Animation.BOUNCE);t&&setTimeout(function(){n.setAnimation(null)},t)}function irt(n,t){var u=t.getBounds(),i=t.getProjection(),s=i.fromLatLngToPoint(u.getNorthEast()),r=i.fromLatLngToPoint(u.getSouthWest()),e=Math.pow(2,t.getZoom()),f=i.fromLatLngToPoint(n),o=0;return(f.x<r.x||r.x==0)&&(o=$(t.getDiv()).width()/2,r=i.fromLatLngToPoint(u.getCenter())),new google.maps.Point((f.x-r.x)*e+o,(f.y-s.y)*e)}function td(t,i){var r=i.closest(".ui-popup-container"),u=n.promo();c.addClass("app-has-popup-open");gr();no(i,!1)}function rrt(n){n.popup("close")}function tf(n){n.data("mobilePopup")._currentTransition="none";rrt(n)}function tv(n){itt(n);c.removeClass("app-has-popup-open");no(n,!0);n.data("position-options",null).popup("destroy").remove()}function rf(n){n.find("a").data("data-context",null);n.find("li").remove()}function urt(n){rf(n);n.off("vclick").listview("destroy")}function go(n,t){function o(){i.length&&i[i.length-1].text&&i.push({})}function f(n){var t=[];$(r).each(function(){var r=this,u=r.icon;r.system?n&&(!r.system||u=="eye"||u=="phone"||u=="mail")&&u!="dots"&&t.push(r):r.text&&!r.isStatic&&i.push(r)});n&&t.length&&(o(),$(t).each(function(){var n=this,r=n.href,t={text:n.text,icon:n.icon};t.href?t.callback=n.callback:t.href=r;i.push(t)}))}n=$(n);var h=ei(n),l=h.length?h.attr("data-for"):null,a=s(l),e=a.dataView,u=e.extension(),r=t&&t.context,i=[],c;u.lookupInfo()?(r=[],u.context(r),f()):(f(),t&&t.autoPopulate==!1||(r=[],u.context(r,["ActionColumn"]),r.length&&(o(),f()),o(),r=[],u.context(r,["Grid"]),f(!0)));t&&$(t.itemsToAppend).each(function(){i.push(this)});$(e._fields).each(function(){var r=this,f=e._allFields[r.AliasIndex],s=r.HyperlinkFormatString,o,n,t;s&&(n=u.commandRow(),n&&(t=n[f.Index],t!=null&&(o=na(r,n),t=f.format(n[f.Index]),c||(c=!0,i.push({})),i.push({text:t,icon:"material-icon-info-outline",href:o}))))});rt({items:i,anchor:n,iconPos:"left",defaultIcon:"carat-r",x:t&&t.x||n.length&&n.offset().left+n.outerWidth()/2,y:t&&t.y||n.length&&n.offset().top+n.outerHeight(!0)*.66,y2:t&&t.y2||n.length&&n.offset().top+n.outerHeight(!0)*.33})}function bh(t){function u(){n.busy(!1);lu([{name:"UserName",value:i.UserName}])}var f=r.AccountManager.list(),i=f[t];t==r.userName()?$(".app-acc-man .app-acc-close").trigger("vclick"):i.Token?(n.busy(!0),r.switchUser(i,function(){r._navigated=!0;window.location.reload()},u)):u()}function iv(){Web.Membership._instance.logout();sessionStorage&&(sessionStorage.signedOut=!0)}function rv(t,u){function v(){cy&&h.match(/\blogout\b/)&&(t.push({text:br.LogoutLink,icon:"power",callback:iv}),a=!0)}function y(){h.match(/\blogin\b/)&&c&&!ky()&&(t.length&&t.push({}),t.push({text:i.AddAccount,icon:"material-icon-add",callback:function(){ys?lu():lu(null,!0)}}),l&&t.push({text:i.ManageAccounts,icon:"material-icon-settings",callback:function(){kr().remove();lu(null,"switch")}}))}var o=r.userName(),h=e("membership.profile"),c=r.AccountManager.enabled(),f=r.AccountManager.list(),l,a,p,s;if(!ys){y();return}if(h.match(/\bview\b/)){if(p=f&&f[o]&&f[o].Email,s={text:o,desc:p,user:o,icon:!1,keepOpen:!0,callback:bt},t.push(s),u?(s.transition=!0,s.keepOpen=!1,s.callback=function(){var n=[{text:i.Back,callback:iu,icon:ut},{}];rv(n);it(n,"#app-panel-profile-context",{position:"left"})}):ly&&t.push({text:br.MyAccount,icon:"account",callback:function(){n.show({controller:"MyProfile",startCommand:"Edit",startArgument:"myAccountForm"})}}),u)return;v();t.push({})}if(h.match(/\bswitch\b/)&&c&&f)for(id in f)f[id].UserName&&(l=!0,id!=o&&t.push({text:id,context:id,icon:!1,desc:f[id].Email,user:id,callback:bh}));y();a||v()}function frt(n){var t=[];rv(t);t.length&&rt({anchor:n,y:n.offset().top+n.outerHeight(),title:t.length>1?"":r.userName(),items:t})}function ert(n,t,i,u,e,o){var h=t._filter,s=!t._id,c=!s&&t.viewProp("advancedSearchFilter");t._filter=u&&[i+":$in$"+u]||[];s||t.viewProp("advancedSearchFilter",null);uv(n,{valuesOnly:!0,dataView:t,field:i,afterclose:function(){t._filter=h;s||t.viewProp("advancedSearchFilter",c);o&&o()},callback:function(n,t){e&&e(ak(n.mappedId?f.activePage.data("detail-map")[n.mappedId]:r.find(n.dataViewId),n.field,t))}})}function rd(n,t){var i=ei(n),r=i.length?i.attr("data-for"):null,u=s(r);return t&&t.dataView||u.dataView}function uv(t,u){function tt(n,t){$(n).each(function(i){var r=this,u=r.itemClassName;return u&&u.indexOf("app-btn-apply")!=-1?(n.splice(0,i),this.callback=t,!1):r.animate?(n.splice(0,i),!1):void 0})}function it(t){n.contextScope(f._id);uu(f,e,uu(f,e)==t?!1:t);ah();n.contextScope(null)}function ft(){var n=ei(t),i=n.length?n.find(".app-grid.app-listview"):null;f.pageProp("frozenField",y==e?"_none_":e);f.extension()._reset=!0;yo(f);f.sync()}function et(){r.alert("hidden")}var f=rd(t,u),e=u.field||t.attr("data-field-name"),w=t.offset(),k=ro(),c=f.findField(e),v=f.findFieldUnderAlias(c),d=(uu(f,e)||"").toLowerCase(),l=[],s=[],a,g=c.AllowSorting&&!u.valuesOnly,ut=c.AllowQBE,y=ds(f),b,h;(g&&(s=[{text:du(c,"asc"),icon:d=="asc"?"check":"false",context:"asc",callback:it},{text:du(c,"desc"),icon:d=="desc"?"check":"false",context:"desc",callback:it},],s.push({text:i.Group,icon:"material-icon-group-work",callback:function(){la(f,c.Name)}})),$(f._fields).each(function(){var n=this;n.Hidden||n.GroupBy||n.OnDemand||(b=n.Name,y=="_first_"&&(y=b))}),e==b||u.valuesOnly||(u.hide&&s.push({}),s.push({text:hi.Freeze,icon:e==y?"check":null,callback:ft})),u.hide&&s.push({text:i.Hide,callback:et}),ut&&(a=gu({scopeField:v,samples:u.samples}),g&&a.splice(0,0,{}),u.valuesOnly&&tt(a,u.callback)),s&&(l=l.concat(s)),a&&(l=l.concat(a)),l.length)&&(h={x:u&&u.x||w.left+t.outerWidth()/2,y:u&&u.y||w.top+t.outerHeight(!0)*3/4,y2:u&&u.y2||w.top},rt({items:l,anchor:t,x:h.x,y:h.y,scope:f._id,afteropen:function(n){nl().length&&f._loadListOfValues(null,v.Name,c.Name,function(){var i=nl(),t=i.closest(".ui-listview"),r=i.length&&i.data("data-context"),c=!o,l=nt,e;r&&f._id==r.context.id&&v.Name==r.context.field&&(c&&t.hide(),e=gu(v),u.valuesOnly&&tt(e,u.callback),rf(t),fv(t,s.concat(e),u),t.listview("refresh"),c&&t.show(),!k&&h.y+5+ip(n)>l&&h.y2&&(h.y=h.y2,n.popup("option","arrow","t,b,l,r")),n.popup("reposition",k?{x:p/2,y:l-8}:h))})},afterclose:function(){u.afterclose&&u.afterclose()}}))}function fv(n,t,i){var r;$(t).each(function(){var t=this,f,u,e,s,h,c=t.icon,o=c;t.text?(r=!1,h=c=="check",h&&(o="false"),f=$("<li/>").appendTo(n),o||o==!1||(o=i.defaultIcon),e=o||"false",f.attr("data-icon",!1),t.disabled&&f.addClass("ui-disabled"),t.itemClassName&&f.addClass(t.itemClassName),t.callback?(u=$("<a/>").appendTo(f).text(t.text).data("data-context",t),t.keepOpen&&(u.addClass("app-keep-open"),t.animate||u.addClass("app-btn-icon-transparent")),h?(ft(t.radio&&!1?"material-icon-radio-button-checked":"material-icon-check",u),f.addClass("app-checked")):t.radio&&!1&&ft("material-icon-radio-button-unchecked",u),t.linkClassName&&u.addClass(t.linkClassName),t.animate&&u.addClass("app-animated app-animation-spin"),t.desc&&$('<p class="app-item-desc"/>').appendTo($("<p/>").appendTo(u)).text(t.desc)):t.href?u=$("<a/>").appendTo(f).text(t.text).attr("data-href",t.href):f.text(t.text).addClass("app-list-instruction ui-li-divider ui-bar-a"),t.visible&&(f.attr("data-visible","true"),u.addClass("app-selected")),t.selected&&t.depth&&u.addClass("app-item-selected"),e=bo(e),nh(e)&&ft(e,u),s=t.user,s&&ps(s,$('<i class="app-icon-avatar"/>').appendTo(u.addClass("app-avatar")).text(ws(s))),t.depth&&(f.addClass("app-has-depth"),u.addClass("app-depth"+t.depth)),t.color!=null&&$('<span class="app-event"> <\/span>').insertBefore(u.contents()).addClass("app-event-color-"+t.color)):r||(r=!0,$('<li data-role="list-divider"/>').appendTo(n))});r&&n.find("li").last().remove()}function ort(n){var t,i=$(document.activeElement);return i.is(":input")&&i.blur(),ay!=null&&+new Date-ay<300&&o&&(setTimeout(n,300),t=!0),t}function rt(t){function lt(){return on({x:t&&t.x||i&&i.length&&i.offset().left+i.outerWidth()/2,y:t&&t.y||i&&i.length&&i.offset().top+i.outerHeight(!0)*.8,y2:t&&t.y2||i&&i.length&&i.offset().top+i.outerHeight(!0)*.2})}function ot(i,r){var f=n.contextScope(),u=i.callback;t.scope&&n.contextScope(t.scope);u&&u(i.context,r);n.contextScope(f)}var v;if(!tt&&!ort(function(){rt(t)})){if(py()){setTimeout(function(){rt(t)},100);return}var c=!o,s=nt,r=$('<div class="app-popup app-popup-listview" data-theme="a"><\/div>'),i=$(t.anchor),u,h,f,l,d,g,ft=t.items||[],et=i.is(".app-btn-promo"),a,e=ro(),y=e?0:t.tolerance!=null?t.tolerance:5;if(!i||(currentPage=$(i).closest(".ui-page"),!currentPage.length||currentPage.is(".ui-page-active"))){gr();dt();kt();typeof t.x=="number"&&(t.x=Math.ceil(t.x));typeof t.y=="number"&&(t.y=Math.ceil(t.y));i.length&&(t.x==null&&(t.x=Math.ceil(i.offset().left+(t.xOffset?t.xOffset:i.outerWidth()/2))),t.y==null&&(t.yOffset=="bottom"?t.y=Math.ceil(i.offset().top+(c?i.outerHeight():i.outerHeight()/2)):typeof t.yOffset=="number"&&(t.y=Math.ceil(i.offset().top+i.outerHeight()*(c?t.y:1-t.y)))));(t.iconPos=="left"||!0)&&r.addClass("app-popup-icon-left");t.title&&$('<h1 class="ui-title"/>').appendTo($('<div class="ui-header ui-bar-a"><\/div>').appendTo(r)).text(t.title);u=$('<div class="ui-panel-inner" tabindex="0"><\/div>').appendTo($('<div class="ui-content"><\/div>').appendTo(r));h=$('<ul class="app-listview"/>').appendTo(u);fv(h,ft,t);h.listview().on("vclick",function(n){var i=$(n.target),t=i.closest("a");return i.is("[data-href]")?(g=i.attr("data-href"),g&&ih(g),k(t,function(){tf(r)})):t.length&&!d&&tu(t)&&(d=!0,k(t,function(){f=t.data("data-context");l=t;f.keepOpen?(ot(f,l),al(l),f=null,l=null,d=!1):tf(r)})),!1});if(tt=!0,bi(!1),"arrow"in t||!i.length||(t.arrow=c||t.dropDown?"t,b,l,r":"b,t,l,r"),r.popup({history:!c,arrow:e?null:t.arrow,tolerance:y,transition:o?vp():"none",afteropen:function(){td(null,r);t.afteropen&&t.afteropen(r);u.focus();tt=!1;bi(!0)},afterclose:function(){tt=!1;i&&(!(i.data("data-context")||{}).row||i.is(".app-calendar-selected"))&&i.removeClass("app-selected");t.afterclose&&t.afterclose(r,f);setTimeout(function(){t.autoFocus!=!1&&cr();f&&ot(f,l);f=null;l=null;rf(h);urt(h);tv(r)},100)},beforeposition:function(){if(b.width&&u[0].scrollHeight>u.height()){u.css({width:"","overflow-y":""}).parent().width("");var n=h.width();u.css({"overflow-y":"scroll"}).css({width:n+b.width}).parent().css({width:n,overflow:"hidden"})}}}),dw(r),ft.length==0&&(r.find(".ui-content").hide(),r.find(".ui-header").css({"border-bottom-width":0,"margin-bottom":".25em"})),a=e?{x:p/2,y:s-8}:lt(!0),i&&i.length){et||t.highlightAnchor==!1||i.is(".app-calendar-selected")||i.addClass("app-selected");var st=i.offset(),at=nt,ht=cu(),w=st.top,it=at-(st.top+i.outerHeight()),ct=e?s*.6:Math.max(w-ht*2,it-ht*2,50),ut=ip(r),vt=r.outerHeight()>s?ct:Math.max(ct,u.height());e||(!c&&w-y<ut?r.popup("option","arrow","b,t,l,r"):a.y2&&(w>it&&ut>it-y||!c&&ut<w-y)&&(a.y=a.y2,r.popup("option","arrow","b,t,l,r")));u.css({minHeight:e?Math.min(s*.4,s-156):null,maxHeight:e?Math.min(s*.6,s-156):vt})}stt(r);v=h.find('li[data-visible="true"]');v.length&&u.offset().top+u.outerHeight()<v.offset().top+v.outerHeight()&&u.scrollTop(v.offset().top-u.offset().top-(u.outerHeight()-v.outerHeight())/2);et&&n.promo().show();e&&r.addClass("app-popup-panel");r.data("position-options",a).popupopen(a)}}}function srt(n){var t=[];$(n).closest(".app-bar-buttons").find(".ui-btn:not(:visible):not(.app-btn-more)").each(function(){var n=$(this);t.push({text:n.text(),callback:function(){n.trigger("vclick")}})});rt({anchor:n,items:t,y:n.offset().top+n.outerHeight()/4*3,tolerance:3})}function hrt(n){return{overlayTheme:"b",history:!0,transition:n||"pop",positionTo:"window",afteropen:function(){$(this).attr("tabindex",0).focus();var n=iy;n&&setTimeout(function(){n()},200);iy=null},afterclose:function(){cr();var n=ic;n&&setTimeout(function(){n()},100);ic=null}}}function ud(n){var t=r.find(n.id),u=t.findField(n.field),i=n.op;t.removeFromFilter(u);i!="$clear"&&(i.startsWith("$")&&(i+="$"),t._filter.push(n.field+":"+i+(i.match(/\$(true|false)/)?"":t.convertFieldValueToString(u,n.value))));eo(t)}function fd(t,u){function o(n,i){var u=f.Name+":"+n;n.startsWith("$")&&(u+="$");u+=t.convertFieldValueToString(f,y);g!=u&&c.push({text:r.filterDef(d,n).Text+(i?" "+i:""),context:{id:t._id,field:e,op:n,value:y},callback:ud})}function it(i){var r=n.contextScope();n.contextScope(t._id);uu(t,e,uu(t,e)==i?!1:i);ah();n.contextScope(r)}function ut(n){var i=ei(l),r=l.data("data-context");r&&(sh(t).removeClass("app-selected"),i.length&&ra(i),l.addClass("app-selected"),pf(t,l),t.extension().tap(r,"none"),i.length?vu(t,i):s(t).echoChanged=!0,n())}function p(){ut(function(){go(l,ft)})}var a=$(u.target).closest(".app-field"),l=a.closest("a"),f,e,y,h,v,b,k=i.LookupViewAction,d,g,c=[],nt,tt,ft={x:ai(),y:yf()},w;if(a.length){if(w=l.data("data-context"),!w)return;e=a.attr("class").match(/app\-field\-(\w+)/);e&&(e=e[1]);e&&(u.preventDefault(),f=t.findField(e),nt=f.AllowQBE,tt=f.AllowSorting,v=t.findFieldUnderAlias(f.Name),v.ItemsDataController||(b=new RegExp("\\b"+e+"\\s*=\\s*\\w+"),$(t._fields).each(function(){var n=this;if(n.Copy&&b.exec(n.Copy))return v=n,k=String.format(ef.DetailsToolTip,t._allFields[n.AliasIndex].HeaderText),!1})),v.ItemsDataController&&!v.ItemsTargetController&&c.push({text:k,icon:"material-icon-arrow-forward",callback:function(){ut(function(){n.details({field:v})})}}),tt&&(c.length&&c.push({}),c.push({text:du(f,"asc"),icon:uu(t,e)=="asc"?"check":!1,context:"asc",callback:it},{text:du(f,"desc"),icon:uu(t,e)=="desc"?"check":!1,context:"desc",callback:it})),nt&&(c.length&&c.push({}),d=ct.Filters[f.FilterType].List,y=w.row[f.Index],$(t._filter).each(function(){var n=this;if(n.startsWith(e+":"))return g=n,c.push({text:String.format(st.ClearFilter,f.HeaderText),icon:"material-icon-clear",context:{id:t._id,field:e,op:"$clear"},callback:ud},{}),!0}),y==null?(o("$isempty"),o("$isnotempty")):(h=f.text(y),f.FilterType=="Text"&&(h='"'+h+'"'),f.FilterType=="Text"?(o("=",h),o("<>",h),o("$contains",h),o("$doesnotcontain",h)):f.FilterType=="Boolean"?(o("$true"),o("$false")):(o("=",h),o("<>",h),o("<=",h),o(">=",h),o("<",h),o(">",h)))),c.length?(c.push({},{text:i.More,icon:"material-icon-more-horiz",callback:function(){p(a)}}),rt({anchor:a,title:f.HeaderText,items:c,x:ai(u.pageX),iconPos:"left"})):p(a))}else{if($(u.target).closest(".app-grid-header").length)return;if($(u.target).closest(".app-presenter").length)return;l=$(u.target).closest(".ui-btn");l.length?p(l):u.preventDefault()}return!1}function ed(t){var i=$(t.target).closest(".ui-btn"),r=i.data("icon"),e,u,f;if(i.is(".app-btn-promo")){if(e=i.data("icon-list"),e)return k(i,function(){var r=[],o=i.attr("data-icon"),t,f;if(i.is(".app-btn-promo-cancel"))return $(".ui-popup-screen.in").trigger("vclick"),!1;$(e.icons).each(function(){t=this;t.match(gh)||(f=e.labels[t].split(/\n/),r.push({text:f[0],desc:f[1],icon:t,context:t,callback:function(t){n.executeInContext(t)}}))});u=r[r.length-1];u&&u.callback?u.callback(u.context):(i.addClass("ui-icon-delete app-btn-promo-cancel").removeClass(o),rt({anchor:n.promo(),items:r,iconPos:"left",y:i.offset().top-1,afterclose:function(){i.removeClass("ui-icon-delete app-btn-promo-cancel").addClass(o)}}))}),!1;if(re())return k(i,ia),!1}return f=bt,r=="search"?f=fr:r=="user"?f=function(){frt(i)}:r=="phone"&&nr?n.executeInContext(r):f=r=="apps"?function(){ev("right")}:function(){n.executeInContext(r=="check"?"ok":r)},k(i,f),!1}function od(t,i,r){var e,u;oi()||(t=f.path.convertUrlToDataUrl(f.path.makeUrlAbsolute(t,f.path.documentBase)),e=c.find("> div[data-url]").filter(function(){return $(this).attr("data-url")==t}),r?(fe(),location.href=t):e.length?(e.appendTo(c),u=s(e.attr("id")),u?(n.makeModalOrPanel(u),u.navigateInfo={href:t,transition:i},n.changePage(u.id)):f.navigate(t,{transition:i})):(oi(!0),$.ajax({url:t,dataType:"html",success:function(r){var u;if(oi(!1),u=r.match(/<td\s+id\s*=\s*"PageContent"\s*>([\s\S]+)?<\/td>\s*<td\s+id\s*="PageContent.+"\s*>/i),u||(u=r.match(/<div\s+id\s*=\s*"PageContent".+?>([\s\S]+)?<\/div>\s*<footer /i)),u&&!r.match(/\$create\(Web.DataView|\s+data-controller\s*=\s*"/)){for(var f=u[1],e,h=new Sys.StringBuilder,l=/<script.+?>([\s\S]+?)<\/script>/ig,a,o,s,v=1;a=l.exec(f);)h.append(a[1]);for(f=f.replace(l,""),e=$("<div><\/div>").appendTo(c).hide().attr("data-href",t),e.html(f).data("scripts",h.toString()),s=dc(t);n.pageInfo(s);)s=dc(t)+v++;o={pageId:s,selector:e,transition:i,dynamic:!0};n.pageInfo({id:o.pageId,text:o.pageId,url:t,root:!0});n.start(o);e.data("scripts",null).remove()}else fe(),location.href=t},error:function(){oi(!1)}})))}function crt(n){var t=$(n.target);if(t.is(".app-btn-toggle"))return t.addClass("ui-btn-active"),c.focus(),setTimeout(function(){function u(){i.removeClass("app-text-expanded");t.attr("title",es.Maximize).toggleClass("ui-icon-carat-u ui-icon-carat-d");yr()}t.removeClass("ui-btn-active");var i=t.prev(),r,n;i.is(".app-text-expanded")?(r=i.closest(".dv-item,.ui-field-contain"),r.length?(n=w(t),le(n,r.offset().top-(n.offset().top-n.scrollTop())-n.height()*.33,u)):u()):(i.addClass("app-text-expanded"),t.attr("title",es.Minimize).toggleClass("ui-icon-carat-u ui-icon-carat-d"))},ti),!1}function sd(n){h.left.visible&&(arguments.length||(n=!h.left.mini,e("ui.sidebar.mini",n),ot("minisidebar",n)),h.left.mini=n,c.toggleClass("app-has-minisidebar-left",h.left.mini),kp(),th(!0),ki(!0),$(document).trigger("sidebarstatechanged.app"),lt(!1,0,function(){if(h.left.visible){var t=h.left.inner;t.css({transform:"translate3d("+(n?"100":"-66")+"%,0,0)"});setTimeout(function(){t.css({transition:"transform 128ms ease-in-out"});setTimeout(function(){t.css("transform","").one("transitionend",function(){t.css("transition","")})})})}}))}function lrt(){ev(null,!0)}function ev(n,t){var r=[],u;t&&(u=at,r=[{text:i.Back,icon:ut,callback:function(){at=u;it(r,"#app-panel-apps")}},{}]);nf(r,!0,t?Web.Menu.nodes:null,t?1:0);it(r,"#app-panel-apps"+(t?"-all":""),{position:n||"left"})}function art(t){var r=$(t.target);if(!wt)return ac(),kt(r,!1),dt(),r.attr("data-action")=="#app-back"?(n._backText.addClass("ui-btn-active"),k(r,function(){n._backText.removeClass("ui-btn-active");li()})):k(r,function(){if(h.left.visible)vf(!0),sd();else{var n=[{text:hc(),itemClassName:"app-logo"}],t=$("#app-panel-menu-scope.ui-panel-open");t.length?t.panel("close"):(vf(!0),rv(n,!0),n.length&&n.push({}),(!hw()||Web.Menu.nodesWithIcons.length&&ht("ui.menu.tiles")||!h.left.visible&&e("ui.menu.location")!="toolbar")&&(nf(n,!0),n.push({})),ht("settings.enabled")&&n.push({text:i.Settings,icon:"material-icon-settings",transition:!0,callback:po}),it(n,"#app-panel-menu",{position:"left"}))}}),!1}function hd(t,i){var u,r=f.path.parseUrl(t),e=r.hash;return r.host&&(u=function(){if(!oi())if(r.host=="maps.apple.com"||r.host=="maps.google.com"||i)ih(t);else{var u=r.pathname.replace(/\//g,"-").substring(1)||r.host.replace(/\W/g,"-"),s=r.filename.replace(/\W/g," "),o=n.pageInfo(u),f,e;o||n.pageInfo({id:u,external:!0,href:t});f=n.page(u);e=f.find("iframe");oi(!0);n.busy(!0);e.length&&e.remove();e=$('<iframe class="app-page-external"/>').attr("src",t).appendTo(w(f).addClass("app-wrapper-external")).load(function(){et()==u?(oi(!1),n.busy(!1)):setTimeout(function(){n.changePage(u)})});gt&&w(f).css("overflow","auto")}}),u}function vrt(t){var v,e,y,u,l,a,p;if(!t.isDefaultPrevented()){var h=$(t.target),i=h.is("a")?h:h.closest("a"),o=i.attr("href")||(i.attr("data-action-path")?"#app-action":""),r;if(!tt){switch(o){case"#app-menu":r="#app-btn-menu";break;case"#app-context":r="#app-btn-context";break;case"#app-back":r=li;break;case"#app-details":r=function(){var n=s(),t;n&&n.dataView&&(t=n.dataView.extension(),t.command(t.commandRow(),"Select"),ls=i.attr("data-field-text"),n.dataView._viewDetails(i.attr("data-field-name")))};break;case"#app-refresh":r=function(){var n=s();n&&n.dataView&&n.dataView.sync()};break;case"#app-clear-filter":r=function(){var n=s();n&&n.dataView&&fl(n.dataView,!1)};break;case"#app-filter":r=function(){var n=s();n&&n.dataView&&gu({mode:"everything"})};break;case"#app-action":if(i.is(".app-btn-disabled"))return i.removeClass("ui-btn-active"),!1;r=function(){var r=i.attr("class").match(/ui-icon-([\w\-]+)/)||[0,"carat-r"],t=i.attr("data-action-path");t=="wizard-next"?setTimeout(function(){dr("next",{container:w()})}):t=="wizard-prev"?setTimeout(function(){dr("prev",{container:w()})}):i.is(".app-btn-more")?srt(i):r&&(r[1]=="carat-r"?n.executeInContext(null,i.text(),t):n.executeInContext(r[1],null,t))};break;default:if(o)if(o.match(/^tel/))ih(o),r=bt;else if(!i.attr("target"))if(v=i.attr("data-content-type"),v&&v.match(/^image/))r=function(){if(e=$("#app-popup-image"),!e.length){e=$('<div id="app-popup-image" class="app-popup-image" data-role="popup" data-overlay-theme="b" data-theme="b" data-position-to="window"><a href="#app-back" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn ui-icon-close-circle ui-btn-icon-notext ui-btn-right"/><img class="app-image-preview" style="max-width:10000px"/><div class="app-image-preview-box"><\/div><\/div>').appendTo(c).popup(hrt("none")).popup("option","history",!0);e.find(".app-image-preview").one("load",function(t){var i=$(t.target);setTimeout(function(){oi(!1);i.width("").height("");var o=e.find(".app-image-preview-box"),s=n.screen(),r=i.width(),f=s.width*.9,t=i.height(),u=s.height*.9;r>f?(t*=f/r,r=f,t>u&&(r*=u/t,t=u)):t>u&&(r*=u/t,t=u);i.hide();o.css({background:"",width:r+"px",height:t+"px"}).show();e.popup("reposition",{positionTo:"window"});o.css({background:String.format("url({0})",i.attr("src")),"background-size":String.format("{0}px {1}px",r,t)})},100)})}oi(!0);e.find(".app-image-preview-box").hide();e.find(".app-image-preview").attr("src","").width(100).height("").show().attr("src",o+"&_ticks="+(new Date).getTime());ic=function(){tv(e)};e.popupopen()};else if(r=hd(o,i.is('[rel="external"]')),!r&&!i.closest(".ui-panel-inner").length)if(y=f.path.parseUrl(o),u=y.hash,u)if(i.closest(".app-content-framework").length){if(h.data("app-click-test"))return;h.data("app-click-test",!0);f.linkBindingEnabled=!1;t.type="click";$(document).trigger(t);h.data("app-click-test",null);f.linkBindingEnabled=!0;t.isDefaultPrevented()||(u=="#"?r=function(){le(w(),0)}:(l=u&&u.length>1&&f.activePage.find(u+',a[name="'+u.substring(1)+'"]'),a=w(),r=l&&l.length?function(){p=l.offset().top-(a.offset().top-a.scrollTop());k(i,function(){le(a,p)})}:function(){$(u).is(".ui-page")&&n.changePage(u.substring(1))}));r&&t.preventDefault()}else u!="#"&&(r=function(){f.navigate(u)});else r=function(){od(o,i.attr("data-transition"),i.attr("rel")=="external")}}if(r&&!n.busy()){if(i.attr("download")){i.click();return}return k(i,function(){if(n.busy(!1),typeof r=="string"){var t=r;r=function(){$(t).trigger("vclick")}}r()}),!1}}}}function cd(t){var u=t.message,f=u!=null?u.toString():"",i=t.cancel;n.busy(!1);ui(function(){var t=n.pageInfo();yc(function(){var i=t.dataView.survey(),n;i&&(n=i._cancel,t._canceled||(n==!1&&(n=i._submit),n&&n()))})});r.survey({_submit:t.submit,_cancel:i,controller:t.name,questions:[{name:"Message",value:f,text:!1,readOnly:!0,rows:3,htmlEncode:!f.match(/<\/\w+>/)}],options:{modal:{fitContent:!0,always:!0,max:"xxs",buttons:{more:!1}},promo:!1},submit:"alertconfirmed.app",cancel:i!=!1?"alertnotconfirmed.app":i,layout:'<div data-container="panel"><span data-control="field" data-field="Message">[Message]<\/span><\/div>'})}function ov(n,t,i){$(n).each(function(){var n=this,r=n.url,f=$("<li/>").appendTo(t).addClass("app-depth"+i),u,e;r?(u=r.match(bv),u&&(r=u[2],e=u[1]),$("<a/>").appendTo(f).data("node",n).attr({href:r,target:e,rel:"external"}).text(n.title)):$("<span/>").appendTo(f).text(n.title);n.children&&ov(n.children,t,i+1)})}function yrt(){var r,t;for(r in ii.Nodes){ii.nodes=ii.Nodes[r];break}ii.nodes&&(t=$("#app-btn-context").on("vclick",function(){if(!n.busy()&&!t.data("skipClick")){var i=re();return k(t,function(){if(i)switchToQuickFind();else if(($(".ui-panel-open").attr("id")||"").match(/^app-panel-context/))vf();else{vf(!0);var t=c.is(".app-has-panel-right")?"left":"";n.showContextMenu({position:t,scope:t?n.dataView():null})}}),!1}}),$('[data-app-role="sitemap"]').attr("class","app-site-map").each(function(){function u(){var n=$('<li><a rel="external"/><\/li>').appendTo(t).find("a");$("#app-welcome").length&&!r?n.attr("href","#app-welcome").text(br.LoginButton):di.loginStatus(n)}var f=$(this),t=$('<ul data-inset="false" />').appendTo(f),r=di&&di.loggedIn();di&&!r&&u();ov(ii.nodes,t,1);di&&r&&u();t.listview().on("vclick",'a[rel="external"]',function(t){var i=$(t.target),r=i.attr("href"),f=i.attr("target"),u=r.match(/^#/);return tu(i)?(u||f||fe(),k(i,function(){u?n.changePage(r.substring(1)):wo(i.data("node"))}),!1):!1}).filterable({filterPlaceholder:i.FilterSiteMap})}))}function pr(n){var t=n.originalEvent,i=t;return t.pageY==null&&(t=t.touches[0]||t.changedTouches[0]),{x:i.pageX,y:i.pageY}}function ye(){clearTimeout(sv);uf&&(uf.data("touch-start",null),uf=null)}function ns(n){if(au(n),y){var t=y.moved&&(y.originalX!=y.x||y.originalY!=y.y);t&&(y.swipeLeft=y.originalX>y.x,y.swipeRight=y.originalX<y.x,y.swipeUp=y.originalY>y.y,y.swipeDown=y.originalY<y.y,y.swipeHorizontalDistance=Math.abs(y.originalX-y.x),y.swipeVerticalDistance=Math.abs(y.originalY-y.y));n.type!="touchcancel"&&(n.type!="mousemove"||y.moved)||(d._keepTap=!0);$(document).trigger($.Event(t?"dragend.app":"dragcancel.app",{drag:y}));t||n.type=="taphold"?(n.preventDefault(),n.stopPropagation(),d.dragged(!0)):y.dir=="all"&&n.type=="touchend"&&(ir={x:y.x,y:y.y},$(document.elementFromPoint(y.x,y.y)).trigger("vclick"));y.target=null;y.data=null;y=null}yt&&(y=yt,yt=null,ns(n));$(document).off("pointermove mousemove touchmove",lv).off("pointerup pointercancel mouseup touchend touchcancel",ns)}function lv(n,t){var i;if(yt){var i=pr(n),u=Math.abs(i.x-yt.x),r=Math.abs(i.y-yt.y),f=yt.dir=="horizontal";if((u<1||r<1)&&(y&&(y.moved=!1),!t))return;yt.dir=="all"||f&&u>r&&u>(yt.mouse?3:yt.pointer?2:1)&&r<(yt.pointer&&yt.touch?50:9)?(ye(),y=yt,(n.type=="touchmove"||n.type=="pointermove")&&n.preventDefault(),yt=null,bi(!1)):(f&&(u||r)&&ye(),(!f||r)&&ns(n))}y&&(n.preventDefault(),gr(),i=pr(n),y.moved||(y.moved=!0,y.originalX=y.x,y.originalY=y.y),(y.x!=i.x||y.y!=i.y)&&(y.lastX=y.x,y.lastY=y.y,y.x=i.x,y.y=i.y,y.dropTarget=n.type.match(/^touch|pointer/)?document.elementFromPoint(i.x,i.y):n.target,$(document).trigger($.Event("dragmove.app",{drag:y}))))}function bi(n){o||(c[0].style.pointerEvents=n?"":"none")}function prt(){av||(av=!0,aw(),dt(),vc().length&&n.promo(!1),$(document).trigger("resizing.app"),n._toolbarButtons.hide())}function ki(t,i){var o,r,u,e;tt||(wt=!1,t&&(av=!1,fo(),$(".ui-panel-dismiss").height(nt),pi(),o=vc(),o.length&&(pi(o),r=s(),df(r?r.dataView:null),wc()),lt(!1,null,function(){ur();wu();yr();nu();ce(null,!0);ae()})),dt(),u=w(i),hr(u),wp(u),t||ae(null,i),df(),fo(!0),h.left.visibile&&h.left.inner.trigger("scroll"),wtt(u),t?so(u):setTimeout(function(){so(u)}),t&&f.activePage.find(".app-echo-toolbar").each(function(){echo=$(this).parent();echo.is(":visible")&&(pageId=echo.attr("data-for"),r=s(pageId),r.echoId&&!r.dataView._busy()&&lh(r.dataView,echo))}),clearTimeout(uy),uy=setTimeout(function(){if(!tt){er();n.refreshMenuStrip();var t=et();$(n._pages).each(function(){var i=this,n;i.echoId&&(n=$("#"+i.echoId),n.length&&n.closest(".ui-page").attr("id")!=t&&(i.echoChanged=!0,n.find(".app-echo-controls").addClass("app-stale")))});yw(w())}},1e3),t&&(e=$(".ui-popup"),e.is(".app-popup-message,.app-popup-listview")?tf(e):e.popup("reposition",{positionTo:"window"}),wt=!1,$(document).trigger("resized.app")))}function dt(){vt&&vt[0].style.display!="none"&&vt.hide();lf&&(clearTimeout(lf),lf=null)}function vv(n,t,i,r,u){var c,y;if(!o||u){c=i.split(/\n/g);vt||(vt=$('<div class="app-tooltip"><\/div>').appendTo(document.body).hide(),tp()&&vt.addClass("app-large"));vt.text(i);c&&(i.match(/\t/)?(y=$("<table/>").appendTo(vt.empty()),$(c).each(function(){var n=this.split(/\t/g),t=$("<tr/>").appendTo(y);$(n).each(function(){var n=this,i=$("<td/>").appendTo(t);n.match(/\"/)?i.html(n.replace(/"(.+?)"/g,"<b>$1<\/b>")):i.text(n)})})):(vt.empty().removeClass("app-tooltip-message"),$(c).each(function(n){var t=this;n&&$("<br/>").appendTo(vt);t.match(/\"/)&&(t=t.replace(/"(.+?)"/g,"<b>$1<\/b>"));$("<span/>").appendTo(vt).html(t)})));vt.show();var a=gi.scrollLeft(),w=gi.scrollTop(),v=vt.outerWidth(),e=vt.outerHeight(),b=p,f,s,l=r&&r[0].className;u&&(t+=2);l&&typeof l=="string"&&(l.match(/\bapp-btn-float\b/)?(f=r.offset(),n=r.css("right")!="auto"?f.left-v-8:f.left+r.outerWidth()+12,t=f.top+r.outerHeight()/2-e/2+1,s=!0):l.match(/\bui-btn\b/)&&r.closest(".app-sidebar").length&&(h.left.mini?(n=h.left.width+6,t=r.offset().top+r.outerHeight()/2-e/2+1,s=!0):r.parent().is(".app-bar-toolbar-bottom")&&(f=r.offset(),t=f.top-e-6,n=f.left+r.outerWidth()/2-vt.outerWidth()/2,n<0&&(n=2),s=!0)));s||(a+n+v>=a+b&&(n=a+b-v-16),w+t+e>=w+nt&&(t=t-24-e));vt.css({left:s?n:n-5,top:t});u&&vt.addClass("app-tooltip-message")}}function ld(){$(".app-data-input").removeData("keepFocus").trigger("blur")}function wrt(i){var r,v,h,k,s,u,y,f,p,e,b,a;if(!t.valid())return!1;if(p=$(".app-data-input"),f=i.closest("[data-input]"),p.length)if(o||!0)f.data("hitTest",!0),p.closest("[data-input]").data("hitTest")||(p=null),f.removeData("hitTest"),ld();else return;if(f.find("[data-input-hotspot]").length&&!i.is("[data-input-hotspot]"))return!1;if(o&&(clearTimeout(l.textInputStubTimeout),$(".app-text-input-stub").length||(e=w(),b=kf(e),b.is(".app-page-modal")&&b.data("original-top",b.css("top")).css("top",15),$('<div class="app-text-input-stub"><\/div>').height(Math.min(350,e.height()*.5)).appendTo(e))),u=$.Event("getvalue.input.app"),f.trigger(u),a=u.inputRows,r=a?$('<textarea class="app-data-input" rows="'+(parseInt(a)+1)+'"/>'):$('<input class="app-data-input"/>').attr("type",u.inputIsPassword?"password":"text"),o||a||r.attr("spellcheck","true"),k=t.createContainer(f.addClass("app-has-focus")),r.appendTo(k),a&&k.addClass("app-has-textarea"),h=u.inputAltValue||u.inputValue||"",u.inputMaxLength&&r.attr("maxlength",u.inputMaxLength),r.val(h).data("original",h),u.placeholder&&(v=$('<span class="app-data-input-placeholder"/>').insertAfter(r).text(u.placeholder).css("display",h?"none":""),v.css({"margin-top":-v.height()/2}),r.data("placeholder",v)),u.change&&(r.data({change:u.change,last:h}),u.change=null),s=f.attr("data-type"),!s){switch(u.inputDataType){case"DateTime":s="datetime";break;case"Date":s="date"}f.attr("data-type",s)}switch(s){case"datetime":break;default:s&&o&&r.attr("type",s).val(u.inputValueRaw)}return(y=$.Event("beforefocus.input.app",{inputElement:r}),f.trigger(y),y.inputElement=null,y.isDefaultPrevented())?!1:(r.focus()[0].setSelectionRange(o?h.length:0,h.length),o&&(e=w(),clearTimeout(l.textInputScrollTimeout),l.textInputScrollTimeout=setTimeout(function(){var u=r.offset(),s=r.outerHeight(),t,i,h=c.scrollTop(),f=e.height(),o=e.offset();gt&&(f*=.5);u.top<o.top||u.top+s>o.top+h+f?(gt&&(t=r[0],i=r.val().length,i||r.val(" "),t.selectionStart=0,t.selectionEnd=0),n.animatedScroll(e,u.top-o.top+e.scrollTop()-h-f/2+s/2,function(){gt&&(i||r.val(""),t.selectionStart=i,t.selectionEnd=i);er()})):er()},500)),!0)}var kh="app-transition",ff=navigator.userAgent,dh=navigator.platform,gt=/iPhone|iPad|iPod/.test(dh)&&ff.indexOf("AppleWebKit")>-1,ts=gt?parseInt(navigator.userAgent.match(/\(i.*;.*CPU.*OS (\d+)_\d+/)[1]):null,nr=/Android/i.test(ff),brt=/chrom(e|ium)/i.test(ff),is=!!ff.match(/Trident\/7\./),ad=/safari/i.test(ff),o,rs=96,us=100,krt=dh.match(/Mac/i)!=null,vd=dh.match(/Win/i)!=null,yd=Sys.CultureInfo.CurrentCulture,wr=yd.dateTimeFormat,pd=/^s*(\w+)\s*\|s*(.+?)\s*(\|\s*(.+)\s*)?$/,wd=/(<(\/*(a|span).*?>)|(&nbsp;)|onclick=\".+?\")/g,bd=/(<(\/*(b).*?>))/g,kd=/\" ([\.;])/g,yv=/\b(((material\-icon|glyphicons|glyphicon|fa|ion)\-([\w\-]+?)))(\s|$|,)/,dd=/phone/i,gd=/email/i,ng=/\burl/i,tg=/^\s*(\w+)(\s+(\w+)\s*)?$/,pv=/\$(true|false|in|notin|tomorrow|today|yesterday|next|this|last|year|past|future|quarter|month|isempty|isnotempty)/,fs=/\s*(\w+)(\s+(asc|ascending|desc|descending))?\s*(,|$)/gi,gh=/(delete|clear|trash|remove|undo|erase)/,wv=/^(Byte|Currency|Decimal|Double|Int16|Int22|Int64|Single|SByte|UInt16|UInt32|UInt64)$/,bv=/^(_\w+):(.+)$/,di,nc="",ii,tr={cache:{},list:[],keyCodes:[]},si=Web.DataViewResources,kv=si.Views,dv=si.Menu,ct=si.Data,fu=si.Pager,gv=si.ModalPopup,st=si.HeaderFilter,i=si.Mobile,hi=si.Grid,es=si.Form,tc=si.Actions,eu=si.Validator,ef=si.Lookup,br=Web.MembershipResources&&Web.MembershipResources.Bar,ou=tc.Scopes.Grid,ig=si.InfoBar,su=i.Themes,ni=i.Import,os=i.Develop,ss=ct.BooleanDefaultItems[0][1],hs=ct.BooleanDefaultItems[1][1],rg=ct.NullValueInForms,ny,ty,iy,ic,of,sf,ry,pe,cs,uy,we,fy,wt,or,tt,ey={},at,ci,ug,oy={},fg=500,eg=500,be=["tn","xxs","xs","sm","md","lg","xl","xxl"],hf,cf,og="http://www.w3.org/2000/svg",vt,lf,sg=500,hg,cg=0,sy,lg,rc,yi,uc,ls,ke,as,fc,de,g,ec={},h,r=$app,t,l=window,vs=history,sr=l.parent!=l,oc,c,gi=$(l),p=gi.width(),nt=window.innerHeight,f=$.mobile,ri=f.navigate.history,ti=34,ag=450,sc=1e3,af,b,hy,cy,ly,ys,vg,ge,ir,ay,d,y,yt,ut="material-icon-chevron-left",wk,n,uf,sv,hv,cv,av;r.keyCode={backspace:8,tab:9,enter:13,esc:27,space:32,insert:45,"delete":46,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};r.import=function(u,e){function a(n){return n.match(/\.(\w+)$/)[1].toLowerCase()}function c(n){var f=r.import.state.queues.errors,o=e.data[n.index-1],u,t;if(!f.length){t=[i.Line,i.Error];for(u in o)t.push(u);f.push(bb(t))}t=[n.index+1,n.error];for(u in o)t.push(o[u]);f.push(bb(t))}function v(n,t){for(var i,u=e.data,f=t.DataFormatString,r=0;r<Math.min(u.length,100);r++)if(i=u[r],i&&(i=i[n]),i)break;return i&&t.Type.match(/^Date/)&&typeof i=="number"&&(i=f?String.format(f,k(i)):i.toString()),i}function g(n){for(var r="",t=0,i=10240;t<n.byteLength/i;++t)r+=String.fromCharCode.apply(null,new Uint8Array(n.slice(t*i,t*i+i)));return r+String.fromCharCode.apply(null,new Uint8Array(n.slice(t*i)))}function y(n){var t=n[n.length-1];return t=="Z"?n.length-1>0?y(n.substring(0,n.length-1))+"A":"AA":n.substring(0,n.length-1)+String.fromCharCode(n.charCodeAt(n.length-1)+1)}function p(n){this.message=n}function nt(){var n=e.dataView,u=e.view,f=n.get_parentDataView();ui(yh);r.survey({text:n.get_view().Label,text2:tc.Scopes.ActionBar.Import.HeaderText,parent:n._id,context:{id:n._id,controller:n._controller,view:u},controller:"import_from_file",topics:[{description:ni.SelectFile,wrap:!0,questions:[{name:"file",text:!1,type:"blob"}]}],options:{materialIcon:"file-upload",discardChangesPrompt:!1,modal:{fitContent:!0,max:"xs",always:!0}},submitText:i.Submit,submit:function(n){function e(){o||t.focus({fieldName:"file"})}var f=n.dataView,u=f.survey("data"),s=f.survey().context;u.file?r.import("supports",{name:u.file[0].name})?ui(function(){r.import("parse",{file:u.file[0],callback:function(n){r.import("map",{data:n,name:u.file[0].name,context:s})}})}):(n.preventDefault(),$app.alert(String.format(ni.NotSupported,u.file[0].name),e)):(n.preventDefault(),$app.alert(i.Files[o?"Tap":"Drop"],e))}})}function w(){var s,i,l;try{if(s=h.result,a(e.file.name)=="csv")i=$.csv.toObjects(s);else{i=[];var nt=g(s),v=XLSX.read(btoa(nt),{type:"base64"}),c=v.Sheets[v.SheetNames[0]],w=c["!ref"],r=w?w.match(/(([A-Z]+)(\d+))\:(([A-Z]+)(\d+))/):null,b,k,t,u,f,o=[],d=[];if(!r)throw new p(ct.NoRecords);if(b=r[2],k=r[5],u=parseInt(r[3]),lastRow=parseInt(r[6]),u<lastRow){for(f=u+1,t=b;t!=k;)o.push(t),t=y(t);for(o.push(t),o.forEach(function(n){var t=c[n+u];d.push(t?t.v:null)});f<=lastRow;)l={},i.push(l),o.forEach(function(n,t){var i=c[n+f],r=d[t];r&&(l[r]=i?i.v:null)}),f++}}if(i.length)n.busy(!1),e.callback&&e.callback(i);else throw new p(ct.NoRecords);}catch(tt){n.busy(!1);$app.alert(tt.message)}}function b(t){function nt(n,t){var r=g[n.Name];r.value=t;r.items.values.push({value:t,text:t});i.splice(i.indexOf(t),1)}var u=e.context,c,l,f;if(!arguments.length){r.execute({controller:u.controller,view:u.view||"createForm1",requiresData:!1,success:function(n){b(n)}});return}var s=$app.find(u.id),p=(s._filterFields||"").split(","),w=t.fields,h=[],i=[],a,o=[],k=s.get_view().Label,y=[],g={};for(a in e.data[0])h.push(a.toLowerCase()),i.push(a);if(u.importColumns=i.slice(0),w.forEach(function(n){var e=n;if(n=w[n.AliasIndex],!e.Hidden&&!n.OnDemand&&!e.ReadOnly&&e.Type!="DataView"){var r=n.Name,l=n.HeaderText,t={name:r,text:l,causesCalculate:!0,items:{style:"DropDownList",values:[{value:null,text:ni.NotMatched}]},value:null,columns:30,placeholder:ni.NotMatched,required:!n.AllowNulls},f=h.indexOf(l.toLowerCase()),a=p.indexOf(e.Name);if(a!=-1){if(a>0)return;delete t.items;var b=s.context(),c=b.headerField(),v=s.context("data");t.value=c?c.format(v[c.Name]):ct.NullValueInForms;t.readOnly=!0;u.masterKey=[];p.forEach(function(n){u.masterKey.push({field:n,newValue:v[n],modified:!0})})}else f==-1&&(f=h.indexOf(r.toLowerCase())),f==-1?o.push(n):(r=i[f],t.value=r,t.items.values.push({value:r,text:r}),h.splice(f,1),i.splice(f,1));y.push(t);g[t.name]=t}}),o.length){for(c=0;c<i.length;)f=i[c],l=null,$(o).each(function(n){var t=this;if(t.HeaderText.indexOf(f)!=-1||t.Name.indexOf(f)!=-1)return l=t,o.splice(n,1),!1}),l?nt(l,f):c++;o.length&&o.forEach(function(n){f=null;$(i).each(function(){var t=this;if(t.indexOf(n.HeaderText)!=-1||t.indexOf(n.Name)!=-1)return f=t.toString(),!1});f&&nt(n,f)})}y.forEach(function(n){i.forEach(function(t){n.items&&n.items.values.push({value:t,text:t})});var r=n.value,u;r&&(u=t.map[n.name],n.footer=v(r,u))});u.availableColumns=i;u.metadata=t;r.survey({controller:"import_map",text:k,text2:tc.Scopes.ActionBar.Import.HeaderText,description:String.format(ni.FileStats,e.data.length,e.name),questions:y,options:{modal:{max:"xs",fitContent:!0,always:!0},materialIcon:"settings_input_component"},context:u,submit:function(t){e.fieldMap=t.dataView.survey("data");for(var i in e.fieldMap)t.dataView.findField(i).ReadOnly&&delete e.fieldMap[i];t.dataView.tag("discard-changes-prompt-none");ui(function(){ui(function(){var t=n.pageInfo();yc(function(){t._canceled||t.dataView.survey().cancel()});d("init")});r.survey({controller:"import_status",options:{modal:{max:"xxs",fitContent:!0,always:!0,buttons:{more:!1,fullscreen:!1}},contentStub:!1},questions:[],layout:String.format('<div style="padding:1em"><div>{0} <b>{1}<\/b> {2} <b>{3}<\/b>...<\/div><div class="app-import-status">&nbsp;<br/>&nbsp;<br/>&nbsp;<br/>&nbsp;<\/div><\/div>',ni.Importing,e.name,ni.Into,k),submit:!1,cancel:function(){r.import.state=null}})})},submitText:ni.StartImport,calculate:function(n){var i=n.dataView,e=i._fields,o=i.survey(),s=o.context,u=s.importColumns.slice(0),f=i.survey("data");e.forEach(function(n){if(!n.ReadOnly){var i=f[n.Name],e=n.FooterText;i!=null?(u.splice(u.indexOf(i),1),n.FooterText=v(i,t.map[n.Name])):n.FooterText=null;e!=n.FooterText&&setTimeout(function(){r.input.execute({values:[{name:n.Name,value:f[n.Name]}]})})}});e.forEach(function(n){if(!n.ReadOnly){var t=n.Items,i=f[n.Name];n.ItemCache=null;t.splice(1);i!=null&&t.push([i,i]);u.forEach(function(n){t.push([n,n])})}})}})}function s(){return(new Date).getTime()}function k(n){var e=Math.floor(n-25568),o=e*86400,i=new Date(o*1e3),s=n-Math.floor(n)+1e-7,t=Math.floor(86400*s),r=t%60,u,f;return t-=r,u=Math.floor(t/3600),f=Math.floor(t/60)%60,new Date(i.getFullYear(),i.getMonth(),i.getDate(),u,f,r)}function d(){var t=r.import.state,vi,y,et,it,st,pt,wt,bt,l,b,tt,kt,dt,gt,ai;if(arguments[0]=="init"){r.import.state=t=e;var ti=t.context.metadata,yi=t.fields={},ii=t.fieldMap,it=t.columnMap={};for(y in ii)et=ii[y],et&&(it[et]=y);t.duplicate={test:[],accept:[]};ti.fields.forEach(function(n){yi[n.Name]=n;var i=n.Tag;i&&(i.match(/\bimport-duplicate-test\b/)&&t.duplicate.test.push(ti.fields[n.AliasIndex]),i.match(/\bimport-duplicate-accept\b/)&&t.duplicate.accept.push(n.Name))});t.status=f.activePage.find(".app-import-status");t.dataView=r.find(t.context.id);t.index=0;t.count=0;t.lookupCache={};t.queues={lookup:[],nextLookup:0,test:[],submit:[],errors:[]};t.started=s();t.mode="scan"}else if(t){var u=t.queues,pi=s(),p=t.data,ot=t.context.controller,ri=t.context.view;if(t.mode=="scan"){if(it=t.columnMap,p.length)while(t.index<p.length){st=p[t.index++];var g=[],y,h,nt,o,a,v=[],ht,rt=[],ct=[],ui=t.duplicate.test;for(y in it)if(o=st[y],h=t.fields[it[y]],h&&e.fieldMap[h.Name]==y)if(nt=h.Name,a=h.OriginalIndex!=h.Index?t.fields[t.context.metadata.fields[h.OriginalIndex].Name]:null,o==null)a&&(h=a),g.push({field:h.Name,newValue:o,modified:!0}),ui.indexOf(h)!=-1&&rt.push(nt+": "+eu.RequiredField);else{if(a){nt=a.Name;var fi=a.ItemsDataController,ei=a.ItemsDataView,lt=a.ItemsDataTextField,at=a.ItemsDataValueField,vt=fi+"_"+ei+"_"+at+"_"+lt,ut=t.lookupCache[vt],w,yt;ut||(ut=t.lookupCache[vt]={});w=ut[o];w&&w.v!=null?o=w.v:at&&(ht={controller:fi,view:ei,filter:[{field:lt,value:o}]},ht.fieldFilter=[at,lt],yt={valueIndex:g.length,args:ht,entryKey:vt},v.push(yt),w?yt.resolve=!0:w=ut[o]={v:null},o=null)}else typeof o=="number"&&h.Type.match(/^Date/)?o=k(o):typeof o=="string"&&o&&h.Type!="String"&&(pt={NewValue:o},wt=t.dataView._validateFieldValueFormat(t.fields[nt],pt),wt?rt.push(h.HeaderText+": "+wt):(o=pt.NewValue,typeof o=="number"&&h.Type.match(/^Date/)&&(o=new Date(o))));g.push({field:nt,newValue:o,modified:!0});ui.indexOf(h)!=-1&&ct.push({field:h.Name,value:st[y]})}if(bt=t.context.masterKey,l={index:t.index,type:"submit",command:"Insert",values:g},bt&&bt.forEach(function(n){g.push(n)}),rt.length?(l.error=rt.join("\n"),c(l)):ct.length?(v.length&&(l.requests=v),l.filter=ct,u.test.push(l)):v.length?(l.type="lookup",l.requests=v,u.lookup.push(l)):u.submit.push(l),s()-pi>8)break}t.mode="send"}else if(t.mode=="send"){if(!t.busy){function oi(n){var t=r.import.state;t.busy=!1;t.mode="error";t.error=n.get_message()}if(u.submit.length)t.busy=!0,b=[],$(u.submit).each(function(n){if(n>9)return!1;for(var t=this,u=[],r,i=0;i<t.values.length;i++)r=t.values[i],r&&u.push(r);b.push({command:t.command,controller:ot,view:ri,values:u,_src:t})}),u.submit.splice(0,b.length),t.message=ni.InsertingRecords,r.execute({batch:b,done:function(n){var t=r.import.state;t.busy=!1;t.count+=b.length;b.forEach(function(t,i){var r=n[i];r.errors.length&&(t._src.error=r.errors.join("\n"),c(t._src))})},fail:oi});else if(u.test.length)t.busy=!0,t.message=ni.TestingRecords,tt=[],kt=t.duplicate.accept,$(u.test).each(function(n){if(n>9)return!1;var t=this;tt.push({controller:ot,view:ri,filter:t.filter,requiresRowCount:!1,fieldFilter:["_pk_only"],_trc:t})}),u.test.splice(0,tt.length),r.execute({batch:tt,done:function(n){var t=r.import.state;t.busy=!1;n.forEach(function(n,t){var f=n[ot],i=tt[t]._trc,e,s,h,r,o,l;if(f.length==0)i.requests?(i.requests.forEach(function(n){n.resolve=!1}),u.lookup.push(i)):u.submit.push(i);else if(kt.length)if(f.length==1){if(i.command="Update",e=i.values,h=0,e.forEach(function(n,t){kt.indexOf(n.field)==-1?e[t]=null:h++}),h){r=i.requests;for(s in f[0])e.push({field:s,oldValue:f[0][s],modified:!1});if(r)for(o=0;o<r.length;)l=r[o],l.resolve=!1,e[l.valueIndex]?o++:r.splice(o,1);r&&r.length?u.lookup.push(i):u.submit.push(i)}}else i.error=ni.Duplicates+": "+f.length,c(i)})}});else if(u.nextLookup<u.lookup.length){t.busy=!0;for(var v=[],si=[],wi=u.nextLookup,hi,ft,bi=10;bi-->0;)if(ft=u.nextLookup++,u.lookup[ft].requests.forEach(function(n){n.args._ilc={lookupIndex:ft,valueIndex:n.valueIndex,entryKey:n.entryKey};n.resolve?si.push(n.args):v.push(n.args)}),ft==u.lookup.length-1)break;hi=u.nextLookup-1;t.message=ni.ResolvingReferences;function ci(){var n,i;for(si.forEach(function(n){var r=u.lookup[n._ilc.lookupIndex],i=t.lookupCache[n._ilc.entryKey][n.filter[0].value];i.v!=null&&(r.values[n._ilc.valueIndex].newValue=i.v)}),n=wi;n<=hi;n++)i=u.lookup[n],i.error?c(i):u.submit.push(i)}v.length?r.execute({batch:v,done:function(n){var t=r.import.state,i=t.queues;t.busy=!1;n.forEach(function(n,r){var u=v[r],f=n[u.controller],o=u._ilc.lookupIndex,e=i.lookup[o],s=t.lookupCache[u._ilc.entryKey][u.filter[0].value];f&&f.length?s.v=e.values[u._ilc.valueIndex].newValue=f[0][n.primaryKey[0].Name]:e.error=!0});ci()},fail:oi}):(t.busy=!1,ci())}else u.test.length&&(t.mode="done");t.index<p.length?t.mode="scan":!u.submit.length&&u.nextLookup>=u.lookup.length&&!u.test.length&&!t.busy&&(t.mode="done")}}else t.mode=="error"&&(vi=t.error);dt=s();gt=new Date(s()-t.started);t.status.html(String.format("{0:N1}% {1}<br/>{2}...<br/>{3}: {4}<br/>{5}: {6}",t.count/p.length*100,ni.Complete,t.message||ni.TestingRecords,ni.Expected,gt<6e4?i.Dates.InAMin:yb(new Date(dt+Math.round(gt/(t.count||1)*(p.length-t.count))),new Date(dt)),ni.Remaining,p.length-t.count));t.mode=="done"&&(n.pageInfo()._canceled=!0,ai=t.dataView,li(function(){u.errors.length&&kb("errors_"+e.name+".csv",u.errors.join("\r\n"));setTimeout(function(){r.alert(String.format("{0} <b>{1}<\/b> {2} <b>{3}<\/b>.",ni.Done,e.name,ni.Into,ai.get_view().Label),function(){se(e.context.id)})})}),t=null)}t&&t.mode!="error"&&requestAnimationFrame(d)}if(u=="upload")nt();else{if(u=="supports")return extension=e.name.match(/\.(\w+)$/),extension&&!!extension[1].match(/^(csv|xlsx|xls)/i);if(u=="parse"){n.busy(!0);$(".app-glass-pane").addClass("app-glass-pane-reject");var h=new FileReader,l=e.file;a(l.name)=="csv"?h.readAsText(l):h.readAsArrayBuffer(l);h.onload=function(){try{$.csv?w():$.getScript(__baseUrl+"scripts/touch-import.js",w)}catch(t){n.busy(!1);$app.alert(t.message)}};h.onerror=function(t){n.busy(!1);$app.alert(t.message)}}else u=="map"&&b()}};$(document).on("vclick",".app-bar-actions h3, .app-echo-toolbar h3",function(t){var e=$(this).closest(".app-echo"),h=e.length?e.attr("data-for"):s().id,i=$(t.target).closest("h3"),c=i.offset(),f=[],l=n.contextScope(),a,u;return i.addClass("app-selected"),a=ib(),n.contextScope(h),vk(f,!1,!0),u=$.Event("viewselector.dataview.app"),u.items=f,u.dataView=r.find(h),$(document).trigger(u),n.contextScope(l),rt({anchor:i,items:f,iconPos:"left",dropDown:!o,y:c.top+i.outerHeight(),y2:c.top}),!1}).on("vclick",".app-bar-actions .ui-btn, .app-echo-toolbar .ui-btn",function(t,i){function h(){var t=u.context&&u.context.group,i=[],n;t?(n=s(c).dataView,ko(t.Id,n,i,n.extension().commandRow()),rt({items:i,iconPos:"left",defaultIcon:"carat-r",scope:n._id,anchor:r,y:e.top+r.outerHeight(!0)/4*3,y2:e.top,dropDown:!o})):u.callback(u.context)}var f=$(this).closest(".app-echo"),c=f.length?f.attr("data-for"):s().id,r=$(t.target).closest("a"),e=r.offset(),u=r.data("data-context");if(u)return r.length&&!n.busy()&&(i!=!1?k(r,h):h()),!1});wk={plus:"add",edit:"edit",trash:"delete",duplicate:"content-copy",search:"search",phone:"phone",email:"email",power:"power-settings-new",user:"account-circle",account:"perm-identity",refresh:"refresh",apps:"apps"};$.fn.popupopen=function(n){return c.focus(),this.popup("open",n),this};typeof Web=="undefined"&&(Web={DataView:{}});Web.DataView.MobileBase=function(){Web.DataView.MobileBase.initializeBase(this)};Web.DataView.MobileBase.prototype={initialize:function(){},show:function(){},hide:function(){},systemFilter:function(){return null},reset:function(){},notify:function(){},wait:function(){},dataView:function(n){if(n==null)return this._dataView;this._dataView=n},inserting:function(){return this.dataView().inserting()},editing:function(){return this.dataView().editing()},content:function(){var t=this._dataView;return n.content(t._id)},commandRow:function(n){if(arguments.length==0)return this._commandRow;if(n){var t=this._commandRow=n.slice(0);return this.dataView()._rows=[t.slice(0)],t}return n},command:function(n,t,i,r,u){var e=this,f=e.dataView(),o=0,s=f._keyFields,h;n&&!n.length&&(s.length&&s[0].Name in n?(h=n,n=[],$(f._allFields).each(function(){n.push(h[this.Name])})):(n=null,o=null));e.commandRow(n);f.executeRowCommand(n?o:null,t,i,r,u)},action:function(n,t,i,r,u,f){this.commandRow(n);var e=this.dataView().a;arguments.length==1?(a=arguments[0],this.executeRowCommand(0,a.CommandName,a.CommandArgument,a.CausesValidation,a.Path)):e.executeAction(0,t,i,r,u,f)},itemMap:function(n){return dit(this.dataView(),n)},stateChanged:function(){lt()},lookupInfo:function(n){var t=this.dataView();if(arguments.length)t._lookupInfo=n;else return t._lookupInfo},viewDescription:function(){var t=this.dataView(),i=t._showDescription!=!1,n=i&&t.get_view().HeaderText;return n=i?t._formatViewText(kv.DefaultDescriptions[n],!0,n):"",n?n.replace(/\n/g,"<p/>"):null},executeInContext:function(n,t,i,r){var e=this.lookupInfo(),u=[],f;return i&&this.lookupInfo(null),this.context(u),i&&this.lookupInfo(e),$(u).each(function(){var i=this,u=i.command;if(u&&u==n&&(t==null||i.argument==t))return f=i,r||wi(i),!1}),f},tagged:function(n){return this.dataView().get_isTagged(n)},filterStatus:function(n,t){var u=this,i=u.dataView(),r,f=te(i),e=i?i.get_filter():null,o=f.length>0,s=i&&e.length>0&&!i.filterIsExternal();return(s||o)&&u.options().filterDetails?(r=new Sys.StringBuilder,o&&!t&&i._renderFilterDetails(r,f,!1),s&&i._renderFilterDetails(r,e,!n),r.toString().replace(wd,"").replace(bd,'"').replace(kd,'"$1')):null},aggregates:function(){var n=this._dataView._aggregates;return n&&n.length?n:null},aggregateLabels:function(){var n=[];return $(this._dataView._fields).each(function(){var t=this;n.push(t.Aggregate==0?null:String.format(Web.DataViewResources.Grid.Aggregates[Web.DataViewAggregates[t.Aggregate]].FmtStr,"").trim())}),n},_disposeSession:function(){var r=this.dataView(),t=r._pageSession,n,i;if(t){for(i in t)n=t[i],n&&typeof n=="object"&&(n.length==1&&n[0]&&n[0].tagName=="STYLE"&&n.remove(),delete t[i]);delete r._pageSession}},focus:function(n,i){var u=this,r=f.activePage.find('[data-input-container="'+u._dataView._id+'"]');r.length&&t.focus({container:r,fieldName:n,message:i})}};Web.DataView.Extensions={};Web.DataView.prototype.pageProp=function(n,t){if(n=this._id+"_"+n,arguments.length==1)return ku(n);ku(n,t)};Web.DataView.prototype.viewProp=function(n,t){if(n=(this._viewId||"grid1")+"_"+n,arguments.length==1)return this.pageProp(n);this.pageProp(n,t)};Web.DataView.prototype.session=function(n,t,i){var u=this,r=u._pageSession;if(r||(r=u._pageSession={}),n=(i||this._viewId||"grid1")+"_"+n,arguments.length==1)return r[n];t?r[n]=t:delete r[n]};Web.DataView.prototype.mobileUpdated=function(){var t=this,c=t.pageProp("viewId"),f,e,i;t._startPage||t.get_useCase()||t.get_lastCommandName()||(c&&(t._viewId=c),f=t.viewProp("sortExpression"),e=t.viewProp("groupExpression"),i=t.viewProp("filter"),f&&(t._sortExpression=f),e&&(t._groupExpression=e),i&&i.length&&(t._filter=(t._filter||[]).concat(i)));var l=$(t._element),u=uk(l,document.title),a=r.eval(l.attr("data-page-header")),v=n._dataText,h={id:t.get_id(),text:a||u.text,headerText:v||a||u.text,dataView:t,activator:u};v&&(h.headerTextLocked=!0);n._dataText=null;t._pageSize=ff.match(/iPad;.*CPU.*OS \d_\d/i)||!o?30:30;s(h);t._hidden||t._filterSource||n._appLoaded||$('<a class="app-action-navigate"/>').attr("href","#"+h.id).appendTo($("<li>").appendTo(n.pageMenu())).text(u.text);$(t._element).remove();t._element=null};Web.DataView.prototype.gridSettings=function(n){var t=this,i,r;if(arguments.length){if(n){for(i in n.width);for(r in n.hidden);n.sequence.length||i||r||(n=null)}t.viewProp("gridSettings",n)}else return n=t.viewProp("gridSettings"),n||(n={sequence:[],width:{},hidden:{}}),n};Web.DataView.prototype.gridChanged=function(){var n=this;yo(n);aa(n);ur();wu();ce();hr();ae()};Web.DataView.Extensions.Grid=function(n){return new Web.DataView.MobileGrid(n)};Web.DataView.Extensions.DataSheet=function(n){return new Web.DataView.MobileGrid(n)};Web.DataView.MobileGrid=function(n){Web.DataView.MobileGrid.initializeBase(this);this.dataView(n)};Web.DataView.MobileGrid.prototype={initialize:function(){var n=this,t=n.dataView().pageProp("viewStyle");t||(n.tagged("view-style-map")&&!n.tagged("disable-view-style-map")?t="Map":n.tagged("view-style-cards")&&!n.tagged("disable-view-style-cards")?t="Cards":n.tagged("view-style-list")&&!n.tagged("disable-view-style-list")?t="List":n.tagged("view-style-grid")&&!n.tagged("disable-view-style-grid")?t="Grid":n.tagged("view-style-charts")&&!n.tagged("disable-view-style-charts")?t="Charts":n.tagged("view-style-calendar")&&!n.tagged("disable-view-style-calendar")?t="calendar":(t=p>480?"Grid":"List",$(n._dataView._fields).each(function(){if(this.OnDemand&&this.OnDemandStyle!=1)return t="Cards",!1}),$(n._dataView._fields).each(function(){if(this.Rows>1)return t="List",!1})));n._viewStyle=t},options:function(){var n=this.dataView();return{quickFind:n.get_isGrid()&&n.get_showQuickFind(),filterDetails:!0}},viewStyle:function(t){var i=this,r=i.dataView(),u=i._viewStyle,e,o;if(arguments.length==0)return u;e=f.activePage;o=u;i._viewStyle=t;e&&(r.pageProp("viewStyle",t),i._instructed=!1,n.presenter("supports",t)||(i._reset=!0),t=="Grid"&&ltt(r),r.sync());lt()},tap:function(t,i){var f,e,o;if(t){var r=this.dataView(),h=s(r),u=t.row||t;r._busy()||n.busy()||(r._hasKey()?(this.command(u,"Select"),f=r.headerField(),e=u[f.Index],e&&(n._dataText=f.format(e)),t.pageIndex!=null&&this.currentPageIndex(t.pageIndex),i&&sh(r).each(function(){var n=$(this),t=n.data("data-context");if(t&&r.rowIsSelected(t.row))return n.addClass("app-selected"),!1}),i&&i!="select"||(this.lookupInfo()?this.executeInContext("Select"):(o=[],n.navContext(o),$(o).each(function(){var n=this;if(n.text&&n.icon!="dots"&&!n.system&&!n.isStatic)return wi(n),!1})))):n.infoView(r,!0,u),lt())}},clearSelection:function(n){var r=this,t=r.dataView(),u=t._selectedKey,i;if(u&&u.length){if(t.multiSelect()&&t._selectedKeyList.length){wl(t);return}i=$.Event("clear.dataview.app");t._clearSelectedKey();t._forgetSelectedRow(!0);r._commandRow=null;r.currentPageIndex(null);i=$.Event("clear.dataview.app");i.dataView=t;$(document).trigger(i);n&&(ho(t).find('ul[data-role="listview"] a.app-selected').removeClass("app-selected"),s(t).page.find('.app-wrapper > ul[data-role="listview"] a.app-selected').removeClass("app-selected ui-btn-active"),vu(t));lt()}},quickFind:function(n){var i=this.dataView(),t,u,r;if(arguments.length){if(n&&ht("search.quickFind.history.enabled")){for(t=i.viewProp("quickFindHistory"),u=e("search.quickFind.history.depth")||25,t||(t=[]),r=t.indexOf(n),r>-1&&t.splice(r,1),t.splice(0,0,n);t.length>u&&t.length;)t.splice(t.length-1,1);i.viewProp("quickFindHistory",t)}i.viewProp("quickFind",n);i._executeQuickFind(n);sw(i)}else return i.viewProp("quickFind")||""},useAdvancedSearch:function(n){var i=this.dataView(),t;if(arguments.length)i.viewProp("useAdvancedSearch",n);else return t=i.viewProp("useAdvancedSearch"),t==null&&(t=i.get_searchOnStart()),t==!0},dispose:function(){var u=this,i=u.dataView(),r=i._lookupInfo,f=s(i),t=f?w(f.page):null;t&&(n.presenter("dispose",{id:i._id,container:t}),oe(t),t.prev().find("h3, .app-bar-controls").off(),t.find(".app-map").each(function(){var t=$(this),n=t.data("data-map");n&&(gk(n),n.map=null,t.data("data-map",null))}));r&&(r.field=null,r.callback=null);u._disposeSession()},refresh:function(){function hr(i){if(o.requiresInitCallback)return o.initCallback=function(){t.get_searchOnStart()?ui(function(){setTimeout(function(){fr("show",t._id)})}):i()},o.requiresInitCallback=!1,n.navigate(o.id),!0;i()}function ai(n){n?(sr=c.css("display")!="block",sr&&(c.css({display:"block","z-index":-10}),pi(c))):sr&&(hl(c),c.css({display:"","z-index":""}))}function uu(){if(!du){var n=t.get_selectedKey();t._selectedKeyList=n.length?[n.join(";")]:[];ve(t)}}function ou(n){var i=$('<li data-icon="false" class="dv-item"/>').appendTo(n),u=$('<a class="ui-btn app-divider app-calculated"/>').appendTo(i);return ao(t,vt,null,u,r.aggregateLabels()),i}function ff(){var p,i,k,s;if(ai(!0),n.bar(b?"show":"hide",ni),vt&&(b&&pt?h[0].scrollHeight-v(pt,"margin-bottom")<h.height()?n.bar("hide",it):(pt.prev().addClass("ui-last-child"+(pt.is(".app-has-promo")?" app-has-promo":"")),pt.remove(),n.bar("show",it)):(n.bar(vt?"show":"hide",it),p=!0)),b&&(he(t),gb(t,ni),wu(u)),p||pi(c),d||!r._synced){if(vw(t,c,b),i=t.get_master(),i&&(i.inserting()?vi(o.text,g):(k=i.extension().commandRow(),s=i._fields[0],s=i._allFields[s.AliasIndex],vi([s.format(k[s.Index]),o.text],g))),t._lookupInfo&&o.headerText!=!1&&(vi(o.headerText,g),ri!=0&&(c.attr("data-page-header",!1),vi(!1,g))),w.length){var f=h.offset().top,l=h.height(),y,e=Math.ceil(w.offset().top),nt=w.outerHeight(!0);function ut(n,t){var i=n.find("p");t+=v(n,"height");n.css("height",t);i.css("margin-top",(t-i.outerHeight())/2)}ot=h.scrollTop();rt&&rt>0&&rt+nt<l?(e-f<rt?ut(u.find(".dv-load-at-top"),rt-(ot+e-f)):(y=h[0].scrollHeight,y-(ot+e-f-rt)<l&&ut(u.find(".dv-load-at-bottom"),l-(y-(ot+e-f-rt)))),rr(h,ot+e-f-rt)):rr(h,ot+e-f-(l-nt)/2);d&&t.raiseSelected()}else if(r._synced||!t.get_selectedKey().length||t._lookupInfo)r.clearSelection();else{function ft(){et()!=o.id||tt?setTimeout(ft,50):t.sync()}ft()}r._synced=!0;w&&w.length&&t.multiSelect()&&ar(!0,bl(u),hb(t),w.find(".app-btn-check"))}else w&&w.length&&!d&&!a&&li!=null&&rr(h,h.scrollTop()+w.offset().top-h.offset().top-li);nu(c);c.find(".ui-header-fixed").length&&c.addClass("app-has-fixed-bar");ai(!1);oi(!1)}var r=this,nt=r.pageIndex(),pu=r.pageCount(),t=r.dataView(),gt=t._totalRowCount,o=s(t),bu=t._fields,ku=t._allFields,ht=r.content(),c=o.page,yt=r.visibleDataRows(nt),u=ht.find('ul[data-role="listview"]').show(),kr,ni=c.find(".app-bar-hscrollbar"),it=c.find(".app-bar-aggregates"),pt,vt=r.aggregates(),ii=this.pageSize(),d=r._reset,du=t._keepKeyList,dr=nt>0,gr=nt<pu-1,hi,tr,iu=t.get_showRowNumber()==!0,y=r.viewStyle(),b,h=ht,ot=h.scrollTop(),ci,li,rt,g=h.find(".app-page-header"),ir,or,sr,gu,ru,wt=ht.prevAll(".app-bar-actions"),cr,yr,pr,ut,cu,dt,at,bi,ki,lu,ei,au,si,di,gi,vu;if(r.echoCallback){r.echoCallback();return}if(!yt){d&&rf(u);t.goToPage(nt,!0);return}if(o.echoId&&!o.echoInitialized){vr(o.echoId);o.displayed||(o.initialized=!1);return}if(t._keepKeyList=!1,d&&(o.echoChanged=!0,r.currentPageIndex(nt)),!tt&&o.id!=et()&&o.id!=sy&&!t._lookupInfo){uu();er();t._keepKeyList=!0;return}if(o.initialized=!0,o.displayed=!0,n.makeModalOrPanel(o),cr=t.tagged(/\bpage\-header\-(\w+)\b/),cr&&(cr[1]=="none"?(o.headerText=!1,vi(!1,g)):c.addClass("app-page-header-show")),o.headerText!=!1&&wb(t,c,g),tk(t),r._autoSelect&&(yr=r._autoSelect,r._autoSelect=null,ui(function(){r.tap(yr.row,yr.action)})),o.loading&&(o.loading=!1,c.find(".app-page-loading").remove()),w=u.find("a.app-selected").first(),w.length&&(li=w.offset().top-h.offset().top),d&&(rt=li,uu()),t._requiresContextRefresh&&(t._requiresContextRefresh=!1,lt()),r._checkedViews||(r._checkedViews=!0,!t._lookupInfo&&t.get_showActionBar()?wt=att(t,ht):(ir=[],ka(ir,!1,o)>1&&(or=[],$(ir).each(function(){var n=this;or.push({text:n.text,active:n.icon=="checked",callback:n.callback})}),n.tabs("create",{tabs:or,className:"ui-header-fixed app-tabs-views",id:t._id+"_view-tabs",scope:"page",placeholder:ht}),o.headerText=!1,vi(!1,g),gu=!0))),wt.length&&g.addClass("app-has-action-bar"),n.presenter("supports",{name:y,id:t._id})){function nf(){return t._rows.forEach(function(n){if(t.rowIsSelected(n))return r.commandRow()?r.commandRow(n):(t._forgetSelectedRow(!0),r.command(n,"Select")),!1}),ch(wt,t,o),el(h,r),n.bar("hide",ni),n.bar("hide",it),result=n.presenter("show",{name:y,id:t._id,container:h,reset:d})}hr(nf);r._reset=!1;return}if(y.match(/Grid|Cards|List|Map/)||(y=r._viewStyle=lp()?"Grid":"List",t.pageProp("viewStyle",y)),t.groupBy(),b=y=="Grid",tr=r.itemMap(y=="List"),df(t,tr.thumb!=null),nw(h,r,y=="Map"),y=="Map"){if(n.bar("hide",ni),n.bar("hide",it),ht.find('ul[data-role="listview"]').hide(),hp(c),!r.tagged("supports-view-style-map")){r.viewStyle(p>480?"Grid":"List");lt();return}if(yh(),d){r._reset=!1;r._mapPageWindow=null;pr=!1;$(yt).each(function(){if(t.rowIsSelected(this))return pr=!0,r.tap(this,"none"),!1});pr?t.raiseSelected():r.clearSelection();r.refresh();return}vi(!0);ai(!0);el(h,r);ch(wt,t,o);ut=h.find("> .app-map");ut.length||(ut=$('<div class="app-map"><\/div>').appendTo(h).attr("data-map-for",t._id).hide());n.registerAPI("Map")||(h.find(".app-presenter-instruction").hide(),$('<div class="app-api-error">Google MAP API Key is required. Specify a valid key in <i>Settings | Features | Touch UI<\/i> section of your project properties.<br/><br/><a href="https://developers.google.com/maps/documentation/javascript/get-api-key" rel="external">Get The Key Now!<\/a><\/div>').appendTo(ut.empty().show()));nu(c);ai(!1);function tf(i){function f(){var c=s!=n.asyncJob(),o,l,e,h;if(u.length&&!c)o=u[0],l=new Date,i.geocoder.geocode({address:o.address},function(n,e){var s,h,c,a;if(e==google.maps.GeocoderStatus.OK)s=n[0].geometry.location,h=nd(r,ut,s,o.title,o.row),t.rowIsSelected(o.row)&&ph(i,h),dk(o.address,s.lat(),s.lng()),ga(i),wh(h,750,google.maps.Animation.DROP);else if(e==google.maps.GeocoderStatus.ZERO_RESULTS)dk(o.address);else{if(e==google.maps.GeocoderStatus.OVER_QUERY_LIMIT){setTimeout(f,1e3);return}alert(e+": "+o.address)}u.splice(0,1);c=new Date-l;a=675;c<a?setTimeout(function(){f()},a-c):f()});else{if(!c&&u.length==0&&i.markers.length<eg&&(e=r._mapPageWindow,e||(e=r._mapPageWindow={top:nt,bottom:nt,dir:"up"}),e.dir=="up"?e.bottom<r.pageCount()-1?(e.bottom++,e.dir="down"):e.top--:e.top>0?(e.top--,e.dir="up"):e.bottom++,h=e.dir=="down"?e.bottom:e.top,h>=0&&h<r.pageCount()-1)){r.pageIndex(h);r.refresh();return}c||(oi(!1),r._mapPageWindow=null)}}var o=kk(t),u=[],s=n.nextAsycJob(),e;i.fit=!0;r._mapPageWindow==null&&gk(i);$(yt).each(function(){var n=this.slice(0),f=trt(n,o),s=ku[bu[0].AliasIndex],h=s.text(n[s.Index]);typeof f=="string"?f!="ZERO_RESULTS"&&(u.push({address:f,title:h,row:n}),i.geocoder||(i.geocoder=new google.maps.Geocoder)):(e=nd(r,ut,f,h,n),t.rowIsSelected(n)&&ph(i,e))});ga(i);oi(!0);f()}function eu(){var t=ut.data("data-map");t?(ut.show(),ol(h),tf(t)):n.supports("Map")?(t={map:new google.maps.Map(ut.get(0),{zoom:8}),geocoder:null,markers:[]},ut.data("data-map",t).show(),r.refresh()):setTimeout(eu,100)}hr(eu);r._reset=!1;lr(ht);return}is||(ci=$('<div class="app-scrollable-cover"><\/div>').appendTo(h.parent()).css({position:"absolute",left:h.offset().left,top:h.offset().top,width:hu(h),height:h.outerHeight(),zIndex:2,backgroundColor:nr?"transparent":"#fff"}));u.length||(u=$('<ul data-role="listview" class="app-listview"/>').addClass(oh(t)).appendTo(ht).listview().on("taphold",function(n,i){if(i&&(n=i),vtt())return!1;if(!t._busy()){var s=$(n.target),f=s.closest("a"),h=f.data("data-context"),e=t.multiSelect()&&!1;return f.closest("li").is(".dv-item")&&!f.is(".app-divider")&&(f.is(".app-selected")?(f.removeClass("app-selected"),e||(r.clearSelection(),r.lookupInfo()?k(f,function(){r.executeInContext("Clear")}):k(f,function(){}))):t._hasKey()&&(e||hh(u),f.addClass("app-selected"),r.tap(h,"none"),o.echoChanged=!0,k(f)),hi=!0),!1}}).on("vclick",function(i){function p(n){t._busy()||(r._loadAtTop=!n,r.pageIndex(r.pageIndex(n?"bottom":"top")+(n?1:-1)),r.refresh())}var e=$(i.target),f=e.closest("a").removeClass("ui-btn-active"),c,l,a,y,h,v,s,w;if(!e.is(".app-btn-toggle,[data-href]")){if(l=e.closest(".app-field"),l.length&&(a=l.find("[data-href]"),a.length))return setTimeout(function(){a.trigger("vclick")},10),!1;if(!f.length||f.is(".app-divider")||ww(i)){if(y=e.closest(".app-group"),y.length)return e.is(".app-group")||(w=e.closest(".app-group").find(".app-group-path,.app-group-title").addClass("ui-btn-active"),setTimeout(function(){w.removeClass("ui-btn-active");pa(!0)},ti)),!1}else{if(f.is(".dv-load-at-bottom"))p(!0);else if(f.is(".dv-load-at-top:visible"))setTimeout(function(){p(!1)},50);else{if(hi){hi=!1;return}if(!tu(e)||n.busy())return!1;if(i.ctrlKey)return u.trigger("taphold",i),hi=!1,!1;if(f.is(".dv-action-none")||eb(i,t))return!1;c=t.multiSelect();c&&pl(i)?dl(t,f):(h=f.data("data-context"),v=ob(i),h?(c&&f.find(".app-btn-check").addClass("app-btn-check-selected"),u.find("a.app-selected").removeClass("app-selected ui-btn-active"),v?(e=sb(e),s=function(){pf(t,f);r.tap(h,"none");go(e)}):s=function(){t._hasKey()?(f.addClass("app-selected"),v||(pf(t,f),r.tap(h)),o.echoChanged=!0):r.tap(h)}):f.is(".dv-action-refresh")?s=function(){se(t._id)}:f.is(".dv-action-new")?s=function(){r.executeInContext("New",null,!1)}:f.is(".dv-action-filter-clear")&&(s=function(){fl(t,!0)}),s&&(s(),k(e)))}return!1}}}).contextmenu(function(n){return fd(r.dataView(),n)}),ha(t,u),!it.length&&vt&&(kr=n.bar("create",{type:"footer",page:c}),it=$('<div class="app-bar-aggregates"><\/div>').appendTo(kr)),ni.length||y!="Grid"||he(t));d&&rf(u);d!=!1&&it.length&&vt&&(b?ou(aggregateListView=$('<ul class="ui-listview app-listview app-grid"/>').appendTo(it.empty())):nk(t,it.empty(),vt));dn(u,y);y=="Grid"&&he(t);ch(wt,t,o);ca(t,u);var ft=u.find(".dv-item"),bt=ft.length>ii*2,kt=u.find("li").last(),l,ri,a=r._loadAtTop,w,fi,wr,br=kt&&kt.length&&kt.prev(),uf=br&&br.position().top,su,yi,wi;su=cit(u);(dr&&kt.length==0||bt&&!a&&!u.find("li.dv-load-at-top-parent").length)&&(g.hide(),l=$(String.format('<li data-icon="false" class="dv-load-at-top-parent"><a class="dv-load-at-top"><p>{0}<\/p><\/a><\/li>',st.Loading)),bt?(l.insertBefore(ft.get(0)),dr=!0):l.appendTo(u));a?(l=u.find("li").first(),l.is(".app-list-instruction")&&(l=l.next()),fi=l.length&&l.next(),wr=fi&&fi.position().top+su,yt=yt.slice(0).reverse()):kt.remove();ri=nt*ii;cu=kc(t);$(yt).each(function(n){var i=this,f=$('<li class="dv-item" data-icon="false"/>'),o=a?ri+ii-n:ri+n+1,e=$('<a class="ui-btn"/>').appendTo(f).data("data-context",{row:this.slice(0),pageIndex:nt});t.rowIsSelected(i)&&(e.addClass("app-selected"),r.commandRow()?r.commandRow(i):(t._forgetSelectedRow(!0),r.command(i,"Select")));a?f.insertAfter(l):f.appendTo(u);b?ao(t,i,iu?o:null,e):yu(t,i,tr,iu?o:null,f,e,y=="List");bf(t,i,f,cu)});(gr&&!a||bt&&a&&!u.find(".dv-load-at-bottom-parent").length)&&(kt=si=$(String.format('<li data-icon="false" class="dv-load-at-bottom-parent"><a class="dv-load-at-bottom"><p>{0}<\/p><\/a><\/li>',st.Loading)).appendTo(u));a&&nt==0&&l.remove();(!gt||t.get_searchOnStart())&&(yi=$('<li><a class="dv-action-refresh ui-btn ui-btn-icon-left ui-icon-refresh"><p/><\/a><\/li>').appendTo(u).find("a"),yi.attr("title",fu.Refresh).find("p").text(ct.NoRecords),t._filter&&t._filter.length&&!t.filterIsExternal()&&(wi=$('<li><a class="dv-action-filter-clear  ui-btn ui-btn-icon-left ui-icon-clear"><p/><\/a><\/li>').appendTo(u).find("a"),wi.attr("title",i.ClearFilter).find("p").text(i.ClearFilter)));gr||(vt&&b&&gt>0&&(pt=ou(u)),e("ui.actions.promote")?ru=!0:wt.length||(dt=r.executeInContext("New",null,!1,!0),dt&&(bi=$('<li class="dv-action-new">').appendTo(u).attr("data-icon",dt.icon),at=$('<a class="dv-action-new"/>').appendTo(bi).attr("title",i.LookupNewAction),b?$("<p>").appendTo(at).text(dt.text):($("<h3>").appendTo(at),ki=bi.prev(),ki.is(".dv-item")&&(at.html(ki.find("a").html()).find("p,img,span").css("visibility","hidden"),ki.is(".ui-li-has-thumb")&&bi.addClass("ui-li-has-thumb")),at.find("h3").text(dt.text),gt||$("<p>").appendTo(at.html("")).text(dt.text)))));a&&(c.attr("data-page-header",""),o.headerText!=!1&&vi(ri==0,g));lu=u.find("li").first();ei=r.instruction();(ei||b)&&!u.find(".app-list-instruction").length&&(si=$('<li data-role="list-divider" class="app-list-instruction"/>').insertBefore(l?l:lu),ei&&$('<span class="app-view-instruction"/>').appendTo(si).html(ei),b&&!!gt&&(au=gl(t,si),ei||au.addClass("app-grid-header-no-description")),si.toggleClass("app-no-records",gt<1));a&&l&&l.find(".ui-btn").css("height","").find("p").css("margin-top","");bt&&(a?(ft=ft.slice(ii*(nr?2:2)),ft.find("a").data("data-context",null),ft.remove(),u.find("li.dv-action-new").remove()):(g.hide(),di=$(String.format('<li style="clear:left;height:{0}px"><\/li>',f.getScreenHeight()*10)).appendTo(u),u.find("li.app-li-card").remove(),ft=ft.slice(0,ii),ft.find("a").data("data-context",null),ft.remove().empty()));lit(t,u);ur(u);u.listview("refresh");ru&&u.find("li.dv-item").last().addClass("app-has-promo");w=u.find("a.app-selected");rt==null&&(bt?a?(gi=fi.position().top,rr(h,ot+gi-wr)):(vu=br.position().top,rr(h,ot+vu-uf)):a?(gi=fi.position().top,rr(h,ot+gi-wr)):a==null&&rr(h,0));di&&setTimeout(function(){di.prev().addClass("ui-last-child");di.remove()},100);b&&(yi&&yi.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"),at&&at.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"),wi&&wi.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"));ff();hr(function(){ae(d?10:200)});ci&&(nr&&bt?setTimeout(function(){ci.remove()},300):ci.remove());r._reset=!1;r._loadAtTop=null},reset:function(){var r=this.dataView(),n=s(r),u="#"+n.id,t=f.navigate.history,i;this._reset=!0;$(t.stack).each(function(n){return n>t.activeIndex?!1:this.hash==u?(i=!0,!1):void 0});i||(n.initialized=!1,n.echoInitialized=!1,n.echoId=!1)},visibleDataRows:function(n){var u=this._dataView,i=u._cachedPages,t,r;if(i)for(t=0;t<i.length;t++)if(r=i[t],r.index==n)return r.rows;return null},currentPageIndex:function(n){return arguments.length&&(this._currentPageIndex=n),this._currentPageIndex},pageIndex:function(n){var t=this._dataView,i,r;if(typeof n=="string")return n=="bottom"&&(i=this.content().parent().find("ul li.dv-item").last().find("a").data("data-context"),i)?i.pageIndex:n=="top"&&(r=this.content().parent().find("ul li.dv-item").first().find("a").data("data-context"),r)?r.pageIndex:t.get_pageIndex();if(n==null)return t.get_pageIndex();t.set_pageIndex(n)},pageCount:function(){var n=this._dataView;return n.get_pageCount()},pageSize:function(){var n=this._dataView;return n.get_pageSize()},instruction:function(n){var e=this,o=e.lookupInfo(),r,u=e.dataView(),c=e.viewDescription()||"",t=c?[c]:[],h=e.filterStatus(),s=u.groupExpression(),f;return o&&(t.length&&t.push(" "),r=o.field,t.push(String.format(r.ItemsDescription||i.LookupInstruction,r._autoAlias?r.AltHeaderText||r.HeaderText:r._dataView._allFields[r.AliasIndex].HeaderText)),o.value&&(f=o.text,f&&f.length>50&&(f=f.substring(0,50)+"..."),t.push(String.format(i.LookupOriginalSelection,f)))),u.multiSelect()&&t.push('<span class="app-multi-select-instruction">'+cb(u)+"<\/span>"),n!=!1&&(t.length||h||s)&&u._totalRowCount>1&&(t.length&&(t.push(" "),t.push(String.format(i.ShowingItemsInfo,u._totalRowCount))),$(s).each(function(n){var r=u.findField(this);r&&(n==0&&(t.length&&t.push(" "),t.push(i.GroupedBy," ")),n&&(n==s.length-1?t.push(" ",ct.Filters.Labels.And," "):t.push(", ")),t.push(r.HeaderText),n==s.length-1&&t.push("."))})),h&&(t.length&&t.push(" "),t.push(String.format('<span class="app-filter" title="{1}">{0}<\/span>',h,i.Filter))),t.join("")},context:function(n,r){var h=this,u=h.dataView(),y=u.extension(),c=u._totalRowCount,p=u.get_view().Label,w=u.get_sortExpression(),f=h.commandRow()||[],e=this.lookupInfo(),o,l=f&&f.length,v;if(c!=-1)if(u.get_showViewSelector()&&n.push({text:p,count:String.format("{0:N0}",c),icon:"gear",system:!0,toolbar:!1,transition:!0,callback:yk}),(u.get_showQuickFind()&&(c>1||u.get_filter().length>u.get_externalFilter().length)||te(u).length)&&n.push({text:hi.PerformAdvancedSearch,desc:ow(u),icon:"search",toolbar:!1,system:!0,context:{dataViewId:u._id},callback:pp}),n.push({text:i.Sort,icon:"sort",transition:!0,desc:ek(u),toolbar:!1,system:!0,callback:hit}),n.push({text:i.Filter,icon:"filter",transition:!0,desc:y.filterStatus(!0),toolbar:!1,system:!0,callback:gu}),n.push({text:i.Group,icon:"group",transition:!0,desc:ok(u),toolbar:!1,system:!0,callback:pa}),e&&e.value==null||n.push({}),pk(u,n,f),e||da(u,n,f),e){o=e.field;function a(n,i,r){var u=t.methods.lookup._rowToValues(n,i,r);u&&li(function(){e.change(u)})}l&&n.push({text:i.LookupSelectAction,icon:"material-icon-arrow-forward",command:"Select",callback:function(){a(o,s().dataView,f)}});e.value&&n.push({text:i.UnSelect,icon:"material-icon-clear",command:"Clear",callback:function(){a(o,s().dataView,null)}});String.isNullOrEmpty(o.ItemsNewDataView)||n.push({text:i.LookupNewAction,icon:"material-icon-add",command:"New",system:!0,callback:function(){h.executeInContext("New",o.ItemsNewDataView,!0)}});n.push({});l&&!o.tagged("lookup-details-hidden")&&n.push({text:i.LookupViewAction,icon:"material-icon-info-outline",callback:function(){Web.DataView._defaultUseCase="ObjectRef";h.executeInContext("Select","editForm1",!0)}});da(u,n,f)}else r||(r=["Grid","ActionColumn","ActionBar"]),r.length==1&&r[0]=="Grid"&&$(u._views).each(function(){var n=this;if(n.Type=="Form"&&n.Id.match(/edit/))return v=n.Id,!1}),ko(r,u,n,f,v)}};Web.DataView.Extensions.Form=function(n){return new Web.DataView.MobileForm(n)};Web.DataView.MobileForm=function(n){Web.DataView.MobileForm.initializeBase(this);this.dataView(n)};Web.DataView.MobileForm.prototype={initialize:function(){this._editors={};this._initRow()},_initRow:function(){var n=this.dataView(),t=this.inserting()?n._newRow:n._rows[0];return n._mergeRowUpdates(t),this.commandRow(t)},reset:function(){this._reset=!0;this._initRow()},options:function(){return{quickFind:!1,filterDetails:!1}},dispose:function(){this._dispose();this._disposeSession()},_disposeLayout:function(n){function t(n){for(var i,r=0;r<n.length;r++)i=n[r],t(i.children),i.children=null,i.self.removeData(),i.self=null}n=$(n);n.find(".app-data-list").remove();n.find(".app-drop-box").each(function(){r.upload("destroy",{container:this})});t(n.data("rootNodes"))},_dispose:function(t){var f=this,e=f._dataView,i=this.content(),o,u;f._newValues=null;i.find('[data-layout="form"]').each(function(){f._disposeLayout(this)});i.find(".app-data-list").remove();$(e._allFields).each(function(){var i=this,t;i._dataViewId&&(t=r.find(i._dataViewId),t._filterSource==e._id&&n.deletePage(t._id))});i.find(".app-status-bar, .app-bar-buttons,.app-stub,.app-form-grid").remove();o=i.parent().find('div[data-role="header"]');oe(i);u=i.find(".app-echo").each(function(){var t=$(this).attr("data-for"),n=s(t);n&&(n.echoId=null,n.echoInitialized=!1)});u.find(".app-echo-toolbar").find(".ui-icon-dots, h3, .app-echo-controls, .app-echo-see-all").off();u.find(".app-echo-inner").off();u.find(".app-echo-footer").off();u.remove();n.tabs("destroy",{container:i});t&&lt();f._disposeSession()},viewStyle:function(){return"Form"},refresh:function(){function at(){y&&bp(y);wp(u);n.bar("show",k);n.refreshTitleState();n.refreshAppButtons(b,{buttonBars:f!="None"?k:[],layout:l,toolbar:!1,dataView:i});o||ui(function(){t.focus({container:u})})}var e=this,i=e.dataView(),vt=e.editing(),r=s(i),pt=i._fields,wt=i._allFields,l,bt=i._categories,u=e.content(),a,v=[],b,y,g,k,ot=this.inserting(),yt=this._reset,f=i.get_showActionButtons(),st=i._confirmContext,h=r.page,nt=h.find(".app-page-header"),ht,p,c,it,rt,ut,ct,ft,d,et;if(yt&&(e._dispose(),e._commandRow=null),a=vt?i.editRow():e.commandRow()||e._initRow()||[],n.makeModalOrPanel(r),ott(i,h,a),p=e.viewDescription(),p&&$('<div class="app-view-description"><\/div>').appendTo(nt).html(p),c=st&&st.WindowTitle||i.get_view().Label,c&&(r.headerTextLocked?typeof r.headerText=="string"&&(r.headerText=typeof c=="string"&&!i.inserting()?[r.headerText,c]:c):(i.inserting()&&i._filterSource&&(it=w(i._filterSource).find(".app-page-header h1").text()),r.headerText=it?[c,it]:c)),ot&&nt.attr("data-locked","false").data("data-text",null),rt=i.tagged(/page\-header\-(\w+)/),rt&&rt[1]=="none"&&(r.headerText=!1),!r.headerText==!1&&wb(i,h,nt),h.is(".app-page-modal")||r.headerText==!1||$('<div class="app-page-header-placeholder dv-heading" data-selector=".app-page-title"><span class="app-static-text app-page-title"><span class="app-text"/><\/span><\/div>').appendTo(u),l=tn(i,hu(u)),g=i.statusBar(),g&&(y=$('<div class="app-status-bar"><\/div>').html(g).appendTo(u),ut=y.find("li.Segment"),ct=ut.length+10,ut.each(function(n){this.style.zIndex=ct-n}),o&&y.css("overflow-x","auto")),p&&r.headerText==!1&&(ft=$('<ul data-role="listview" class="app-list-instruction"/>').appendTo(u),$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(ft).html(p),ft.listview()),i.tagged("action-buttons-none")&&(f="None"),(f=="TopAndBottom"||f=="Top")&&$('<div class="app-bar-buttons"><\/div>').appendTo(u),l.appendTo(u),(r.isModal||r.isPanel)&&f!="None"?f="Auto":f!="Auto"||yy()||(f="None"),f=="Auto"?k=$('<div class="app-bar-buttons"><\/div>').appendTo(n.bar("create",{type:r.isPanel?"header":"footer",page:h})):((f=="TopAndBottom"||f=="Bottom")&&$('<div class="app-bar-buttons"><\/div>').appendTo(u),k=u.find(".app-bar-buttons")),b=[],e.context(b),!ot){v=[];function lt(){n.tabs("create",{tabs:v,className:"app-tabs-echo",scope:i.get_selectedKey(),change:function(){}})}$(n._pages).each(function(){var r=this,t,n,e,f=r.dataView,o=f&&f._filterSource;o&&o==i._parentDataViewId&&!f._dataViewFieldName&&(n=r.activator,n&&n.type=="Tab"&&($(v).each(function(){if(n.text==this.text)return t=this,!1}),t||(d!=n.container&&(d&&(lt(),v=[]),d=n.container),t={text:n.text,content:[]},v.push(t))),e=ua(r.id,u),t&&t.content.push(e))});d&&lt()}ht=$('<div class="app-stub"><\/div>').appendTo(u);i.tagged("promo-none")&&ht.addClass("app-hidden");e.stateChanged();e._reset=!1;r.requiresInitCallback?(et=h.css("display")!="block",et&&h.css({display:"block","z-index":-10}),i._unchangedRow=a.slice(0),f!="None"&&f!="Auto"&&n.refreshAppButtons(b,{buttonBars:u.find(".app-bar-buttons"),toolbar:!1,dataView:i}),rn(i,a,l),bf(i,a,l),i._isWizard&&dr("start",{layout:l}),hr(u),nu(h),et&&h.css({display:"","z-index":""}),r.requiresInitCallback=!1,tt=!1,r.initCallback=at,n.navigate(r.id)):at()},collect:function(){var t=this,i=[],n=t.dataView(),f=n._allFields,r,e=t.inserting(),u;return u=n.editRow(),r=n._originalRow,$(f).each(function(n){var t=this,f=u[n],o=r[n];t.Type.match(/^Date/)&&(f=f!=null?new Date(f):null);t.Type!="DataView"&&i.push({Name:t.Name,NewValue:f,OldValue:o,Modified:f!=o||f==null&&!t.AllowNulls&&!t.IsPrimaryKey,ReadOnly:!!(t.ReadOnly&&!(t.IsPrimaryKey&&e))})}),i},stateChanged:function(){var i=this,r=i.dataView(),f=i.content(),n=f.find("[data-layout]"),u;n.data("prepared")?(u=r.editRow(),t.evaluate({dataView:r,row:u,container:n}),t.render({container:n,dataView:r,row:u}),lt(!1,0),ki(),i.editing()&&!o&&t.focus({container:n})):lt()},context:function(n){var t=this,i=t.dataView(),r=t.commandRow(),u=t.editing();n.isSideBar||pk(i,n,r);u||da(i,n,r);ko(["Form","ActionBar"],i,n,r)},afterCalculate:function(){return}};r.alert=function(n,t){cd({name:"_alert",message:n,submit:t,cancel:!1})};r.confirm=function(n,t,i){cd({name:"_confirm",message:n,submit:t,cancel:i})};$(document).on("alertconfirmed.app alertnotconfirmed.app",function(t){var i=t.rules.dataView(),r=i.survey(),u=t.type=="alertconfirmed"?r._submit:r._cancel;n.pageInfo(i)._canceled=!0;vo(!1);ui(function(){vo(!0);u&&u()})});r.showMessage=function(n){n&&r.alert(n)};ii=Web.Menu={};ii.Nodes={};l.$nextTabIndex=l.$closeHovers=bt;typeof Web.Membership!="undefined"&&(Web.Membership.prototype.initialize=function(){var n=this,t;if(cy=n.get_authenticationEnabled(),ly=n.get_displayMyAccount(),ys=n.loggedIn(),vg=n.get_user(),t=n.get_cultures(),!String.isNullOrEmpty(t)&&!(__tf!=4)){var i={value:"Detect,Detect",text:br.AutoDetectLanguageOption,selected:!1},u=[i];$(t.split(/;/)).each(function(){if(this.length){var n=this.split("|"),t={value:n[0],text:n[1],selected:n[2]=="True"};u.push(t);t.selected&&(i=t)}});r.cultureList=u}},Web.Membership.prototype.dispose=function(){},Web.Membership.prototype.updated=function(){if(di=this,cl(),this.get_idleTimeout())$(document).on("awake.app",function(){return!di.idle()});this.idleInterval(!0);n&&this.mobileUpdated()},Web.Membership.prototype._idle=function(){var n=this;n.idleInterval(!1);iv()},Web.Membership.prototype.loginStatus=function(n){var t=this,i=t.loggedIn(),r=$(n).text(i?br.LogoutLink:br.LoginLink).on("vclick",function(){return k(r,function(){i?iv():t.showLogin()}),!1})},Web.Membership.prototype.mobileUpdated=function(){var n=this;$(document).one("start.app",function(){n._allowLoginInMenu=n.get_displayLogin()});if(this.loginStatus('a[data-app-role="loginstatus"]'),!r.AccountManager.enabled())$(document).one("start.app",function(){l.location.href.match(/\?ReturnUrl=(.+?)(#.+)?$/)&&lu(null)})},Web.Membership.prototype.showLogin=function(){lu(null,!0)});Web.Mobile=function(){var n=this,t;n._asyncJob=0;n._pageMap={};n._pages=[];t=$("#app-bar-toolbar");sr&&t.css("visibility","hidden");n._toolbar=t;n._logo=t.find(".app-logo");n._actionButton=$(".app-btn-promo");n._toolbarButtons=t.find(".app-btn");n._title=t.find("h1").addClass("app-hidden");n._menuButton=$("#app-btn-menu");n._backText=t.find(".app-back-text").hide().attr("title",i.Back);n._contextButton=$("#app-btn-context");n._modalDataViews=[];n._modalStack=[];n._pagesToDelete=[]};Web.Mobile.prototype={settings:function(n,t){if(arguments.length==1)return e(n);e(n,t)},appName:function(){var t=this;return t._appName||(t._appName=n._logo.text()||$("#PageHeaderBar").text()||$('head meta[name="application-name"]').attr("content")),t._appName},height:function(){var n=nt;return navigator.userAgent.match(/Mobile.+Safari/)&&!navigator.userAgent.match(/Chrome/)&&(n+=60),n},page:function(n){var t,i,r;return n||(n="Main"),t=$("#"+n),t.length||(t=$(String.format('<div data-role="page" id="{0}"><div data-role="content"><\/div><\/div>',n)).appendTo(c).page(),i=s(t),r=$('<div id="app-bar-heading" class="app-bar-heading"><div class="app-bar-text"><\/div><\/div>').hide().appendTo(t),i&&(i.page=t,i.stickyHeader=r,i.scrollable=fh(t).data("sticky-header",r),i.home&&i.dataView&&i.dataView.get_isForm()&&!i.dataView._selectedKey.length&&r.remove()),pi(t)),t},makeModalOrPanel:function(t){var u=t.page,r=t.dataView,rt=t.home,e=!1,b,o,h,a,v,f,d,g,y,nt;if(r&&(r.tagged("content-stub-none")&&u.addClass("app-content-stub-hidden"),b=r&&r.tagged(/\bmodal\-dock\-(top|left|right|bottom)\b/),b&&(r.tagged("modal-fit-content")||!$(".app-page-modal-background").filter(io).length)&&u.addClass("app-page-modal-dock app-page-modal-dock-"+b[1])),!rt&&($(".app-page-modal-root").length?e=!0:(o=r&&r.tagged(/\bmodal\-(never|always|(when\-(tn|xxs|xs|sm|md|lg|xl|xxl)))\b/),o?(u.addClass("app-page-"+o[0]),e=o[1]=="always"||!(o[1]=="never"||p<pt(o[3]))):e=vy()),h=r&&r.tagged(/\bsplit(\-(single|multiple))?\-(right|bottom|top|left)(\d+)?\b/),h&&(a=r.get_parentDataView(),a))){v=a._panels;v||(v=a._panels=[]);var l=h[3],tt=h[2]||"single",k=h[4]?parseInt(h[4]):l=="top"?33:66,f,it=s(a).page;$(v).each(function(){var n=this;if(n.location==l)return f=n,!1});l=="right"&&pt("md")<p&&(e=!1,f?(f.size<k&&(f.size=k),f.accepts=="single"&&(n.deletePage(s(f.pages[0].attr("id"))),f.pages=[])):f={pages:[],location:l,size:k,accepts:tt},f.pages.push(u),v.push(f),r._panelContainer=it,u.appendTo(c),$(f.pages).removeClass("app-page-panel-active"),u.addClass("app-page-panel app-page-panel-active app-page-panel-"+l+" app-page-panel-"+tt),w(u).css("top",cu()-1),t.isPanel=!0,d=n._modalDataViews,g=d.indexOf(t.id),g!=-1&&d.splice(g,1),it.addClass("app-has-panel app-has-panel-"+l))}e&&!u.is(".app-page-modal")?(u.find(".app-page-header-fixed").remove(),u.addClass("app-page-modal"),r&&r.tagged("modal-title-none")||(y=$('<div class="app-page-modal-title"><span class="app-text"/><\/div>').insertBefore(w(u)),$('<a class="app-btn app-btn1 app-btn-search"/>').appendTo(y).hide().attr("title",hi.PerformAdvancedSearch),r&&r.tagged("modal-buttons-more-none")||$('<span class="app-btn-context app-btn app-btn2 ui-icon-dots"/>').appendTo(y).attr("title",i.More),r&&r.tagged("modal-buttons-fullscreen-none")||$('<span class="app-btn app-btn3 app-btn-fullscreen"/>').appendTo(y).attr("title",i.Fullscreen),$('<span class="app-btn app-btn4 app-btn-close"/>').appendTo(y).attr("title",gv.Close)),nt=r&&r.tagged(/\bmodal\-max\-(tn|xxs|xs|sm|md|lg|xl|xxl|any)\b/),nt&&u.addClass("app-page-"+nt[0])):!e&&u.is(".app-page-modal")&&(u.removeClass("app-page-modal").css({left:"",top:"",width:"",minWidth:"",maxWidth:"",paddingTop:""}),u.find(".app-page-modal-title").remove(),t.scrollable.css({left:"",top:"",width:"",minWidth:"",maxWidth:""}));!!t.isModal!=e&&(t.isModal=e,pi(u))},activeLink:function(n,t){if($(f.activeClickedLink).is(".app-tab-active")||f.removeActiveLinkClass(!0),n){var i=$(n).closest("a");i.length&&(n=i);n.is(".app-btn-static")||(n.addClass("ui-btn-active"),(t==null||t)&&(f.activeClickedLink=n))}},blink:function(n,t){kt(n);setTimeout(function(){kt();setTimeout(function(){kt(n);setTimeout(function(){kt();t&&t()},200)},200)},200)},content:function(t){var i=s(t),r=i&&i.page?i.page:n.page(t),u=w(r);return u.length?u:r.find('[data-role="content"]')},showContextPanel:function(n,t,i){it(n,"#"+t,i)},toggleContextPanel:function(n){this.contextScope()&&(n+="-scope");$(n).panel("toggle")},causesCalculate:function(){},pageVar:function(n,t){if(arguments.length==1)return ku(n);ku(n,t)},userVar:function(n,t){if(arguments.length==1)return ot(n);ot(n,t)},callWithFeedback:function(n,t){n=$(n);n&&n.length&&k(n,t)},pageHeader:function(n){var t=s(n.id),i=[n.text];n.text2&&(i[1]=n.text2);t&&(t.headerText=i,t.id==et()&&vi(i))},dataView:function(){var n=this.pageInfo();return n?n.dataView:null},prevPageInfo:function(){var n=f.navigate.history.stack,t,i;return n.length>1&&(t=n[n.length-2].pageUrl,t&&(i=s(t))),i},pageInfo:function(n){if(n?n._id&&n._controller?n=n._id:n.selector!=null&&n.length!=null&&(n=n.attr("id")||""):n=et(),typeof n=="string")return this._pageMap[n];if(n)this._pageMap[n.id]=n,n.dataView&&n.dataView._id&&(this._pageMap[n.dataView._id]=n),this._pages.push(n);else return null},scrollable:function(){var n=w();return arguments[0]=="refresh"&&so(n,!1),n},unloading:function(){fe()},refresh:function(n,t,i){lt(n,t,i)},refreshEchoToolbarWithDelay:function(n,t){vu(n,t)},listPopup:function(n){rt(n)},cardPopup:function(n){nv(n)},busyIndicator:function(n){oi(n)},viewStyle:function(n,t,i){ie(n,t,i)},bar:function(t,i){function h(){f=r.prev();f.is(".app-bar-actions")&&f.is(":visible")?r.css("top",f.offset().top+f.outerHeight()):r.css("top","")}function c(){var t=!0;r.children().each(function(){var n=$(this);n.css("display")!="none"&&(t=!1)});t?(r.hide(),r.is(".app-bar-footer")&&n.promo().css("margin-bottom",""),l()):r.show()}function l(){pi(r.closest(".ui-page"))}var r,f,u;if(t=="create"){var o=i.type,a=i.page,e=w(a),s;return r=e.find(".app-bar-"+o),r.length||(o=="header"?(r=$('<div class="app-bar-header ui-header ui-bar-inherit ui-header-fixed"><\/div>').hide().insertBefore(e),h()):o=="footer"&&(s=e.next(),r=$('<div class="app-bar-footer ui-footer ui-bar-inherit ui-footer-fixed"><\/div>').hide().insertAfter(s.is(".app-vscrollbar")?s:e))),r}(u=i,u&&u.length)&&(r=u.parent(),t=="show"?(r.is(".app-bar-header")&&h(),r.show(),u.show(),l(),n.tabs("fit")):t=="hide"?(u.hide(),c()):t=="remove"&&(u.remove(),c()))},promo:function(n,t){function o(){if(!i.is(".ui-disabled")&&(e("ui.actions.promote")||re())){r=$(".ui-page-active").is(".app-page-modal");i.css({"margin-bottom":r?0:""});var n=i.is(":visible"),t,o=i.attr("data-icon");if(!n){if(t=s(),t&&o&&(t._promo||(t._promo={}),t._promo[o]?n=!0:t._promo[o]=!0),!n)i.one("transitionend",function(){wt=!1});i.css({"margin-bottom":r?0:"",transform:n?"none":"scale(.5)"}).css({transition:n?"none":"transform 200ms"}).show()}u=f.activePage.find(".app-bar-footer");u.length&&u.height()&&i.css("margin-bottom",r?0:v(i,"margin-bottom")+u.outerHeight());n||setTimeout(function(){wt=!0;i.css("transform","none")},50)}else i.hide()}var i=this._actionButton,r,u;return arguments.length==0?i:typeof n=="boolean"?(n?o():i.hide(),i):typeof n=="string"?(i.find(".app-icon").remove(),n=bo(n),ft(n,i.attr({title:t,"data-icon":n})),n.match(gh)?(i.hide().addClass("ui-disabled"),!1):(i.removeClass("ui-disabled"),o(),!0)):void 0},toolbar:function(n){var t=this._toolbar;return typeof n=="boolean"?n?t.show():t.hide():typeof n=="string",t},stickyHeaderBar:function(n){var t=w(n);return t.data("sticky-header")||$()},enumerateFields:function(n,t,i,r){var u=n._allFields,f=i==null;r||(r=n.extension().commandRow());f?(i=[],$(u).each(function(){this.ShowInSummary&&!this.Hidden&&i.push(this)})):t.push({text:n.get_view().Label,theme:"a",isStatic:!1,instruction:!0});$(i).each(function(){var i=u[this.AliasIndex],f=r[i.Index],e=i.text(f);i.OnDemand?i.OnDemandStyle!=1&&f&&!f.match(/^null/)&&t.push({src:String.format("{0}blob.ashx?{1}=t|{2}{3}",n.resolveClientUrl(n.get_appRootPath()),i.OnDemandHandler,f,i.OnDemandStyle==2?"&_nocrop":""),desc:i.HeaderText,display:"before"}):oa(i)&&f?t.push({text:e,desc:i.HeaderText,href:"tel:"+e,icon:"phone"}):sa(i)&&f?t.push({text:e,desc:i.HeaderText,href:"mailto:"+e,icon:"mail"}):t.push({text:e,desc:i.HeaderText,isStatic:!0,display:"before"})});i.length&&t.push({})},infoView:function(n,t,u,f){var o=[],c=t?"left":f||"",h,s,e,l;for(t||o.push({text:i.Back,callback:iu,icon:ut});n;)l=o.length,h=n.extension().itemMap(),s=n._allFields,e=[s[h.heading]],t||$(h.desc).each(function(){e.push(s[this])}),$(n._fields).each(function(){this.Hidden||e.indexOf(s[this.AliasIndex])!=-1||e.push(this)}),this.enumerateFields(n,o,e,u),n=r.find(n._filterSource);it(o,"#app-panel-info-view"+(c?"-standalone":""),{position:c,className:"app-panel-info-view"})},deletePage:function(t){var r,u,i,f;typeof t=="string"&&(t=s(t));r=t.page;u=t.dataView;u&&u.dispose();r&&(w(r).removeData().off(),r.page("destroy").remove().empty());i=n._modalDataViews.indexOf(t.id);i!=-1&&n._modalDataViews.splice(i,1);i=n._pages.indexOf(t);i!=-1&&n._pages.splice(i,1);f=ri.stack;$(f).each(function(n){var i=this;if(i.hash=="#"+t.id)return f.splice(n,1),n<ri.activeIndex&&ri.activeIndex--,!1});t.dataView=null;t.page=null;t.scrollable=null;delete n._pageMap[t.id]},garbageCollector:function(t){var i=n._pagesToDelete;arguments.length?i.push(t):i.length&&setTimeout(function(){$(i).each(function(){n.deletePage(this)});i.splice(0,i.length)},32)},modalDataView:function(n,t){var i=this,u,r,f;t!=!1&&i.busy()||(n&&i.busy(!0),t&&setTimeout(function(){n!=et()&&i.modalDataView(n,!1)}),u=[],n?(r=i.pageInfo(n),f=i.page(n),ls&&(r.text=ls,ls=null),r.dataView._lookupInfo||(r.dataView._isModal=!0),i._modalDataViews.indexOf(n)==-1&&i._modalDataViews.push(n),i.changePage(n)):($(i._modalStack).each(function(){i.deletePage(this)}),i._modalStack=[]))},unloadPage:function(n,t){function s(){i._modalStack.indexOf(u)==-1&&i._modalStack.push(u)}var i=this,u=i.pageInfo(n),e;if(u&&(e=i._modalDataViews.indexOf(u.id),e>=0)){var h=u.dataView,c=r.find(h._parentDataViewId),f=i.pageInfo(t),o=f?i._modalDataViews.indexOf(f.id):-1;(f&&(c==f.dataView||f.home)||t.attr("id")=="Main"||o>=0&&e>o)&&s()}},sidebar:function(){return eh()},desktop:function(){return!o},rowContext:function(n,t){go(n,t)},animate:function(){return rh()},clearHtmlSelection:function(n){gr(n)},lastTouch:function(){return ir},syncEmbeddedViews:function(n){hr(n)},animatedScroll:function(n,t,i){le(n,t,i)},scroll:function(n,t){rr(n,t)},configureFilter:function(t){n.contextScope(t.scope);gu(t);n.contextScope(null)},pointer:function(){return o?"touch":"mouse"},busy:function(n){var i=this,r=i._busy==!0,t;if(arguments.length==1)i._busy=n,t=i._glassPane,t||(t=i._glassPane=$('<div class="app-glass-pane"><\/div>').on("touchstart pointerdown mousedown",function(n){au(n);t.addClass("app-glass-pane-reject");n.preventDefault();n.stopPropagation()})),n?t.is(".app-glass-pane-active")||t.addClass("app-glass-pane-active").appendTo(c):t.parent().length&&t.detach().removeClass("app-glass-pane-reject app-glass-pane-active");else return i._busy==!0},executeInContext:function(t,i,r){if(!n.busy()){var u=[];n.navContext(u);$(u).each(function(){var n=this;if(!r&&(t&&n.icon==t||!t&&n.text==i)||r&&r==n.path)return wi(n),!1})}},navigate:function(t){typeof t=="string"?(t.match(/^#/)&&(t=t.substring(1)),n.changePage(t)):t.id&&$("#"+t.id).length?($("#"+t.id).trigger("navigating.app"),n.changePage(t.id)):t.href&&od(t.href,t.transition)},changePage:function(t,i){et()!=t&&n.busy(!0);var a=f.activePage,b,s=a&&this.pageInfo(a.attr("id")),r=this.pageInfo(t),p=$.Event("navigating.app");if(r){if(r.isPanel){h.left.mini||e("ui.sidebar.mini")==!1||sd(!0);bc({toPage:r.page,toPageInfo:r,prevPage:a});return}r.navigating?r.navigating=!1:r.page&&(r.page.trigger(p),p.isDefaultPrevented()&&(r.initialized=!1,r.navigating=!0))}if(tb(!0),this.pageInit(t)){b=this.page(t).css("padding-top",a.css("padding-top"));var k=g.pageTransition,u=this.pageInfo(t),w=u.home,o,c,v,y=u.navigateInfo;if(y){u.navigateInfo=null;f.navigate(y.href,{transition:y.transition});o=ri.stack;o[o.length-1].hash="#"+u.id;return}c=u.replaceUrl;s&&s.deleted&&(l.location.replace("#"+t),ui(function(){var t=n.dataView();t._doneCallback=s.dataView._doneCallback;t._cancelCallback=s.dataView._cancelCallback;n.deletePage(s);wc(f.activePage)}));f.changePage("#"+t,{changeHash:!(i==!1)&&!w,transition:"none"});o=ri.stack;v=o[o.length-1];c&&(u.replaceUrl=null,$("#"+t).attr("data-url",decodeURIComponent(c)),v.hash!="#advanced-search"&&f.navigate.navigator.squash(c),v.url=decodeURIComponent(f.path.makeUrlAbsolute(c,f.path.documentBase)));w&&(v.transition=k,f.path.documentBase.hrefNoHash=f.path.documentBase.hrefNoSearch,f.path.documentBase.href=f.path.documentBase.hrefNoSearch+f.path.documentBase.hash)}},title:function(){return document.title},navContext:function(n,t){var e=this,f=e.contextPageInfo(),p=f,u=f&&f.dataView,c=u,o=c&&c.extension(),y=u&&u.get_useCase(),h=u&&u.extension(),a=!0,v=-1;h&&(t||h&&h.context(n),f.dataView._parentDataViewId&&(f=e.pageInfo(f.dataView._parentDataViewId),u=f.dataView,v--));!o||o.inserting()||o.lookupInfo()||$(e._pages).each(function(){var h=this,f=h.dataView,l=f&&f.extension(),c,o=!1;f&&(c=!f._hidden&&!f._parentDataViewId,c&&(u&&u._filterSource?(c=r.find(u._filterSource)==f,o=c,c||(c=r.find(f._filterSource)==u)):c=f._filterSource?r.find(f._filterSource)==u:!1));!c||y||h.external||(a&&(t||n.push({}),a=!1),o||e.contextScope()&&o||f._autoHide==0&&!u.extension().commandRow()||n.push({text:o?i.Back:h.text,icon:o?"back":null,count:o?null:l&&(!l._reset||s(f).echoInitialized)?f._totalRowCount:null,callback:o?function(){vs.go(v)}:function(){e.changePage(h.id)},system:!0,navigateTo:o?"master":"detail",pageTransition:!o,sidebarCollapse:o?null:"detail",context:h&&h.id,activator:h&&h.activator}))});n.isSideBar||n.isTaskAssistant||(n.length&&n.push({}),g.siteContent&&!1&&(yi||(yi={text:"Edit",system:!0,callback:iw},yi.isStatic=!0,yi.icon="glyphicon-edit",yi.desc="Page",uc={text:"Properties",system:!0,callback:cn},uc.icon="glyphicon-wrench"),yi.disabled||(n.push(yi),n.push(uc),n.push({}))),ht("help.enabled")&&!l.location.pathname.match(/\/help(\/|$)/)&&di&&(rc||(rc={text:br.HelpLink,system:!0,toolbar:!1,icon:"material-icon-info",callback:function(){di.help()}}),n.push(rc)));tr.list.length&&(tr.list.splice(0),tr.keyCodes.splice(0));$(n).each(function(){var t=this.shortcut,n,i,f,u;if(t){if(n=tr.cache[t],!n){for(n={shortcut:t,ctrlKey:!1,altKey:!1,shiftKey:!1},f=t.split(/\s*\+\s*/g),u=0;u<f.length;u++)if(i=f[u].toLowerCase(),i.length>1)switch(i){case"ctrl":n.ctrlKey=!0;break;case"alt":n.altKey=!0;break;case"shift":n.shiftKey=!0;break;default:n.which=r.keyCode[i];n.which||(n.invalid=!0)}else n.which=i.toUpperCase().charCodeAt(0);tr.cache[t]=n}n.which&&!t.invalid&&(tr.keyCodes.push(n.which),tr.list.push(n))}});__designerPort&&!n.isSideBar&&n.push({text:os.Tools,system:!0,icon:!1,toolbar:!1,transition:!0,callback:dtt})},refreshAppButtons:function(t,u){var lt=this,at=lt._title,li=Math.max(v(n._toolbar,"width")/2,at.offset().left+(at.is(".app-hidden")?0:at.outerWidth()-1)),vi=lt._logo,y,o,vt=n._contextButton,it=[],g,a=[],rt={search:hi.PerformAdvancedSearch,user:tt,apps:i.Apps},gt={},d,k=[],ut=[],ni,ti,ii,ri,ui,c=u&&u.dataView||n.dataView(),yt=0,w,fi=u&&u.buttonBars||f.activePage.find(".app-bar-buttons"),et=u&&u.layout||f.activePage.find("[data-layout]"),nt=c&&n.content(c._id).prevAll(".app-bar-actions"),wt,ei,oi,ot,bt,si,ci,kt,ai,st,tt,ct,b,dt;if(u&&u.promo&&c&&(si=s(c).page.find(".app-page-modal-title .app-btn1").hide(),ot=!c||!c.get_showActionBar()||c.get_isForm(),$(t).each(function(){var t=this,i;o=t.icon;i=t.toolbar!=!1&&o&&!o.match(/more|back|undo/);o&&(ot||t.uiScope=="ActionBar"&&(o=="material-icon-add"||o=="material-icon-edit")||t.system&&o!="material-icon-info-outline")&&(o=="search"?si.show():(o.match(/^(refresh|phone|mail|eye)$/)||i)&&!c.get_isForm()&&d!="material-icon-add"&&(n.promo(o,t.text),d=o))})),(!u||u.toolbar)&&(re()?vt.show().attr("title",hi.HideAdvancedSearch).addClass("ui-icon-carat-u").removeClass("ui-icon-dots"):(vt.attr("title",i.More).removeClass("ui-icon-carat-u").addClass("ui-icon-dots"),t.length&&vt.show()),sn(),lt._toolbarButtons.each(function(){y=$(this).show();ci||(ci=y.show()[0].offsetWidth);y.offset().left>li&&it.push(y);y.hide()}),g=it.length,g>0)){for(ot=!c||!c.get_showActionBar()||c.get_isForm(),$(t).each(function(){var n=this,t;o=n.icon;t=n.toolbar!=!1&&o&&!o.match(/more|back|undo/);o&&(ot||n.uiScope=="ActionBar"&&(o=="material-icon-add"||o=="material-icon-edit")||n.system&&o!="material-icon-info-outline")&&(o=="search"?ui=!0:o=="refresh"?ti=!0:o=="phone"?ni=!0:o=="mail"?ri=!0:o=="eye"&&t?ii=!0:t&&a.indexOf(o)==-1?a.push(o):o=null,o&&(rt[o]=lc(n)+(n.desc?"\n"+n.desc:"")),n.path&&(gt[o]=n.path),n.uiScope=="ActionBar"&&ut.push(o))}),ri&&a.push("mail"),ni&&a.push("phone"),ii&&a.push("eye"),ti?a.push("refresh"):!a.length||c&&(c.editing()||c.get_isForm()&&yy())||!e("ui.actions.promote")?n.promo(!1):(c&&(kt=c.get_isForm()?"material-icon-edit":"material-icon-add",bt=a.indexOf(kt),bt>0&&(a.splice(bt,1),a.unshift(kt))),$(a).each(function(){var n=this;if(!n.match(gh))return d=n.toString(),!1}),c&&(s(c).loading||c.get_searchOnStart()||c._requiresContextRefresh)||!n.promo(d,rt[d])||(n.promo().data("icon-list",{icons:a.slice().reverse(),labels:rt}),k.push(d),a.splice(a.indexOf(d),1))),ui&&(a.length<g?a.push("search"):a[g-1]="search"),sr||p>=pt("md")&&(e("ui.menu.apps.location")=="toolbar"&&a.push("apps"),ys&&a.push("user"));ut.length>0;)o=ut[0],ut.splice(0,1),a.indexOf(o)!=-1&&a.splice(a.indexOf(o),1);for(a.length<g&&(yt=g-a.length),w=0;w<yt;w++)$(it[w]).hide();while(w<g)y=$(it[w]),o=a[w-yt],ai=y.data("icon"),y.attr("title",rt[o]),y.data("action-path",gt[o]),k.push(o),y.empty().removeClass("app-avatar"),o=="user"?(st=l._userLetters,tt=r.userName(),st||(l._userLetters=st=ws(tt)),ps(tt,$('<i class="app-icon-avatar"/>').text(st).appendTo(y.addClass("app-avatar").attr("title",tt)))):ft(bo(o),y),y.data("icon",o).show(),w++;n._usedToolbarIcons=k.slice(0)}for(fi.length&&fi.each(function(){var r=$(this),n,s,f,u,o,l,a,h;if(r.is(":visible"))if(r.children().remove(),ct)r.append(ct.html()).toggleClass("app-bar-buttons-md",ct.is(".app-bar-buttons-md"));else{if(ct=r,o=c&&c._isWizard,b||(b=[],$(t).each(function(){var n=this,t=n.icon;!n.system&&t!="dots"&&n.text&&n.uiScope=="Form"&&(b.push(n),n.command=="Cancel"&&(f=b.length-1))})),o&&(b=b.reverse(),f!=null&&(f=b.length-1-f)),u=r.width(),o&&(b.splice(0,0,{text:i.Prev,path:"wizard-prev"},{text:i.Next,path:"wizard-next"}),f!=null&&(f+=2,cancelButton=b[f],b.splice(f,1),u>375&&b.splice(0,0,cancelButton))),$(b).each(function(){var n=this,t=n.path,i=$('<a class="ui-btn ui-mini"/>').text(n.text).attr("data-action-path",n.path).appendTo(r);n.shortcut&&i.attr("title",lc(n));t&&t.match(/^wizard/)&&i.addClass("app-btn-has-icon")}),dr("status",{layout:et}),n=r.toggleClass("app-bar-buttons-md",u>=pt("md")).find(".ui-btn").last(),n.length&&(l=r.offset().left+u,a=n.offset().left+n.outerWidth()-v(n,"margin-right")-1,n.position().left+n.outerWidth()-1>u+2&&(r.find(".ui-btn").css("min-width","8em"),n.length&&n.position().left+n.outerWidth()-1>u+2&&(r.find(".ui-btn").css("min-width","4em"),n.length&&n.position().left+n.outerWidth()-1>u+2&&o&&r.find(".app-btn-has-icon").addClass("app-btn-icon-notext"),n.length&&n.position().left+n.outerWidth()-1>u+2))))for(s=$('<a data-action-path="more" class="ui-btn ui-corner-all ui-mini app-btn-more app-btn-icon-notext"/>').html("&nbsp;").attr("title",i.More).appendTo(r);n.length&&s.position().left+s.outerWidth()-1>u+2;)n=n.hide().prev();c&&(h=e("ui.actions.reverse")==!0,vd&&!h||o||c._controller=="MyProfile"&&c._viewId.match(/^(pas|ide)/)||!(ht("ui.actions.autoReverse")||h)||r.append(r.find(".ui-btn").get().reverse()))}}),et.length&&(dt={},et.find('[data-control="action"]').each(function(){var t=et.attr("data-input-container"),n;n=dt[t];n||(n=r.find(t),dt[t]=n)}));k.length;)if(w=0,k[0]=="user"||k[0]=="apps")k.splice(0,1);else while(w<t.length)k.length&&t[w].icon==k[0]?(t.splice(w,1),k.splice(0,1)):w++;(!u||u.toolbar!=!1||u.actionBar==!0)&&nt&&nt.length&&(wt=nt.find("h3").next(),ei=Math.floor(wt.offset().left)+wt.outerWidth(!0),oi=Math.floor(nt.offset().left)+hu(nt)-8,nt.data("selector").toggleClass("app-hidden",!c.get_showViewSelector()||h.left.visible&&e("ui.sidebar.views.collapsed")==!0),ik(c,nt.data("controls"),ei,oi,!0,d))},endModalState:function(t,i){if(!tt){tt=!0;var r=n.page(i._id);li()}},renderContext:function(n,t,r){var l=!1,a,f=t.isSideBar,e=f&&h.left.mini,u,c,s={};$(t).each(function(){var b,it,p;if(!r||r(this)){var t=this,c=t.text,k=t.shortcut,d=t.count||k,a=e&&t.miniIcon||t.icon,v=nh(a),g=a=="check"||v?"false":a=="ok"?"check":a,w=t.href,u,i,y=t.sidebarCollapse,nt=!1,tt;f&&h.left.mini&&!a&&(c&&!t.transition||t.src)||(u=$("<li/>").attr({"data-icon":!g&&t.pageTransition&&!v?"false":g,"data-theme":t.theme||"a"}).appendTo(n),t.callback||t.dataRel||w?(i=$("<a/>").appendTo(u).data("context-action",t),e?(i.html("&nbsp;").attr("title",c),c&&t.transition&&$("<span/>").text(c.substring(0,1)).appendTo(i)):i.text(c),w&&i.attr({rel:"external",href:w}),!d||(f||o)&&k||$('<span class="ui-li-count"/>').appendTo(i.addClass("ui-li-has-count")).html(d),t.dataRel&&i.attr("data-rel",t.dataRel),t.isStatic&&i.addClass("app-summary-btn")):t.isStatic?u.html(c):t.src?$('<img class="ui-li-thumb"/>').appendTo(u.addClass("ui-li-has-thumb")).attr({src:t.src}):(l?u.remove():(tt=u.attr("data-role","list-divider").html(c),!t.isStatic&&c&&t.instruction!=!1&&tt.addClass("app-list-instruction")),l=!0,nt=!0),nt||(l=!1),t.desc&&!e&&(b=t.display=="before",b&&$('<p class="app-item-desc app-item-desc-before"/>').insertBefore((i?i:u).contents()).text(t.desc),it=$('<p class="app-item-desc"/>').appendTo(i?i:u).text(t.desc),b&&it.addClass("app-item-desc-after")),t.wrap&&u.addClass(t.callback?"app-wrap-text":"app-wrap"),t.disabled&&u.addClass("ui-disabled"),t.itemClassName&&u.addClass(t.itemClassName),t.linkClassName&&i.addClass(t.linkClassName),t.keepOpen&&(i.addClass("app-keep-open"),t.animate||t.count||i.addClass("app-btn-icon-transparent")),t.animate&&i.addClass("app-animated app-animation-spin"),t.selected||a=="check"?(f?i.addClass("app-option-selected"):t.depth||ft(t.radio&&!1?"material-icon-radio-button-checked":"material-icon-check",i),t.depth&&(i.addClass("app-item-selected"),v&&ft(a,i))):v?ft(a,i):t.radio&&!1&&ft("material-icon-radio-button-unchecked",i),y&&f&&(s[y]||(s[y]=[]),s[y].push(u)),p=t.user,p&&ps(p,$('<i class="app-icon-avatar"/>').appendTo(i.addClass("app-avatar")).text(ws(p))),t.depth&&(u.addClass("app-has-depth"),i.addClass("app-depth"+t.depth)),(t.transition&&!t.reverse||t.pageTransition)&&ft(e?"material-icon-navigate-next":"material-icon-chevron-right",i.addClass("app-group-actions")),t.popOut&&!e&&ft("material-icon-chevron-right",i),t.color&&$('<span class="app-color-block"/>').appendTo(i).css("background-color",t.color))}});for(a in s)if(u=s[a],u.length>4){for(c=3;c<u.length;c++)u[c].hide();$("<a/>").appendTo($('<li data-icon="false" data-theme="a"/>').insertBefore(u[3])).text("+"+(u.length-3)+" "+i.More.toLowerCase()).data("context-action",{callback:un})}},tabs:function(n,r){function e(n,t){if(!n||n=="page"||n=="user")return null;var u=rk(r.id)||[],i,f;if(n=n.toString(),$(u).each(function(t){var r=this;if(r.oid==n)return i=r,f=t,!1}),arguments.length==1)return i?i.tab:null;i?u.splice(f,1):i={oid:n};i.tab=t;u.push(i);u.length>10&&u.splice(0,1);rk(r.id,u)}function s(){function a(){n.find(".app-tab-active").is(":visible")||n.find(".app-tab-more").addClass("ui-btn-active")}var i=r.tabs,l=r.scope,v=r.placeholder||$((i[0].content||[])[0]),s=r.container||$('<div class="app-tabs ui-header ui-bar-inherit"><\/div>').insertBefore(v).addClass(r.className),n=$("<ul/>").appendTo(s),h=i[0].text,c;$(i).each(function(){var n=this;n.active&&(h=n.text);$(n.content).each(function(){$(this).addClass("app-tab-content")})});r.id||(r.id=v.attr("id"),r.id&&(r.id+="_tabs"));r.id&&(s.attr("id",r.id),h=e(l)||l=="page"&&ku(r.id)||l=="user"&&ot(r.id)||h);$(i).filter(function(){return this.text==h}).length||(h=i[0].text);$(i).each(function(t){var i=this,f=$('<a class="ui-btn"/>').appendTo($("<li/>").appendTo(n)).text(i.text).attr("data-text",i.text),r=i.content,u;i.active=i.text==h;i.active&&(t>0&&(r&&r.length&&$(r[0]).is('[data-container="tab"]')&&(r=r.children()),$(r).each(function(){var n=this.style;if(n&&n.display!="none")return u=!0,!1})),u&&t!=0?(h=null,i.active=!1):f.addClass("ui-btn-active app-tab-active"))});h||(i[0].active=!0,n.find(".ui-btn").first().addClass("ui-btn-active app-tab-active"));n.on("vclick",function(h){var l=$(h.target).closest("a"),ut=n.find(".app-tab-active"),w=s.parent(),v=w.find(".app-stub,.app-stub-main"),d=arguments.length!=2?null:arguments[1].selectedTab,y=c||d||l.attr("data-text"),nt=f.activePage,p,b=0,tt,g;if(t.cancel()){if(d&&(c=d),l.length)if(!c&&l.is(".app-tab-more"))n.find(".ui-btn").removeClass("ui-btn-active"),k(l,function(){l.addClass("ui-btn-active");g=[];$(r.tabs).each(function(t){var i=this;g.push({text:i.text,icon:i.active?"check":!1,wrap:!0,context:{text:i.text,index:t},linkClassName:"app-btn-icon-transparent",callback:function(t){l.removeClass("ui-btn-active");c=t.text;$(n.find(".ui-btn")[t.index]).trigger("vclick")}})});rt({items:g,anchor:l,afterclose:function(){setTimeout(function(){l.removeClass("ui-btn-active");n.find(".app-tab-active").addClass("ui-btn-active");a()},50)}})});else{if(n.find(".ui-btn").removeClass("app-tab-active ui-btn-active"),l.addClass("app-tab-active ui-btn-active"),$(i).each(function(){var n=this;n.active&&(y==n.text&&(tt=!0),$(n.content).each(function(){b+=$(this).outerHeight(!0)}));n.active=n.text==y;n.active&&(p=n)}),tt){c=null;a();return}r.scope=="page"?ku(r.id,y):r.scope=="user"?ot(r.id,y):e(r.scope,y);b&&v.length&&v.offset().top+v.outerHeight()-b<w.offset().top+w.height()&&v.height(b+v.outerHeight());hl(nt);c&&(c=null,u(s));function it(){o(s);a();p.callback&&p.callback();r.change&&(or=!1,r.change(p),er(),r.restoreScrolling!=!1&&bw(nt));r.stickyHeader&&yr();gw(w,v)}!1&&p.content?it():setTimeout(function(){it()})}return!1}});s.data({"data-tabs":r.tabs,options:r});o(s);u(s,!1)}function h(n){n||(n=r.container?r.container.find(".app-tabs"):w().find(".app-tabs"));n.find("ul").off();n.data({"data-tabs":null,options:null}).remove()}function o(n){n||(n=w().find(".app-tabs"));$(n).each(function(){$($(this).data("data-tabs")).each(function(){var n=this;$(n.content).each(function(){$(this).toggleClass("app-tab-active",n.active)})})})}function u(n){n||(n=(r&&r.page||f.activePage).add($(".ui-page.ui-page-active .app-bar-header.ui-header-fixed")));var t=n.find(".app-tabs");t.find("ul").css("visibility","");t.each(function(){var u=$(this),r=u.width(),s=u.data("data-tabs"),f=u.offset().left+v(u,"padding-left"),t,n,o,e;if(r&&(u.find(".app-tab-more").parent().remove(),t=u.find(".ui-btn").css({"padding-left":"","padding-right":"","min-width":"","max-width":"",display:""}),$(s).each(function(n){var r=this,u=!0,i=$(r.content);i.length==1&&$(i[0]).is('[data-container="tab"]')&&(i=$(r.content).children());i.each(function(){var t=this,n=t.style;if(n&&n.display=="none")return u=!1,!1});u||(t[n].style.display="none")}),n=t.last(),n.offset().left-f+n.outerWidth()>r&&(t.css("min-width","8em"),n.offset().left-f+n.outerWidth()>r&&(t.css("min-width","4em"),n.offset().left-f+n.outerWidth()>r&&(t.css({"padding-left":"1em","padding-right":"1em"}),n.offset().left-f+n.outerWidth()>r&&(t.css({"padding-left":".5em","padding-right":".5em"}),n.offset().left-f+n.outerWidth()>r))))))for(n=$('<a class="ui-btn app-tab-more"/>').appendTo($("<li/>").appendTo(n.closest("ul"))).text(i.More).css({"min-width":"4em","padding-left":"0.5em","padding-right":"0.5em"}),e=t.length-1;n.offset().left-f+n.outerWidth()>r;){if(!e){$(t.get(0)).css("max-width",r-n.outerWidth()-12);break}o=$(t.get(e)).css("display","none");o.is(".app-tab-active")&&n.addClass("ui-btn-active");e--}})}switch(n){case"create":r.tabs&&r.tabs.length>1&&s(r);break;case"destroy":h();break;case"fit":u()}},refreshTitleState:function(){n._title.toggleClass("app-hidden",n._menuButton.is(".ui-icon-bars"))},refreshMenuStrip:function(){var f;ii.nodes||yrt();var t=this._menuStrip,r=t&&t.strip,ct=this._title,d=n._logo,g=v(d,"left")+d.outerWidth(),y=h.left.visible?(h.left.mini?g:h.left.width)+1:g,w=n._toolbar,nt=w.find(".app-btn-cluster-right .ui-btn").filter(io).first(),b=(nt.length?nt.offset().left:hu(w))-16,tt=ii.nodes,c,a,o,st,it,s,ut=e("ui.menu.location")=="toolbar",u,ft,et;if(!r)if(t=this._menuStrip={strip:$('<div class="app-menu-strip"><\/div>').appendTo(w)},r=t.strip,ut){for(c=$("<ul/>"),f=0;f<tt.length;f++){var l=tt[f],u=$("<li/>").appendTo(c),ot=$('<a class="ui-btn"/>').appendTo(u).text(l.title).attr({title:l.description}).data("data-node",l);l.children&&ot.addClass("app-has-children");l.selected&&ot.addClass("app-selected")}t.links=c.find(".ui-btn");t.items=t.links.parent();t.more=$('<a class="ui-btn app-has-children"/>').appendTo($("<li/>").appendTo(c)).text(i.More);function ht(n){wo(n)}c.appendTo(r).on("vclick contextmenu",function(n){var i=$(n.target).closest(".ui-btn"),f=i.is(".app-selected"),t=i.data("data-node"),u=t&&t.url&&!t.children;if(i.length==0)return!1;if(u){if(n.type=="contextmenu")return!1;t.url&&!t.url.match(bv)&&fe();r.find(".app-selected").removeClass("app-selected");i.addClass("app-selected")}return k(i,function(){if(u)ht(t);else{var f=[],n=[];t?n.push(t):(depth=0,t={children:[]},r.find("li:hidden a").each(function(){n.push($(this).data("data-node"))}));nf(f,!0,n,1);rt({anchor:i,items:f,afteropen:function(n){var t=n.find(".ui-panel-inner"),i=t.find(".app-item-selected");i.length&&t.offset().top+t.height()<i.offset().top+i.outerHeight()&&t.scrollTop(i.offset().top-t.offset().top-(t.height()-i.outerHeight())/2)}})}}),!1})}else t.title=$('<span class="app-menu-strip-title"/>').appendTo(r.addClass("app-menu-strip-has-title")).text(ii.currentNode?ii.currentNode.title:document.title);if(s=b-y,ut){if(s!=r.data("tested-width")||!r.is(":visible"))if(r.data("tested-width",s),p>414&&s>=200&&r.attr("data-enabled")!="false"&&n._menuButton.is(".ui-icon-bars"))for(r.removeClass("app-hidden"),oo(!0),r.width(s).css({left:y}),a=t.items,o=t.more.removeClass("app-selected").parent(),st=o.find(".ui-btn").text(i.More),o.hide(),a.show(),f=a.length-1;f>=0;f--){if(u=$(a[f]),et=u.outerWidth(),ft=u.offset().left,ft+et-1>=b&&(o.show(),it=o.outerWidth(),u.hide()),u.is(":hidden")&&u.find(".app-selected").length&&t.more.addClass("app-selected"),!o.is(":visible")||o.offset().left+it-1<b){f<=1&&!u.is(":visible")&&oo(!1);break}else u.hide(),u.find(".app-selected").length&&t.more.addClass("app-selected");if(f<=1){oo(!1);break}}else oo(!1)}else r.width(s).css({left:y}),oo(s>=100)},refreshSideBar:function(t,u){function st(){var f,o,t,w;if(b=!1,f=ht("ui.sidebar.views.styles"),o=ht("ui.sidebar.views.names"),c.dataView().get_showViewSelector()&&(f||o)){var a=[],s=e("ui.sidebar.views.collapsed")==!0,r=p.dataView,k=r.get_view().Label,y,d;cw(u);o&&r.get_showActionBar()&&ka(a,!1,p,null,!0)>1&&(h.left.mini||s||($(a).each(function(){u.push(this)}),u.push({})));t=[];c.tagged("view-style-grid-disabled")||t.push({text:i.Grid,icon:"grid",selected:tt,callback:function(){tt||ie(l,"Grid")}});c.tagged("view-style-list-disabled")||t.push({text:i.List,icon:"bullets",selected:rt,callback:function(){rt||ie(l,"List")}});c.tagged("view-style-cards-disabled")||t.push({text:i.Cards,icon:"cards",selected:it,callback:function(){it||ie(l,"Cards")}});c.tagged("supports-view-style-map")&&!c.tagged("view-style-map-disabled")&&t.push({text:i.Map,icon:"location",selected:ut,callback:function(){ut||ie(l,"Map")}});n.presenter("enumerate",{id:l,list:ft});$(ft).each(function(){var n=this;c.tagged("view-style-"+n.name.toLowerCase()+"-disabled")||(n.name==v&&(n.selected=!0),t.push(n))});f&&t.length>1&&(s?$(t).each(function(){var n=this;if(n.selected)return y=n.text,d=n.icon,!1}):($(t).each(function(){u.push(this)}),cw(u)));s&&(w=r._totalRowCount>0?" ("+String.format("{0:N0}",r._totalRowCount)+")":"",u.push({text:k+w,desc:y,icon:"material-icon-folder-open",context:{position:"left"},popOut:!0,itemClassName:"app-view-selector",callback:yk}))}}var ct=this,lt=eh().find(".ui-panel-inner"),p=s(),f=p&&p.dataView,d=f,l=f&&f._id,o=f&&f.get_parentDataView(f),a=[],g=f&&f.get_showActionBar(),w=$('.TaskBox.About .Inner .Value, head meta[name="description"]'),nt=o&&!o._parentDataViewId,b=f&&f.get_isGrid(),c=f&&f.extension(),v=b&&c.viewStyle(),tt=v=="Grid",it=v=="Cards",rt=v=="List",ut=v=="Map",ft=[],at={items:u},et=[],ot=["material-icon-undo","check","info"],k,y;if(nt){while(f&&a.indexOf(f)==-1){if(o&&o._dataViewFieldName)break;(f.get_showInSummary()||o&&f!=o&&o.get_showInSummary())&&!f.inserting()&&f.extension().commandRow()&&a.unshift(f);f.get_isForm()&&(f=o);f=r.find(f._filterSource)}k=u.length;$(a).each(function(){n.enumerateFields(this,u)});u.length>k&&(f=a[a.length-1],y=u[k],y.icon="material-icon-chevron-right",y.miniIcon="material-icon-info-outline",y.context=f._id,y.callback=by,u.push({}))}g&&d&&(d.extension().context(et,["ActionBar"]),$(et).each(function(){var t=this,n=t.icon;t.uiScope=="ActionBar"&&n&&n!="dots"&&n!="carat-r"&&ot.push(n)}));$(t).each(function(){var n=this;ot.indexOf(n.icon)!=-1||n.system&&n.toolbar==!1||n.command=="Select"||n.icon=="eye"&&(!o||o.get_showInSummary())||(n.text||u.length)&&(n.navigateTo&&b&&st(),n.theme=null,n.uiScope=="ActionBar"&&g||u.push(n))});b&&st();h.left.mini||e("ui.menu.location")!="sidebar"||(u.length&&u[u.length-1].callback&&u.push({}),nf(u),!ht("ui.sidebar.toolbar")&&ht("settings.enabled")&&u.push({},{text:i.Settings,icon:"material-icon-settings",transition:!0,callback:sit}));w.length&&nt!=!1&&(u.length&&u[u.length-1].text&&u.push({}),u.push({text:w.is("meta")?w.attr("content"):w.html(),isStatic:!0,wrap:!0}))},contextPageInfo:function(){return s(this._contextScope)},refreshContext:function(){lt()},contextScope:function(n){if(arguments.length==0)return this._contextScope;this._contextScope=n},contextDataView:function(n){var t,i;return n!=null&&(t=ei(n),t.length)?r.find(t.attr("data-for")):(i=this.contextPageInfo(),i?i.dataView:null)},showContextMenu:function(t){var r=t.position||"left",i="#app-panel-context-"+r;t&&(this.contextScope(t.scope),t.scope&&(i+="-scope",t.position=r));fk(i,function(){n.refreshContextMenu(i)},t).panel("toggle")},refreshContextMenu:function(t,i,r){var s=this,f=$(t),w=f.find(r||"ul"),u=w.length?w:f.find("ul"),b=u.outerHeight(),a,v,o=f.is(".app-sidebar"),l,y,e,p;if(o&&!f.is(":visible")){i=[];s.navContext(i);s.refreshAppButtons(i);return}if(o&&!is&&(v=$("<div><\/div>").appendTo(c).css({"z-index":2e3,position:"absolute",left:0,top:f.find(".ui-panel-inner").offset().top,width:f.outerWidth(),height:nt,"background-color":"#fff"})),b&&(a=$("<div><\/div>").height(b).insertAfter(u)),rf(u),u.find("a").removeData(),u.find("li").remove(),i||(i=[],i.isSideBar=o,s.navContext(i)),o&&(s.refreshAppButtons(i),y=[],e=0,this.refreshSideBar(i,y),i=y,i.isSideBar=!0,h.left.visible&&h.left.mini))while(e<i.length)if(p=i[e].icon,p&&n._usedToolbarIcons.indexOf(p)!=-1)for(i.splice(e,1);e<i.length&&!i[e].text;)i.splice(e,1),e>0&&e--;else e++;for(l=$.Event(o?"sidebar.app":"more.app"),l.items=i,l.panel=f,$(document).trigger(l);i.length&&!i[i.length-1].text&&!i[i.length-1].src;)i.splice(i.length-1);this.renderContext(u,i);u.listview("refresh");u.find("a.ui-btn-icon-right").removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left");u.find("li.app-wrap").addClass("ui-li-static ui-body-a").find("a").attr({"class":""});u.prev().find(".app-focus").length&&u.find(".ui-btn").first().addClass("app-focus ui-btn-active");f.is(".app-reset-scrolling")?f.find(".ui-panel-inner").scrollTop(0):ftt(f);a&&a.remove();v&&v.remove();o&&h.left.inner.trigger("scroll")},pageShown:function(n){ui(n)},isWebView:function(){return gt&&!l.navigator.standalone&&!ad},isHosted:function(){return sr},icon:function(n,t){return ft(bo(n),t)},details:function(i){var f=i.field,u=f._dataView,e=u._allFields[f.AliasIndex],o=u.editing()?u.editRow():u.extension().commandRow();n.show({controller:f.ItemsDataController,view:i.view||"editForm1",filter:[{name:f.ItemsDataValueField,value:i.key||o[f.Index]}],headerText:e.format(o[e.Index])||e.HeaderText,done:function(e){if(et()==u._id)if(u.get_isForm()){if(!(e._newRow&&e._newRow.length)){var o=r.input.methods.lookup._rowToValues(f,e,e.editRow());t.execute({dataView:u,values:o})}i.done&&i.done(e)}else u.sync();else n.dataView().sync()},cancel:i.cancel})},lookup:function(i){var h;if(dt(),i.create){var r=i.field,d=i.dataInput,a=i.value,v=r.ItemsDataTextField,e=r._dataView;n.show({controller:r.ItemsDataController,startCommand:"New",startArgument:r.ItemsNewDataView,filter:e.get_contextFilter(r,e.extension().collect()),defaultValues:a!=null&&v?[{name:v,value:a}]:null,done:function(n){var o=t.methods.lookup._rowToValues(r,n,n.editRow()),i=[];$(o).each(function(){i.push(this.value)});var f=0,e=r.DynamicItems||r.Items,u=i[1]?i[1].toString().toLowerCase():"undefined";if(r.ItemsStyle.match(/AutoComplete|Lookup/))for(;;){if(r._dataView.session(r.Name+"_listOfValues_"+u,null),!u.length)break;u=u.substring(0,u.length-1)}else $(e).each(function(n){if(this[0]==null||this[1].toString().toLowerCase()<u)f=n;else return!1}),e.splice(f+1,0,i);r.ItemsStyle.match(/AutoComplete|Lookup|DropDownList/)?(t.methods.lookup.focus(d.data("autoComplete",!1)),t.methods.lookup._useItemValue(r,i)):t.methods.listbox._useItemValue(r,i,!0)}});return}var o,u=i.field,s=u._dataView,y=u._dataView,p=y.get_contextFilter(u,y.extension().collect()),c,e,l,w=i.query,g=s._allFields[u.AliasIndex],b=g.HeaderText,k=b!="&nbsp;"?b:u.AltHeaderText,nt=s.editRow();if(co(),!u.ContextFields&&(o=n._modalStack.length&&n._modalStack[0].dataView,h=f.navigate.history,o&&o._lookupInfo&&o._lookupInfo.field==u&&h.activeIndex<h.stack.length-1&&h.stack[h.activeIndex+1].hash=="#"+o._id)){o._lookupInfo=i;vs.go(1);return}this.modalDataView();c=u.ItemsDataController.toLowerCase();$find(c)&&(c+=Sys.Application.getComponents().length);e=$create(Web.DataView,{id:c,baseUrl:s.get_baseUrl(),servicePath:s.get_servicePath(),controller:u.ItemsDataController,viewId:u.ItemsDataView,externalFilter:p,filterSource:p.length>0?"options":null,showSearchBar:!0,showFirstLetters:u.ItemsLetters,searchOnStart:u.SearchOnStart,description:u.ItemsDescription},null,null,$("<p>")[0]);l=this.pageInfo(e);w&&e.viewProp("quickFind",w);l.headerText=i.value?[i.text,k]:k;l.resolved=!0;e._lookupInfo=i;i.value==null||u.ItemsValueSyncDisabled||np(e,[i.value]);e._parentDataViewId=s._id;this.modalDataView(l.id,!0)},show:function(t){var l=t.controller,y=t.view||"grid1",e,a=JSON.stringify(t),i,r,o,h=n._modalStack,u,c,v;if(o=h.length&&h[h.length-1],u=f.navigate.history,o&&o.showSign==a&&t.cache!=!1&&u.activeIndex<u.stack.length-1&&u.stack[u.activeIndex+1].hash=="#"+o.id){vs.go(1);return}for(co(),$(t.filter).each(function(){var n=this;n.name&&(n.Name=n.name);n.value&&(n.Value=n.value)}),this.modalDataView(),c=l.toLowerCase(),v=1,e=c;$find(e);)e=c+v++;return i=$create(Web.DataView,{id:e,baseUrl:__baseUrl,servicePath:__servicePath,controller:l,viewId:y,externalFilter:t.filter,showSearchBar:!0,startCommandName:t.startCommand,startCommandArgument:t.startArgument,showActionButtons:t.showActionButtons,exitModalStateCommands:["Cancel"],tag:t.tags},null,null,$("<p>")[0]),i._doneCallback=function(n){s(n).showSign=null;dg(n);li(function(){t.done&&t.done(n)})},i._ditto=t.defaultValues,i._cancelCallback=t.cancel||li,r=this.pageInfo(i),r.headerText=t.headerText,r.headerText&&(r.headerTextLocked=!0),r.resolved=!0,r.showSign=a,t.key&&np(i,[t.key]),this.modalDataView(r.id,!0),i},pageInit:function(n,t){var i=this.pageInfo(n),r,u;return i==null?!1:(r=i.dataView,u=i.initialized||!i.dataView&&i.initialized!=!1,r&&r._busy())?!1:(i.initialized||(i.initialized=!0,r&&(i.requiresInitCallback=!0,t!=!1&&oi(!0),i.refreshed==!1?(i.refreshed=!0,r.extension().refresh()):r._loadPage())),u)},pageShow:function(n){var t;if(f.activePage&&(f.activePage.find("[data-role='navbar'] a.app-tab-active").addClass("ui-btn-active"),t=this.pageInfo(n),t!=null)){var i=t.dataView,r=i?i.extension():null,u=this._modalStack.indexOf(t);u>=0&&this._modalStack.splice(u,1);t.initialized||(t.initialized=!0,i&&i._loadPage());r&&r._reset&&r.refresh()}},screen:function(){var n=0,t=cu(),i=f.getScreenHeight();return{top:n+t,bottom:n+f.getScreenHeight(),height:i-t,width:p}},callWhenVisible:function(n,t){var i=typeof n=="string"?f.activePage.find(n):n;i.each(function(){var n=$(this);if(n.is(":visible")&&n[0].style.visibility!="hidden"){var i=n.offset().top,u=i+n.outerHeight(),e=w(n),r=e.offset().top,f=r+e.height()-1;(r<=i&&i<=f||r<=u&&u<=f||i<=r&&f<=u)&&t(n)}})},asyncJob:function(){return this._asyncJob},nextAsycJob:function(){return++this._asyncJob},supports:function(n){switch(n){case"Map":return this._supportsMap==!0}return!1},mapsApiKey:function(){var n=!!l.location.host.match(/^localhost\b/);return e("map.apiKey")||(n?"key=AIzaSyAhggwxCKiA2oEdxaRqap4t4-_96ajw_uw":"")},registerAPI:function(t,i){var r=this,u,e,f;if(t=="Map")return r._mapAPI?i&&i():(e=!!l.location.host.match(/^localhost\b/),f=n.mapsApiKey(),u="https://maps.googleapis.com/maps/api/js?&callback=appFactoryCallback",f?(u+="&"+f,r._mapAPI=!0,l.appFactoryCallback=function(){r._supportsMap=!0;$(document).trigger($.Event("map.init.app"));i&&i();l.appFactoryCallback=null},$.getScript(u)):i&&i()),r._mapAPI;t!="Charts"||r._chartsAPI||n.registerAPI("Map",function(){$.getScript("https://www.google.com/jsapi",function(){$.getScript("https://www.gstatic.com/charts/loader.js",function(){r._chartsAPI=!0;$(document).trigger($.Event("charts.init.app"));i&&i()})})})},fetchOnDemand:function(){function t(n){n.trigger("vclick")}if(!or){var i=n.dataView();this.callWhenVisible(".dv-load-at-bottom",t);this.callWhenVisible(".dv-load-at-top",t)}return this},keyboard:function(){return py()},callInAnimationFrame:function(n){if(requestAnimationFrame)var t=requestAnimationFrame(function(){n();cancelAnimationFrame(t)});else n()},stickyHeader:function(n){var d=this,g=l._stickyHeaderHideInstruction;l._stickyHeaderHideInstruction=!1;var a=w(n),s=a.closest(".ui-page"),y=gs(s),r=y.attr("data-selector"),i=r?s.find(r):y.find(".app-static-text"),t=ru(n),u,f=!0;if(t&&t.length){if(!tt&&(i.length||r)){var h=s.is(".app-page-modal"),b=v(a,"top"),k=Math.ceil(i.length?i.offset().top:-1),e,c,nt=0;k<b&&(r||i.height()>0)&&(t.is(":visible")&&t.data("screen-width")==p?f=!1:(f=!1,h?t.is(".app-bar-heading-modal")||t.addClass("app-bar-heading-modal"):t.is(".app-bar-heading-modal")&&t.removeClass("app-bar-heading-modal"),t.data("screen-width",p),t.show()[0].style.width=hu(a)-v(t,"padding-left")-v(t,"padding-right")-1-(h&&!o?6:h&&o?-1:0)+"px",s.find(".ui-content").children().each(function(){var n=$(this);n.is(".app-tabs,.app-bar-actions,.app-bar-header")&&n.css("display")!="none"&&(nt+=n.outerHeight())}),u=t.css({top:b+(h?-1:0)}).find(".app-bar-text"),r?(c=y.html(),c!=u.data("html")&&(u.data("html",c).html(c).css("white-space","normal"),g&&t.find(".app-view-instruction,.app-group:not(.app-group-fixed)").addClass("app-hidden").parent().addClass("app-bar-text-instruction-hidden"))):(e=i.text().trim(),e?e!=u.data("text")&&u.data("text",e).text(e).css("white-space",""):f=!0),t.outerHeight()+v(t,"top")<i.outerHeight()+k&&(t.hide(),f=!0)))}return(f||$(document.activeElement).closest("[data-input]").length)&&t.hide(),d}},wait:function(){},start:function(t){function nt(n){return $(n).each(function(){return this.selected?(v=this,!1):this.children&&(nt(this.children),v)?!1:void 0}),null}function rt(){var i=t&&$(t.selector).data("scripts");i&&eval(i);$(document).trigger($.Event("start.app"));n._started=!0}function ut(){n.tabs("create",{tabs:p,className:"app-tabs-echo",scope:"page",change:function(){}})}var ft=n._appLoaded&&n._pageCreated,g,v;if(!t&&!ft){setTimeout(function(){n.start()},16);return}f.ignoreContentEnabled=!0;var i=n.pageMenu(t&&t.pageId),k=0,a,d=$(t&&t.selector||"#PageContent"),u=d.attr("data-href"),et=n._pages.length>1,b=d.find('div[data-app-role="page"]').each(function(f){var e=$(this),a=e.find('> div[data-role="content"]'),h=e.attr("data-content-framework");h&&e.attr("data-enhance","false");a.length||(a=$('<div data-role="content"><\/div>'),e.contents().appendTo(a),a.appendTo(e));e.attr({"data-role":"page","data-app-role":null}).addClass("app-page-scrollable").appendTo(c);var s=r.eval(e.attr("data-page-header")),l=uk(e),o={text:(s!="false"?s:"")||l.text||n.title(),description:l.description,activator:l,url:u,transition:t&&t.transition},y=e.attr("id")||dc(u||location.pathname)+(f>0||u?f+1:"")||"_root",p,v;s=o.text.split(/\s*\|\s*/);o.headerText=s.length>1?s:s[0];e.find('div[data-role="content"]').contents().wrapAll('<div class="app-page-content'+(h?" app-content-framework app-"+h:"")+'"><\/div>');e.page().attr("id",y);o.id=y;o.page=e;o.dynamic=t&&t.dynamic;n.pageInfo(o);o.scrollable=v=fh(e,!1).find(".app-page-content");h&&(e.attr("data-page-header","false"),r.configureFramework(h,v,function(n){de=n}));et&&n.makeModalOrPanel(o);e.each(function(){$.each(this.attributes,function(){var t=this,n;t.specified&&(n=t.name,n.match(/^data\-/)&&!n.match(/^(data-(content-framework|page-header|app-role|role|activator|enhance))$/)&&v.attr(n,t.value))})});r.dataBind(v,[]);l.text&&(k++,p=$('<a class="app-action-navigate" />').attr("href","#"+y).text(l.text).appendTo($("<li/>").appendTo(i)),o.description&&$("<p/>").appendTo(p).text(o.description));sl(e)});b.length&&(a=b.first(),k==0&&a.attr("data-activator")!="false"&&$('<a class="app-action-navigate" />').attr("href","#"+a.attr("id")).text(a.attr("data-page-header")||dv.SeeAlso).appendTo($("<li/>").appendTo(i)),i.is(".ui-listview")&&i.listview().listview("refresh"));g=ii.nodes;t||nt(g);v&&!b.length&&i.find("a").length==0&&ov(v.children,i,1);var tt=this,o=t?n.page(t.pageId):f.activePage,y=o.find("a.app-action-navigate"),ot=location.href.match(/#(.+)$/),h,p=[],w,it=tt._pages[0];y.length==1&&(t||e("ui.list.initialMode")=="SeeAll"||!it.dataView||it.dataView.get_lastCommandName()||l.location.href.match(/_controller=.+_commandName=.+/))?$(this._pages).each(function(){var t=this,i=t.dataView;if(sy=i&&i._id,(!u||t.url==u&&!t.root)&&(!i||!i._hidden)){u||(t.home=!0,u=f.path.documentBase.pathname+l.location.search);rt();f.navigate.history.clearForward();u&&(t.replaceUrl=u);i&&(fh($("#Main")),$('<h1 class="app-page-loading"/>').appendTo(n.content().empty()).text(st.Loading));as=!0;tt.changePage(t.id);$(document).one("pageready.app",function(){as=!1});return!1}}):o.attr("id")=="Main"&&(y.length&&o.find('a[rel="external"]').parent().remove(),y.show(),h=fh(o),o.addClass("app-page-scrollable"),vi(document.title),$(y).each(function(){var r=$(this),u=r.attr("href"),i=u&&s(u.substring(1)),t,f,n;i&&i.dataView&&i.activator.type!="Button"&&(n=i.activator,n&&n.type=="Tab"&&($(p).each(function(){if(this.text==n.text)return t=this,!1}),t||(w!=n.container&&(w&&(ut(),p=[]),w=n.container),t={text:n.text,content:[]},p.push(t))),f=ua(i.id,h),t&&t.content.push(f),r.parent().remove())}),w&&ut(),i=n.pageMenu(),i.find('a.app-action-navigate,a[rel="external"]').length?i.listview().show():i.remove(),pi(),h.find(".app-tabs").length>1&&$('<div class="app-stub-main"><\/div>').appendTo(h),nu(),rt(),er(),fb(),lr(h),cr())},pageMenu:function(n){var r=this,i=this.content(n),t=i.find("ul.app-page-menu");return t.length||(t=$('<ul data-role="listview" data-inset="false" class="app-page-menu"/>').appendTo(i).hide().on("vclick",function(n){var t=$(n.target),i,u;return t.is("a")||(t=t.closest("a")),t.length&&(i=t.attr("href"),u=i.match(/^#/),u||fe(),k(t,function(){u?r.changePage(i.substring(1)):(kt(t,!1),l.location.href=i)})),!1})),t},initialize:function(){function rt(n){$(n).each(function(){var n=this,i=n.cssClass,t=i&&i.match(yv);t&&(r.push({node:n,icon:t[0]}),n.icon=t[0]);n.children&&rt(n.children);Web.Menu.nodeCount++})}function ut(n){return $(n).each(function(){var n=this;return n.url&&n.url.toLowerCase()==t||n.selected?(v=n,v.selected=!0,Web.Menu.currentNode=v,!1):n.children&&(ut(n.children),v)?(n.selected=!0,!1):void 0}),null}function ct(){var n=gf(),t;if(n-ot>2500){if(t=$.Event("awake.app"),$(document).trigger(t),t.isDefaultPrevented())return;n=gf()}ot=n;setTimeout(ct,1250)}var v,t,r,et,w,s,a,it;kg();t=l.location.pathname+l.location.search.replace(/(\_(\w+)=(.*?)(&|$))/,"");r=Web.Menu.nodesWithIcons=[];t.match(/\?$/)&&(t=t.substring(0,t.length-1));Web.Menu.nodeCount=0;for(et in ii.Nodes){w=ii.Nodes[et];ut(w);rt(w);break}var vt=this,ot=gf(),k=f.path.parseUrl(location.href),d=k&&k.hash,nt,st=$("head"),o=$('<div class="app-scrollbar-info"><div><\/div><\/div>').appendTo(c);b={width:o[0].offsetWidth-o[0].clientWidth,height:o[0].offsetWidth-o[0].clientWidth,gridColumnPadding:16};o.remove();ttt();d&&(d.match(/\W/)||!$(d).length)&&(f.navigate.history.initialDst="",nt=f.navigate.history.stack[0],nt.url=k.hrefNoHash,nt.hash="",f.path.documentBase.href=f.path.documentBase.hrefNoHash);gt?$('<meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black'+(ts>=8?"-translucent":"")+'"/><link rel="apple-touch-icon" href="../touch/logo-icon.png"/>').appendTo(st):nr&&$('<meta name="mobile-web-app-capable" content="yes"/><link rel="icon" sizes="196x196" href="../touch/logo-icon.png"/>').appendTo(st);setTimeout(ct,10);g.appInfo.match(/\|$/)||$("#app-welcome").remove();n._logo.html(hc());th();n.refreshMenuStrip();var u=h.left.toolbar,r=Web.Menu.nodesWithIcons,lt=ht("settings.enabled"),at=e("ui.menu.apps.location"),y=!at||at=="sidebar",tt=r.length<=4&&r.length==ii.nodeCount||!y,p=Math.min(r.length,(tt?4:3)+(lt?0:1));if(ht("ui.sidebar.toolbar")){if(ht("ui.sidebar.icons"))for(s=0;s<p;s++)a=r[s],it=$('<a class="ui-btn ui-btn-a app-btn-page app-btn'+s+'">&nbsp;<\/a>').appendTo(u).attr("title",a.node.title).data("context",a.node),ft(a.icon,it),a.node==ii.currentNode&&it.addClass("app-selected");else p=0,tt=!y;!tt&&y&&ft("material-icon-apps",$('<a class="ui-btn ui-btn-a app-btn-apps">&nbsp;<\/a>').appendTo(u).attr("title",i.Apps));lt&&ft("material-icon-settings",$('<a class="ui-btn ui-btn-a app-btn-settings">&nbsp;<\/a>').appendTo(u).text(i.Settings).attr("title",i.Settings));p&&u.addClass("app-has-icons");e("ui.menu.location")!="sidebar"&&y||p||u.addClass("app-has-optional-apps");dp();h.left.inner.closest(".ui-panel").addClass("app-has-toolbar-bottom")}else u.hide(),h.left.inner.css("bottom",0);no(h.left.inner,!1)},presenter:function(t,i){function f(){u[i.name]=i}function e(n){ie(n.id,n.name)}function o(){var n=u[typeof i=="string"?i:i.name];return n&&(typeof i=="string"||n.supports(r.find(i.id),i.config))}function s(){var e=r.find(i.id),s=e.extension(),o=i.container.is(".app-echo-inner"),t=yh(),f;if(o||e==n.dataView()){if(t=u[i.name],o&&t.echo&&!t.echo())return!1;o||(nw(i.container,s),i.container.find('ul[data-role="listview"]').hide(),el(i.container,s));f=$(i.container).find('div[data-presenter="'+t.name+'"][data-scope="'+e._viewId+'"]');f.length||(f=$('<div data-role="presenter" class="app-presenter"><\/div>').appendTo(i.container).attr({"data-presenter":t.name,"data-scope":e._viewId}));f.show();i.container=f;t.show(i)}else vr(i.id+"_echo");return!0}function h(){$(i.container).find('div[data-role="presenter"]').each(function(){var n=$(this),r=n.attr("data-presenter"),t=u[r];t&&(i.container=n,t.hide(i),n.hide())})}function c(){$(i.container).find('div[data-role="presenter"]').each(function(){var n=$(this),r=n.attr("data-presenter"),t=u[r];t&&(i.container=n,t.dispose(i),n.remove())})}function l(){var o=r.find(i.id),s=n.contextDataView()!=n.dataView(),f,t;for(f in u)t=u[f],t.supports(o)&&(!s||!t.echo||t.echo())&&i.list.push({name:f,text:t.text(),icon:t.icon(),context:{id:o._id,name:f},callback:e})}function a(){return u[i.name]}var u=n._presenters;switch(t){case"supports":return o();case"enumerate":l();break;case"register":f();break;case"show":return s();case"hide":h();break;case"dispose":c();break;case"find":return a()}}},function(){var n,t,u;$.event.special.swipe.teardown();$.event.special.swipe.setup=function(){};$.event.special.tap.teardown();$.event.special.tap.setup=bt;$.mobile.autoInitializePage=!1;var a=/\b_touch_(\w+)=(\w+)\b/g.exec(location.href),v=f.focusPage;if(f.focusPage=bt,$.extend($.fn.buttonMarkup,{initSelector:"a:jqmData(role='button'), .ui-bar > a, .ui-bar > :jqmData(role='controlgroup') > a"}),n=f.SerialTransition.prototype,n.toPreClass="",n.cleanFrom=function(){this.$from.removeClass(f.activePageClass)},n.doneIn=function(){this.deferred.resolve(this.name,this.reverse,this.$to,this.$from,!0)},n.hideIn=function(n){n.call(this)},n.scrollPage=bt,n.startIn=function(){this.hideIn(function(){this.$to.addClass($.mobile.activePageClass)});this.doneIn()},n.startOut=bt,n.toggleViewportClass=bt,n.transition=function(){var n="none",t="",i=$.mobile.getScreenHeight();return this.$from&&!n?this.startOut(i,t,n):this.doneOut(i,t,n,!0),this.deferred.promise()},f.resetActivePageHeight=function(){},c=$("body"),t=l.matchMedia("screen and (min-resolution: 144dpi)"),t.matches||(t=l.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)")),t.matches&&(rs=144,t=l.matchMedia("screen and (min-resolution: 240dpi)"),t.matches||(t=l.matchMedia("screen and (-webkit-min-device-pixel-ratio: 2.5)")),t.matches&&(screepDPI=432)),o="ontouchstart"in l,o){if(!gt&&!nr)$(document).on("mousemove touchstart",function(n){ir=null;n.type.match(/^touch/)?o||(o=!0,c.removeClass("app-desktop app-show-system-buttons-on-hover")):o&&(o=!1,g&&e("ui.showSystemButtons")=="Always"||c.addClass("app-show-system-buttons-on-hover"),c.addClass("app-desktop"))})}else if(l.PointerEvent){o=!0;$(document).on("pointerdown pointermove",function(n){var t=n.originalEvent.pointerType;t=="touch"?o||(o=!0,c.removeClass("app-desktop app-show-system-buttons-on-hover")):t=="mouse"&&o&&(o=!1,g&&e("ui.showSystemButtons")=="Always"||c.addClass("app-show-system-buttons-on-hover"),c.addClass("app-desktop"))})}o||c.addClass("app-desktop");$("#aspnetForm").hide();var r=$('<div id="app-bar-toolbar" class="app-bar-toolbar ui-header ui-bar-a ui-header-fixed" data-role="header" data-position="fixed" data-theme="a" class="app-bar-toolbar"><\/div>').appendTo(c),h=$('<div data-role="page" id="Main"><\/div>').appendTo(c),s='<a class="ui-btn-right app-btn ui-btn ui-btn-icon-notext ui-shadow ui-corner-all"/>',y=$('<a class="ui-btn ui-btn-a ui-btn-icon-notext app-btn-float app-btn-promo"/>').hide().appendTo(c).on("vclick",ed);$('<div data-role="content" class="app-content-main"><\/div>').appendTo(h);$('<span class="app-btn-menu-background"/>').appendTo(r);$('<a data-role="button" id="app-btn-menu" class="app-btn-menu ui-btn ui-btn-icon-notext ui-shadow ui-corner-all ui-icon-bars ui-btn-left"/>').appendTo(r);$('<span class="app-back-text"/>').appendTo(r);$('<span class="app-logo"/>').appendTo(r);$('<h1 class="ui-title"/>').appendTo(r);u=$('<div class="app-btn-cluster-right"><\/div>').appendTo(r);$(s).appendTo(u);$(s).appendTo(u);$(s).appendTo(u);$(s).appendTo(u);$(s).appendTo(u);$('<a id="app-btn-context" data-role="button" class="app-btn-context ui-btn-right ui-link ui-btn ui-icon-dots ui-btn-icon-notext ui-shadow ui-corner-all"/>').appendTo(u).attr("title",i.More).hide();r.find(".app-btn").data("icon","gear").on("vclick",ed)}();n=r.touch=r.mobile=new Web.Mobile;n.activeLinkBlacklist=".ui-slider-handle,.dv-action-see-all,.app-do-not-activate";n._presenters={};c.on("pagecontainercreate",function(){n.start()}).on("pagecontainerbeforeshow",function(t,i){var e=f.activePage,u=s(),r=u?u.headerText:n.title();r&&typeof r!="string"&&(r=r[0]);r==!1&&(r="");n.toolbar(r);wy(u);n.pageShow(et());n.unloadPage(i.prevPage,e);cl();n.contextScope(null)}).on("pagecontainerbeforehide",function(){tt=!0;n.busy(!0)}).on("pagecontainerbeforechange",function(n,t){if(typeof t.toPage=="string"&&t.toPage.match(/^http/)&&as)return as=!1,!1}).on("pagecontainerbeforetransition",function(i,u){if(u.toPage&&u.prevPage){var h=$(u.toPage).attr("id"),c=s(h),l=$(u.prevPage),o=l.attr("id"),a=s(o),e=a&&a.dataView,v,y;if(h==o||c&&c.deleted)return!1;if(e&&(v=e._dismissAll,e._dismissAll=!1,u.options.reverse&&e.editing()&&(!t.cancel()||!e.changed("ignore"))))return y=l.attr("data-url"),setTimeout(function(){wg(o);r.confirm(ct.DiscardChanges,function(){e.changed("ignore",!0);li()},function(){t.focus()})}),i.preventDefault(),!1}dt();n.promo(!1);hl(f.activePage);yl(eh())}).on("pagecontainershow",function(){f.activePage&&bw(f.activePage)}).on("pagecontainertransition",function(n,t){et()!="Main"||t.options.fromPage?bc(t):setTimeout(function(){bc(t)})});r.dragMan=d=new function(){return this.prototype={active:function(){return this._active==!0},call:function(t,i){if(i.drag){this._dragged=!1;var u=this,r=this[i.drag.type],s=r&&r[t],f=i.drag,o,e;clearTimeout(u._draggedTimeout);t=="start"?(d._keepTap=!1,u._active=!0,e=f.target,o=n.contextDataView(e),f.dataView=o,r&&(!r.options||r.options.taphold!=!1)&&(u._tapholdTimeout=setTimeout(function(){if(u._tapholdTimeout=null,f){if(f.touch)$(document).one("vmouseup pointerup",function(n){n.preventDefault();n.stopPropagation();ac()});var n=$.Event("taphold.app",{drag:f});f.target=e;f.dataView=o;$(e).trigger(n);ns(n)}},750))):d._keepTap||u._tapholdTimeout&&(clearTimeout(u._tapholdTimeout),u._tapholdTimeout=null);r&&s&&(!r.options||!r.options.dataView||f.dataView)&&r[t](i.drag);(t=="end"||t=="cancel")&&(i.drag.dataView=null,u._active=!1,bi(!0))}},dragged:function(n){var t=this;return arguments.length&&(t._dragged=n,n&&clearTimeout(t._draggedTimeout),t._draggedTimeout=setTimeout(function(){t._dragged=!1},200)),t._dragged==!0}}};$(document).on("mousedown pointerdown touchstart","[data-draggable]",function(n){var i;if(au(n),i=n.type,(i!="mousedown"||n.which==1)&&!yt&&!y){gr();dt();var f=ir,o=$(this),r=o.attr("data-draggable"),u=d[r],e=n.originalEvent.pointerType,t=u&&u.options;if(e!="mouse"||n.which!=3)if(yt={x:f.x,y:f.y,lastX:f.x,lastY:f.y,target:o,type:r,data:null,cancel:!1,mouse:e=="mouse"||i=="mousedown",pointer:!!i.match(/^pointer/),touch:e=="touch"||!!i.match(/^touch/),pen:e=="pen",tooltip:t&&t.tooltip},$(document).trigger($.Event("dragstart.app",{drag:yt})),r!=yt.type&&(r=yt.type,u=d[r],t=u&&u.options),yt.cancel)yt=null;else{(yt.dir=="all"||t&&t.immediate)&&(n.preventDefault(),t&&t.immediate&&lv(n,!0));$(document).on("pointermove touchmove mousemove",lv).on("pointerup pointercancel touchend touchcancel mouseup",ns);if(n.isDefaultPrevented())return!1}}}).on("dragstart.app",function(n){d.call("start",n)}).on("dragmove.app",function(n){d.call("move",n)}).on("dragend.app",function(n){d.call("end",n)}).on("dragcancel.app",function(n){d.call("cancel",n)}).on("taphold.app",function(n){d.call("taphold",n)});d.hscrollbar={options:{taphold:!1,immediate:!0},start:function(n){var t=this,i=n.target.parent().prev();i.css("overflow-x")!="auto"&&(i=i.children().first());n.dir="all";t._scrollable=i;n.target.parent().addClass("app-scrollbar-dragging");t._rect=n.target.parent()[0].getBoundingClientRect();t._ratio=t._scrollable[0].offsetWidth/n.target.width();t._offset=n.x-n.target.offset().left},move:function(n){var t=this;t._scrollable.scrollLeft((n.x-t._rect.left-t._offset)*t._ratio)},cancel:function(n){this.end(n)},end:function(n){n.target.parent().removeClass("app-scrollbar-dragging");n.target.parent().prev().focus()}};d.vscrollbar={options:{taphold:!1,immediate:!0},start:function(n){n.dir="all";this._scrollable=n.target.parent().prev();n.target.parent().addClass("app-scrollbar-dragging");this._rect=n.target.parent()[0].getBoundingClientRect();this._ratio=this._scrollable[0].scrollHeight/this._scrollable.height();this._offset=n.y-n.target.offset().top},move:function(n){var t=this;t._scrollable.scrollTop((n.y-t._rect.top-t._offset)*t._ratio)},cancel:function(n){this.end(n)},end:function(n){n.target.parent().removeClass("app-scrollbar-dragging");cr()}};d["grid-header"]={options:{dataView:!0},start:function(n){if(o){var t;n.target.find(".app-field-separator").each(function(){var i=$(this),r=i.offset(),u=n.x-r.left;Math.abs(u)<=22&&(t=i)});t&&(n.originalType=n.type,n.type="grid-header-separator",n.target=t,d["grid-header-separator"].start(n))}}};d["grid-header-field"]={options:{dataView:!0},start:function(n){var t=n.target,i,u=t.offset(),r;n.mouse||(i=t.width(),i>b.gridColumnPadding*2&&(u.left+i-b.gridColumnPadding<n.x?(n.target=t.next(),r=!0):u.left+b.gridColumnPadding>n.x&&t.prev().is(".app-field-separator")&&(n.target=t.prev(),r=!0)));r?(n.originalType=n.type,n.type="grid-header-separator",d["grid-header-separator"].start(n)):n.dir=n.mouse?"all":"horizontal"},move:function(n){var t=this,e=n.dataView,i=t._lastDropTarget,r,h=t._dragLine,g=0,tt,et,l=ei(n.target),a,ot,y,it,st,p=o?30:20,s,u,rt,k,ut=t._mirror;if(s=(l.length?l:f.activePage.find(".app-grid")).find(".dv-item").first(),u=s.offset(),k=e.session("grid-frozen-width")||0,!t._dragLine){tt=w();et=tt.offset();st=!0;i=t._lastDropTarget=n.target;t._targetFieldName=i.attr("data-field-name");a=l.length?l.find(".dv-item").last():null;ot=nt-(a?a.offset().top+a.outerHeight():et.top+tt.outerHeight());h=t._dragLine=$('<div class="app-drag-line"><\/div>').appendTo(c);h.css({top:i.offset().top,bottom:ot});n.target.css("color",h.css("background-color"));d["data-item"]._scrollbar(n,!1);var ft=i.prevAll(".app-field-separator").first(),ht=i.nextAll(".app-field-separator").first(),ct=ft.length?ft.offset().left+Math.ceil(ft.outerWidth()/2):i.offset().left-(o?b.gridColumnPadding/2:2),vt=ht.offset().left+Math.ceil(ht.outerWidth()/2),lt=i.css("padding-top"),at=i.css("padding-bottom");ut=t._mirror=$('<span class="app-drag-header-field"/>').appendTo(c).css({"font-size":i.css("font-size"),paddingLeft:b.gridColumnPadding/2,paddingRight:b.gridColumnPadding/2,paddingTop:lt,paddingBottom:at,textAlign:i.css("text-align")}).width(vt-ct-b.gridColumnPadding).height(i.closest(".app-grid-header").height()-v(lt)-v(at)).text(i.text());t._mirrorDispX=n.x-ct;t._mirrorDispY=n.y-i.offset().top+(n.mouse?0:i.outerHeight());t._mirrorWidth=ut.outerWidth()}s.find(".app-field").each(function(){var t=$(this),i=t.offset();(t.is(".app-frozen")||i.left>u.left+k)&&n.x>=i.left-b.gridColumnPadding/2&&n.x<i.left+t.width()+b.gridColumnPadding/2&&(y=t)});y&&(it=y.attr("class").match(/\bapp-field-([\w\_]+)\b/i),it&&(i=y,t._targetFieldName=it[1]));t._lastDropTarget=i;r=i.prev();r.is(".app-field-separator")?g=Math.ceil(r.outerWidth(!0)/2)+2:(r=i,g=-b.gridColumnPadding/2);r.length&&h.css({transform:"translate3d("+(r.offset().left+g)+"px,0,0)",transition:st||n.instantFeedback?"":"transform 160ms ease-out"});t._mirror.css({left:n.x-t._mirrorDispX,top:n.y-t._mirrorDispY});n.instantFeedback=!1;clearTimeout(t._gridScrollTimeout);rt=s.width();(u.left+rt-(n.x-t._mirrorDispX+t._mirrorWidth-1)<=p||n.x-t._mirrorDispX-(u.left+k)<=p)&&(t._gridScrollTimeout=setTimeout(function(){var r=e.session("grid-avail-width"),o=Math.ceil(r-r*(s.width()/r)),i=e.session("scroll-left")||0,h=n.x-t._mirrorDispX,l=h+ut.outerWidth()-1,c=h-(u.left+k),f;i<o&&u.left+rt-l<=p?(i=Math.min(i+32,o),f=!0):i>0&&c>0&&c<=p?(i=Math.max(i-32,0),f=!0):clearTimeout(t._gridScrollTimeout);f&&(e.session("scroll-left",i),bu(e,-i,!1),n.instantFeedback=!0,n.dropTarget=document.elementFromPoint(ai(),yf()),t.move(n))},100))},end:function(n){var e=this,t=n.dataView,f=t._allFields,o=t.gridSettings(),i=o.sequence,r=n.target.attr("data-field-name"),u=e._targetFieldName;r=f[t.findFieldUnderAlias(r).Index].Name;u=f[t.findFieldUnderAlias(u).Index].Name;i.length||$(t._fields).each(function(){i.push(this.Name)});i.splice(i.indexOf(r),1);i.splice(i.indexOf(u),0,r);this._removeDragState(n);t.gridChanged()},cancel:function(n){this._removeDragState(n)},taphold:function(n){uv(n.target,{x:n.x,samples:!1,hide:!0})},_removeDragState:function(n){var t=this;clearTimeout(t._gridScrollTimeout);n.target.css("color","");t._lastDropTarget=null;t._dragLine&&(t._dragLine.remove(),t._dragLine=null,t._mirror.remove(),t._mirror=null);d["data-item"]._scrollbar(n,!0)}};d["grid-header-separator"]={options:{dataView:!0,taphold:!1,immediate:!0},start:function(n){var t=this,u=w(),i=n.target.prevAll("[data-field-name]").first(),f=ei(i),r=f.length?f.find(".dv-item").last():null,e=nt-(r?r.offset().top+r.outerHeight():u.offset().top+u.outerHeight());t._columnHeader=i;t._left=Math.ceil(i.offset().left);t._minRight=t._left+uo()+n.target.outerWidth()+2;i.next().is(".app-btn-more")&&(t._minRight+=i.next().outerWidth());t._maxRight=t._left+(i.closest(".app-bar-heading").length?w():i.closest(".app-grid")).width()*.75;t._dragLine=$('<div class="app-drag-line"><\/div>').appendTo(c).css({transform:"translate3d("+(n.target.offset().left+Math.floor(n.target.outerWidth()/2))+"px,0,0)",top:n.target.offset().top,bottom:e});t._leftLine=$('<div class="app-drag-line"><\/div>').appendTo(c).css({left:t._left-Math.ceil(b.gridColumnPadding/2),top:i.offset().top,bottom:e});i.css("color",t._dragLine.css("background-color"));n.dir=n.mouse?"all":"horizontal"},move:function(n){var t=this,i=n.x;i<t._minRight&&(i=t._minRight);i>t._maxRight&&(i=t._maxRight);t._right=i;t._dragLine.css("transform","translate3d("+i+"px,0,0)")},end:function(n){var t=this,o=t._dragLine,f=t._right-t._left-n.target.outerWidth()-2,i=n.dataView,r=i.gridSettings(),u=t._columnHeader,e=i.findField(u.attr("data-field-name"));u.next().is(".app-btn-more")&&(f-=u.next().outerWidth());r.width[e.Name]||u.parent(".app-grid-header").find("[data-field-name]").each(function(){var n=$(this),t=n.width();r.width[n.attr("data-field-name")]=t});r.width[e.Name]=f;i.gridSettings(r);d.dragged(!0);t._removeLine(n);pu(i,!1,!0);i.gridChanged()},cancel:function(n){this._removeLine(n)},_removeLine:function(n){var t=this;n.target.prevAll("[data-field-name]").first().css("color","");t._dragLine.remove();t._leftLine.remove();t._columnHeader=null}};d.dismiss={start:function(n){n.dir="all"},move:function(){},end:function(n){this.cancel(n)},cancel:function(n){n.target.trigger("vclick")}};d.panel={start:function(n){var t=this;n.dir="horizontal";t._lastX=t._x=n.x;t._time=+new Date},move:function(n){var t=this,i=n.target,r=t._dir,u=n.x-t._x;t._dir||(r=t._dir=i.is(".ui-panel-position-right")?"right":"left",r=="right"?i.offset().left:i.outerWidth(),i.css({position:"absolute"}),t._animated=i.is(".ui-panel-animate"));t._displacement=u;t._movedBy=n.x-n.lastX;r=="right"?i.css({right:Math.min(0,-t._displacement)}):i.css({left:Math.min(0,t._displacement)});t._lastX=n.x},end:function(n){function c(){f?t.panel("close",!0):t.css({transform:"none",transition:"transform 0 linear",right:e=="right"?0:"",left:e=="left"?0:""});i._done(t)}var i=this,r=i._displacement,t=n.target,u=t.outerWidth(),e=i._dir,s=o?30:10,h=+new Date-i._time<=250,f;if(e=="right")if(v(t,"right")==0)i._done(t);else{f=i._movedBy>=0&&(h&&r>=s||Math.abs(r)>=u*.5);t.css({transition:"transform 300ms ease",transform:"translate3d("+(f?u-r:-r)+"px,0,0)"}).removeClass("ui-panel-animate").one("transitionend",c)}else if(v(t,"left")==0)i._done(t);else{f=i._movedBy<1&&(h&&-r>=s||Math.abs(u+r)<=u*.5);t.css({transition:"transform 300ms ease",transform:"translate3d("+(f?-(u+r):-r)+"px,0,0)"}).removeClass("ui-panel-animate").one("transitionend",c)}},cancel:function(n){this._done(n.target)},_done:function(n){var t=this;t._dir=null;n.css({position:"",transition:"",transform:"",left:"",right:""});t._animated&&setTimeout(function(){n.addClass("ui-panel-animate")},100)}};d["data-item"]={options:{dataView:!0},start:function(n){var t=this,i=n.dataView,s=i.extension().viewStyle(),h=n.target.closest(".app-listview"),r=i.session("grid-avail-width"),f=h.width(),u,e,o;if(s=="Grid"&&r>f){if(i.multiSelect()&&(u=n.target.closest(".ui-btn").find(".app-btn-check"),u.length&&n.x<u.offset().left+u.outerWidth()+8))return;e=f/r;o=Math.ceil(r-r*e);t._maxScroll=o;t._originalX=n.x;t._lastX=n.x;t._listViewWidth=f;t._scrollLeft=i.session("scroll-left")||0;n.dir="horizontal";t._minScroll=v($("span."+ue(i)),"margin-left")+t._scrollLeft;i.session("scroll-left-margin",t._minScroll)}},move:function(n){var t=this,r=n.dataView,u,i=t._scrollLeft;t._scrollbar(n);u=Math.ceil(t._originalX-n.x);i+=u;i<0?(i=0,t._originalX=n.x,t._scrollLeft=i):i>t._maxScroll&&(i=t._maxScroll,t._originalX=n.x,t._scrollLeft=i);n.time=+new Date;r.session("scroll-left",i);bu(r,-i,!0)},end:function(n){this._stopAnimation(n);var r=this._scrollLeft,u=+new Date,f=n.time,e=(u-f)*100,i=n.x-n.lastX;if(e>0&&Math.abs(i)>5){var o=i<0?1:-1,t=r+this._listViewWidth*o;t<this._minScroll?t=0:t>this._maxScroll&&(t=this._maxScroll);n.dataView.session("scroll-left",t);bu(n.dataView,-t,!1,!0)}},cancel:function(n){this._stopAnimation(n)},taphold:function(n){n.target.is(".app-btn-more")?n.target.trigger("vclick"):n.target.trigger("contextmenu")},_stopAnimation:function(n){d.scrollingAnimationFrame!=null&&(cancelAnimationFrame(d.scrollingAnimationFrame),d.scrollingAnimationFrame=null);this._scrollbar(n,!0)},_scrollbar:function(n,t){t?n.hscrollbar&&(ce(n.hscrollbar.parent().parent()),n.hscrollbar=null):n.scrollbarHandled||(n.scrollbarHandled=!0,b.height>0&&(n.hscrollbar=ei(n.target).length?n.target.closest(".app-grid").find(".app-hscrollbar-inner"):f.activePage.find(".app-bar-hscrollbar .app-hscrollbar-inner"),n.hscrollbar.width(1).parent().data("ignore-scrolling",!0),setTimeout(function(){n.hscrollbar&&n.hscrollbar.parent().removeData("ignore-scrolling",!0)},100)))}};$(document).ready(function(){g=__settings;n.initialize()}).on("dragend",function(){$.event.special.swipe.eventInProgress=!1}).on("touchstart pointerdown mousedown",function(n){au(n)}).on("touchstart pointerdown",function(t){if(!$(t.target).is(":input")){if(tt){t.preventDefault();return}var r=$(t.target),i=r.closest("a,.app-feedback"),u=hv=pr(t);cv=!ir.isScrollable;i.length&&(uf=i.data("touch-start",u),i.is(n.activeLinkBlacklist)||(i.parent().is("li")?(clearTimeout(sv),sv=setTimeout(function(){uf&&kt(uf,!1)},250)):o&&kt(i,!1)))}}).on("touchmove pointermove",function(n){var u,f=$(n.target),i=$(uf),e=f.closest(".ui-panel-inner,.app-wrapper"),t=pr(n),r=i.length&&i.data("touch-start"),o;if(gt&&!i.length&&f.closest(".app-bar-toolbar").length){n.preventDefault();return}if(f.is(".ui-panel-dismiss,.ui-popup-screen,.app-scrollable-cover")){n.preventDefault();return}if(cv&&(cv=!1,e.length&&(t.y>hv.y?u=e.scrollTop()==0:t.y<hv.y&&(o=kw(e),u=o.height>=o.maxHeight-1)),u)){ye();kt();n.preventDefault();gt&&(or=!1);return}i.length&&(r&&(r.scrollTop!=t.scrollTop||Math.abs(r.x-t.x)>0||Math.abs(r.y-t.y)>0)&&kt(),ye())}).on("touchend pointerup",function(n){au(n);var i=$(n.target).closest("a"),r=pr(n),t=i.length&&i.data("touch-start");i.length&&(!t||t.scrollTop!=r.scrollTop||Math.abs(t.x-r.x)>0||Math.abs(t.y-r.y)>0)&&n.preventDefault();ye()}).on("touchcancel pointercancel",function(){kt();ye()}).on("scrollstart.app",function(){cl();t.methods.lookup._hidePopup()}).on("scrolldir.app scrollstop.app",function(n){if(n.relatedTarget){var t=$(n.relatedTarget),o=t.find("> .app-listview").filter(":visible"),r=o.find(".app-group"),u,c,a,f;r.length&&(u=gs(kf(t)),u.length&&(group=u.find(".app-group"),group.length||(group=$('<div class="app-group"><\/div>').appendTo(u),$(r[0]).is(".app-group-fixed")&&group.addClass("app-group-fixed")),c=t.offset().top+ru(t).outerHeight(!0),r.each(function(){var n=$(this);if(n.offset().top+n.outerHeight(!0)/2>c)return!1;a=n}),f=(a||$(r[0])).html(),f!=group.html()&&(group.html(f),ru(t).find(".app-group").html(f))));var s=t.data("scroll-dir"),v=o.filter(".app-grid"),y=o.find(".app-group-fixed").first(),e=v.length>0||y.length,h=t.data("sticky-header"),i=e?h.find(".app-view-instruction,.app-group:not(.app-group-fixed)"):null,p=i&&i.parent();s=="up"?(e&&i.length&&!i.is(":visible")&&i.removeClass("app-hidden"),co(h),yr(t)):(s=="down"||!s&&e)&&(e?(i.addClass("app-hidden"),p.addClass("app-bar-text-instruction-hidden"),l._stickyHeaderHideInstruction=!0,yr(t)):h.hide());n.type=="scrollstop"&&(clearInterval(ty),ty=setTimeout(function(n){var i=kw(n);i.top<=0&&i.height<=i.maxHeight+1&&(ae(),er(null,null,t.find(".app-echo")))},250,t))}}).on("contextmenu MSHoldVisual selectstart",function(n){var t,i,r,u;o&&!$(n.target).is(":input")||tt?n.preventDefault():n.type=="contextmenu"?(t=$(n.target),t.is(".ui-popup-screen")?(i=$(".ui-popup-active .ui-popup.app-popup-listview"),i.length&&(tf(i),n.preventDefault(),r=pr(n),u=document.elementFromPoint(r.x,r.y),setTimeout(function(){var n=$(u);n.trigger(n.closest(".app-control-helper").length?"vclick":"contextmenu")},50))):t.closest(".ui-popup").length?n.preventDefault():t.is(".app-has-children")&&(n.preventDefault(),setTimeout(function(){t.trigger("vclick")},50))):n.type=="MSHoldVisual"&&n.preventDefault()}).one("pagecreate","#Main",function(){n._pageCreated=!0}).on("vclick","a",vrt).on("vclick",".app-input-value",function(n){return $(n.target).prev().focus(),!1}).on("vclick",".app-btn-toggle",crt).on("vclick",".app-filter",function(t){var i=ei(t.target);return i.length&&n.contextScope(i.attr("data-for")),gu({mode:"everything"}),!1}).on("vclick","[data-href]",function(){var n=$(this),t=n.attr("data-href"),i=n.closest(".app-field");return i.addClass("app-selected"),setTimeout(function(){i.removeClass("app-selected");var n=t.match(/^(_\w+)\:(.+)$/),f,r;n&&n[1]?(u=n[2],r=n[1]=="_blank"?null:"modal=yes,alwaysRaised=yes,resizable=yes",r?l.open(u,f,r):l.open(u,f)):l.location.href=t},ti),!1}).on("vclick contextmenu",".app-grid-header",function(n){if(d.dragged()||wt){n.preventDefault();n.stopPropagation();return}gr();var t=$(n.target),i={x:n.pageX,y:null};if(!t.is(".app-btn-more"))return t.is(".app-icon")&&(t=t.parent()),pl(n)?wl(rd(t)):(t.attr("data-field-name")||$(this).find("span").each(function(){var i=$(this),r=i.offset().left;if(!i.is(".app-btn-check,.app-btn-more")&&r<=n.pageX&&n.pageX<r+i.outerWidth(!0))return t=i,!1}),t.is(".app-frozen-spacer")&&(t=t.next()),t.is("span")&&!t.is(".app-btn-check,.app-field-separator")&&(t.addClass("ui-btn-active"),i.x&&(i.y=t.offset().top+t.outerHeight()*.75),(n.type=="contextmenu"||n.type=="vclick"&&n.ctrlKey)&&(i.samples=!1,i.hide=!0),n.preventDefault(),setTimeout(function(){t.removeClass("ui-btn-active");uv(t,i)},ti))),!1}).on("vclick contextmenu",".app-bar-heading",function(n){var t=$(n.target);if(t.closest(".app-group").length&&!t.is(".app-group"))return pa(!0),!1}).on("editorstart.app",wn).on("editorstop.app",bn);gi.on("resize",function(){o||(p=gi.width(),nt=gi.height(),prt())}).on("throttledresize",function(){ki(!0)}).on("orientationchange",function(){p=gi.width();nt=gi.height();ki(!0)});$(document).on("mousedown",function(){var n=vt&&vt[0];n&&n.display!="none"&&!n.className.match(/\bapp-tooltip-message\b/)&&dt()}).on("mousemove",function(n){n.pageX!=null&&(hf=n.pageX,cf=n.pageY)}).on("vclick",".app-tooltip-message",function(){dt()}).on("mouseenter","[title]",function(n,t){var i=$(this),r=i.attr("title"),u=hf,f=cf;if(r){if(hg){r&&(i.attr("title",null),setTimeout(function(){i.attr("title",r)},1e3));return}i.attr("title","").data("title",r);clearTimeout(lf);lf=setTimeout(function(){if(lf=null,!y||y.tooltip){var n=i.offset();i[0].namespaceURI==og&&Math.abs(u-hf)<=11&&Math.abs(f-cf)<=11||hf>=n.left&&hf<n.left+i.outerWidth()&&cf>=n.top&&cf<n.top+i.outerHeight()?vv(hf,cf+23,r,i):vt&&!vt[0].className.match(/\bapp-tooltip-message\b/)&&vt.hide()}},t!=null?t:sg)}}).on("mouseleave","[title]",function(){var n=$(this),t=n.data("title");t&&n.attr("title",t);vt&&!vt[0].className.match(/\bapp-tooltip-message\b/)&&dt()});t=r.input={methods:{none:{render:bt},text:{render:function(n){var s=n.container,f=n.inner,l=n.row,i=n.field,h=i._dataView,c=n.originalField,o,e,r,u;c||i.Index==i.AliasIndex||(i=h._allFields[i.AliasIndex]);e=l[i.Index];e==null?(r=n.editing?t.fieldToPlaceholder(c||i):"",s.addClass("app-null")):(i.ItemsStyle&&i.ItemsStyle!="Lookup"&&i.ItemsStyle!="AutoComplete"?(o=h._findItemByValue(i,e),o&&(r=o[1])):r=i.text(e),i.TextMode==1&&(r=new Array(r.length+1).join("*")),s.removeClass("app-null"));i.Rows&&!i.ItemsTargetController&&n.inner.css({"min-height":i.Rows+"em"}).addClass("app-text-multiline");r?i.HtmlEncode?f.text(r):f.html(r):f.html("&nbsp;");lo(f,i,e,r,!0)&&f.attr("title",r);n.editing&&(i.Type.match(/^(Byte|Currency|Decimal|Double|Int16|Int32|Int64|Single|SByte|UInt16|UInt32|UInt64)$/)?u="number":oa(i)?u="tel":sa(i)?u="email":ytt(i)&&(u="url"),u&&n.container.attr("data-type",u));this._createFooter(n)},focus:function(n){var t=n.closest("[data-input]").find(".app-data-input");if(t.length)t.focus();else return wrt(n)},_createFooter:function(n){var i=n.container,f=n.inner,u=n.field,r=n.originalField,t;r||(r=u);r.FooterText?(t=i.find(".app-control-footer"),t.length||(t=$('<span class="app-control-footer"/>')),t.appendTo(i.addClass("app-has-footer")),t.html(r.FooterText)):i.is(".app-has-footer")&&i.removeClass("app-has-footer").find(".app-control-footer").remove()}},blob:{render:function(n){var w=n.container,f=n.inner,i=n.field,s=i._dataView,c=n.row,v=n.editing,l=c[i.Index],h,a;if(!l||l.match(/^null/))h=t.fieldToPlaceholder(i),w.addClass("app-null"),f.text(h);else{h=l;v||(a=f.find(".app-drop-box"),a.length&&r.upload("destroy",{container:a}));f.empty();var y=s.resolveClientUrl(s.get_appRootPath()),u=$('<a rel="external"/>').appendTo(f).attr("href",String.format("{0}blob.ashx?{1}=o|{2}",y,i.OnDemandHandler,h)),e,p=i.Name.toLowerCase();i.OnDemandStyle!=1?(u.addClass("app-has-image"),$("<img/>").appendTo(u).attr({src:String.format("{0}blob.ashx?{1}=t|{2}&_nocrop",y,i.OnDemandHandler,h),title:ct.BlobDownloadHint}),$(s._allFields).each(function(){var n=this,t=n.Name.toLowerCase();if(t==p+"contenttype"||t==p+"content_type")return e=c[n.Index],!1}),$(s._allFields).each(function(){var n=this,t=n.Name.toLowerCase();if(t=="contenttype"||t=="content_type")return e=c[n.Index],!1}),e||(e="image"),e.match(/^image/i)?u.attr("data-content-type",e):o||u.attr("target","_blank")):(u.appendTo(f).addClass("app-link-blob").attr("title",ct.BlobDownloadHint),$('<span class="glyphicon glyphicon-download"> <\/span>').appendTo(u),$("<span/>").text(ct.BlobDownloadLink).appendTo(u),o||u.attr("target","_blank"))}v&&r.upload("create",{container:$('<div tabindex="0"><\/div>').appendTo(f).addClass("drop-box-"+i.Index),dataViewId:s._id,fieldName:i.Name,change:function(){ki(!1)}});t.methods.text._createFooter(n)},focus:function(n){if(!n.is(":input"))return n.find(".app-drop-box").focus(),!0}},checkbox:{render:function(n){var f=n.container,i=n.inner,r,e=n.field,o=e.Items,u,s=n.editing,h=n.row[e.Index];u=o[o.length-1][0]==h;h==null?i.html(rg):ft("material-icon-"+(u?"check-box":"check-box-outline-blank"),i.empty());i.css("visibility",s?"hidden":"");s?(r=$('<div class="app-checkbox-container" tabindex="0"><\/div>').appendTo(t.createContainer(f)),u&&r.addClass("app-checkbox-on"),$('<a class="app-checkbox-button" />').appendTo(r)):f.find(".app-data-input-container").remove();t.methods.text._createFooter(n)},focus:function(n,t){var i=n.find(".app-checkbox-container").focus();return t&&t.is('[data-control="label"]')&&this._toggleState(i),!0},click:function(n){var i=ai(n.clientX),t=$(n.target).closest("[data-input]").find(".app-checkbox-container");t.offset().left-8<=i&&i<=t.offset().left+t.outerWidth()+8&&(this._toggleState(t),n.preventDefault())},_toggleState:function(n){var r=n.is(".app-checkbox-on"),f=n.find(".app-checkbox-button"),u=n.closest("[data-checkbox-style]").attr("data-checkbox-style"),i;if(t.cancel()){if(dt(),n.toggleClass("app-checkbox-on"),u!="circle"&&u!="square")if(r)n.addClass("app-checkbox-on app-animation").addClass("app-animate-off").one("transitionend",function(){setTimeout(function(){n.removeClass("app-animation").removeClass("app-checkbox-on app-animate-off")})});else n.addClass("app-animation").addClass("app-animate-on").one("transitionend",function(){n.removeClass("app-animation").removeClass("app-animate-on")});i=t.elementToField(n);t.execute({dataView:i._dataView,values:[{name:i.Name,value:!r}],redraw:!1})}}},lookup:{render:function(n){var f=n.originalField=n.field,a=f.ItemsTargetController;n.field=n.dataView._allFields[n.field.AliasIndex];var o=n.inner,s=n.container,e=s.find(".app-data-input-button"),w=s.data("node"),c=n.editing,l,h,y,u,p;!c&&a?t.methods.listbox.render(n):(c&&!e.is(".app-data-input-button")&&(e=$('<span class="app-data-input-button"><span class="app-caret"><\/span><\/span>').insertAfter(o).attr("title",ou.Select.HeaderText),l=f.ItemsStyle,l=="Lookup"?e.addClass("app-caret-r"):l=="DropDownList"&&$('<span class="app-caret app-caret2"><\/span>').appendTo(e.addClass("app-caret-u-d"))),c?o.css("max-width",w.self.width()-(e.outerWidth()||22)-v(o,"padding-left")*2):(e.length&&e.is(".app-data-input-button")&&e.remove(),o.find(".app-control-before").remove(),s.removeClass("app-null app-has-helper")),a?(h=s.find(".app-control-before"),h.length||(o.text(t.fieldToPlaceholder(f)),s.addClass("app-null app-has-helper"),h=$('<span class="app-control-before app-control-helper" tabindex="0"/>').insertBefore(o),p=$("<ul/>").appendTo(h),y=f.DynamicItems||f.Items,u=n.row[f.Index],u||(u=""),typeof u!="string"&&(u=u.toString()),u?(u=u.split(r._simpleListRegex),$(y).each(function(n){var t=this,i=t[0],r;u.indexOf(i.toString())!=-1&&(r=$("<li/>").text(t[1]).attr("data-index",n).appendTo(p))})):h.hide())):t.methods.text.render(n),c||!f.ItemsDataController||n.row[f.Index]==null||f.tagged("lookup-details-hidden")||$('<span class="app-field-object-ref app-feedback"/>').appendTo(o).attr("title",i.LookupViewAction))},focus:function(n){var r=n.find(".app-control-helper"),s=r.data("focus")==!1,f=n.find("li"),e,u,i,o;return(r.removeData("focus"),!s&&f.length)?t.valid()?(e=n.closest("[data-input]"),e.addClass("app-has-focus"),r.focus(),f.removeClass("app-focus").first().addClass("app-focus"),!0):!1:(u=t.methods.text.focus(n),u&&(i=t.elementToField(n),o=i._dataView.editRow(),n.data("autoComplete")==!1?n.removeData("autoComplete"):o[i.Index]==null&&(t.elementToButton(n).removeClass("app-caret-r"),i.ItemsStyle=="Lookup"&&this._showList({field:i,value:null,input:n.closest("[data-input]").find(".app-data-input")}))),u)},click:function(r){var e=t.eventToButton(r),h=e.offset(),c=ai(r.clientX),u=$(r.target),f=u.closest("[data-input]");if(u.is("li")){if(!t.cancel())return r.preventDefault(),!1;if(f.find(".app-data-input").length){r.preventDefault();f.find(".app-data-input").blur();setTimeout(function(){u.trigger("vclick")},100);return}function l(){f.removeClass("app-has-focus");u.removeClass("app-focus")}u.is(".app-focus")||u.parent().find("li").removeClass("app-focus");f.find(".app-data-input").blur();var a=f.find(".app-control-helper").blur(),s=t.elementToField(u),v=[{text:ou.Delete.HeaderText,icon:"trash",callback:function(){t.methods.lookup._removeBasketItem(u,!0);a.focus()}}];s.tagged("lookup-details-hidden")||v.push({text:i.LookupViewAction,icon:"carat-r",callback:function(){l();n.details({field:s,key:s.Items[parseInt(u.attr("data-index"))][0]})}});f.addClass("app-has-focus");u.addClass("app-focus");rt({anchor:u,items:v,autoFocus:!1,afterclose:function(n,t){o?l():t||a.focus()}});r.preventDefault()}else u.closest(".app-control-helper").length?u.closest(".app-control-helper").focus():f.attr("data-input")=="dropdownlist"&&!f.find(".app-data-input").length&&o?(r.preventDefault(),this.lov(f)):e.length&&h.left<=c&&c<h.left+e.outerWidth()+8&&this.clickButton(r)&&r.preventDefault()},clickButton:function(i,r){function y(){e.removeClass("ui-btn-active");s=u._dataView;c=s._allFields[u.AliasIndex];l=s.editRow();n.lookup({field:u,value:v?l[u.Index]:null,text:v?c.format(l[c.Index]):null,change:function(n){if(u.ItemsTargetController){if(n.length>=2)if(t.methods.lookup._useItemValue(u,[n[0].value,n[1].value]))o||f.find(".app-control-helper").data("focus",!1);else{f.addClass("app-has-focus").find(".app-control-helper").focus();return}}else t.execute({dataView:s,values:n});o||setTimeout(function(){a.focus(f)},100)}})}var e=t.eventToButton(i),a=t.elementToMethod(e),f=e.closest("[data-input]"),h=f.find(".app-data-input").length>0,u=t.eventToField(i),s,c,v=!u.ItemsTargetController,l;return!h&&!t.cancel()?!1:(h&&t.popup(":visible")?(t.popup("hide"),t.methods.lookup._buttonUp(e)):u.ItemsStyle!="Lookup"?(e.removeClass("ui-btn-active"),h||(f.find(".app-control-helper").data("focus",!1),a.focus(f)),f.find(".app-data-input").trigger($.Event("keydown",{ctrlKey:!0,which:32}))):r!=!1?(e.addClass("ui-btn-active"),setTimeout(y,ti)):y(),ac(),!0)},blur:function(n){var i=$(n.target),u=i.closest("[data-input]"),f=u.find(".app-control-inner"),e=i.data("restoreText"),r=t.eventToField(n);r.ItemsTargetController?(f.text(t.fieldToPlaceholder(r)),t.fitContainer(u)):e!=null&&f.text(e);this._buttonUp(i);t.popup("hide");clearTimeout(r._showListTimeout)},setup:function(n){var i=t.eventToField(n);n.change=function(n){var o=i._dataView,r=n.input,f,e,u;if(n.value?i.AllowAutoComplete==!1&&(r.val(r.data("original")).select(),n.value=""):(t.popup(":visible")||i.AllowAutoComplete==!1||i.ItemsStyle=="DropDownList")&&(clearTimeout(i._showListTimeout),r.val(""),r.removeData("restoreText"),t.popup("hide"),t.methods.lookup._clearValue(i),f=!0,r.data("original",""),i.ItemsTargetController&&(u=r.closest("[data-input]"),u.find(".app-control-inner").text(t.fieldToPlaceholder(i)),t.fitContainer(u))),e=t.elementToButton(r),e.removeClass("app-caret-r"),r.data("autoComplete")==!1)r.removeData("autoComplete"),clearTimeout(i._showListTimeout);else{if(!n.value&&(f||t.methods.lookup._clearValue(i),i.ItemsTargetController&&n.keyCode))return;t.methods.lookup._showList({field:i,value:n.value,originalValue:r.data("original"),input:r,keyCode:n.keyCode})}}},lov:function(n){function c(n){var t=e[n];r.input.methods.lookup._useItemValue(i,t)}var i=t.elementToField(n),u=i._dataView,f=u._allFields[i.AliasIndex],s=u.editRow(),e=i.DynamicItems||i.Items,h=s[i.Index],o=[];$(e).each(function(n){var t=this;o.push({text:f.format(t[1]),icon:h==t[0]?"check":!1,callback:c,context:n})});rt({x:ai(),y:yf(),title:f.HeaderText,anchor:n.find(".app-control-inner"),items:o})},_clearValue:function(n){if(!n.ItemsTargetController){var e=n._dataView,u=[{name:n.Name,value:null}],o=n.Copy,f,i;if(n.Index!=n.AliasIndex&&u.push({name:e._allFields[n.AliasIndex].Name,value:null}),o)while(i=r._fieldMapRegex.exec(o))i=i[1],f=n._dataView.findField(i),(f&&f.ReadOnly||i=="null")&&u.push({name:i,value:null});t.execute({dataView:e,values:u})}},_hidePopup:function(){if(!o&&t.popup(":visible")){t.popup("hide");var n=$(".app-data-input").closest("[data-input]").find(".app-data-input-button");n.length&&this._buttonUp(n)}},_buttonUp:function(n){var i=t.elementToField(n);n.is(".app-data-input-button")||(n=t.elementToButton(n));i&&i.ItemsStyle=="Lookup"&&n.addClass("app-caret-r");n.removeClass("app-caret-u app-caret-d")},_getCopyFields:function(n){var o=n.Copy,i,t,u,f,e;if(o&&(i=n._dataView,t=t=i.session(n.Name+"_copyFields"),!t)){for(t=[];u=r._fieldMapRegex.exec(o);)f=u[1],e=u[2],(i.findField(f)||e=="null")&&t.push({fromField:e,toField:f});i.session(n.Name+"_copyFields",t)}return t},_showList:function(n){function ft(r){var yt,pt,a,c,wt,tt,bt,kt,dt;f=o.val();var ut=h.data("ul"),a,c,ft=o.offset(),gt=o.outerHeight(),ni=w(o),ti=ni.offset(),oi=hu(ni),d,l,ii=f&&RegExp.escape(f),si=f?new RegExp(k?ii:"^"+ii+".*","i"):null,e,at=0,ri,g,ot,ht,ct,lt,s,ui,fi,vt,et;if(h.data("list",r).css({width:"","max-width":"","min-width":"","max-height":"",height:""}).removeClass("app-wrap"),ut.empty(),h.show(),$(r).each(function(o){var h=this,s,c;h.totalRowCount?f.length>=h.value.length&&at<h.totalRowCount&&$('<li class="app-instruction"/>').appendTo(ut).text(String.format(i.ShowingItemsRange,at,h.totalRowCount)):h.text?(c=$("<li/>").appendTo(ut).text(h.text),h.instruction&&c.addClass("app-instruction"),h.command&&(c.attr("data-command",h.command),h.command=="SeeAll"&&$('<span class="app-icon app-caret-r"><span class="app-caret"/><\/span>').appendTo(c))):(s=h[1],e=s?s.toString().match(si):null,(u.AllowNulls||h[0]!=null||!f||f==s)&&(b||!f&&(u.ItemsStyle=="AutoComplete"||u.ItemsStyle=="Lookup")||f&&s&&(e||s==f||f==n.originalValue))&&(at++,s!=null&&(s=s.toString()),c=$("<li/>").appendTo(ut).attr("data-index",o),!ri&&e&&(l=s,d=c,ri=h[0]!=null),e&&k&&f!=n.originalValue?(e.index&&$("<span/>").text(s.substring(0,e.index)).appendTo(c),$("<b/>").text(s.substring(e.index,e.index+e[0].length)).appendTo(c),e.index+e.length<s.length-1&&$("<span/>").text(s.substring(e.index+e[0].length)).appendTo(c)):e&&!k?($('<span class="app-text-normal"/>').text(s.substring(0,f.length)).appendTo(c),$('<span class="app-text-bold"/>').text(s.substring(f.length)).appendTo(c)):c.text(s==null?st.EmptyValue:s),s==fi&&h.length>2?(et=t.methods.lookup._itemToDetails(u,h),et&&$("<i/>").text(et).appendTo(c),vt||(et=t.methods.lookup._itemToDetails(u,r[o-1]),et&&$("<i/>").text(et).appendTo(c.prev()),vt=!0)):vt=!1,fi=s))}),!d&&f&&r[0].text!=st.Loading&&r[0].text!=i.NoMatches&&(yt=$('<li class="app-instruction"/>').text(i.NoMatches),pt=ut.find("li:first"),pt.length?yt.insertBefore(pt):yt.appendTo(ut),a=it.parent(),c=a.find(".app-control-inner"),c.length&&o.data("restoreText")==null&&o.data("restoreText",c.text()),c.text(f+""),t.fitContainer(a,it)),g=Math.max(ut[0].getBoundingClientRect().width+2,rt.length?rt.offset().left-ft.left+rt.outerWidth():0),g=Math.min(g,oi*.9),h.addClass("app-wrap"),h.css({width:g,"max-width":g,"min-width":g}),ot=ft.left-1,ct=ft.top-1,ht=ft.top+gt,lt=nt-(ft.top+gt),s=h.outerHeight(),lt<s?ct>lt?(ui=!0,s=ct<s?ct:""):s=lt:s="",s&&(s-=4),s=s||h.outerHeight(),ui&&(ht=ft.top-s,wt=t.elementToButton(o),wt.is(".app-caret-u-d")||wt.addClass("app-caret-u")),ot+g+ti.left>p-10&&(ot=p-ti.left-1-g-10),h.css({left:ot,top:ht,"max-height":s,height:s}),d){if(d.addClass("app-selected"),tt=d.position().top-(s-d.outerHeight())/2,l=l.trim(),bt=f.length<l.length,bt&&!k&&n.keyCode!=8)a=o.closest("[data-input]"),c=a.find(".app-control-inner"),c.length&&o.data("restoreText")==null&&o.data("restoreText",c.text()),l=f+l.substring(f.length),c.text(l),t.fitContainer(a,o.closest(".app-data-input-container").width("")),o.data("autoComplete",!1),o.val(l)[0].setSelectionRange(f.length,l.length),o.removeData("autoComplete");else if(u.ItemsStyle=="DropDownList"&&!bt&&o[0].selectionStart==0&&o[0].selectionEnd==l.length){tt=h.css("left",-1e4).scrollTop(tt).scrollTop();var hi=d.offset().top,ft=o.offset(),y=ht-(hi-ft.top)-1,ei=h.outerHeight();y<0?(y-=4,h.find("li").last().css("margin-bottom",-y),tt=Math.ceil(tt-y),y=4):y+ei>nt&&(kt=nt-ei-4,dt=y-kt,y=kt,h.find("li").first().css("margin-top",dt),tt=Math.floor(tt-dt));h.css({top:y,left:ot-v(d,"padding-left")})}h.scrollTop(tt)}else o.val()||(a=o.closest("[data-input]"),c=a.find(".app-control-inner"),c.length&&o.data("restoreText")==null&&o.data("restoreText",c.text()),t.fitContainer(a,o.closest(".app-data-input-container").width("")))}function ct(n){h.is(":visible")&&h.data("field")==l._id+"_"+u.Name&&(e.splice(0,1),ft([[null,n.get_message()]].concat(e)))}function lt(){for(var p=u.ItemsDataController,c=u.ItemsDataTextField,b=u.ItemsDataValueField,y=l.editRow(),w=[c],a=l.get_contextFilter(u,l.extension().collect()),k=f!=n.originalValue?[c+":$"+ht+"$%js%"+r.serializer.serialize(f)]:[],v=0;v<a.length;)a[v].Value==null?a.splice(v,1):v++;h.data("field",l._id+"_"+u.Name);$(t.methods.lookup._getCopyFields(u)).each(function(){this.fromField!="null"&&w.push(this.fromField)});r.execute({controller:p,view:u.ItemsDataView,sync:y[tt.Index]==f?y[u.Index]:null,lookupContext:{Controller:l._controller,View:l._viewId,FieldName:u.Name},_filter:k,sortExpression:c,format:!0,pageSize:us,fieldFilter:w,externalFilter:a,distinct:u.tagged("lookup-distinct"),success:function(n){if(s(l)&&o.parent().length){var t=[],r=n[p];$(r).each(function(){var i=this,r=[i[b||n.primaryKey[0]],i[c]];et&&$(et).each(function(){r.push(i[this.fromField])});t.push(r)});u.ContextFields||l.session(u.Name+"_listOfValues_"+(y[tt.Index]==f?"":f).toLowerCase(),t);e.splice(0,1);r.length<n.totalRowCount&&t.push({totalRowCount:n.totalRowCount,value:f});h.is(":visible")&&h.data("field")==l._id+"_"+u.Name&&(u.ItemsStyle!="Lookup"||f?e=t.concat(e):(e.splice(0,1),e=t.concat(e),e.splice(0,0,{text:ot,instruction:!0})),e.length||(e=[{text:i.NoMatches,instruction:!0}]),ft(e))}},error:ct})}var u=n.field,l=u._dataView,b=u.ItemsStyle!="Lookup"&&u.ItemsStyle!="AutoComplete",et=this._getCopyFields(u),d,g,ot=i.TypeToSearch,tt=l._allFields[u.AliasIndex],ht=tt.AutoCompleteAnywhere?"contains":"beginswith",k=ht=="contains",f=n.value||"",c,h=t.popup(),o=n.input,it=o.parent(),rt=t.elementToButton(o),ut,a,y,e=[];if(dt(),it.length){if(u.ItemsTargetController&&o.closest("[data-input]").find(".app-control-before .app-focus").removeClass("app-focus"),b)e=u.DynamicItems||u.Items;else{if(u.AllowAutoComplete!=!1)if(f||u.ItemsStyle=="AutoComplete"){if(c=f.toLowerCase(),!u.ContextFields){for(a=l.session(u.Name+"_listOfValues_"+c);!a&&c.length;)if(c=c.substring(0,c.length-1),a=l.session(u.Name+"_listOfValues_"+c),a&&a.length>=us){a=null;break}while(a&&c.length){for(c=c.substring(0,c.length-1),y=l.session(u.Name+"_listOfValues_"+c);!y&&c.length;)if(c=c.substring(0,c.length-1),y=l.session(u.Name+"_listOfValues_"+c),y&&y.length>=us){y=null;break}y&&y.length<us&&(a=y)}}a?e=e.concat(a):(e.push({value:null,text:st.Loading,instruction:!0}),ut=!0)}else e.push({value:null,text:ot,instruction:!0});u.ItemsStyle=="Lookup"&&(u._doSearch?(u._doSearch=!1,a=u.ContextFields?null:l.session(u.Name+"_listOfValues_"),a?e=e.concat(a):(ut=!0,e.splice(1,0,{value:null,text:st.Loading,instruction:!0}))):f||e.push({text:i.ShowOptions,command:"ShowOptions"}),e.push({text:i.SeeAll,command:"SeeAll"}))}t.canCreateItems(u)&&(b&&(e=e.slice(0)),e.push({text:ef.GenericNewToolTip,command:"New"}));!b&&n.originalValue&&e.push({text:i.LookupClearAction,command:"Clear"});e.length||e.push({text:i.NoMatches,instruction:!0});ft(e);ut&&(clearTimeout(u._showListTimeout),u.ItemsDataValueField||(g=u.ItemsDataController+"_"+u.ItemsDataView+"_DataValueField",u.ItemsDataValueField=r.cache[g]),u.ItemsDataTextField||(d=u.ItemsDataController+"_"+u.ItemsDataView+"_DataTextField",u.ItemsDataTextField=r.cache[d]),u.ItemsDataTextField&&u.ItemsDataValueField?u._showListTimeout=setTimeout(lt,300):r.execute({controller:u.ItemsDataController,view:u.ItemsDataView,requiresData:!1,success:function(n){u.ItemsDataValueField=n.primaryKey[0].Name;u.ItemsDataTextField=n.fields[0].Name;r.cache[g]=u.ItemsDataValueField;r.cache[d]=u.ItemsDataTextField;lt()},error:ct}))}},_itemToDetails:function(n,t){var f=[],u=2,e=n.Copy,i,o;if(e)while(o=r._fieldMapRegex.exec(e))i=n._dataView.findField(o[1]),i&&!i.Hidden&&!i.OnDemand&&i.Index==i.AliasIndex&&t&&t[u]!==undefined&&f.push(n.format(t[u])),u++;return f.join("; ")},_rowToValues:function(n,t,i){var p=n._dataView._allFields[n.AliasIndex],y=n.Copy,o=n.ItemsDataValueField,s=n.ItemsDataTextField,e,u,c,h,l,a=null,v=null,f;if(o||$(t._allFields).each(function(){if(this.IsPrimaryKey)return o=this.Name,!1}),s||$(t._allFields).each(function(){var n=this;if(!n.Hidden&&!n.OnDemand)return s=n.Name,!1}),e=t.findField(o),u=t.findField(s),i&&(v=i[u.Index],a=i[e.Index]),e)if(u){if(n.ItemsTargetController&&u)e&&(f=[{name:e.Name,value:a}]),u&&f.push({name:u.Name,value:v});else if(f=[{name:n.Name,value:a}],n.Index!=n.AliasIndex&&f.push({name:p.Name,value:v}),y)while(c=r._fieldMapRegex.exec(y))l=c[2],h=t.findField(l),(h||l=="null")&&f.push({name:c[1],value:h&&i?i[h.Index]:null})}else r.alert("Invalid text field "+s);else r.alert("Invalid value field "+o);return f},_removeBasketItem:function(n,i){if(n.length){var o=n.closest("[data-input]"),e=t.elementToField(n),s=e._dataView,h=s.editRow(),u=(h[e.Index]||"").split(r._simpleListRegex),c=e.Items[parseInt(n.attr("data-index"))],f;i?(f=n.next(),f.length||(f=n.prev())):(f=n.prev(),f.length||(f=n.next()));f.addClass("app-focus");n.remove();u.splice(u.indexOf((c[0]||"").toString()),1);u.length||(u=null);o.data("redraw",!1);t.execute({dataView:s,values:[{name:e.Name,value:u?u.join(","):u}]});u||(o.find(".app-control-helper").hide(),t.methods.lookup.focus(o))}},_createItemFromText:function(i,u,f){function h(){n.lookup({field:i,create:!0,dataInput:u,value:f})}var c=i.ItemsDataController,s=i.ItemsNewDataView,e=i.ItemsDataValueField,o=i.ItemsDataTextField;!n.busy()&&f&&i.ItemsDataController&&(s&&e&&o&&!i.Copy?(t.popup("hide"),r.execute({controller:i.ItemsDataController,view:s,command:"Insert",values:[{field:e},{field:o,newValue:f}],done:function(n){if(n.rowsAffected&&!n.errors.length){var r=n[i.ItemsDataController],u=[r[e],r[o]];$(".app-data-input").removeData("restoreText");t.methods.lookup._useItemValue(i,u)}else h()}})):h())},_useItemValue:function(n,i){var o=i[0],u=i[1]||"",c=n._dataView,y=c.editRow(),p=c._allFields[n.AliasIndex],r=$(".app-data-input"),e=r.closest("[data-input]"),b=e.find(".app-control-inner"),d,l,s,h,k,v;if(o==null)t.methods.lookup._clearValue(n),k=t.fieldToPlaceholder(n),r=e.find(".app-data-input").val(r.val()?k:""),t.fitContainer(e,r.closest(".app-data-input-container")),r.length&&r[0].setSelectionRange(0,k.length);else{if(n.ItemsTargetController){if(s=y[n.Index]||"",o!=null&&(o=o.toString()),$(s.split(",")).each(function(n){if(o==this)return d=n,!1}),h=d==null,$(n.Items).each(function(n){var t=this,i=t[0]!=null?t[0].toString():i;if(i==o)return l=n,!1}),h&&(s&&(s+=","),s+=o,l==null&&(n.Items.push(i),l=n.Items.length-1)),f.activePage.find('[data-input-container="'+c._id+'"] [data-control="field"][data-field="'+n.Name+'"]').each(function(){var t=$(this),n=t.find(".app-control-helper");n.length&&(n.find("li").removeClass("app-focus"),h?($("<li/>").text(u).attr("data-index",l).appendTo(n.show().find("ul")),t.data("redraw",!1)):n.find('li[data-index="'+l+'"]').addClass("app-focus").closest("[data-input]").addClass("app-has-focus"))}),u="",r.length){r.data({original:u,last:u}).val(u)[0].setSelectionRange(0,0);e.find(".app-data-input-placeholder").show();b.text(t.fieldToPlaceholder(n));b.css("width","");t.fitContainer(e,r.closest(".app-data-input-container").width(""));h||e.addClass("app-has-focus").find(".app-control-helper").focus();var g=e.offset(),nt=e.outerHeight(),a=w(r),tt=a.height(),it=a.offset();g.top+nt>it.top+tt&&a.scrollTop(a.scrollTop()+(g.top+nt-(it.top+tt)+4))}return h&&t.execute({dataView:c,values:[{name:n.Name,value:s}]}),h}r.length&&r.data({original:u,last:u}).val(u)[0].setSelectionRange(0,u.length);b.text(u);r.length&&t.fitContainer(e,r.closest(".app-data-input-container").width(""));e.find(".app-data-input-placeholder").hide();(y[n.Index]!=o||y[p.Index]!=u)&&(v=[{name:n.Name,value:o}],n.Index!=p.Index&&v.push({name:p.Name,value:u}),$(t.methods.lookup._getCopyFields(n)).each(function(n){v.push({name:this.toField,value:this.fromField=="null"?null:i[n+2]})}),t.execute({dataView:c,values:v}))}}},autocomplete:{render:function(n){t.methods.lookup.render(n)},focus:function(n){return t.methods.lookup.focus(n)},click:function(n){t.methods.lookup.click(n)},clickButton:function(n,i){return t.methods.lookup.clickButton(n,i)},blur:function(n){t.methods.lookup.blur(n)},setup:function(n){t.methods.lookup.setup(n)}},dropdownlist:{render:function(n){t.methods.lookup.render(n)},focus:function(n){return t.methods.lookup.focus(n)},click:function(n){t.methods.lookup.click(n)},clickButton:function(n,i){return t.methods.lookup.clickButton(n,i)},blur:function(n){t.methods.lookup.blur(n)},setup:function(n){t.methods.lookup.setup(n)}},radiobuttonlist:{render:function(n){t.methods.listbox.render(n)},focus:function(n){return t.methods.listbox.focus(n)},click:function(n){t.methods.listbox.click(n)},clickButton:function(n,i){return t.methods.listbox.clickButton(n,i)},blur:function(n){t.methods.listbox.blur(n)}},checkboxlist:{render:function(n){t.methods.listbox.render(n)},focus:function(n){return t.methods.listbox.focus(n)},click:function(n){t.methods.listbox.click(n)},clickButton:function(n,i){return t.methods.listbox.clickButton(n,i)},blur:function(n){t.methods.listbox.blur(n)}},listbox:{render:function(n){var f=n.inner,w,i,c,u=n.field,s,a,k=n.row,l,d=u.Columns,o,g=u.DynamicItems||u.Items,v,e,h,y,p,nt;if(s=k[u.Index],n.editing){if(l=t.canCreateItems(u,k),e=g.length,d?o=Math.ceil((e+(l?1:0))/d):(o=u.Rows,o||(o=5)),n.container.removeClass("app-null"),y=f.find(".app-focus").text(),i=f.find(".app-data-list"),!i.length){f.empty();b.height&&(w=$('<span class="app-data-list-outer"/>').appendTo(f));i=$('<span class="app-data-list" tabindex="0"/>').appendTo(w||f);b.height&&i.css("margin-bottom",-b.height);h=$('<span class="app-hscrollbar2"><span class="app-hscrollbar-handle" data-draggable="hscrollbar"><\/span><\/span>').appendTo(f).find(".app-hscrollbar-handle");i.on("scroll",function(){if(i.data("scrolling")==!1)i.removeData("scrolling");else{uh(i,h,!0);var n=h.data("reveal-timeout"),t=h.parent();t.addClass("app-scrollbar-reveal");clearInterval(n);n=setInterval(function(){t.removeClass("app-scrollbar-reveal");clearInterval(n)},200);h.data("reveal-timeout",n)}})}e&&i.empty();i.removeClass("app-inner-shadow-right app-inner-shadow-left app-inner-shadow-left-right");u.ItemsStyle=="CheckBoxList"&&s&&(v=s.toString().split(r._simpleListRegex));$(g).each(function(n){n%o==0&&(c=$("<ul/>").appendTo(i));var r=this,f=$("<li>").appendTo(c).attr("data-index",n),t=r[1];t==null&&(t=st.EmptyValue);u.HtmlEncode?f.text(t):f.html(t);(v&&v.indexOf((r[0]||"").toString())!=-1||s==r[0])&&f.addClass("app-selected")});p=i.find('[data-index="new"]');l?p.length||((o&&e%o!=0||e<u.Rows)&&e||(c=$("<ul/>").appendTo(i)),$("<li>").appendTo(c).attr("data-index","new").text(ef.GenericNewToolTip)):p.remove();this._scrollItemIntoView(i,!1);e||l&&i.find("li").length==1||i.children().addClass("app-hidden");y&&f.find("li").each(function(){var n=$(this);if(y==n.text())return n.addClass("app-focus"),!1});nt=i.next().show();e?uh(i):nt.hide()}else f.find(".app-data-list").remove(),(u.ItemsStyle=="CheckBoxList"||u.ItemsTargetController)&&s?(a=u.text(s,!1),u.HtmlEncode?f.text(a):f.html(a)):t.methods.text.render(n);t.methods.text._createFooter(n)},focus:function(n){var t=n.find(".app-data-list");return t.length||(t=n.closest(".app-data-list")),t.focus(),this._focusItem(t),this._scrollItemIntoView(t),!1},click:function(i){var r=$(i.target).closest("li"),f,s,u,h,e,o;if(t.cancel()&&!r.parent().is(".app-hidden")&&(dt(),r.length)){if(f=r.closest(".app-data-list"),u=t.elementToField(r),u._dataView._busy()||r.parent().is(".app-hidden"))return;if(r.attr("data-index")=="new"){this._focusItem(r);n.lookup({field:u,create:!0,dataInput:f.closest("[data-input]")});i.preventDefault();return}if(h=u._dataView,e=u.DynamicItems||u.Items,e.length)if(u.ItemsStyle=="CheckBoxList")r.toggleClass("app-selected"),o=[],f.find(".app-selected").each(function(){var n=parseInt($(this).attr("data-index")),t=e[n];o.push((t[0]||"").toString())}),t.execute({dataView:h,values:[{name:u.Name,value:o.join(",")}],redraw:!1});else{if(r.is(".app-selected")){this._focusItem(f);return}f.find(".app-selected").removeClass("app-selected");r.addClass("app-selected");t.methods.listbox._useItemValue(u,e[parseInt(r.attr("data-index"))])}s=w(f);s.height()>f.height()&&f.focus();this._scrollItemIntoView(r);this._focusItem(r);i.preventDefault()}},blur:function(){},_scrollItemIntoView:function(n,t){if(n.is(".app-selected,.app-focus")||(n=n.find(".app-selected,.app-focus").first()),n.length){var r=n.offset(),f=n.outerWidth(),i=n.closest(".app-data-list"),e=i.width(),o=Math.min(f*.2,e*.1),u=i.offset();r.left<u.left?i.data("scrolling",!1).scrollLeft(n.parent().prev().length?i.scrollLeft()+r.left-u.left-o:0):r.left+f>u.left+e&&i.data("scrolling",!1).scrollLeft(i.scrollLeft()+r.left-u.left-(e-f-o));t!=!1&&uh(i,null,!1)}},_focusItem:function(n){if(!o){var t=n.closest(".app-data-list"),i=t.find("li").removeClass("app-focus");n.is("li")||(n=t.find(".app-selected").first());n.length||(n=i.first());n.addClass("app-focus")}},_useItemValue:function(n,i,u){var e=n._dataView,s,f=[{name:n.Name,value:i[0]}],h=n.Copy,c,l=n.Index!=n.AliasIndex,o;if(n.ItemsTargetController)s=e.editRow(),o=s[n.Index]||"",o&&(o+=","),o+=i[0].toString(),f[0].value=o;else if(l&&f.push({name:e._allFields[n.AliasIndex].Name,value:i[1]}),h)for(c=2;copyInfo=r._fieldMapRegex.exec(h);)copyToField=copyInfo[1],copyFromField=copyInfo[2],e.findField(copyToField)&&f.push({name:copyToField,value:copyFromField=="null"?null:i[c++]});u||(t.execute({dataView:e,values:f,redraw:!1}),f.splice(0,l?2:1));f.length&&t.execute({dataView:e,values:f})}}},fieldToPlaceholder:function(n){var t="",i;return n.Watermark?t=n.Watermark:n.ItemsTargetController?t=ef.AddItem:n.ItemsStyle&&n.ItemsStyle!="CheckBox"&&n.ItemsStyle!="CheckBoxList"&&!n.ItemsTargetController?(i=n.DynamicItems||n.Items,t=i&&i.length&&i[0][0]==null?i[0][1]:ef.SelectLink):n.AllowNulls||(t=eu.Required),t},eventToButton:function(n){return this.elementToButton(n.target)},elementToButton:function(n){return $(n).closest("[data-input]").find(".app-data-input-button")},eventToMethod:function(n){return this.elementToMethod(n.target)},elementToMethod:function(n){var i=$(n).closest("[data-input]");return t.methods[i.attr("data-input")]},eventToField:function(n){return this.elementToField($(n.target))},elementToField:function(n){var e=n.closest("[data-field]"),i=e.attr("data-field"),u=n.closest("[data-input-container]"),t,f;if(i&&u.length)return t=r.find(u.attr("data-input-container")),t&&(f=t.findField(i)),f},inputsOf:function(n){return n.find('[data-input]:not([data-input="none"])').filter(io)},peersOf:function(n){var t=n.closest("[data-input-container]"),i,r;return t.length||(t=c),n.data("active",!0),r=t.find('[data-input]:not([data-input="none"])').filter(io).each(function(n){var t=$(this);if(t.data("active"))return i=n,t.removeData("active"),!1}),{list:r,index:i}},eventToDirection:function(n){function u(){return $(t).closest('[data-layout="form"]').length>0}var t=n.target,r,i=n.keyCode||n.which;if(i==9&&(r=n.shiftKey?"left":"right"),i!=37||this.selectionStart!=0||t.selectionEnd!=0||u()||(r="left"),i==39&&t.value&&t.selectionStart==t.value.length&&!u()&&(r="right"),(i!=38||n.ctrlKey)&&(i!=13||!n.shiftKey)||t.tagName=="TEXTAREA"&&t.selectionStart||(r="up"),i==40&&!n.ctrlKey||i==13&&!n.shiftKey){var f=t.tagName=="TEXTAREA",e=t.tagName=="INPUT",o=t.selectionStart,s=t.value;(e||f)&&!e&&(!f||(i!=40||o!=s.length)&&(i!=13||o!=0||t.selectionEnd!=s.length))||(r="down")}return r},blur:function(n){this.move(n)},move:function(n,i,r){function p(i){if(t.valid()){var r=$(i),e=r.attr("data-input"),u=t.methods[e],f=r.find("[data-input-hotspot]");u&&u.focus&&u.focus(f.length?f:r,n)}}var l;n.is("[data-input]")||(n=n.closest("[data-input]"));var v=n.find(".app-data-input"),y=n.closest('[data-layout="form"]').length>0,f=typeof i=="string"?null:i,u;if(dt(),!f&&i){y&&(i=="down"&&(i="right"),i=="up"&&(i="left"));var s=t.peersOf(n),h=n.closest("[data-container]"),a=parseInt(h.attr("data-columns")),c,e;a>1&&(u=t.inputsOf(h),c=u.toArray().indexOf(n[0]));i=="left"?(a>1&&(e=h.prev(),e.is('[data-container="row"][data-columns]')?(u=t.inputsOf(e),u.length&&(f=u[c])):(e=h.nextAll('[data-container="row"][data-columns]').last(),e.length&&(u=t.inputsOf(e),u.length&&(f=u[c-1])))),f||(s.index?f=s.list[s.index-1]:r==9&&(u=t.find(n,"up"),u&&u.length&&(f=u[u.length-1])))):i=="right"?(a>1&&(e=h.next(),e.is('[data-container="row"][data-columns]')?(u=t.inputsOf(e),u.length&&(f=u[c],!f&&c&&(e=h.nextAll('[data-container="row"][data-columns]').last(),e.length&&(u=t.inputsOf(e),l=$(u[c-1]),l.length&&(s=t.peersOf(l),s.index==s.list.length-1?f=n:n=l))))):(e=h.prevAll('[data-container="row"][data-columns]').last(),e.length&&(u=t.inputsOf(e),u.length&&(f=u[c+1])))),f||(s.index<s.list.length-1?f=s.list.get(s.index+1):r==9&&(u=t.find(n,"down"),u&&u.length&&(f=u[0])))):(i=="up"||i=="down")&&(u=t.find(n,i),u&&(f=u[u.length>s.index?s.index:u.length-1]));y&&!f&&(f=n)}o?(v.blur(),f&&p(f)):setTimeout(function(){v.blur();f&&setTimeout(function(){p(f)},10)},10)},find:function(n,t){var i,r,u;return n.is("[data-input-container]")||(n=n.closest("[data-input-container]")),i=n.data("active",!0).parent().find("[data-input-container]"),$(i).each(function(n){var t=$(this);if(t.data("active"))return r=n,t.removeData("active"),!1}),u=t=="up"?r==0?null:$(i.get(r-1)):r<i.length-1?$(i.get(r+1)):null,u?u.find('[data-input]:not([data-input="none"])'):null},popup:function(){var t=this,n=t._popup,i;if(arguments.length==1)if(arguments[0]=="hide")$(n).hide();else return $(n).is(arguments[0]);else return n||(n=t._popup=$('<div class="app-data-input-popup"><\/div>').hide().appendTo(c),i=$("<ul/>").appendTo(n),n.data("ul",i)),n},render:function(n){var i=n.container,e=n.inner,o=n&&n.dataView||r.find(i.closest("[data-input-container]").attr("data-input-container")),u=n.field,s=n.row,f=n.editing,h,c,l,a,v;if(o&&!u){if(i.is("[data-layout]")&&!i.data("prepared"))return;f=f!=null?f:o.extension().editing();i.attr("data-state",f?"write":"read");s||(s=o.extension().commandRow());f?i.find('[data-control="field"]').each(function(){var i=$(this),u=i.data("node"),r,n;u.ready&&(r=i.attr("data-field"),n=o.findField(r),n&&n.Type!="DataView"&&t.render({container:i,dataView:o,field:n,editing:f,row:s}))}):i.find('[data-control="field"]').removeAttr("data-input")}else{if(v=i.data("node"),!v.ready)return;if(!i.is(":visible")){v.dirty=!0;return}u&&(a=f&&i.attr("data-read-only")!="true"&&!u.isReadOnly()&&!u._inputReadOnly,c=(u.ItemsStyle||(u.OnDemand?"blob":"text")).toLowerCase(),i.attr("data-input",a?c:"none"),h=i.attr("data-placeholder"),h&&(u.Watermark=h=="$label"?u.HeaderText:h));l=t.methods[c];l&&(e||(e=i.find(".app-control-inner")),e.length?e.addClass("app-field-data"):e=i,l.render({container:i,inner:e,dataView:o,field:u,row:s,editing:a}))}},createContainer:function(n){var i=n.children(),t=$('<div class="app-data-input-container"><\/div>').appendTo(n);return i.each(function(){var n=this;n.className.match(/\b(app-control-helper)\b/)||(n.style.visibility="hidden")}),this.fitContainer(n,t),t},fitContainer:function(n,t){t||(t=n.find(".app-data-input-container"));var i=n.find(".app-data-input-button"),u=n.is(".app-has-helper"),r=n.find(".app-control-inner"),f=(r.length?r:n)[0].getBoundingClientRect().height;i.length&&(i.css("visibility",""),t.css({height:f,width:u?r.outerWidth():Math.ceil(i.position().left)-v(t,"padding-left")*2+3}))},execute:function(i){var u=i.dataView,o=i.values,y=o.length,c=i.populateDynamicLookups,a,p={},s,e,h,v;typeof u=="string"?u=r.find(u):u||(u=n.pageInfo().dataView);u._ignoreUnsavedChanges=!1;a=i.container||f.activePage.find('[data-input-container="'+u._id+'"]');c!=!1&&$(o).each(function(){var n=this,t=u.findField(n.name||n.Name);t&&u._enumerateContextFieldValues(t,o,p)});v=u.editRow();c!=!1&&$(o).each(function(){var n=this,i=n.name||n.Name,t=u.findField(i);t&&(t.CausesCalculate&&!s&&(s=t),v[t.Index]=n.name?n.value:n.NewValue)});c!=!1&&(e={dataView:u,row:v,fields:[],container:a},t.evaluate(e),e.visibilityChanged&&(clearTimeout(l._visibilityChangeTimeout),l._visibilityChangeTimeout=setTimeout(function(){ki()},10)));e&&e.fields.length?(h=o.slice(),$(h).each(function(){var n=this,i=u.findField(n.name||n.Name),t=e.fields.indexOf(i);t!=-1&&e.splice(t,1)}),$(e.fields).each(function(){h.push({name:this.Name})})):h=o;$(h).each(function(){var n=this,r=n.name||n.Name,f=u.findField(r),e=u.editing(),o=$(a).find('[data-control][data-field="'+r+'"]');o.each(function(){var n=$(this),o=n.attr("data-control"),r;o!="label"&&(r=e&&n.attr("data-read-only")!="true"&&!f.isReadOnly(),n.data("redraw")==!1?n.removeData("redraw"):i.redraw==!1&&r||t.render({container:n,inner:n.find(".app-control-inner"),dataView:u,field:f,row:v,editing:r}))})});s&&i.raiseCalculate!=!1&&u._raiseCalculate(s,s);c!=!1&&y!=o.length&&u._raisePopulateDynamicLookups();hr(a.closest(".app-wrapper"),!0)},evaluate:function(t){var i=t.dataView,f=t.row,u=t.scope,o=t.fields,r=t.container,h,c=[],l=[],b;if($(i._expressions).each(function(){var n=this,e=n.Scope,a,s,v,y="",p;n.Type==1&&(e==5&&(!u||u.readOnly)?(a=i.findField(n.Target),a&&(s=!!i._evaluateJavaScriptExpressions([n],f,!1),v=a._inputReadOnly!=s,a._inputReadOnlyChanged=v,a._inputReadOnly=s,v&&o&&o.indexOf(a)==-1&&o.push(a))):(e==3||e==2||e==7)&&r&&(!u||u.visibility)?(s=!!i._evaluateJavaScriptExpressions([n],f,!1),v=n._visChanged!=s,n._visChanged=s,v&&(t.visibilityChanged=!0,e==3?y="f:":e==2?(y="c:",h=!0):e==7&&(y="v:"),p=r.find('[data-visibility="'+y+n.Target+'"]').css("display",s?"":"none"),s&&$(p).each(function(){var n=$(this).data("node");n&&c.push(n)}))):e==1&&(!u||u.readOnly)&&l.push(n))}),l.length&&r&&bf(i,f,r,l),!t.ignoreFormButtons&&i.isDynamicAction("Custom")&&r.find("[data-action]").each(function(){var t=$(this),r=t.attr("data-action"),n;i.isDynamicAction(r)&&(n=i.findAction(r),n&&(i._clonedRow=f,t.toggleClass("app-disabled",!i._isActionAvailable(n)),i._clonedRow=null))}),h&&i._isWizard&&dr("status"),c.length&&to({controls:$(c)}),h&&nu(),!t.ignoreDynamicButtons&&i.isDynamicAction("Form")){var a=r.closest(".ui-page").find(".app-bar-buttons"),w,e,v=[],y=[],k=[],p=[];a.length&&a.first().find(".ui-btn").each(function(){v.push($(this).attr("data-action-path"))});i._clonedRow=f;i.extension().context(p);$(p).each(function(){var n=this;n.uiScope=="Form"&&y.push(n.path);n.icon&&k.push(n.icon)});v.length?v.join()!=y.join()&&(w=!0,e=!s(i).isModal):(n._toolbarButtons.each(function(){var t=this,n;if(t.style.display!="none"&&(b=!0,n=$(t).data("action-path"),n&&y.indexOf(n)==-1))return e=!0,!1}),b||(e=!0));(w||e)&&n.refreshAppButtons(p,{buttonBars:a,layout:r,toolbar:e,dataView:i});i._clonedRow=null}},value:function(n){var t=$(".app-data-input").first();if(arguments.length)n==null&&(n=""),t.val(n)[0].setSelectionRange(n.length,n.length),t.closest("[data-input]").find(".app-data-input-placeholder").css("display",n?"none":"");else return t.length?t.val():null},valid:function(n){if(arguments.length)this._valid=n!=!1;else return this._valid!=!1},cancel:function(n){return t._canceled=n==!1,ld(),t._canceled=!1,t.valid()},triggerSetValue:function(n,t,i){this.valid(!0);var r=$.Event("setvalue.input.app",{inputValue:t,inputOriginalValue:i,inputElement:n[0],inputValid:!0,inputError:null});return n.trigger(r),r.inputElement=null,this.valid(r.inputValid),r},focus:function(n){var r;if(!tt){n||(n={});var i=n.container||f.activePage.find('[data-layout][data-state="write"]'),u=n.fieldName||i.closest(".ui-page").data("last-focused-field"),e=u?'[data-field="'+u+'"]':"",o=i.find("[data-control]"+e+':not([data-input="none"])');o.each(function(){var u=$(this),s=u.offset(),h=t.methods[u.attr("data-input")],c,f=u.closest('[data-container="tab"]'),o=u.closest('[data-container="wizard"]'),a,l;if(h&&h.focus&&(e||!f.length||f.is(".app-tab-active"))&&(!o.length||dr("visible",{step:o,container:i})))return o.length&&dr("show",{step:o,container:i}),u.closest('[data-container="collapsible"].app-container-collapsed').each(function(){var n=$(this);n.removeClass("app-container-collapsed").find(".app-icon-carat").attr("title",es.Minimize);so($(n.children()[1]),!0)}),f.length&&!f.is(".app-tab-active")&&f.closest('[data-container="tabset"]').first().find(".app-tabs").first().find(".ui-btn").filter(function(){return $(this).text()==f.attr("data-tab-text")}).trigger("vclick"),ru(i).hide(),h.focus(u),r=!0,n.message&&(t.popup("hide"),a=t.elementToField(u),a.ItemsStyle=="Lookup"&&(l=t.elementToButton(u),l.addClass("app-caret-r"),l.removeClass("app-caret-u app-caret-d")),c=u.find(".app-data-input,.app-data-list"),c.length&&(s=c.offset(),setTimeout(function(){vv(s.left+1,s.top+u.outerHeight(),n.message,null,!0)}))),!1})}return r},focusCopyMaster:function(n){var i,r=new RegExp("\\b"+n.Name+"\\s*=\\s*.+\\b");$(n._dataView._fields).each(function(){var n=this,t=n.Copy;if(t&&r.exec(t))return i=n.Name,!1});i&&t.focus({fieldName:i})},canCreateItems:function(n,t){t||(t=n._dataView.editRow());var i=!!n.ItemsNewDataView,f=n.ContextFields,u,e;if(i&&f)while(e=r._fieldMapRegex.exec(f))u=n._dataView.findField(e[2]),u&&t[u.Index]==null&&(i=!1);return i}};$(document).on("getvalue.input.app",function(n){var i=t.eventToField(n),e=t.eventToMethod(n),u,f,o,r,s;i&&(f=i._dataView,u=f._allFields[i.AliasIndex],i.Index==u.AliasIndex||i.ItemsStyle||(u=i),s=f.editRow(),r=s[i.Index],i.ItemsTargetController?r=null:i.ItemsStyle&&i.ItemsStyle!="Lookup"&&i.ItemsStyle!="AutoComplete"&&(o=f._findItemByValue(i,r),o&&(r=o[1])),n.inputValue=r!=null?i.format(r):"",n.inputValueRaw=r,n.inputDataType=i.Type,u.Len&&(n.inputMaxLength=u.Len),i.Index!=u.Index&&(r=s[u.Index],n.inputAltValue=r!=null?u.format(r):""),i.ItemsStyle||(n.inputRows=i.Rows),n.inputIsPassword=i.TextMode==1,n.placeholder=t.fieldToPlaceholder(i),e&&e.setup&&e.setup(n))}).on("setvalue.input.app",function(n){var i=t.eventToField(n),u,s,h=$(n.target),c=h.closest("[data-field]"),r=n.inputValue,e,o,f;!i||i.isReadOnly()||i.ItemsStyle||i.OnDemand||(u=i._dataView,s=i.Name,o=u.editRow(),o&&(String.isBlank(r)?r=null:(e={NewValue:r},f=u._validateFieldValueFormat(i,e,!0),f||(r=e.NewValue)),f?(n.inputError=f,n.inputValid=!1):(i.Index!=i.AliasIndex&&(i.AliasIndex=i.Index),t.execute({dataView:u,values:[{name:i.Name,value:r}]}))))}).on("vclick",'[data-control="action"]',function(n){var u=$(n.target),f=u.closest("[data-control]"),e=f.closest("[data-input-container]"),i=r.find(e.attr("data-input-container")),t;if(i)return dt(),t=i.findAction(f.attr("data-action")),t&&i._isActionAvailable(t)&&k(u.closest(".app-action-column-button"),function(){var n=i.extension();n.command(n.commandRow(),t.CommandName,t.CommandArgument,t.CausesValidation,t.Path)}),!1}).on("vclick",'[data-control="label"]',function(){var i=$(this),e=i.closest("[data-input-container]"),s=r.find(e.attr("data-input-container")),h=i.attr("data-field"),c,n,l,a,u,f;return s&&(o||!lw())&&(f=s.findField(h),f&&(i.data("active",!0),e.find("[data-control]").each(function(){var t=$(this),i=t.attr("data-control"),r=t.attr("data-field");if(i=="label")t.data("active")&&(l=!0);else if(r==h)if(l){if(n)return!1;n=t}else c=t}),i.removeData("active"),n||(n=c),n&&(a=n.attr("data-input"),u=t.methods[a],u&&(u.focus?u.focus(n,i):t.focusCopyMaster(f))))),!1}).on("vclick mousedown","[data-input]",function(n){var i,r;if(!$(n.target).closest(".app-data-input-button").length){if(n.type=="mousedown"&&n.which!=3)return;if($(this).find(".app-data-input").length&&!$(n.target).closest(".app-control-helper").length)return}if(!wt&&(i=t.eventToMethod(n),i)){if(i.click&&i.click(n),n.isDefaultPrevented())return!1;i.focus?i.focus($(n.target))&&(n.preventDefault(),n.type=="mousedown"&&$(this).find(".app-data-input-placeholder").css("display","none")):n.type=="vclick"&&(o||!lw())&&(r=t.eventToField(n),t.focus({fieldName:r.Name})||t.focusCopyMaster(r))}}).on("blur",".app-data-input",function(n){function v(n,t){clearTimeout(l._focusTextInputTimeout);l._focusTextInputTimeout=setTimeout(function(){i.focus();n&&(i.attr("title",n),vv(i.offset().left+1,i.offset().top+i.outerHeight()+1,n,null,!0));t&&t(r)},10)}function w(){o&&(clearTimeout(l.textInputScrollTimeout),clearTimeout(l.textInputStubTimeout),l.textInputStubTimeout=setTimeout(function(){var i=$(".app-text-input-stub"),n=kf(i),t;n.length&&(t=n.data("original-top"),t!=null&&n.removeData("original-top").css("top",t));i.remove()},200))}function e(n){t.valid(!0);var u=$.Event("remove.input.app",{input:i});$(i).trigger(u);setTimeout(function(){i.attr("title")&&dt();i.remove();r.find(".app-data-input-focus").remove();a.remove().empty();r.find(".app-control-helper .app-focus").length||r.removeClass("app-has-focus");y.contents().css("visibility","");n&&n(r);$(".cloud-grid-focus").removeClass("cloud-grid-focus")},10);w()}function s(n){var t,n=n.split(/,/);return n.length==1?t=p.closest(n[0]).is(i.closest(n[0])):$(n).each(function(){return t=s(this),t?!1:void 0}),t}var i=$(n.target),f=t.eventToMethod(n),r=i.closest("[data-input]"),h=i.data("original"),c=i.val().trim(),a=i.parent(),y=a.parent(),p=$(n.relatedTarget),u;if(t._canceled){clearTimeout(l._focusTextInputTimeout);e();return}if(s(".app-data-input-popup,.app-data-input-helper,.app-data-input-button"))return!1;if(i.data("keepFocus"))return i.removeData("keepFocus"),!1;(f&&f.blur&&f.blur(n),n.isDefaultPrevented())||(s(".app-data-input-container,.app-data-input-placeholder")?(n.preventDefault(),v()):c==h?e():(u=t.triggerSetValue(i,c,h),u.inputValid?e(u.inputValidCallback):(n.preventDefault(),v(u.inputError,u.inputErrorCallback))))}).on("keydown",function(i){var r=event.keyCode||event.which,u,e,s;if(r==27){if(y||yt){$(document).trigger($.Event("dragcancel.app",{drag:yt||y}));event.preventDefault();return}if(!n.busy()&&!t.popup(":visible")){if(u=$(".app-calendar-plugin-container"),u.length&&u.is(":visible"))return n.CalendarInput("escape"),!1;if(vf(!1))return i.preventDefault(),!1;if(f.activePage.is(".app-page-modal"))return setTimeout(li),i.preventDefault(),!1}}return r==70&&(i.ctrlKey||i.metaKey)?(fr("enumerate"),!1):!o&&cc(i)?void 0:r==121?(event.preventDefault(),e=i.shiftKey,s=e?n._contextButton:n._menuButton,(e||s.is(".ui-icon-bars")&&!f.activePage.is(".app-page-modal"))&&setTimeout(function(){wt=!1;s.trigger("vclick")}),!1):void 0}).on("keydown",".app-data-input",function(n){var ht,nt,tt,b,c,it,rt,l,a,h,ut;if(cc(n))return!1;var e=this,v=n.ctrlKey||n.metaKey,ft=n.altKey,i=n.keyCode||n.which,p,et,f=$(n.target),s=f.closest("[data-input]"),k,lt=f.closest('[data-layout="form"]').length>0,d,u,w,h,r,g,o;if(!v&&(i==38||i==8)){var ot=$(e).closest("[data-input]").find(".app-control-before"),st=ot.find("li"),y=ot.find(".app-focus"),at=y,ct;if(st.length&&!y.length&&!e.value&&!t.popup(":visible"))return y=st.last(),i==38&&(ct=y.offset(),st.each(function(){var n=$(this),t=n.offset();if(t.top==ct.top)return y=n,!1})),y.addClass("app-focus"),setTimeout(function(){ot.focus().addClass("app-has-focus")}),!1}if(i==27){if(t.popup(":visible"))return t.popup("hide"),!1;if(w=f.data("change"),p=f.data("original"),et=f.val()!=p,!et&&(ht=s.closest(".app-page-modal"),ht.length&&!t.popup(":visible"))){ht.data("last-focused-field",s.attr("data-field"));return}return n.stopPropagation(),n.preventDefault(),w?(f.val(p),p||s.data("autoComplete",!1),t.move(s,t.popup(":visible")?s.data("autoComplete",!1):null)):(nt=$.Event("cancel.input.app",{inputElement:f}),s.trigger(nt),nt.inputElement=null,nt.isDefaultPrevented()||(et?(dt(),f.val(p).select()):(t.blur(s),cr()))),!1}if((i==13&&!v||i==9)&&t.popup(":visible"))if(r=t.popup().find(".app-selected"),h=t.elementToField(f),r.length){if(i==9&&h.ItemsTargetController&&(i=13),(!r.is("[data-command]")||i==13)&&(r.trigger("vclick",{feedback:!1}),i==13))return!1}else if(i==13&&h.AllowAutoComplete!=!1&&(f.data("original")||!!f.val()))return t.methods.lookup._createItemFromText(h,f.closest("[data-input]"),f.val()),!1;if((i==13&&v||i==39&&e.selectionStart==e.selectionEnd&&(!e.value||e.value.length==e.selectionEnd))&&(tt=t.eventToButton(n),tt.length&&t.elementToField(tt).ItemsStyle=="Lookup"&&tt.is(":visible")&&(k=t.eventToMethod(n),k&&k.clickButton)))return t.popup(":visible")||(t.blur(s),n.stopPropagation(),n.preventDefault(),k.clickButton(n)),!1;if(v&&i==13)return t.blur(s),n.preventDefault(),!1;if(!ft&&(i==38||i==40)&&(h=t.eventToField(n),b=h.DynamicItems||h.Items,c=-1,h.ItemsStyle=="DropDownList"&&!t.popup(":visible")&&!h.ItemsTargetController))return $(b).each(function(n){if(this[1]==e.value)return c=n,!1}),c!=-1?(i==38&&c>(!h.AllowNulls&&b[0][0]==null?1:0)&&c--,i==40&&c<b.length-1&&c++):c=0,it=b[c],it&&($(e).data("last",it[1]),setTimeout(function(){t.methods.lookup._useItemValue(h,it,!0)})),n.preventDefault(),!1;if(d=t.eventToDirection(n),i==32&&!(v||n.shiftKey||ft)&&!e.value.trim())return!1;if(i==40&&ft||i==32&&v){if(w=f.data("change"),w)return t.popup(":visible")||(n.stopPropagation(),n.preventDefault(),setTimeout(function(){w({input:f,value:f.val(),lastValue:f.data("last")})})),!1;if(rt=$.Event("help.input.app",{inputElement:f}),s.trigger(rt),rt.inputElement=null,rt.isDefaultPrevented()||i==32)return!1}if((i==8||i==46)&&e.selectionStart>0&&e.selectionStart<e.selectionEnd&&t.popup(":visible")&&f.data("autoComplete",!1),(i==33||i==34)&&t.popup(":visible")){if(u=t.popup(),r=u.find(".app-selected"),r.length){for(o=r.removeClass("app-selected"),u.scrollTop(u.scrollTop()+(i==33?-1:1)*u.height());o.length;){if(i==33){if(o.offset().top<u.offset().top)break}else if(o.offset().top+o.outerHeight()-1>u.offset().top+u.height())break;o.is(".app-instruction")||(r=o);o=i==33?o.prev():o.next()}r.addClass("app-selected")}else r=u.find("li:not(.app-instruction)").first().addClass("app-selected");return!1}if((i==38||i==40)&&!(n.ctrlKey||n.shiftKey||n.altKey)&&t.popup(":visible")){if(n.preventDefault,n.stopPropagation(),u=t.popup(),r=u.find(".app-selected").removeClass("app-selected"),g=u.find("li:not(.app-instruction)"),r.length)for(o=r;o.length;){if(o=i==38?o.prev():o.next(),o.length&&!o.is(".app-instruction")){r=o;break}o.length||g.filter(":not([data-command])").length||(r=[])}else r=i==38?g.last():g.first();if(r.length)return r.addClass("app-selected"),i==38&&r.prev().is(".app-instruction")&&(r=r.prev()),i==40&&r.next().is(".app-instruction")&&(r=r.next()),l=r.offset(),a=u.offset(),i==38?l.top<a.top?u.scrollTop(l.top-a.top+u.scrollTop()-1):l.top>=a.top+u.height()&&u.scrollTop(l.top-a.top+u.scrollTop()-(u.height()-r.outerHeight())-1):i==40&&(l.top+r.outerHeight()>=a.top+u.height()?u.scrollTop(l.top-a.top+u.scrollTop()-(u.height()-r.outerHeight())-1):l.top<a.top&&u.scrollTop(l.top-a.top+u.scrollTop()-1)),!1}if(d&&s.is('[data-input-tab-stop="false"]'))return(i==13||i==9)&&(t.blur(s),n.stopPropagation(),n.preventDefault()),!1;if(d){if(lt&&i==13){if(!t.popup(":visible")&&(h=t.elementToField(f),ut=f.val(),ut&&ut!=f.data("original")))return t.methods.lookup._createItemFromText(h,f.closest("[data-input]"),ut),!1;n.stopPropagation()}return setTimeout(function(){t.move(s,d,i)}),n.preventDefault(),!1}if(i==113){selectionStart=e.selectionStart;selectionEnd=e.selectionEnd;selectionStart==0&&selectionEnd==e.value.length?e.selectionStart=selectionEnd:(e.selectionStart=0,e.selectionEnd=this.value.length);n.preventDefault();return}}).on("keyup",".app-data-input",function(n){var c=this,f=n.keyCode||n.which,i=$(c),u=i.data("placeholder"),e,s=i.data("change"),o,r=i.val(),h=r.trim();(h||(r=h),f!=38&&f!=40&&f!=13)&&(u&&(e=r?"none":"",u=u[0],u.style.display!=e&&(u.style.display=e)),s&&(o=i.data("last"),r!=o&&(i.data("last",r),setTimeout(function(){s({input:i,value:r,lastValue:o,keyCode:f});e||t.fitContainer(i.closest("[data-input]"),i.closest(".app-data-input-container").width(""))}),n.preventDefault())))}).on("cut paste",".app-data-input",function(){var n=$(this);setTimeout(function(){n.trigger("keyup")})}).on("contextmenu",".app-data-input",function(){$(this).data("keepFocus",!0)}).on("mousedown contextmenu",".app-data-input-placeholder",function(){$(this).css("display","none")}).on("vclick mousedown",".app-data-input-popup",function(i){function l(){if(o)if(s=t.elementToMethod(u),o=="SeeAll")i.target=u,setTimeout(function(){t.popup("hide");s&&s.clickButton&&s.clickButton(i,!1)},ti);else if(o=="Clear")setTimeout(function(){u.blur();t.methods.lookup._clearValue(e);setTimeout(function(){t.methods.lookup.focus(c)},100)},ti);else if(o=="New"){var l=u.val();u.blur();n.lookup({field:e,create:!0,dataInput:c,value:l})}else o=="ShowOptions"&&setTimeout(function(){e._doSearch=!0;t.methods.lookup._showList({field:e,value:null,input:u})},ti);else t.popup("hide"),h&&e&&(u.removeData("restoreText"),t.methods.lookup._buttonUp(u),r.input.methods.lookup._useItemValue(e,h[parseInt(f.attr("data-index"))]))}var f=$(i.target).closest("li"),o=f.attr("data-command"),h=t.popup().data("list"),u=$(".app-data-input"),c=u.closest("[data-input]"),e=t.elementToField(u),s;return f.length&&!f.is(".app-instruction")&&(f.parent().find(".app-selected").removeClass("app-selected"),f.addClass("app-selected"),u.focus(),arguments.length!=2||arguments[1].feedback?setTimeout(l,ti):l()),!1}).on("keydown",".app-checkbox-container",function(n){if(!cc(n)){var r=n.keyCode||n.which,i=$(this),u;return u=r==32||r==39&&!i.is(".app-checkbox-on")||r==37&&i.is(".app-checkbox-on")?"toggle":t.eventToDirection(n),u?(u=="toggle"?t.elementToMethod(i)._toggleState(i):t.move(i,u,r),!1):void 0}}).on("keydown",".app-data-list",function(n){var f=n.keyCode||n.which,e=$(this),i,u,r;return(f==32?i="vclick":f==8||f==46?i="clear":n.ctrlKey||(f==38?i="up":f==40?i="down":f==37?i="left":f==39?i="right":f==36?i="home":f==35&&(i="end")),i)?(u=e.find(".app-focus"),u.length?i=="up"?(r=u.prev(),r.length||(r=u.parent().prev().find("li").last())):i=="down"?(r=u.next(),r.length||(r=u.parent().next().find("li").first())):i=="right"?(r=u.parent().next().find(":eq("+u.index()+")"),r.length||(r=u.parent().next().find("li").last())):i=="left"?r=u.parent().prev().find(":eq("+u.index()+")"):i=="home"?r=e.find("ul").first().find("li").first():i=="end"?r=e.find("ul").last().find("li").last():i=="vclick"?(r=null,u.trigger("vclick")):i!="clear"||e.closest("[data-control]").is('[data-input="checkboxlist"]')||(r=null,e.find("ul").first().find("li").first().trigger("vclick")):t.methods.listbox._scrollItemIntoView(e.find(".app-selected").first().addClass("app-focus")),r&&r.length&&(t.methods.listbox._focusItem(r),t.methods.listbox._scrollItemIntoView(r)),!1):(i=t.eventToDirection(n),i)?(t.move(e,i,f),!1):void 0}).on("keydown",".app-control-helper",function(n){var c=$(this),r=n.keyCode||n.which,s=c.find("li"),i=c.find(".app-focus"),l=i,o;if(s.length&&i.length){if(o=i.offset(),r==32||r==40&&(n.ctrlKey||n.metaKey))return i.trigger("vclick"),!1;if(r==46||r==8)return t.methods.lookup._removeBasketItem(i,r!=8),!1;if(r==9||r==13||r==27)return setTimeout(function(){var u=i.closest("[data-input]");n.shiftKey&&r!=27?t.move(u,"up",r):(c.data("focus",!1),t.methods.lookup.focus(u))}),!1;if(r==36)i=s.first();else if(r==35)i=s.last();else if(r==38){var f=o.left,u=f+i.outerWidth()-1,e=0,h=o.top-1;$(s.get().reverse()).each(function(){var o=$(this),r=o.offset(),n=r.left,t=n+o.outerWidth()-1,s;if(e==0&&r.top<h||e>0&&r.top==h)t<f||n>u||(s=n>=f&&t<=u?t-n+1:n<f&&t<=u?t-f+1:n<u&&t>=u?u-n+1:u-f+1,s>e&&(i=o,e=s,h=r.top));else if(e)return!1})}else if(r==40){var f=o.left,u=f+i.outerWidth()-1,e=0,h=o.top+1;s.each(function(){var o=$(this),r=o.offset(),n=r.left,t=n+o.outerWidth()-1,s;if(e==0&&r.top>h||e>0&&r.top==h)t<f||n>u||(s=n>=f&&t<=u?t-n+1:n<f&&t<=u?t-f+1:n<u&&t>=u?u-n+1:u-f+1,s>e&&(i=o,e=s,h=r.top));else if(e)return!1})}else if(r==39||r==37)s.each(function(){var t=$(this),n=t.offset();if(r==39&&n.top==o.top&&n.left>o.left)return i=t,!1;r==37&&n.top==o.top&&n.left<o.left&&(i=t)});else return;if(i==l){if(r==39&&i.next().length&&(i=i.next()),r==37&&i.prev().length&&(i=i.prev()),r==38)return setTimeout(function(){t.move(i.closest("[data-input]"),"up",9)}),!1;if(r==40)return setTimeout(function(){c.data("focus",!1);t.methods.lookup.focus(i.closest("[data-input]"))}),!1}return s.removeClass("app-focus"),i.addClass("app-focus"),!1}}).on("blur",".app-data-list,.app-control-helper,.app-checkbox-container,.app-drop-box",function(){var n=$(this);n.find(".app-focus").removeClass("app-focus")}).on("keydown",".ui-panel-inner",function(n){var u=n.keyCode||n.which,e=$(this),f,s=e.offset(),t,i,r,o;if(u==37?t="left":u==39?t="right":u==40?t="down":u==38?t="up":u==36?t="home":u==35?t="end":(u==13||u==32)&&(t="select"),u==9&&e.closest(".app-sidebar").length)return cr(),w().find(".app-selected").addClass("ui-btn-active"),!1;if(t){if(e.find("ul").each(function(){var n=$(this),t=n.offset();if(t.left>=s.left&&t.left<s.left+10)return f=n,!1}),!f)return!1;if(r=f.find(".ui-btn").filter(function(){return!$(this).parent().is(".ui-disabled")}),i=f.find(".app-focus"),i.length&&(t=="right"&&(t=i.find(".material-icon-chevron-right").length?"select":"down"),t=="left"&&(t=i.find(".material-icon-chevron-left").length?"select":"up"),t=="select")){if(i.length)return(o=i.data("data-context")||i.data("context-action"),u==32&&(!o||!o.keepOpen))?!1:(wt=!1,i.trigger("vclick"),!1);t="down"}i.length?t=="down"?$(r).each(function(n){if(i.is(this))return i=$(r.get(n<r.length-1?n+1:0)),!1}):t=="up"?$(r).each(function(n){if(i.is(this))return i=$(r.get(n>0?n-1:r.length-1)),!1}):t=="home"?i=r.first():t=="end"&&(i=r.last()):(i=r.first(),(t=="up"||t=="end")&&(i=r.last()),i.addClass("app-focus"));f.find(".ui-btn-active, .app-focus").removeClass("ui-btn-active app-focus");i.addClass("app-focus ui-btn-active");nb(i,e);event.preventDefault()}}).on("keydown",".app-drop-box",function(n){var i=n.keyCode||n.which,r=$(this),t;return i==32?t="vclick":(i==8||i==46)&&(t="clear"),t?(t=="vclick"?r.trigger(t):t=="clear"&&r.parent().find(".app-clear").trigger("vclick"),!1):void 0}).on("keydown",".app-wrapper",function(t){var rt=t.keyCode||t.which,l,w,nt,e,o,b,a,c,tt,i,y,k,d,u;switch(rt){case 35:i="end";break;case 36:i="home";break;case 39:i="right";break;case 40:i="down";break;case 37:i="left";break;case 38:i="up";break;case 13:if($(t.target).is("textarea"))return;i="enter";break;case 9:n._menuButton.is(".ui-icon-bars")&&!f.activePage.is(".app-page-modal")&&(i="tab")}if(i&&$(".ui-panel-dismiss:visible,.app-popup").length)return t.preventDefault(),!1;if(i&&!t.ctrlKey&&!$(t.target).is(":input")){if(l=$(this),e=l.children(".app-listview"),i=="tab"&&h.left.visible)return lt(!0),lt(!1,0),e.find(".ui-btn-active").removeClass("ui-btn-active"),h.left.inner.focus().find(".ui-btn").first().addClass("app-focus ui-btn-active"),!1;if(e.length&&e.is(":visible")){if(i.match(/left|right|home|end/)&&e.is(".app-grid")){c=n.dataView();var g=c.session("grid-avail-width"),it=e.find(".dv-item").first(),p=it.length&&Math.ceil(g-g*(it.width()/g)),r=c.session("scroll-left")||0,v;p&&(i=="right"&&r<p?(r=Math.min(r+32,p),v=!0):i=="left"&&r>0?(r=Math.max(r-32,0),v=!0):i=="home"?(r=0,v=!0):i=="end"&&(r=p,v=!0));v&&(c.session("scroll-left",r),bu(c,-r));t.preventDefault();return}o=e.find(".dv-item .app-selected");o.length||(o=e.find(".dv-item").first().find("a"),i="none");o.length&&(u=o.parent(),c=n.dataView(),tt=c.extension(),i=="right"?i="down":i=="left"&&(i="up"),i=="down"?u=u.next():i=="up"&&(u=u.prev()),o=u.find("a"),b=o.data("data-context"),b&&!u.is(".dv-load-at-top-parent,.dv-load-at-bottom-parent,.app-calculated")&&(e.find(".ui-btn.app-selected").removeClass("app-selected ui-btn-active"),pf(c,o),tt.tap(b,i=="enter"?null:"none"),s(c).echoChanged=!0,o.addClass("app-selected ui-btn-active"),i.match(/up|down/)&&(a=u.offset(),w=l.offset(),headerBar=l.data("sticky-header"),nt=headerBar.offset(),k=Math.max(w.top,nt.top+headerBar.outerHeight()),d=w.top+l.height()-1,a.top<k?y=a.top-k:a.top+u.outerHeight()>d&&(y=a.top+u.outerHeight()-d)),t.preventDefault(),y&&setTimeout(function(){l.scrollTop(l.scrollTop()+y)},10)))}}}).on("mousedown",".app-hscrollbar2",function(n){if(!o){var i=$(this),t;$(n.target).is(".app-hscrollbar-handle")||(t=i.prev(),t.attr("class").match(/-outer/)&&(t=t.children().first()),t.scrollLeft(t.scrollLeft()+(n.pageX<i.find(".app-hscrollbar-handle").offset().left?-1:1)*hu(t)))}}).on("mousedown",".app-vscrollbar",function(n){if(!o){var i=$(this),t;$(n.target).is(".app-vscrollbar-handle")||(t=i.prev(),t.attr("class").match(/-outer/)&&(t=t.children().first()),t.scrollTop(t.scrollTop()+(n.pageY<i.find(".app-vscrollbar-handle").offset().top?-1:1)*t.height()))}}).on("transitionend",".app-hidden",function(){var t=$(this).parent(),i,n;t.is(".app-data-list")&&(n=t.find('[data-index="new"]'),n.length&&(i=t.data("revealTimeout"),clearTimeout(i),t.data("revealTimeout",setTimeout(function(){n.parent().prevAll().remove();n.prevAll().remove();n.parent().removeClass("app-hidden")},50))))}).on("vclick",'[data-container="toggle"]',function(){var n=$(this),t;return n.addClass("ui-btn-active"),setTimeout(function(){n.removeClass("ui-btn-active");setTimeout(function(){t=n.parent().toggleClass("app-container-collapsed").is(".app-container-collapsed");n.parent().find('[data-control="dataview"]').each(function(){var i=$(this).attr("id"),r=n.closest(".app-wrapper").find("#"+i.substring(0,i.length-3)+"_echo");r.css("display",t?"none":"")});t||to({controls:n.closest('[data-container="collapsible"]').data("node").children});ki()})},ti),gr(),dt(),!1}).on("vclick",".app-field-object-ref",function(){var t=$(this),f=t.closest("[data-control]"),e=t.closest("[data-input-container]"),i,u;return i=r.find(e.attr("data-input-container")),i&&(u=i.findField(f.attr("data-field")),u&&k(t,function(){n.details({field:u})})),!1}).on("vclick",".app-echo-see-all",function(){var t=$(this).addClass("ui-btn-active");return setTimeout(function(){t.removeClass("ui-btn-active");n.changePage(t.closest(".app-echo").attr("data-for"))},ti),!1}).on("vclick",".app-echo-toolbar a",function(t){var i=$(t.target),r=i.closest(".app-echo").attr("data-for");return tu(i)&&!n.busy()&&k(i,function(){i.is(".ui-icon-dots")&&n.showContextMenu({scope:r,position:kf(i).is(".app-page-panel")?"right":null})}),!1}).on("vclick",".app-sidebar ul",function(t){if(of||!tu(t.target))return!1;var i=$(t.target).closest("a"),r=i.data("context-action");if(i.length){if(r)return n.busy()||k(i,function(){wi(r,i)}),!1;kt(i,!1)}}).on("vclick",".app-bar-buttons",function(n){var t=ai(n.clientX);$(this).find(".ui-btn").each(function(){var n=$(this),i=n.offset();if(n.is(":visible")&&t>=i.left-8&&t<=i.left+n.outerWidth()+8)return setTimeout(function(){n.trigger("vclick")}),!1})}).on("vclick",".app-page-modal-title",function(t){var r,u=ai(t.clientX);return $(this).find(".app-btn").each(function(){var n=$(this),t=n.offset();if(n.is(":visible")&&u>=t.left-8&&u<=t.left+n.outerWidth()+8){r=n;return}}),r&&k(r,function(){if(r.is(".ui-icon-dots"))n.showContextMenu({scope:""});else if(r.is(".app-btn-search"))fr();else if(r.is(".app-btn-close"))li();else if(r.is(".app-btn-fullscreen")){var t=!r.is(".app-btn-fullscreen-exit");r.removeData("title").toggleClass("app-btn-fullscreen-exit",t).attr("title",i[(t?"Exit":"")+"Fullscreen"]).closest(".ui-page").toggleClass("app-page-modal-fullscreen",t);ki(!0)}}),!1}).on("vclick",".app-btn-menu",art).on("vclick",".app-back-text",function(){return n._menuButton.trigger("vclick"),!1}).on("vclick",".app-bar-toolbar",en).on("vclick",".StatusBar .Segment",function(){var n=$(this).text();return setTimeout(function(){dr("select",{text:n})}),!1}).on("vclick",".app-page-modal-glass-pane-partial",function(){return setTimeout(li),!1}).on("vclick",".app-page-modal-glass-pane,.app-page-modal-background",function(){var t=n.pageInfo(),i;t.dataView&&t.dataView.tagged("modal-tap-out")?li():(i=f.activePage.toggleClass("app-page-modal-centered"),setTimeout(function(){i.toggleClass("app-page-modal-centered")},100))}).on("touchmove pointermove",".app-page-modal-glass-pane,.app-page-modal-background",function(n){return n.preventDefault(),!1}).on("vclick",".app-sidebar .app-bar-toolbar-bottom .ui-btn",function(n){var t=$(n.target).closest(".ui-btn");return t.is(".app-selected")||(t.is(".app-btn-page")&&t.closest(".app-bar-toolbar-bottom").find(".ui-btn").removeClass("app-selected"),k(t,function(){var n=t.data("context");n?(t.addClass("app-selected"),wo(n)):t.is(".app-btn-apps")?ev():t.is(".app-btn-settings")&&po("left")})),!1}).on("focusout",".app-sidebar .ui-panel-inner",function(){$(this).find(".app-focus").removeClass("app-focus ui-btn-active")}).on("keyup",".app-bar-search input",function(){var n=$(this);n.closest(".app-bar-search").toggleClass("app-null",!n.val())}).on("vclick",".app-bar-search",function(){var f=$(this),i,u;return $(this).find(".app-icon").each(function(){var n=$(this),t=ai(),r=n.offset();if(r.left<=t&&t<r.left+n.outerWidth())return i=n,!1}),i?(u=n.contextDataView(),k(i,function(){i.is(".material-icon-cancel")?(i.closest(".app-bar-search").addClass("app-null"),t.execute({values:{name:"QuickFind",value:""}}),t.focus()):i.is(".material-icon-search")?r.action({path:"form/submit"}):i.is(".material-icon-more")&&fr("toggle",u.survey().context.id)}),!1):void 0});Sys.Application.add_init(function(){g=__settings});Sys.Application.add_load(function(){n._appLoaded=!0;$.mobile.initializePage()});Web.DataView.MobileGrid.registerClass("Web.DataView.MobileGrid",Web.DataView.MobileBase);Web.DataView.MobileForm.registerClass("Web.DataView.MobileForm",Web.DataView.MobileBase)})();